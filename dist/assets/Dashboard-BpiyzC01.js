import{r as g,j as e}from"./react-core-BwkdTuSg.js";import{u as pe,a as ue,s,g as he,B as be,f as xe,b as d}from"./index-McppjVnx.js";import{M as U}from"./MetricCard-DnMFhTGK.js";import{U as R,S as c}from"./UnifiedCard-DueRFcqn.js";import{k as fe}from"./vendor-D410aui4.js";import{calculatePendingDeposits as _e}from"./settlementCalculator-U6Ra3Zw5.js";import{V as ve,U as ye,A as we,a8 as F,a9 as W,T as A,j as J,aa as L,ab as Q,S as ee}from"./lucide-icons-CePlpqHy.js";import"./radix-ui-omyR4zpf.js";import"./supabase-C8Oa5ukG.js";function Le({user:l}){const{balance:q,investBalance:je,oroplayBalance:Ne}=pe(),{t:o}=ue(),[w,H]=g.useState({total_users:0,total_balance:0,daily_deposit:0,daily_withdrawal:0,daily_net_deposit:0,casino_betting:0,slot_betting:0,total_betting:0,online_users:0,pending_approvals:0,pending_messages:0,pending_deposits:0,pending_withdrawals:0}),[v,te]=g.useState({deposit:0,withdrawal:0,netDeposit:0,casinoBetting:0,slotBetting:0,totalBetting:0}),[y,ae]=g.useState({deposit:0,withdrawal:0,netDeposit:0,casinoBetting:0,slotBetting:0,totalBetting:0}),[oe,se]=g.useState(0),[Ce,K]=g.useState(!0),[ne,re]=g.useState(new Date);if(g.useEffect(()=>{H(i=>({...i,total_balance:q}))},[q]),!l||typeof l.level!="number")return e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("div",{className:"loading-premium mx-auto"}),e.jsx("p",{className:"text-muted-foreground",children:o.dashboard.loadingDashboard})]})});const j=async()=>{try{K(!0),console.log("============================================"),console.log("ðŸ“Š ëŒ€ì‹œë³´ë“œ í†µê³„ ì¡°íšŒ ì‹œìž‘"),console.log("Partner ID:",l.id),console.log("Partner Level:",l.level),console.log("Partner Type:",l.partner_type),console.log("============================================");const i=new Date;i.setHours(0,0,0,0),console.log("ðŸ” ì§ì ‘ DB ì¡°íšŒ ì‹œìž‘...");const{data:h,error:V}=await s.from("transactions").select("transaction_type, status, amount, created_at").gte("created_at",i.toISOString());if(console.log("ðŸ“Š ì˜¤ëŠ˜ transactions:",h?.length||0,"ê±´"),h&&h.length>0){console.log("ìƒì„¸:",h);const a=h.filter(t=>t.transaction_type==="deposit"&&["approved","completed"].includes(t.status)||t.transaction_type==="admin_adjustment"&&t.amount>0&&["approved","completed"].includes(t.status)).reduce((t,r)=>t+Number(r.amount),0),n=h.filter(t=>t.transaction_type==="withdrawal"&&["approved","completed"].includes(t.status)||t.transaction_type==="admin_adjustment"&&t.amount<0&&["approved","completed"].includes(t.status)).reduce((t,r)=>t+Math.abs(Number(r.amount)),0);console.log("ðŸ’° ì§ì ‘ ê³„ì‚° ìž…ê¸ˆ:",a),console.log("ðŸ’¸ ì§ì ‘ ê³„ì‚° ì¶œê¸ˆ:",n)}const{data:b,error:x}=await s.from("game_records").select("provider_id, bet_amount, played_at").gte("played_at",i.toISOString());if(console.log("ðŸŽ® ì˜¤ëŠ˜ game_records:",b?.length||0,"ê±´"),b&&b.length>0){console.log("ìƒì„¸:",b);const a=[410,77,2,30,78,86,11,28,89,91,44,85,0],n=b.filter(r=>a.includes(Number(r.provider_id))).reduce((r,_)=>r+Number(_.bet_amount),0),t=b.filter(r=>!a.includes(Number(r.provider_id))).reduce((r,_)=>r+Number(_.bet_amount),0);console.log("ðŸŽ° ì§ì ‘ ê³„ì‚° ì¹´ì§€ë…¸:",n),console.log("ðŸŽ² ì§ì ‘ ê³„ì‚° ìŠ¬ë¡¯:",t)}console.log(""),console.log("ðŸ”§ ì§ì ‘ SELECT ì¿¼ë¦¬ ì‹œìž‘ (RPC ì œê±°)...");const B=new Date,f=new Date(B.getFullYear(),B.getMonth(),B.getDate()).toISOString();console.log("ðŸ“… ì˜¤ëŠ˜ ì‹œìž‘ ì‹œê° (UTC):",f),console.log("ðŸ“… í˜„ìž¬ ì‹œê° (ë¡œì»¬):",B.toLocaleString("ko-KR",{timeZone:"Asia/Seoul"}));let m=[];if(l.level===1){const{data:a}=await s.from("partners").select("id");m=a?.map(n=>n.id)||[]}else{m=[l.id];const{data:a}=await s.from("partners").select("id").eq("parent_id",l.id),n=a?.map(t=>t.id)||[];if(m.push(...n),n.length>0){const{data:t}=await s.from("partners").select("id").in("parent_id",n),r=t?.map(_=>_.id)||[];if(m.push(...r),r.length>0){const{data:_}=await s.from("partners").select("id").in("parent_id",r),k=_?.map(O=>O.id)||[];if(m.push(...k),k.length>0){const{data:O}=await s.from("partners").select("id").in("parent_id",k),M=O?.map($=>$.id)||[];if(m.push(...M),M.length>0){const{data:$}=await s.from("partners").select("id").in("parent_id",M),me=$?.map(ge=>ge.id)||[];m.push(...me)}}}}}console.log("ðŸ‘¥ í•˜ìœ„ íŒŒíŠ¸ë„ˆ ID ê°œìˆ˜:",m.length);let p=[];const{data:le}=await s.from("users").select("id").eq("referrer_id",l.id);p=le?.map(a=>a.id)||[],console.log("ðŸ‘¤ ì§ì† íšŒì› ID ê°œìˆ˜:",p.length);let u=[];const Z=m.filter(a=>a!==l.id);if(Z.length>0){const{data:a}=await s.from("users").select("id").in("referrer_id",Z);u=a?.map(n=>n.id)||[],console.log("ðŸ‘¥ í•˜ìœ„ íŒŒíŠ¸ë„ˆ íšŒì› ID ê°œìˆ˜:",u.length)}let I=0;if(p.length>0){const{data:a}=await s.from("transactions").select("amount, created_at").in("transaction_type",["deposit","admin_deposit"]).in("status",["approved","completed"]).in("user_id",p).gte("created_at",f);console.log("ðŸ’° ì§ì† íšŒì› ìž…ê¸ˆ ë°ì´í„°:",a),I=a?.reduce((n,t)=>n+Number(t.amount),0)||0}let T=0;if(p.length>0){const{data:a}=await s.from("transactions").select("amount, created_at").in("transaction_type",["withdrawal","admin_withdrawal"]).in("status",["approved","completed"]).in("user_id",p).gte("created_at",f);console.log("ðŸ’¸ ì§ì† íšŒì› ì¶œê¸ˆ ë°ì´í„°:",a),T=a?.reduce((n,t)=>n+Number(t.amount),0)||0}let P=0;if(u.length>0){const{data:a}=await s.from("transactions").select("amount, created_at").in("transaction_type",["deposit","admin_deposit"]).in("status",["approved","completed"]).in("user_id",u).gte("created_at",f);console.log("ðŸ’° í•˜ìœ„ íŒŒíŠ¸ë„ˆ íšŒì› ìž…ê¸ˆ ë°ì´í„°:",a),P=a?.reduce((n,t)=>n+Number(t.amount),0)||0}let E=0;if(u.length>0){const{data:a}=await s.from("transactions").select("amount, created_at").in("transaction_type",["withdrawal","admin_withdrawal"]).in("status",["approved","completed"]).in("user_id",u).gte("created_at",f);console.log("ðŸ’¸ í•˜ìœ„ íŒŒíŠ¸ë„ˆ íšŒì› ì¶œê¸ˆ ë°ì´í„°:",a),E=a?.reduce((n,t)=>n+Number(t.amount),0)||0}let X=0;if(m.length>0){const{count:a}=await s.from("users").select("id",{count:"exact",head:!0}).in("referrer_id",m);X=a||0}let Y=0;const{count:ie}=await s.from("game_launch_sessions").select("*",{count:"exact",head:!0}).eq("status","active");Y=ie||0;const de=[...p,...u],ce=await _e(de,f,new Date().toISOString());let N=0,C=0;if(p.length>0){const{data:a}=await s.from("game_records").select("provider_id, bet_amount").in("user_id",p).gte("played_at",f);if(a&&a.length>0){const n=[410,77,2,30,78,86,11,28,89,91,44,85,0];N=a.filter(t=>n.includes(Number(t.provider_id))).reduce((t,r)=>t+Number(r.bet_amount||0),0),C=a.filter(t=>!n.includes(Number(t.provider_id))).reduce((t,r)=>t+Number(r.bet_amount||0),0)}}let D=0,S=0;if(u.length>0){const{data:a}=await s.from("game_records").select("provider_id, bet_amount").in("user_id",u).gte("played_at",f);if(a&&a.length>0){const n=[410,77,2,30,78,86,11,28,89,91,44,85,0];D=a.filter(t=>n.includes(Number(t.provider_id))).reduce((t,r)=>t+Number(r.bet_amount||0),0),S=a.filter(t=>!n.includes(Number(t.provider_id))).reduce((t,r)=>t+Number(r.bet_amount||0),0)}}const z=I+P,G=T+E;H(a=>({...a,total_users:X||0,daily_deposit:z,daily_withdrawal:G,daily_net_deposit:z-G,online_users:Y||0,casino_betting:N+D,slot_betting:C+S,total_betting:N+C+D+S,pending_approvals:0,pending_messages:0,pending_deposits:0,pending_withdrawals:0})),te({deposit:I,withdrawal:T,netDeposit:I-T,casinoBetting:N,slotBetting:C,totalBetting:N+C}),ae({deposit:P,withdrawal:E,netDeposit:P-E,casinoBetting:D,slotBetting:S,totalBetting:D+S}),se(ce),console.log(""),console.log("âœ… ëŒ€ì‹œë³´ë“œ í†µê³„ ì—…ë°ì´íŠ¸ ì™„ë£Œ (RPC ì—†ìŒ)"),console.log("============================================")}catch(i){console.error(""),console.error("============================================"),console.error("âŒ ëŒ€ì‹œë³´ë“œ í†µê³„ ë¡œë”© ì˜¤ë¥˜"),console.error("Error:",i),console.error("Message:",i?.message),console.error("Details:",i?.details),console.error("Hint:",i?.hint),console.error("============================================"),fe.error("ëŒ€ì‹œë³´ë“œ í†µê³„ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: "+(i?.message||"ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜"))}finally{K(!1)}};return g.useEffect(()=>{j()},[]),g.useEffect(()=>{const i=setInterval(()=>{re(new Date)},1e3);return()=>clearInterval(i)},[]),g.useEffect(()=>{console.log("ðŸ”” ëŒ€ì‹œë³´ë“œ Realtime êµ¬ë… ì‹œìž‘:",l.id);const i=s.channel("dashboard_transactions").on("postgres_changes",{event:"*",schema:"public",table:"transactions"},x=>{console.log("ðŸ’° [ëŒ€ì‹œë³´ë“œ] transactions ë³€ê²½ ê°ì§€:",x.eventType),j()}).subscribe(),h=s.channel("dashboard_partners").on("postgres_changes",{event:"UPDATE",schema:"public",table:"partners",filter:`id=eq.${l.id}`},x=>{console.log("ðŸ’° [ëŒ€ì‹œë³´ë“œ] partners ë³´ìœ ê¸ˆ ë³€ê²½ ê°ì§€:",x.new),j()}).subscribe(),V=s.channel("dashboard_game_records").on("postgres_changes",{event:"INSERT",schema:"public",table:"game_records"},x=>{console.log("ðŸŽ® [ëŒ€ì‹œë³´ë“œ] game_records ë³€ê²½ ê°ì§€:",x.eventType),j()}).subscribe(),b=s.channel("dashboard_users").on("postgres_changes",{event:"UPDATE",schema:"public",table:"users"},x=>{console.log("ðŸ‘¤ [ëŒ€ì‹œë³´ë“œ] users ë³€ê²½ ê°ì§€:",x.eventType),j()}).subscribe();return()=>{console.log("ðŸ”• ëŒ€ì‹œë³´ë“œ Realtime êµ¬ë… í•´ì œ"),s.removeChannel(i),s.removeChannel(h),s.removeChannel(V),s.removeChannel(b)}},[l.id]),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row items-start md:items-center justify-between gap-4 mb-8",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-100",children:o.dashboard.adminDashboard}),e.jsxs("p",{className:"text-sm text-slate-400",children:[he(l.level)," Â· ",l.nickname,o.dashboard.realtimeStatus]})]}),e.jsxs(be,{variant:"outline",className:"flex items-center gap-2 px-3 py-1.5 text-xs badge-premium-primary",children:[e.jsx(ve,{className:"h-3.5 w-3.5"}),ne.toLocaleString("ko-KR")]})]}),e.jsxs("div",{className:"grid gap-5 md:grid-cols-2 lg:grid-cols-4",children:[e.jsx(U,{title:o.dashboard.totalUsers,value:xe(w.total_users),subtitle:`â†‘ ${o.dashboard.registeredUsers}`,icon:ye,color:"blue"}),e.jsx(U,{title:o.dashboard.todayNetRevenue,value:d(w.daily_net_deposit),subtitle:w.daily_net_deposit>=0?`â†‘ ${o.dashboard.profitToday}`:`â†“ ${o.dashboard.lossToday}`,icon:we,color:w.daily_net_deposit>=0?"green":"pink"}),e.jsx(U,{title:o.dashboard.todayTotalBetting,value:d(w.total_betting),subtitle:`â†‘ ${o.dashboard.customerActivity}`,icon:F,color:"purple"}),e.jsx(U,{title:o.dashboard.pendingCharges,value:d(oe),subtitle:`â†‘ ${o.dashboard.pendingChargesDesc}`,icon:W,color:"orange"})]}),e.jsxs("div",{className:"grid gap-5 md:grid-cols-2",children:[e.jsxs(R,{title:o.dashboard.directUserTransactions,icon:A,iconColor:"text-cyan-400",children:[e.jsx(c,{label:o.dashboard.dailyDeposit,value:d(v.deposit),valueColor:"text-cyan-400",icon:A,iconColor:"text-cyan-400"}),e.jsx(c,{label:o.dashboard.dailyWithdrawal,value:d(v.withdrawal),valueColor:"text-rose-400",icon:J,iconColor:"text-rose-400"}),e.jsx(c,{label:o.dashboard.dailyNetDeposit,value:d(v.netDeposit),valueColor:"text-cyan-400",icon:W,iconColor:"text-cyan-400"})]}),e.jsxs(R,{title:o.dashboard.directUserBetting,icon:L,iconColor:"text-amber-400",children:[e.jsx(c,{label:o.dashboard.casinoTotalBetting,value:d(v.casinoBetting),valueColor:"text-cyan-400",icon:F,iconColor:"text-cyan-400"}),e.jsx(c,{label:o.dashboard.slotTotalBetting,value:d(v.slotBetting),valueColor:"text-amber-400",icon:L,iconColor:"text-amber-400"}),e.jsx(c,{label:o.dashboard.totalBetting,value:d(v.totalBetting),valueColor:"text-cyan-400",icon:Q,iconColor:"text-cyan-400"})]}),e.jsxs(R,{title:o.dashboard.subPartnerTransactions,icon:A,iconColor:"text-purple-400",children:[e.jsx(c,{label:o.dashboard.dailyDeposit,value:d(y.deposit),valueColor:"text-cyan-400",icon:A,iconColor:"text-cyan-400"}),e.jsx(c,{label:o.dashboard.dailyWithdrawal,value:d(y.withdrawal),valueColor:"text-rose-400",icon:J,iconColor:"text-rose-400"}),e.jsx(c,{label:o.dashboard.dailyNetDeposit,value:d(y.netDeposit),valueColor:"text-cyan-400",icon:W,iconColor:"text-cyan-400"})]}),e.jsxs(R,{title:o.dashboard.subPartnerBetting,icon:L,iconColor:"text-green-400",children:[e.jsx(c,{label:o.dashboard.casinoTotalBetting,value:d(y.casinoBetting),valueColor:"text-cyan-400",icon:F,iconColor:"text-cyan-400"}),e.jsx(c,{label:o.dashboard.slotTotalBetting,value:d(y.slotBetting),valueColor:"text-amber-400",icon:L,iconColor:"text-amber-400"}),e.jsx(c,{label:o.dashboard.totalBetting,value:d(y.totalBetting),valueColor:"text-cyan-400",icon:Q,iconColor:"text-cyan-400"})]})]}),l.level===1&&e.jsx("div",{className:"mt-8 p-6 bg-gradient-to-r from-red-900/20 via-red-800/20 to-red-900/20 border-2 border-yellow-600/50 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-16 h-16 rounded-lg bg-gradient-to-br from-red-700 to-red-900 flex items-center justify-center border-2 border-yellow-600",children:e.jsx(ee,{className:"w-8 h-8 text-yellow-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl",style:{fontFamily:"Impact, sans-serif",color:"#fff",letterSpacing:"0.1em",textShadow:"2px 2px 4px rgba(0,0,0,0.8)"},children:"MARVEL THEME CASINO"}),e.jsx("p",{className:"text-gray-400 text-sm mt-1",children:o.dashboard.marvelThemeDescription})]})]}),e.jsx("button",{onClick:()=>{window.location.hash="#/sample1"},className:"px-6 py-3 bg-gradient-to-r from-yellow-600 to-yellow-700 text-black rounded-md border-2 border-yellow-400 hover:from-yellow-500 hover:to-yellow-600 transition-all duration-200",style:{boxShadow:"0 0 20px rgba(234, 179, 8, 0.4)"},children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{style:{fontFamily:"Impact, sans-serif",letterSpacing:"0.05em"},children:o.dashboard.experience}),e.jsx("span",{children:"â†’"})]})})]})}),l.level===1&&e.jsx("div",{className:"mt-6 p-6 bg-gradient-to-r from-orange-900/20 via-amber-900/20 to-orange-900/20 border-2 border-orange-500/50 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-16 h-16 rounded-lg bg-gradient-to-br from-orange-600 to-amber-700 flex items-center justify-center border-2 border-orange-400",children:e.jsx(ee,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl",style:{fontFamily:"Impact, sans-serif",color:"#fff",letterSpacing:"0.1em",textShadow:"2px 2px 4px rgba(0,0,0,0.8)"},children:"INDO CASINO"}),e.jsx("p",{className:"text-gray-400 text-sm mt-1",children:"Experience Indonesian themed casino"})]})]}),e.jsx("button",{onClick:()=>{window.location.hash="#/indo"},className:"px-6 py-3 bg-gradient-to-r from-orange-500 to-amber-600 text-white rounded-md border-2 border-orange-400 hover:from-orange-400 hover:to-amber-500 transition-all duration-200",style:{boxShadow:"0 0 20px rgba(249, 115, 22, 0.4)"},children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{style:{fontFamily:"Impact, sans-serif",letterSpacing:"0.05em"},children:"EXPLORE"}),e.jsx("span",{children:"â†’"})]})})]})})]})}export{Le as Dashboard,Le as default};
