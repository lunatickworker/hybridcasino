const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-McppjVnx.js","assets/react-core-BwkdTuSg.js","assets/vendor-D410aui4.js","assets/radix-ui-omyR4zpf.js","assets/lucide-icons-CePlpqHy.js","assets/supabase-C8Oa5ukG.js","assets/index-B69pnHHb.css"])))=>i.map(i=>d[i]);
import{X as N,s as h,I as R,i as k,C as L,a8 as U,B,_ as H}from"./index-McppjVnx.js";import{r as l,j as e}from"./react-core-BwkdTuSg.js";import{a as V,G as F}from"./GamePreparingDialog-DMAMEqDX.js";import{k as d}from"./vendor-D410aui4.js";import{r as S,w as J,q as X,x as A,y as Z,Z as Y,aG as K,a8 as Q,J as ee,P as ae}from"./lucide-icons-CePlpqHy.js";import"./radix-ui-omyR4zpf.js";import"./supabase-C8Oa5ukG.js";const te=[{id:"all",name:"ì „ì²´",icon:X,gradient:"from-yellow-500 to-amber-600"},{id:"featured",name:"ì¸ê¸°",icon:A,gradient:"from-red-500 to-pink-600"},{id:"new",name:"ì‹ ê·œ",icon:Z,gradient:"from-blue-500 to-cyan-600"},{id:"jackpot",name:"ìž­íŒŸ",icon:Y,gradient:"from-purple-500 to-purple-600"},{id:"bonus",name:"ë³´ë„ˆìŠ¤",icon:K,gradient:"from-green-500 to-emerald-600"},{id:"high-rtp",name:"ê³ ìˆ˜ìµ",icon:Q,gradient:"from-orange-500 to-red-600"}];function me({user:_,onRouteChange:se}){const[m,C]=l.useState("all"),[f,I]=l.useState("all"),[p,G]=l.useState(""),[M,T]=l.useState([]),[D,q]=l.useState([]),[W,g]=l.useState(!1),[b,x]=l.useState(null),[z,c]=l.useState(!1),[$,y]=l.useState("launch"),n=l.useRef(!0);l.useEffect(()=>(E(),()=>{n.current=!1}),[]),l.useEffect(()=>{n.current&&v()},[m,f]);const E=async()=>{if(n.current)try{g(!0);const a=await N.getUserVisibleProviders({type:"slot"});n.current&&q(a),await v()}catch(a){n.current&&(console.error("ì´ˆê¸°í™” ì˜¤ë¥˜:",a),d.error("ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤."))}finally{n.current&&g(!1)}},v=async()=>{if(n.current)try{g(!0);let a=h.from("games").select(`
          id,
          provider_id,
          name,
          type,
          status,
          image_url,
          is_featured,
          priority,
          rtp,
          api_type,
          game_providers!inner(
            id,
            name,
            logo_url
          )
        `).eq("type","slot").eq("status","visible");m!=="all"&&(a=a.eq("provider_id",parseInt(m)));const{data:t,error:i}=await a.order("priority",{ascending:!1});if(i)throw i;const o=(t?.map(r=>({game_id:r.id,provider_id:r.provider_id,provider_name:r.game_providers?.name||"Unknown",provider_logo:r.game_providers?.logo_url,game_name:r.name,game_type:r.type,image_url:r.image_url,is_featured:r.is_featured||!1,rtp:r.rtp,status:r.status,priority:r.priority||0,api_type:r.api_type}))||[]).sort((r,u)=>r.is_featured&&!u.is_featured?-1:!r.is_featured&&u.is_featured?1:u.priority-r.priority);n.current&&T(o)}catch(a){n.current&&(console.error("ê²Œìž„ ë¡œë“œ ì‹¤íŒ¨:",a),d.error("ìŠ¬ë¡¯ ê²Œìž„ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤."))}finally{n.current&&g(!1)}},O=async a=>{if(b!==a.game_id){x(a.game_id);try{const t=await N.checkActiveSession(_.id);if(t?.isActive&&t.api_type!==a.api_type){const s={invest:"Invest API",oroplay:"OroPlay API"};d.error(`${s[t.api_type]} ê²Œìž„ì´ ì‹¤í–‰ ì¤‘ìž…ë‹ˆë‹¤.\\ní˜„ìž¬ ê²Œìž„: ${t.game_name}\\n\\në‹¤ë¥¸ API ê²Œìž„ì„ ì‹¤í–‰í•˜ë ¤ë©´ í˜„ìž¬ ê²Œìž„ì„ ì¢…ë£Œí•´ì£¼ì„¸ìš”.`,{duration:5e3}),x(null);return}if(t?.isActive&&t.api_type===a.api_type&&t.game_id!==a.game_id){console.log("ðŸ”„ [ê²Œìž„ ì „í™˜] ê¸°ì¡´ ê²Œìž„ ì¶œê¸ˆ í›„ ìƒˆ ê²Œìž„ ì‹¤í–‰:",{oldGameId:t.game_id,newGameId:a.game_id}),y("withdraw"),c(!0);const{syncBalanceOnSessionEnd:s}=await H(async()=>{const{syncBalanceOnSessionEnd:o}=await import("./index-McppjVnx.js").then(r=>r.ab);return{syncBalanceOnSessionEnd:o}},__vite__mapDeps([0,1,2,3,4,5,6]));await s(_.id,t.api_type),console.log("âœ… [ê²Œìž„ ì „í™˜] ê¸°ì¡´ ê²Œìž„ ì¶œê¸ˆ ì™„ë£Œ, ìƒˆ ê²Œìž„ ì‹¤í–‰ ì‹œìž‘")}if(t?.isActive&&t.game_id===a.game_id&&t.status==="ready"&&t.launch_url){console.log("ðŸ”„ [ìŠ¬ë¡¯ ì‹¤í–‰] ready ì„¸ì…˜ ìž¬ì‚¬ìš© - ê¸°ì¡´ URL ì‚¬ìš© (ìž…ê¸ˆ API í˜¸ì¶œ ì•ˆí•¨):",t.session_id);const s=window.open(t.launch_url,"_blank","width=1280,height=720,scrollbars=yes,resizable=yes");if(s){d.success(`${a.game_name} ê²Œìž„ì„ ì‹œìž‘í•©ë‹ˆë‹¤.`);const o=t.session_id;await h.from("game_launch_sessions").update({ready_status:"popup_opened",last_activity_at:new Date().toISOString()}).eq("id",o),window.gameWindows||(window.gameWindows=new Map),window.gameWindows.set(o,s),window.gameWindowCheckers||(window.gameWindowCheckers=new Map);let r=!1;const u=async()=>{if(r)return;r=!0,y("withdraw"),c(!0);const w=window.gameWindowCheckers?.get(o);w&&(clearInterval(w),window.gameWindowCheckers?.delete(o)),window.gameWindows?.delete(o),await window.syncBalanceAfterGame?.(o),setTimeout(()=>{c(!1)},500)},j=setInterval(()=>{try{s.closed&&u()}catch{}},1e3);window.gameWindowCheckers.set(o,j)}else{d.error("ì°¨ë‹¨ë˜ì—ˆìŠµë‹ˆë‹¤. íŒì—… í—ˆìš© í›„ ë‹¤ì‹œ í´ë¦­í•´ì£¼ì„¸ìš”.");const o=t.session_id;await h.from("game_launch_sessions").update({ready_status:"popup_blocked",last_activity_at:new Date().toISOString()}).eq("id",o),console.log("âš ï¸ [íŒì—… ì°¨ë‹¨] ready_status=popup_blocked ì—…ë°ì´íŠ¸ ì™„ë£Œ (ready ì„¸ì…˜ ìž¬ì‚¬ìš©)")}x(null);return}y("launch"),c(!0);const i=await N.generateGameLaunchUrl(_.id,a.game_id);if(c(!1),i.success&&i.launchUrl){const s=i.sessionId,o=window.open(i.launchUrl,"_blank","width=1280,height=720,scrollbars=yes,resizable=yes");if(!o)d.error("ì°¨ë‹¨ë˜ì—ˆìŠµë‹ˆë‹¤. íŒì—… í—ˆìš© í›„ ë‹¤ì‹œ í´ë¦­í•´ì£¼ì„¸ìš”."),s&&typeof s=="number"&&(await h.from("game_launch_sessions").update({ready_status:"popup_blocked",last_activity_at:new Date().toISOString()}).eq("id",s),console.log("âš ï¸ [íŒì—… ì°¨ë‹¨] ready_status=popup_blocked ì—…ë°ì´íŠ¸ ì™„ë£Œ. ìž¬í´ë¦­ ì‹œ ê¸°ì¡´ URL ìž¬ì‚¬ìš©ë©ë‹ˆë‹¤."));else if(d.success(`${a.game_name} ê²Œìž„ì„ ì‹œìž‘í•©ë‹ˆë‹¤.`),s&&typeof s=="number"&&(await h.from("game_launch_sessions").update({ready_status:"popup_opened",last_activity_at:new Date().toISOString()}).eq("id",s),window.gameWindows||(window.gameWindows=new Map),window.gameWindows.set(s,o)),s&&typeof s=="number"){window.gameWindowCheckers||(window.gameWindowCheckers=new Map);let r=!1;const u=async()=>{if(r)return;r=!0,y("withdraw"),c(!0);const w=window.gameWindowCheckers?.get(s);w&&(clearInterval(w),window.gameWindowCheckers?.delete(s)),window.gameWindows?.delete(s),await window.syncBalanceAfterGame?.(s),setTimeout(()=>{c(!1)},500)},j=setInterval(()=>{try{o.closed&&u()}catch{}},1e3);window.gameWindowCheckers.set(s,j)}}else d.error(`ê²Œìž„ ì‹¤í–‰ ì‹¤íŒ¨: ${i.error||"ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."}`)}catch(t){console.error("ê²Œìž„ ì‹¤í–‰ ì˜¤ë¥˜:",t),d.error(`ê²Œìž„ ì‹¤í–‰ ì¤‘ ì˜¤ë¥˜: ${t instanceof Error?t.message:"ì‹œìŠ¤í…œ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."}`),c(!1)}finally{x(null)}}},P=M.filter(a=>{const t=p===""||a.game_name.toLowerCase().includes(p.toLowerCase())||a.provider_name.toLowerCase().includes(p.toLowerCase());let i=!0;if(f!=="all"){const o=a.game_name.toLowerCase();switch(f){case"featured":i=a.is_featured;break;case"new":i=!0;break;case"jackpot":i=o.includes("jackpot")||o.includes("ìž­íŒŸ");break;case"bonus":i=o.includes("bonus")||o.includes("ë³´ë„ˆìŠ¤");break;case"high-rtp":i=(a.rtp||0)>=96;break}}let s=!0;return m!=="all"&&(s=a.provider_id===parseInt(m)),t&&i&&s});return e.jsxs("div",{className:"relative min-h-screen overflow-x-hidden",children:[e.jsx("div",{className:"fixed inset-0 z-0 w-full h-full",style:{backgroundImage:"linear-gradient(rgba(0, 0, 0, 0.85), rgba(0, 0, 0, 0.90)), url('https://images.unsplash.com/photo-1511882150382-421056c89033?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxzbG90JTIwbWFjaGluZSUyMGdhbWVzfGVufDF8fHx8MTc1OTcyMDM2M3ww&ixlib=rb-4.1.0&q80&w=1080&utm_source=figma&utm_medium=referral')",backgroundSize:"cover",backgroundPosition:"center center",backgroundRepeat:"no-repeat"}}),e.jsxs("div",{className:"relative z-10 space-y-8 p-4 sm:p-6 lg:p-8",children:[e.jsxs("div",{className:"text-center space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-center gap-4 mb-6",children:[e.jsx(S,{className:"w-16 h-16 text-yellow-400 drop-shadow-[0_0_20px_rgba(250,204,21,0.8)]"}),e.jsx("h1",{className:"text-6xl lg:text-7xl font-bold gold-text neon-glow",children:"VIP ìŠ¬ë¡¯ ê²Œìž„"}),e.jsx(S,{className:"w-16 h-16 text-yellow-400 drop-shadow-[0_0_20px_rgba(250,204,21,0.8)]"})]}),e.jsx("p",{className:"text-3xl text-yellow-100 tracking-wide",children:"í™”ë ¤í•œ ìž­íŒŸê³¼ í•¨ê»˜í•˜ëŠ” í”„ë¦¬ë¯¸ì—„ ìŠ¬ë¡¯ ê²½í—˜"})]}),e.jsxs("div",{className:"flex flex-col lg:flex-row gap-5 items-center justify-between",children:[e.jsxs("div",{className:"relative flex-1 max-w-xl",children:[e.jsx(J,{className:"absolute left-4 top-1/2 transform -translate-y-1/2 w-6 h-6 text-yellow-400"}),e.jsx(R,{type:"text",placeholder:"ê²Œìž„ ê²€ìƒ‰...",value:p,onChange:a=>G(a.target.value),className:"pl-12 h-14 text-lg bg-black/50 border-yellow-600/30 text-white placeholder:text-yellow-200/50 focus:border-yellow-500"})]}),e.jsx("div",{className:"flex flex-wrap gap-3",children:te.map(a=>{const t=a.icon,i=f===a.id;return e.jsxs(k,{variant:"ghost",onClick:()=>I(a.id),className:`
                    relative px-6 py-4 text-lg font-bold transition-all duration-300
                    ${i?`bg-gradient-to-r ${a.gradient} text-white shadow-lg shadow-yellow-500/50 scale-105`:"text-yellow-200/80 hover:text-yellow-100 hover:bg-yellow-900/20"}
                  `,children:[e.jsx(t,{className:"w-5 h-5 mr-2"}),a.name,i&&e.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-1 bg-gradient-to-r from-transparent via-yellow-300 to-transparent"})]},a.id)})})]}),e.jsx(V,{selectedProvider:m,onProviderChange:C,gameType:"slot",providers:D}),W?e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4",children:Array.from({length:10}).map((a,t)=>e.jsx(L,{className:"luxury-card animate-pulse border-yellow-600/20",children:e.jsx("div",{className:"aspect-[4/3] bg-gradient-to-br from-slate-700 to-slate-800 rounded-xl"})},t))}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4",children:P.map(a=>e.jsxs(L,{className:`group cursor-pointer bg-slate-900/80 border border-slate-700/50 hover:border-yellow-500/50 transition-all duration-300 overflow-hidden rounded-xl hover:shadow-xl hover:shadow-yellow-500/20 ${b===a.game_id?"opacity-50":""}`,onClick:()=>O(a),children:[e.jsxs("div",{className:"aspect-[4/3] relative overflow-hidden bg-slate-800",children:[e.jsx(U,{src:a.image_url,alt:a.game_name,className:"w-full h-full object-cover transition-transform duration-500 group-hover:scale-105"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/90 via-black/20 to-transparent opacity-60 group-hover:opacity-80 transition-opacity"}),a.is_featured&&e.jsx("div",{className:"absolute top-2 right-2",children:e.jsxs(B,{className:"bg-yellow-500/90 text-black border-0 text-xs backdrop-blur-sm",children:[e.jsx(A,{className:"w-3 h-3 mr-1 fill-current"}),"ì¸ê¸°"]})}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity duration-300",children:b===a.game_id?e.jsx("div",{className:"flex flex-col items-center gap-2 text-white",children:e.jsx(ee,{className:"w-10 h-10 animate-spin"})}):e.jsxs("div",{className:"flex flex-col items-center gap-3",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-yellow-500/20 backdrop-blur-md flex items-center justify-center border-2 border-yellow-500/50",children:e.jsx(ae,{className:"w-8 h-8 text-yellow-400 fill-current"})}),e.jsx("span",{className:"text-white font-bold text-sm",children:"í”Œë ˆì´"})]})})]}),e.jsxs("div",{className:"p-3 bg-slate-900/90",children:[e.jsx("h3",{className:"font-bold text-white text-base mb-1 truncate",children:a.game_name}),e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("p",{className:"text-yellow-400/80 truncate flex-1",children:a.provider_name}),a.rtp&&e.jsxs("div",{className:"text-green-400 ml-2",children:["RTP: ",a.rtp,"%"]})]})]})]},a.game_id))}),P.length===0&&!W&&e.jsxs("div",{className:"text-center py-16 luxury-card rounded-2xl border-2 border-yellow-600/20",children:[e.jsx("div",{className:"mx-auto w-24 h-24 bg-gradient-to-br from-yellow-500/20 to-amber-600/20 rounded-full flex items-center justify-center mb-6",children:e.jsx(S,{className:"w-12 h-12 text-yellow-400"})}),e.jsx("h3",{className:"text-2xl font-bold gold-text mb-2",children:"ê²Œìž„ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤"}),e.jsx("p",{className:"text-yellow-200/80 text-lg mb-4",children:p?`"${p}"ì— ëŒ€í•œ ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.`:f!=="all"?"ì„ íƒí•œ ì¹´í…Œê³ ë¦¬ì˜ ìž„ì´ ì—†ìŠµë‹ˆë‹¤.":m!=="all"?"ì„ íƒí•œ ì œê³µì‚¬ì˜ ê²Œìž„ì´ ì—†ìŠµë‹ˆë‹¤.":"ì‚¬ìš© ê°€ëŠ¥í•œ ìŠ¬ë¡¯ ê²Œìž„ì´ ì—†ìŠµë‹ˆë‹¤."}),e.jsxs("div",{className:"flex gap-2 justify-center",children:[e.jsx(k,{variant:"outline",onClick:()=>{G(""),I("all"),C("all")},className:"border-yellow-600/30 text-yellow-300 hover:bg-yellow-900/20",children:"ì „ì²´ ê²Œìž„ ë³´ê¸°"}),e.jsx(k,{variant:"outline",onClick:()=>v(),className:"border-yellow-600/30 text-yellow-300 hover:bg-yellow-900/20",children:"ìƒˆë¡œê³ ì¹¨"})]})]})]}),e.jsx(F,{show:z,stage:$})]})}export{me as UserSlot};
