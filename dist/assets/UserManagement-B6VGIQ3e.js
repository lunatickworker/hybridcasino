const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/vendor-D410aui4.js","assets/react-core-BwkdTuSg.js","assets/radix-ui-omyR4zpf.js","assets/index-CGvwOXPh.js","assets/lucide-icons-CAeZOOE5.js","assets/supabase-C8Oa5ukG.js","assets/index-nm0W54x1.css"])))=>i.map(i=>d[i]);
import{r as g,j as e}from"./react-core-BwkdTuSg.js";import{s as c,_ as De,c as ps,b as xs,d as gs,a as Ye,C as te,e as ae,L as X,I as Z,h as M,B as A,T as hs,i as fs,j as be,k as ve,l as xe,m as es,n as bs,S as Se,o as Ce,p as ke,q as Me,r as pe,t as vs,v as js,w as _s,x as ws,y as ys}from"./index-CGvwOXPh.js";import{D as Ns}from"./DataTable-Cv4Bf9qm.js";import{A as Te,a as Ue,b as Ee,c as Re,d as Be,e as Ge}from"./AdminDialog-CFXz2Dfn.js";import{k as m}from"./vendor-D410aui4.js";import{b as qe,t as Oe,W as Ie,G as $e,ac as ye,A as ss,V as Pe,T as Ps,ad as As,a8 as Ls,i as Ss,ab as Cs,Z as ks,Q as Ms,l as Os,X as Is,n as $s,R as Ds,a9 as Ke,ae as Je,af as Xe,ag as Qe,N as Ze,U as Ts,w as Us,ah as Es}from"./lucide-icons-CAeZOOE5.js";import{M as Ne}from"./MetricCard-Bg9coGoy.js";import{F as Rs}from"./ForceTransactionModal-O0UljU0D.js";import"./radix-ui-omyR4zpf.js";import"./supabase-C8Oa5ukG.js";import"./table-BXx61AEI.js";import"./popover-zgyRlH_H.js";import"./command-CChhJe2s.js";async function Fe(n,i,p,f){console.log("ğŸ”§ [API-ACCOUNT] ì™¸ë¶€ API ê³„ì • ìƒì„± ì‹œì‘:",{userId:n,username:i,partnerId:p});const{toast:t}=await De(async()=>{const{toast:y}=await import("./vendor-D410aui4.js").then(Y=>Y.v);return{toast:y}},__vite__mapDeps([0,1,2]));let b=!1,h=!1,_=[];f&&t.loading(`[3/5] Invest API ê³„ì • ìƒì„± ì¤‘... (${i})`,{id:f}),console.log("ğŸ”µ [API-ACCOUNT] Invest API ê³„ì • ìƒì„± ì‹œì‘");try{const y=await Bs(i,p);y.success?(b=!0,console.log("âœ… [API-ACCOUNT] Invest API ê³„ì • ìƒì„± ì„±ê³µ"),f&&t.loading(`[3/5] Invest âœ… â†’ OroPlay API ê³„ì • ìƒì„± ì¤‘... (${i})`,{id:f})):(_.push(`Invest: ${y.error}`),console.error("âŒ [API-ACCOUNT] Invest API ê³„ì • ìƒì„± ì‹¤íŒ¨:",y.error),f&&t.loading(`[3/5] Invest âŒ (${y.error}) â†’ OroPlay API ê³„ì • ìƒì„± ì¤‘...`,{id:f}))}catch(y){const Y=y instanceof Error?y.message:"ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜";_.push(`Invest: ${Y}`),console.error("âŒ [API-ACCOUNT] Invest API ê³„ì • ìƒì„± ì˜ˆì™¸:",y),f&&t.loading(`[3/5] Invest âŒ (${Y}) â†’ OroPlay API ê³„ì • ìƒì„± ì¤‘...`,{id:f})}f&&t.loading(`[4/5] OroPlay API ê³„ì • ìƒì„± ì¤‘... (${i})`,{id:f}),console.log("ğŸ”· [API-ACCOUNT] OroPlay API ê³„ì • ìƒì„± ì‹œì‘");try{const y=await qs(i,p);console.log("ğŸ” [API-ACCOUNT] OroPlay ìƒì„± ê²°ê³¼:",y),y.success?(h=!0,console.log("âœ… [API-ACCOUNT] OroPlay API ê³„ì • ìƒì„± ì„±ê³µ")):(_.push(`OroPlay: ${y.error}`),console.error("âŒ [API-ACCOUNT] OroPlay API ê³„ì • ìƒì„± ì‹¤íŒ¨:",y.error))}catch(y){const Y=y instanceof Error?y.message:"ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜";_.push(`OroPlay: ${Y}`),console.error("âŒ [API-ACCOUNT] OroPlay API ê³„ì • ìƒì„± ì˜ˆì™¸:",y)}let R;b&&h?R="active":b||h?R="partial":R="error";const{error:w}=await c.from("users").update({api_account_status:R,api_invest_created:b,api_oroplay_created:h,api_error_message:_.length>0?_.join("; "):null,api_last_check_at:new Date().toISOString()}).eq("id",n);return w?console.error("âŒ [API-ACCOUNT] DB ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:",w):console.log(`âœ… [API-ACCOUNT] ê³„ì • ìƒì„± ì™„ë£Œ (ìƒíƒœ: ${R})`),{status:R,investCreated:b,oroplayCreated:h,errorMessage:_.length>0?_.join("; "):void 0}}async function Bs(n,i){try{const p=await ts(i),{data:f}=await c.from("api_configs").select("invest_opcode, invest_secret_key, invest_token").eq("partner_id",p).eq("api_provider","invest").single();if(!f?.invest_opcode||!f?.invest_secret_key)return{success:!1,error:"Invest API ì„¤ì •ì´ ì—†ìŠµë‹ˆë‹¤ (api_configs í™•ì¸ í•„ìš”)"};const t=await ps(f.invest_opcode,n,f.invest_secret_key);return t&&t.Result!==!1?{success:!0}:{success:!1,error:t?.Msg||"ê³„ì • ìƒì„± ì‹¤íŒ¨"}}catch(p){return{success:!1,error:p instanceof Error?p.message:"ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜"}}}async function qs(n,i){try{console.log("  ğŸ”¹ [OROPLAY] ========== ì‹œì‘ =========="),console.log("  ğŸ”¹ [OROPLAY] Username:",n),console.log("  ğŸ”¹ [OROPLAY] Partner ID:",i),console.log("  ğŸ”¹ [OROPLAY] 1ë‹¨ê³„: ëŒ€ë³¸ì‚¬ ID ì°¾ê¸° ì‹œì‘");const p=await ts(i);console.log("  âœ… [OROPLAY] ëŒ€ë³¸ì‚¬ ID ì°¾ê¸° ì™„ë£Œ:",p),console.log("  ğŸ”¹ [OROPLAY] 2ë‹¨ê³„: API ì„¤ì • ì¡°íšŒ");let{data:f}=await c.from("api_configs").select("partner_id, oroplay_client_id, oroplay_client_secret").eq("partner_id",p).eq("api_provider","oroplay").single();if(!f?.oroplay_client_id||!f?.oroplay_client_secret){console.log("  âš ï¸ [OROPLAY] ëŒ€ë³¸ì‚¬ ì„¤ì • ì—†ìŒ, ì²« ë²ˆì§¸ ìœ íš¨í•œ ì„¤ì • ì¡°íšŒ");const{data:_}=await c.from("api_configs").select("partner_id, oroplay_client_id, oroplay_client_secret").eq("api_provider","oroplay").not("oroplay_client_id","is",null).not("oroplay_client_secret","is",null).limit(1).single();if(!_)return console.error("  âŒ [OROPLAY] OroPlay API ì„¤ì •ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤"),console.error("  âŒ [OROPLAY] api_configs í…Œì´ë¸”ì— oroplay_client_id, oroplay_client_secretì„ ì„¤ì •í•˜ì„¸ìš”"),{success:!1,error:"OroPlay API ì„¤ì •ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì‹œìŠ¤í…œ ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•˜ì„¸ìš”."};f=_,console.log("  âœ… [OROPLAY] ì²« ë²ˆì§¸ ì„¤ì • ì‚¬ìš© (partner_id:",f.partner_id,")")}else console.log("  âœ… [OROPLAY] API ì„¤ì • ì¡°íšŒ ì„±ê³µ (ëŒ€ë³¸ì‚¬)");console.log("  ğŸ”¹ [OROPLAY] 3ë‹¨ê³„: ìƒˆë¡œìš´ í† í° ê°•ì œ ë°œê¸‰ ì‹œì‘");const t=await xs(f.oroplay_client_id,f.oroplay_client_secret),b=t.token;console.log("  âœ… [OROPLAY] ìƒˆ í† í° ë°œê¸‰ ì„±ê³µ (ê¸¸ì´:",b.length,")"),console.log("  ğŸ”¹ [OROPLAY] í† í° ì•ë¶€ë¶„:",b.substring(0,30)+"..."),console.log("  ğŸ”¹ [OROPLAY] 4ë‹¨ê³„: DBì— ìƒˆ í† í° ì €ì¥"),await c.from("api_configs").update({oroplay_token:b,oroplay_token_expires_at:new Date(t.expiration*1e3).toISOString()}).eq("partner_id",f.partner_id).eq("api_provider","oroplay"),console.log("  âœ… [OROPLAY] DB ì €ì¥ ì™„ë£Œ (partner_id:",f.partner_id,")"),console.log("  ğŸ”¹ [OROPLAY] 5ë‹¨ê³„: OroPlay API createUser í˜¸ì¶œ ì‹œì‘"),console.log("  ğŸ”¹ [OROPLAY] í˜¸ì¶œ íŒŒë¼ë¯¸í„° - token:",b.substring(0,20)+"...",", username:",n);const h=await gs(b,n);return console.log("  âœ… [OROPLAY] createUser ì‘ë‹µ:",h),console.log("  âœ… [OROPLAY] ê³„ì • ìƒì„± ì™„ë£Œ!"),console.log("  ğŸ”¹ [OROPLAY] ========== ì™„ë£Œ =========="),{success:!0}}catch(p){return console.error("  âŒ [OROPLAY] ========== ì˜¤ë¥˜ ë°œìƒ =========="),console.error("  âŒ [OROPLAY] ì˜¤ë¥˜ íƒ€ì…:",p?.constructor?.name),console.error("  âŒ [OROPLAY] ì˜¤ë¥˜ ë©”ì‹œì§€:",p instanceof Error?p.message:String(p)),console.error("  âŒ [OROPLAY] ì˜¤ë¥˜ ìŠ¤íƒ:",p instanceof Error?p.stack:"No stack"),console.error("  âŒ [OROPLAY] ì „ì²´ ì˜¤ë¥˜ ê°ì²´:",JSON.stringify(p,null,2)),{success:!1,error:p instanceof Error?p.message:"ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜"}}}async function ts(n){console.log("    ğŸ”¸ [Lv1ì°¾ê¸°] ì‹œì‘ íŒŒíŠ¸ë„ˆ ID:",n);const{data:i}=await c.from("partners").select("id, partner_type, parent_id").eq("id",n).single();if(!i)throw console.error("    âŒ [Lv1ì°¾ê¸°] íŒŒíŠ¸ë„ˆ ì •ë³´ ì—†ìŒ"),new Error("íŒŒíŠ¸ë„ˆ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤");if(console.log("    ğŸ” [Lv1ì°¾ê¸°] íŒŒíŠ¸ë„ˆ íƒ€ì…:",i.partner_type),i.partner_type==="system_admin")return console.log("    âœ… [Lv1ì°¾ê¸°] Lv1 ì‹œìŠ¤í…œê´€ë¦¬ì ì°¾ìŒ:",i.id),i.id;if(i.partner_type==="head_office"){if(console.log("    ğŸ”¼ [Lv1ì°¾ê¸°] Lv2 ëŒ€ë³¸ì‚¬ ë°œê²¬, ìƒìœ„ Lv1ë¡œ ì´ë™"),!i.parent_id)throw new Error("Lv2 ëŒ€ë³¸ì‚¬ì˜ ìƒìœ„ Lv1ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤");const{data:p}=await c.from("partners").select("id, partner_type").eq("id",i.parent_id).single();if(p?.partner_type==="system_admin")return console.log("    âœ… [Lv1ì°¾ê¸°] Lv1 ì‹œìŠ¤í…œê´€ë¦¬ì ì°¾ìŒ:",p.id),p.id;throw new Error("Lv2ì˜ ìƒìœ„ íŒŒíŠ¸ë„ˆê°€ Lv1ì´ ì•„ë‹™ë‹ˆë‹¤")}if(i.parent_id){console.log("    ğŸ”¼ [Lv1ì°¾ê¸°] ìƒìœ„ íŒŒíŠ¸ë„ˆ íƒìƒ‰ ì‹œì‘");let p=i.parent_id,f=0;for(;p&&f<10;){const{data:t}=await c.from("partners").select("id, partner_type, parent_id").eq("id",p).single();if(console.log(`    ğŸ” [Lv1ì°¾ê¸°] ì‹œë„ ${f+1}: íƒ€ì…=${t?.partner_type}`),t?.partner_type==="system_admin")return console.log("    âœ… [Lv1ì°¾ê¸°] Lv1 ì‹œìŠ¤í…œê´€ë¦¬ì ì°¾ìŒ:",t.id),t.id;if(t?.partner_type==="head_office"){if(console.log("    ğŸ”¼ [Lv1ì°¾ê¸°] Lv2 ëŒ€ë³¸ì‚¬ ë°œê²¬, ìƒìœ„ Lv1ë¡œ ì´ë™"),!t.parent_id)throw new Error("Lv2 ëŒ€ë³¸ì‚¬ì˜ ìƒìœ„ Lv1ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤");const{data:b}=await c.from("partners").select("id, partner_type").eq("id",t.parent_id).single();if(b?.partner_type==="system_admin")return console.log("    âœ… [Lv1ì°¾ê¸°] Lv1 ì‹œìŠ¤í…œê´€ë¦¬ì ì°¾ìŒ:",b.id),b.id;throw new Error("Lv2ì˜ ìƒìœ„ íŒŒíŠ¸ë„ˆê°€ Lv1ì´ ì•„ë‹™ë‹ˆë‹¤")}p=t?.parent_id||null,f++}}throw console.error("    âŒ [Lv1ì°¾ê¸°] Lv1 ì‹œìŠ¤í…œê´€ë¦¬ìë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ"),new Error("ìƒìœ„ Lv1 ì‹œìŠ¤í…œê´€ë¦¬ìë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤")}async function Fs(n){console.log("ğŸ”„ [API-ACCOUNT] ê³„ì • ì¬ìƒì„± ì‹œë„:",n);const{data:i,error:p}=await c.from("users").select("username, referrer_id").eq("id",n).single();if(p||!i)throw new Error("ì‚¬ìš©ìë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤");return await Fe(n,i.username,i.referrer_id)}function Ys({userId:n}){const{t:i}=Ye(),[p,f]=g.useState(""),[t,b]=g.useState(""),[h,_]=g.useState(!1),R=async()=>{if(!p||!t){m.error(i.passwordChange.enterPassword);return}if(p.length<4){m.error(i.passwordChange.minLength);return}if(p!==t){m.error(i.passwordChange.passwordMismatch);return}try{_(!0);const{error:w}=await c.from("users").update({password_hash:p,updated_at:new Date().toISOString()}).eq("id",n);if(w)throw w;m.success(i.passwordChange.changeSuccess),f(""),b("")}catch(w){console.error("Password change error:",w),m.error(i.passwordChange.changeFailed)}finally{_(!1)}};return e.jsxs("div",{children:[e.jsxs("h3",{className:"flex items-center gap-2 mb-3",children:[e.jsx(qe,{className:"h-3.5 w-3.5 text-red-400"}),e.jsx("span",{className:"text-xs",children:i.passwordChange.title})]}),e.jsx(te,{className:"bg-white/5 border-white/10",children:e.jsxs(ae,{className:"p-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(X,{htmlFor:"newPassword",className:"text-xs",children:i.passwordChange.newPassword}),e.jsx(Z,{id:"newPassword",type:"password",value:p,onChange:w=>f(w.target.value),placeholder:i.passwordChange.newPasswordPlaceholder,className:"bg-white/5 border-white/10 text-xs h-9"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(X,{htmlFor:"confirmPassword",className:"text-xs",children:i.passwordChange.confirmPassword}),e.jsx(Z,{id:"confirmPassword",type:"password",value:t,onChange:w=>b(w.target.value),placeholder:i.passwordChange.confirmPasswordPlaceholder,className:"bg-white/5 border-white/10 text-xs h-9"})]})]}),e.jsx("div",{className:"flex justify-end mt-4",children:e.jsx(M,{onClick:R,disabled:h||!p||!t,className:"bg-gradient-to-r from-red-500 to-pink-600 hover:from-red-600 hover:to-pink-700 text-white px-4 py-2 text-xs h-9",children:h?i.passwordChange.changing:i.passwordChange.changeButton})})]})})]})}function Hs({user:n,isOpen:i,onClose:p}){const{t:f}=Ye(),[t,b]=g.useState("basic"),[h,_]=g.useState(!1),[R,w]=g.useState([]),[y,Y]=g.useState([]),[$,je]=g.useState(null),[N,Ae]=g.useState({totalDeposit:0,totalWithdraw:0,totalBets:0,totalWinAmount:0,accountAge:0,lastActivity:"",gameCount:0,winRate:0}),[V,le]=g.useState(1e8),[oe,_e]=g.useState(null),[re,ie]=g.useState(!1),ge=async()=>{try{_(!0);const{data:r}=await c.from("transactions").select("transaction_type, amount, status").eq("user_id",n.id),d=(r||[]).filter(k=>k.transaction_type==="deposit"&&k.status==="approved").reduce((k,C)=>k+(C.amount||0),0),T=(r||[]).filter(k=>k.transaction_type==="withdrawal"&&k.status==="approved").reduce((k,C)=>k+(C.amount||0),0),{data:I}=await c.from("game_records").select("bet_amount, win_amount").eq("user_id",n.id),ee=(I||[]).reduce((k,C)=>k+(C.bet_amount||0),0),Q=(I||[]).reduce((k,C)=>k+(C.win_amount||0),0),q=I?.length||0,G=(I||[]).filter(k=>(k.win_amount||0)>(k.bet_amount||0)).length,U=q>0?G/q*100:0,K=Math.floor((Date.now()-new Date(n.created_at).getTime())/(1e3*60*60*24)),{data:de}=await c.from("game_launch_sessions").select("launched_at").eq("user_id",n.id).order("launched_at",{ascending:!1}).limit(1).single();Ae({totalDeposit:d,totalWithdraw:T,totalBets:ee,totalWinAmount:Q,accountAge:K,lastActivity:de?.launched_at||n.created_at,gameCount:q,winRate:U})}catch(r){console.error("í†µê³„ ê³„ì‚° ì˜¤ë¥˜:",r)}finally{_(!1)}},B=async()=>{try{_(!0);const{data:r,error:d}=await c.from("transactions").select("*").eq("user_id",n.id).order("created_at",{ascending:!1}).limit(100);if(d)throw d;w(r||[])}catch(r){console.error("ì…ì¶œê¸ˆ ë‚´ì—­ ì¡°íšŒ ì˜¤ë¥˜:",r),m.error("ì…ì¶œê¸ˆ ë‚´ì—­ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")}finally{_(!1)}},he=async()=>{try{_(!0);const{data:r,error:d}=await c.from("game_records").select("*").eq("user_id",n.id).order("played_at",{ascending:!1}).limit(100);if(d)throw d;Y(r||[])}catch(r){console.error("ë² íŒ… ë‚´ì—­ ì¡°íšŒ ì˜¤ë¥˜:",r),m.error("ë² íŒ… ë‚´ì—­ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")}finally{_(!1)}},O=async()=>{try{_(!0);const{data:r}=await c.from("game_records").select("*").eq("user_id",n.id).order("played_at",{ascending:!1}).limit(500);if(!r||r.length===0){je(null);return}const d=new Map;r.forEach(u=>{const S=`${u.game_id}_${u.game_title||""}`;d.has(S)||d.set(S,{gameName:u.game_title||`ê²Œì„ ${u.game_id}`,providerName:u.provider_name||"",count:0,totalBet:0,totalWin:0,wins:0});const me=d.get(S);me.count++,me.totalBet+=u.bet_amount||0,me.totalWin+=u.win_amount||0,(u.win_amount||0)>(u.bet_amount||0)&&me.wins++});const T=Array.from(d.values()).sort((u,S)=>S.count-u.count).slice(0,5).map(u=>({game:u.gameName,provider:u.providerName,count:u.count,winRate:u.count>0?u.wins/u.count*100:0,netProfit:u.totalWin-u.totalBet})),I=new Array(24).fill(0);r.forEach(u=>{const S=new Date(u.played_at).getHours();I[S]++});const ee=I.indexOf(Math.max(...I)),q=(I.slice(22).reduce((u,S)=>u+S,0)+I.slice(0,6).reduce((u,S)=>u+S,0))/r.length*100,G=r.map(u=>u.bet_amount||0),U=G.reduce((u,S)=>u+S,0)/r.length,K=Math.max(...G),de=r.reduce((u,S)=>u+(S.bet_amount||0),0),C=r.reduce((u,S)=>u+(S.win_amount||0),0)-de,W=r.filter(u=>(u.win_amount||0)>(u.bet_amount||0)).length/r.length*100;let P=0;U>1e5?P+=3:U>5e4?P+=2:U>1e4&&(P+=1),K>5e5?P+=3:K>2e5?P+=2:K>5e4&&(P+=1),C<-1e6?P+=3:C<-5e5?P+=2:C<-1e5&&(P+=1),r.length>500&&(P+=1);const z=P>=6?"HIGH":P>=3?"MEDIUM":"LOW",L=[];if(T.length>0){const u=T[0],S=(u.count/r.length*100).toFixed(1);L.push(`ğŸ’ ê°€ì¥ ì„ í˜¸í•˜ëŠ” ê²Œì„ì€ "${u.game}"ë¡œ, ì „ì²´ í”Œë ˆì´ì˜ ${S}%ë¥¼ ì°¨ì§€í•©ë‹ˆë‹¤.`),u.winRate>60?L.push(`âœ… "${u.game}"ì—ì„œ ${u.winRate.toFixed(1)}%ì˜ ë†’ì€ ìŠ¹ë¥ ì„ ê¸°ë¡ ì¤‘ì…ë‹ˆë‹¤.`):u.winRate<40&&L.push(`âš ï¸ "${u.game}"ì—ì„œ ${u.winRate.toFixed(1)}%ì˜ ë‚®ì€ ìŠ¹ë¥ ë¡œ, ì „ëµ ê°œì„ ì´ í•„ìš”í•©ë‹ˆë‹¤.`)}L.push(`ğŸ• ì£¼ë¡œ ${ee}ì‹œì— ê°€ì¥ í™œë°œí•œ í™œë™ì„ ë³´ì…ë‹ˆë‹¤.`),q>40&&L.push(`ğŸŒ™ ì•¼ê°„ ì‹œê°„ëŒ€(22ì‹œ~6ì‹œ) í”Œë ˆì´ ë¹„ìœ¨ì´ ${q.toFixed(1)}%ë¡œ ë†’ìŠµë‹ˆë‹¤.`),W>55?L.push(`ğŸ“ˆ ì „ì²´ ìŠ¹ë¥  ${W.toFixed(1)}%ë¡œ í‰ê·  ì´ìƒì˜ ìš°ìˆ˜í•œ ì„±ê³¼ë¥¼ ë³´ì…ë‹ˆë‹¤.`):W<45?L.push(`ğŸ“‰ ì „ì²´ ìŠ¹ë¥  ${W.toFixed(1)}%ë¡œ ê²Œì„ ì „ëµ ì¬ê²€í† ê°€ í•„ìš”í•©ë‹ˆë‹¤.`):L.push(`ğŸ“Š ì „ì²´ ìŠ¹ë¥  ${W.toFixed(1)}%ë¡œ í‰ê· ì ì¸ ìˆ˜ì¤€ì…ë‹ˆë‹¤.`),C>0?L.push(`ğŸ’° ì´ ${Math.abs(C).toLocaleString()}ì›ì˜ ìˆ˜ìµì„ ë‹¬ì„±í–ˆìŠµë‹ˆë‹¤.`):L.push(`ğŸ’¸ ì´ ${Math.abs(C).toLocaleString()}ì›ì˜ ì†ì‹¤ì´ ë°œìƒí–ˆìŠµë‹ˆë‹¤.`),U>5e4&&L.push(`âš¡ í‰ê·  ë² íŒ…ì•¡ì´ ${U.toLocaleString()}ì›ìœ¼ë¡œ ê³ ì•¡ ë² íŒ… ì„±í–¥ì…ë‹ˆë‹¤.`),K/U>10&&L.push("ğŸ“Š ë² íŒ… ê¸ˆì•¡ ë³€ë™ì„±ì´ ë†’ì•„ ì¼ê´€ëœ ë² íŒ… ì „ëµì´ í•„ìš”í•©ë‹ˆë‹¤.");let se="";z==="HIGH"?se="ê³µê²©ì  ê³ ìœ„í—˜ í”Œë ˆì´ì–´":z==="MEDIUM"?W>50?se="ì ê·¹ì  ì•ˆì •í˜• í”Œë ˆì´ì–´":se="ë„ì „ì  ì¤‘ìœ„í—˜ í”Œë ˆì´ì–´":U<1e4?se="ë³´ìˆ˜ì  ì €ìœ„í—˜ í”Œë ˆì´ì–´":se="ì‹ ì¤‘í•œ ì•ˆì •í˜• í”Œë ˆì´ì–´",je({topGames:T,peakHour:ee,nightPlayRatio:q,avgBet:U,maxBet:K,totalBets:r.length,winRate:W,netProfit:C,riskLevel:z,userType:se,insights:L})}catch(r){console.error("íŒ¨í„´ ë¶„ì„ ì˜¤ë¥˜:",r),m.error("íŒ¨í„´ ë¶„ì„ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")}finally{_(!1)}},we=async()=>{try{ie(!0);const{md5Hash:r}=await De(async()=>{const{md5Hash:U}=await import("./index-CGvwOXPh.js").then(K=>K.a8);return{md5Hash:U}},__vite__mapDeps([3,1,0,2,4,5,6])),{data:d,error:T}=await c.from("api_configs").select("invest_opcode, invest_secret_key").eq("partner_id",n.referrer_id).maybeSingle();if(T){console.error("âŒ [ì‚¬ìš©ììƒì„¸] API config ì¡°íšŒ ì—ëŸ¬:",T),m.error("íŒŒíŠ¸ë„ˆ API ì„¤ì • ì¡°íšŒ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");return}if(!d?.invest_opcode||!d?.invest_secret_key){console.warn("âš ï¸ [ì‚¬ìš©ììƒì„¸] API config ì—†ìŒ. referrer_id:",n.referrer_id),m.error(`íŒŒíŠ¸ë„ˆ API ì„¤ì •ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. (Partner ID: ${n.referrer_id})`);return}const I=r(d.invest_opcode+d.invest_secret_key),Q=await(await fetch("https://vi8282.com/proxy",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:"https://api.invest-ho.com/api/game/limit",method:"GET",headers:{"Content-Type":"application/json"},body:{opcode:d.invest_opcode,signature:I}})})).json(),G=(Q.DATA||Q).limit||1e8;_e(G),le(G)}catch(r){console.error("ì—ë³¼ë£¨ì…˜ ì„¤ì • ì¡°íšŒ ì˜¤ë¥˜:",r),m.error("ì„¤ì •ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")}finally{ie(!1)}},Le=async()=>{try{ie(!0);const{md5Hash:r}=await De(async()=>{const{md5Hash:q}=await import("./index-CGvwOXPh.js").then(G=>G.a8);return{md5Hash:q}},__vite__mapDeps([3,1,0,2,4,5,6])),{data:d,error:T}=await c.from("api_configs").select("invest_opcode, invest_secret_key").eq("partner_id",n.referrer_id).single();if(T||!d?.invest_opcode||!d?.invest_secret_key){m.error("íŒŒíŠ¸ë„ˆ API ì„¤ì •ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");return}const I=r(d.invest_opcode+d.invest_secret_key),Q=await(await fetch("https://vi8282.com/proxy",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:"https://api.invest-ho.com/api/game/limit",method:"PUT",headers:{"Content-Type":"application/json"},body:{opcode:d.invest_opcode,users:[n.username],limit:V,signature:I}})})).json();Q.RESULT===!0||Q.result===!0?(m.success("ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤."),_e(V)):m.error("ì„¤ì • ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")}catch(r){console.error("ì—ë³¼ë£¨ì…˜ ì„¤ì • ì €ì¥ ì˜¤ë¥˜:",r),m.error("ì„¤ì •ì„ ì €ì¥í•˜ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")}finally{ie(!1)}};g.useEffect(()=>{!i||!n||(t==="basic"?ge():t==="transactions"?B():t==="betting"?he():t==="pattern"?O():t==="evolution"&&we())},[t,i,n]);const D=r=>`â‚©${r.toLocaleString()}`,fe=r=>{const d=new Date(r);return`${d.getFullYear()}.${String(d.getMonth()+1).padStart(2,"0")}.${String(d.getDate()).padStart(2,"0")}`},ce=r=>{const d=new Date(r);return`${d.getFullYear()}.${String(d.getMonth()+1).padStart(2,"0")}.${String(d.getDate()).padStart(2,"0")} ${String(d.getHours()).padStart(2,"0")}:${String(d.getMinutes()).padStart(2,"0")}`},H=r=>{switch(r){case"approved":case"completed":return e.jsx(A,{className:"bg-green-500/20 text-green-400 border-green-500/30",children:"ìŠ¹ì¸"});case"pending":return e.jsx(A,{className:"bg-yellow-500/20 text-yellow-400 border-yellow-500/30",children:"ëŒ€ê¸°"});case"rejected":return e.jsx(A,{className:"bg-red-500/20 text-red-400 border-red-500/30",children:"ê±°ì ˆ"});default:return e.jsx(A,{children:r})}};return n?e.jsx(Te,{open:i,onOpenChange:p,children:e.jsxs(Ue,{className:"!max-w-[2400px] w-[98vw] max-h-[92vh] overflow-hidden glass-card border border-white/10 p-0",children:[e.jsxs(Ee,{className:"border-b border-white/10 pb-3 pt-4 px-6",children:[e.jsxs(Re,{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center",children:e.jsx(Oe,{className:"h-5 w-5 text-white"})}),e.jsx("div",{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-lg",children:n.nickname}),e.jsxs("span",{className:"text-muted-foreground",children:["(",n.username,")"]}),n.status==="active"?e.jsx(A,{className:"bg-green-500/20 text-green-400 border-green-500/30",children:"í™œì„±"}):n.status==="suspended"?e.jsx(A,{className:"bg-red-500/20 text-red-400 border-red-500/30",children:"ì •ì§€"}):e.jsx(A,{className:"bg-yellow-500/20 text-yellow-400 border-yellow-500/30",children:"ëŒ€ê¸°"}),n.is_online&&e.jsx(A,{className:"bg-green-500/20 text-green-400 border-green-500/30",children:"ì ‘ì†ì¤‘"})]})})]}),e.jsx(Be,{className:"text-sm text-muted-foreground mt-0.5 pl-12",children:"íšŒì›ì˜ ìƒì„¸ ì •ë³´, ì…ì¶œê¸ˆ ë‚´ì—­, ë² íŒ… ë‚´ì—­ ë° AI ê²Œì„ íŒ¨í„´ ë¶„ì„ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤."})]}),e.jsxs(hs,{value:t,onValueChange:b,className:"w-full px-6",children:[e.jsx("div",{className:"bg-slate-800/30 rounded-xl p-1.5 border border-slate-700/40",children:e.jsxs(fs,{className:"bg-transparent h-auto p-0 border-0 gap-2 w-full grid grid-cols-5",children:[e.jsxs(be,{value:"basic",className:"bg-transparent text-slate-400 rounded-lg px-4 py-3 data-[state=active]:bg-gradient-to-br data-[state=active]:from-blue-500/20 data-[state=active]:to-cyan-500/10 data-[state=active]:text-white data-[state=active]:shadow-lg data-[state=active]:shadow-blue-500/20 data-[state=active]:border data-[state=active]:border-blue-400/30 transition-all duration-200",children:[e.jsx(Oe,{className:"h-4 w-4 mr-2"}),e.jsx("span",{className:"text-sm",children:"ê¸°ë³¸ì •ë³´"})]}),e.jsxs(be,{value:"transactions",className:"bg-transparent text-slate-400 rounded-lg px-4 py-3 data-[state=active]:bg-gradient-to-br data-[state=active]:from-green-500/20 data-[state=active]:to-emerald-500/10 data-[state=active]:text-white data-[state=active]:shadow-lg data-[state=active]:shadow-green-500/20 data-[state=active]:border data-[state=active]:border-green-400/30 transition-all duration-200",children:[e.jsx(Ie,{className:"h-4 w-4 mr-2"}),e.jsx("span",{className:"text-sm",children:"ì…ì¶œê¸ˆë‚´ì—­"})]}),e.jsxs(be,{value:"betting",className:"bg-transparent text-slate-400 rounded-lg px-4 py-3 data-[state=active]:bg-gradient-to-br data-[state=active]:from-purple-500/20 data-[state=active]:to-pink-500/10 data-[state=active]:text-white data-[state=active]:shadow-lg data-[state=active]:shadow-purple-500/20 data-[state=active]:border data-[state=active]:border-purple-400/30 transition-all duration-200",children:[e.jsx($e,{className:"h-4 w-4 mr-2"}),e.jsx("span",{className:"text-sm",children:"ë² íŒ…ë‚´ì—­"})]}),e.jsxs(be,{value:"pattern",className:"bg-transparent text-slate-400 rounded-lg px-4 py-3 data-[state=active]:bg-gradient-to-br data-[state=active]:from-orange-500/20 data-[state=active]:to-amber-500/10 data-[state=active]:text-white data-[state=active]:shadow-lg data-[state=active]:shadow-orange-500/20 data-[state=active]:border data-[state=active]:border-orange-400/30 transition-all duration-200",children:[e.jsx(ye,{className:"h-4 w-4 mr-2"}),e.jsx("span",{className:"text-sm",children:"AI ê²Œì„íŒ¨í„´"})]}),e.jsxs(be,{value:"evolution",className:"bg-transparent text-slate-400 rounded-lg px-4 py-3 data-[state=active]:bg-gradient-to-br data-[state=active]:from-red-500/20 data-[state=active]:to-rose-500/10 data-[state=active]:text-white data-[state=active]:shadow-lg data-[state=active]:shadow-red-500/20 data-[state=active]:border data-[state=active]:border-red-400/30 transition-all duration-200",children:[e.jsx(qe,{className:"h-4 w-4 mr-2"}),e.jsx("span",{className:"text-sm",children:"ì—ë³¼ë£¨ì…˜ ì„¤ì •"})]})]})}),e.jsx(ve,{value:"basic",className:"max-h-[calc(92vh-140px)] overflow-y-auto pr-2 pt-3",children:h?e.jsx(xe,{}):e.jsxs("div",{className:"space-y-5 p-4",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"flex items-center gap-2 mb-4",children:[e.jsx(Oe,{className:"h-4 w-4 text-blue-400"}),e.jsx("span",{className:"text-base",children:"ê¸°ë³¸ ì •ë³´"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-x-6 gap-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between py-3 px-4 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"ì•„ì´ë””"}),e.jsx("span",{className:"text-base font-mono",children:n.username})]}),e.jsxs("div",{className:"flex items-center justify-between py-3 px-4 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"ë‹‰ë„¤ì„"}),e.jsx("span",{className:"text-base",children:n.nickname})]}),e.jsxs("div",{className:"flex items-center justify-between py-3 px-4 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"ê°€ì…ì¼"}),e.jsx("span",{className:"text-base",children:fe(n.created_at)})]}),e.jsxs("div",{className:"flex items-center justify-between py-3 px-4 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"ê°€ì… ê²½ê³¼"}),e.jsxs("span",{className:"text-base",children:[N.accountAge,"ì¼"]})]}),e.jsxs("div",{className:"flex items-center justify-between py-3 px-4 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"ì€í–‰"}),e.jsx("span",{className:"text-base",children:n.bank_name||"-"})]}),e.jsxs("div",{className:"flex items-center justify-between py-3 px-4 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"ê³„ì¢Œë²ˆí˜¸"}),e.jsx("span",{className:"text-base font-mono",children:n.bank_account||"-"})]})]})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"flex items-center gap-2 mb-4",children:[e.jsx(Ie,{className:"h-4 w-4 text-emerald-400"}),e.jsx("span",{className:"text-base",children:"ì”ê³  ì •ë³´"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-x-6 gap-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between py-3 px-4 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"ë³´ìœ ê¸ˆ"}),e.jsx("span",{className:"text-lg font-mono",children:D(n.balance||0)})]}),e.jsxs("div",{className:"flex items-center justify-between py-3 px-4 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"í¬ì¸íŠ¸"}),e.jsx("span",{className:"text-lg font-mono",children:D(n.points||0)})]}),e.jsxs("div",{className:"flex items-center justify-between py-3 px-4 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"ì´ ì…ê¸ˆ"}),e.jsx("span",{className:"text-lg font-mono text-blue-400",children:D(N.totalDeposit)})]}),e.jsxs("div",{className:"flex items-center justify-between py-3 px-4 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"ì´ ì¶œê¸ˆ"}),e.jsx("span",{className:"text-lg font-mono text-pink-400",children:D(N.totalWithdraw)})]}),e.jsxs("div",{className:"flex items-center justify-between py-3 px-4 rounded-lg bg-gradient-to-r from-white/10 to-white/5 border border-white/20",children:[e.jsx("span",{className:"text-base",children:"ìˆœ ì…ì¶œê¸ˆ"}),e.jsx("span",{className:`text-lg font-mono ${N.totalDeposit-N.totalWithdraw>=0?"text-green-400":"text-red-400"}`,children:D(N.totalDeposit-N.totalWithdraw)})]}),e.jsxs("div",{className:"flex items-center justify-between py-3 px-4 rounded-lg bg-gradient-to-r from-white/10 to-white/5 border border-white/20",children:[e.jsx("span",{className:"text-base",children:"ê²Œì„ ì†ìµ"}),e.jsxs("span",{className:`text-lg font-mono ${N.totalWinAmount-N.totalBets>=0?"text-green-400":"text-red-400"}`,children:[N.totalWinAmount-N.totalBets>=0?"+":"",D(N.totalWinAmount-N.totalBets)]})]})]})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"flex items-center gap-2 mb-4",children:[e.jsx(ss,{className:"h-4 w-4 text-amber-400"}),e.jsx("span",{className:"text-base",children:"ë² íŒ… í†µê³„"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-x-6 gap-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between py-3 px-4 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"ê²Œì„ í”Œë ˆì´"}),e.jsxs("span",{className:"text-base font-mono",children:[N.gameCount,"íšŒ"]})]}),e.jsxs("div",{className:"flex items-center justify-between py-3 px-4 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"ìŠ¹ë¥ "}),e.jsxs("span",{className:`text-base font-mono ${N.winRate>50?"text-green-400":"text-red-400"}`,children:[N.winRate.toFixed(1),"%"]})]}),e.jsxs("div",{className:"flex items-center justify-between py-3 px-4 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"ì´ ë² íŒ…ì•¡"}),e.jsx("span",{className:"text-base font-mono",children:D(N.totalBets)})]}),e.jsxs("div",{className:"flex items-center justify-between py-3 px-4 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"ì´ ë‹¹ì²¨ì•¡"}),e.jsx("span",{className:"text-base font-mono",children:D(N.totalWinAmount)})]})]})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"flex items-center gap-2 mb-4",children:[e.jsx(Pe,{className:"h-4 w-4 text-purple-400"}),e.jsx("span",{className:"text-base",children:"í™œë™ ì •ë³´"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-x-6 gap-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between py-3 px-4 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"ìµœê·¼ í™œë™"}),e.jsx("span",{className:"text-base",children:ce(N.lastActivity)})]}),e.jsxs("div",{className:"flex items-center justify-between py-3 px-4 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"ì¶”ì²œì¸"}),e.jsx("span",{className:"text-base",children:n.referrer?.username||"-"})]}),n.memo&&e.jsxs("div",{className:"col-span-2 py-3 px-4 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("span",{className:"text-sm text-muted-foreground block mb-1.5",children:"ë©”ëª¨"}),e.jsx("span",{className:"text-base",children:n.memo})]})]})]}),e.jsx(Ys,{userId:n.id})]})}),e.jsx(ve,{value:"transactions",className:"max-h-[calc(92vh-140px)] overflow-y-auto pr-2 pt-3",children:h?e.jsx(xe,{}):R.length===0?e.jsxs("div",{className:"text-center py-12 glass-card rounded-xl",children:[e.jsx(Ie,{className:"h-16 w-16 text-muted-foreground mx-auto mb-4 opacity-50"}),e.jsx("p",{className:"text-muted-foreground text-base",children:"ì…ì¶œê¸ˆ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤."})]}):e.jsx("div",{className:"glass-card rounded-xl overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"border-b border-white/10",children:e.jsxs("tr",{className:"bg-white/5",children:[e.jsx("th",{className:"px-4 py-3.5 text-left text-sm",children:"êµ¬ë¶„"}),e.jsx("th",{className:"px-4 py-3.5 text-left text-sm",children:"ìƒíƒœ"}),e.jsx("th",{className:"px-4 py-3.5 text-left text-sm",children:"ì¼ì‹œ"}),e.jsx("th",{className:"px-4 py-3.5 text-left text-sm",children:"ë©”ëª¨"}),e.jsx("th",{className:"px-4 py-3.5 text-right text-sm",children:"ê¸ˆì•¡"})]})}),e.jsx("tbody",{children:R.map(r=>e.jsxs("tr",{className:"border-b border-white/5 hover:bg-white/5 transition-colors",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`p-1.5 rounded-lg ${r.transaction_type==="deposit"?"bg-green-500/20":"bg-red-500/20"}`,children:r.transaction_type==="deposit"?e.jsx(Ps,{className:"h-4 w-4 text-green-400"}):e.jsx(As,{className:"h-4 w-4 text-red-400"})}),e.jsx("span",{className:"text-sm",children:r.transaction_type==="deposit"?"ì…ê¸ˆ":"ì¶œê¸ˆ"})]})}),e.jsx("td",{className:"px-4 py-3",children:H(r.status)}),e.jsx("td",{className:"px-4 py-3 text-muted-foreground text-sm",children:ce(r.created_at)}),e.jsx("td",{className:"px-4 py-3 text-muted-foreground text-sm max-w-xs truncate",children:r.notes||"-"}),e.jsx("td",{className:"px-4 py-3 text-right",children:e.jsxs("span",{className:`font-mono text-base ${r.transaction_type==="deposit"?"text-green-400":"text-red-400"}`,children:[r.transaction_type==="deposit"?"+":"-",D(r.amount)]})})]},r.id))})]})})})}),e.jsx(ve,{value:"betting",className:"max-h-[calc(92vh-140px)] overflow-y-auto pr-2 pt-3",children:h?e.jsx(xe,{}):y.length===0?e.jsxs("div",{className:"text-center py-12 glass-card rounded-xl",children:[e.jsx($e,{className:"h-16 w-16 text-muted-foreground mx-auto mb-4 opacity-50"}),e.jsx("p",{className:"text-muted-foreground text-base",children:"ë² íŒ… ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤."})]}):e.jsx("div",{className:"glass-card rounded-xl overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"border-b border-white/10",children:e.jsxs("tr",{className:"bg-white/5",children:[e.jsx("th",{className:"px-4 py-3.5 text-left text-sm",children:"ê²Œì„"}),e.jsx("th",{className:"px-4 py-3.5 text-left text-sm",children:"í”„ë¡œë°”ì´ë”"}),e.jsx("th",{className:"px-4 py-3.5 text-left text-sm",children:"ì¼ì‹œ"}),e.jsx("th",{className:"px-4 py-3.5 text-right text-sm",children:"ë² íŒ…"}),e.jsx("th",{className:"px-4 py-3.5 text-right text-sm",children:"ë‹¹ì²¨"}),e.jsx("th",{className:"px-4 py-3.5 text-right text-sm",children:"ì†ìµ"})]})}),e.jsx("tbody",{children:y.map(r=>{const d=(r.win_amount||0)>(r.bet_amount||0),T=(r.win_amount||0)-(r.bet_amount||0);return e.jsxs("tr",{className:"border-b border-white/5 hover:bg-white/5 transition-colors",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`p-1.5 rounded-lg ${d?"bg-green-500/20":"bg-red-500/20"}`,children:e.jsx($e,{className:`h-4 w-4 ${d?"text-green-400":"text-red-400"}`})}),e.jsx("span",{className:"text-sm",children:r.game_title||`ê²Œì„ ID: ${r.game_id}`})]})}),e.jsx("td",{className:"px-4 py-3 text-muted-foreground text-sm",children:r.provider_name||`í”„ë¡œë°”ì´ë” ${r.provider_id}`}),e.jsx("td",{className:"px-4 py-3 text-muted-foreground text-sm",children:ce(r.played_at)}),e.jsx("td",{className:"px-4 py-3 text-right font-mono text-sm",children:D(r.bet_amount||0)}),e.jsx("td",{className:"px-4 py-3 text-right font-mono text-sm",children:D(r.win_amount||0)}),e.jsx("td",{className:"px-4 py-3 text-right",children:e.jsxs("span",{className:`font-mono text-base ${d?"text-green-400":"text-red-400"}`,children:[T>=0?"+":"",D(T)]})})]},r.id)})})]})})})}),e.jsx(ve,{value:"pattern",className:"space-y-3 max-h-[calc(92vh-140px)] overflow-y-auto pr-2 pt-3",children:h?e.jsx(xe,{}):$?e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{className:"grid gap-4 grid-cols-4",children:[e.jsx(te,{className:"glass-card metric-gradient-purple",children:e.jsxs(ae,{className:"pt-4 pb-4 px-5",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2.5",children:[e.jsx(Ls,{className:"h-4 w-4 text-white"}),e.jsx("h3",{className:"text-sm text-white",children:"ì‚¬ìš©ì ì„±í–¥"})]}),e.jsx("p",{className:"text-base font-bold text-white mb-1.5",children:$.userType}),e.jsx("p",{className:"text-sm text-white/80",children:"ë² íŒ… íŒ¨í„´ ì¢…í•© ë¶„ì„"})]})}),e.jsx(te,{className:"glass-card",children:e.jsxs(ae,{className:"pt-4 pb-4 px-5",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2.5",children:[e.jsx(Ss,{className:"h-4 w-4 text-yellow-400"}),e.jsx("h3",{className:"text-sm",children:"ë¦¬ìŠ¤í¬ ë¶„ì„"})]}),e.jsx(A,{className:`px-2.5 py-1 mb-2 ${$.riskLevel==="HIGH"?"bg-red-500/20 text-red-400 border-red-500/30":$.riskLevel==="MEDIUM"?"bg-yellow-500/20 text-yellow-400 border-yellow-500/30":"bg-green-500/20 text-green-400 border-green-500/30"}`,children:$.riskLevel==="HIGH"?"ê³ ìœ„í—˜":$.riskLevel==="MEDIUM"?"ì¤‘ìœ„í—˜":"ì €ìœ„í—˜"}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["í‰ê· : ",e.jsx("span",{className:"font-mono text-base",children:D($.avgBet)})]})]})}),e.jsx(te,{className:"glass-card",children:e.jsxs(ae,{className:"pt-4 pb-4 px-5",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2.5",children:[e.jsx(Cs,{className:"h-4 w-4 text-cyan-400"}),e.jsx("h3",{className:"text-sm",children:"ë² íŒ… í†µê³„"})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"ì´ ë² íŒ…"}),e.jsxs("span",{className:"text-base font-mono",children:[$.totalBets,"íšŒ"]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"ìŠ¹ë¥ "}),e.jsxs("span",{className:`text-base font-mono ${$.winRate>50?"text-green-400":"text-red-400"}`,children:[$.winRate.toFixed(1),"%"]})]})]})]})}),e.jsx(te,{className:"glass-card",children:e.jsxs(ae,{className:"pt-4 pb-4 px-5",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2.5",children:[e.jsx(Pe,{className:"h-4 w-4 text-orange-400"}),e.jsx("h3",{className:"text-sm",children:"ì‹œê°„ íŒ¨í„´"})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"í”¼í¬"}),e.jsxs("span",{className:"text-base font-mono",children:[$.peakHour,"ì‹œ"]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"ì•¼ê°„"}),e.jsxs("span",{className:"text-base font-mono",children:[$.nightPlayRatio.toFixed(1),"%"]})]})]})]})})]}),e.jsx(te,{className:"glass-card",children:e.jsxs(ae,{className:"pt-4 pb-4 px-5",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3 pb-3 border-b border-white/10",children:[e.jsx(ks,{className:"h-4 w-4 text-yellow-400"}),e.jsx("h3",{className:"text-sm",children:"ì„ í˜¸ ê²Œì„ TOP 5"})]}),e.jsx("div",{className:"grid grid-cols-5 gap-3",children:$.topGames.map((r,d)=>e.jsxs("div",{className:"p-3 rounded-lg bg-white/5 hover:bg-white/10 transition-colors",children:[e.jsxs(A,{className:"bg-blue-500/20 text-blue-400 border-blue-500/30 px-2 py-0.5 mb-2",children:[d+1,"ìœ„"]}),e.jsx("p",{className:"text-sm mb-1 truncate",children:r.game}),e.jsx("p",{className:"text-sm text-muted-foreground mb-2 truncate",children:r.provider}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{className:"font-mono text-sm",children:[r.count,"íšŒ"]}),e.jsxs("p",{className:`text-sm ${r.winRate>50?"text-green-400":"text-red-400"}`,children:["ìŠ¹ë¥  ",r.winRate.toFixed(1),"%"]})]})]},d))})]})}),e.jsx(te,{className:"glass-card",children:e.jsxs(ae,{className:"pt-4 pb-4 px-5",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3 pb-3 border-b border-white/10",children:[e.jsx(ye,{className:"h-4 w-4 text-purple-400"}),e.jsx("h3",{className:"text-sm",children:"AI ë¶„ì„ ì¸ì‚¬ì´íŠ¸"})]}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:$.insights.map((r,d)=>e.jsxs("div",{className:"flex items-start gap-2 p-3 rounded-lg bg-purple-500/10 border border-purple-500/20 hover:bg-purple-500/15 transition-colors",children:[e.jsx(ye,{className:"h-4 w-4 text-purple-400 mt-0.5 flex-shrink-0"}),e.jsx("p",{className:"text-sm leading-relaxed",children:r})]},d))})]})})]}):e.jsxs("div",{className:"text-center py-12 glass-card rounded-xl",children:[e.jsx(ye,{className:"h-16 w-16 text-muted-foreground mx-auto mb-4 opacity-50"}),e.jsx("p",{className:"text-muted-foreground text-base mb-2",children:"ë¶„ì„í•  ë² íŒ… ë°ì´í„°ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤."})]})}),e.jsx(ve,{value:"evolution",className:"max-h-[calc(92vh-140px)] overflow-y-auto pr-2 pt-3",children:re?e.jsx(xe,{}):e.jsx("div",{className:"space-y-4 p-4",children:e.jsx(te,{className:"glass-card",children:e.jsxs(ae,{className:"pt-6 pb-6 px-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-5 pb-4 border-b border-white/10",children:[e.jsx(qe,{className:"h-5 w-5 text-red-400"}),e.jsx("h3",{className:"text-base",children:"ì—ë³¼ë£¨ì…˜ ìµœëŒ€ë°°íŒ…ê¸ˆ ì„¤ì •"})]}),e.jsxs("div",{className:"space-y-5",children:[oe!==null&&e.jsx("div",{className:"p-4 rounded-lg bg-blue-500/10 border border-blue-500/30",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-slate-400",children:"í˜„ì¬ ì„¤ì •"}),e.jsxs("span",{className:"font-mono text-lg text-blue-400",children:[oe.toLocaleString(),"ì›"]})]})}),e.jsxs("div",{className:"p-4 rounded-lg bg-slate-800/30 border border-slate-700",children:[e.jsx("div",{className:"text-sm text-slate-400 mb-2",children:"íšŒì› ì•„ì´ë””"}),e.jsx("div",{className:"font-mono text-base text-white",children:n.username})]}),e.jsxs("div",{children:[e.jsx(X,{className:"text-sm text-slate-400 mb-2",children:"ìµœëŒ€ë°°íŒ…ê¸ˆì•¡"}),e.jsx(Z,{type:"number",value:V,onChange:r=>{const d=parseInt(r.target.value)||0;le(d)},className:"bg-slate-800/50 border-slate-700 text-white font-mono text-base",placeholder:"ê¸ˆì•¡ ì…ë ¥"}),e.jsxs("p",{className:"text-sm text-slate-500 mt-2",children:[V.toLocaleString(),"ì›"]})]}),e.jsx("div",{className:"grid grid-cols-4 gap-2",children:[{value:1e5,label:"1ì‹­ë§Œ"},{value:5e5,label:"5ì‹­ë§Œ"},{value:1e6,label:"1ë°±ë§Œ"},{value:5e6,label:"5ë°±ë§Œ"},{value:1e7,label:"1ì²œë§Œ"},{value:5e7,label:"5ì²œë§Œ"},{value:1e8,label:"10ì²œë§Œ"}].map(r=>e.jsx(M,{variant:"outline",size:"sm",onClick:()=>le(d=>d+r.value),className:"bg-slate-800/50 border-slate-700 hover:bg-slate-700 text-sm font-mono",children:r.label},r.value))}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx(M,{variant:"outline",onClick:()=>le(oe||1e8),className:"flex-1 border-slate-700 text-slate-300 hover:bg-slate-700/50 text-sm",children:"ì´ˆê¸°í™”"}),e.jsx(M,{onClick:Le,disabled:re,className:"flex-1 bg-gradient-to-r from-red-500 to-rose-600 hover:from-red-600 hover:to-rose-700 text-sm",children:re?"ì €ì¥ ì¤‘...":"ì €ì¥"})]})]})]})})})})]})]})}):null}const Ws={1:"ì‹œìŠ¤í…œê´€ë¦¬ì",2:"ëŒ€ë³¸ì‚¬",3:"ë³¸ì‚¬",4:"ë¶€ë³¸ì‚¬",5:"ì´íŒ",6:"ë§¤ì¥",7:"ì‚¬ìš©ì"};function zs(){const{authState:n}=es(),[i,p]=g.useState(null),[f,t]=g.useState(!0);return g.useEffect(()=>{(async()=>{if(!n.user?.id){t(!1);return}try{const{data:h,error:_}=await c.from("partners").select("level").eq("id",n.user.id).maybeSingle();_?(console.error("ì‚¬ìš©ì ë ˆë²¨ í™•ì¸ ì˜¤ë¥˜:",_),p(null)):h?p(h.level||null):(console.log("íŒŒíŠ¸ë„ˆê°€ ì•„ë‹™ë‹ˆë‹¤. ì¼ë°˜ ì‚¬ìš©ìë¡œ íŒë‹¨í•©ë‹ˆë‹¤."),p(7))}catch(h){console.error("ì‚¬ìš©ì ë ˆë²¨ í™•ì¸ ì‹¤íŒ¨:",h),p(null)}finally{t(!1)}})()},[n.user?.id]),{userLevel:i,loading:f,isSystemAdmin:i===1,canManageUsers:i&&i<=6,getLevelName:b=>Ws[b]||"ì•Œ ìˆ˜ ì—†ìŒ"}}const Vs=["KBêµ­ë¯¼ì€í–‰","ì‹ í•œì€í–‰","ìš°ë¦¬ì€í–‰","í•˜ë‚˜ì€í–‰","ë†í˜‘ì€í–‰","IBKê¸°ì—…ì€í–‰","ë¶€ì‚°ì€í–‰","ëŒ€êµ¬ì€í–‰","ê´‘ì£¼ì€í–‰","ì „ë¶ì€í–‰","ê²½ë‚¨ì€í–‰","ì œì£¼ì€í–‰","SCì œì¼ì€í–‰","HSBCì€í–‰","KDBì‚°ì—…ì€í–‰","NHë†í˜‘ì€í–‰","ì‹ í˜‘ì¤‘ì•™íšŒ","ìš°ì²´êµ­ì˜ˆê¸ˆë³´í—˜","ìƒˆë§ˆì„ê¸ˆê³ ","ì¹´ì¹´ì˜¤ë±…í¬","ì¼€ì´ë±…í¬","í† ìŠ¤ë±…í¬"];function ot(){const{authState:n}=es(),{lastMessage:i,connected:p,sendMessage:f}=bs();zs();const{t}=Ye(),[b,h]=g.useState([]),[_,R]=g.useState(!0),[w,y]=g.useState(""),[Y,$]=g.useState("all"),[je,N]=g.useState(!1),[Ae,V]=g.useState(!1),[le,oe]=g.useState(!1),[_e,re]=g.useState(!1),[ie,ge]=g.useState("deposit"),[B,he]=g.useState(null),[O,we]=g.useState(null),[Le,D]=g.useState(null),[fe,ce]=g.useState(!1),[H,r]=g.useState(null),[d,T]=g.useState(!1),[I,ee]=g.useState([]),[Q,q]=g.useState(0),[G,U]=g.useState(0),[K,de]=g.useState(0),[k,C]=g.useState(0),[as,W]=g.useState(0),[P,z]=g.useState({username:"",nickname:"",password:"",bank_name:"",bank_account:"",memo:"",selected_referrer_id:""}),L=async(s=!1)=>{try{s||R(!0);let a=[];if(n.user?.level===1){const{data:x,error:v}=await c.from("users").select(`
            *,
            balance_sync_call_count,
            balance_sync_started_at,
            referrer:partners!referrer_id(
              id,
              username,
              level
            )
          `).order("created_at",{ascending:!1});if(v)throw v;h(x||[]);return}else{const{data:x}=await c.rpc("get_hierarchical_partners",{p_partner_id:n.user?.id});a=[n.user?.id||"",...x?.map(v=>v.id)||[]]}const{data:o,error:l}=await c.from("users").select(`
          *,
          balance_sync_call_count,
          balance_sync_started_at,
          referrer:partners!referrer_id(
            id,
            username,
            level
          )
        `).in("referrer_id",a).order("created_at",{ascending:!1});if(l)throw l;h(o||[])}catch(a){console.error("âŒ íšŒì› ëª©ë¡ ì¡°íšŒ ì‹¤íŒ¨:",a),s||m.error("íšŒì› ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤."),h([])}finally{s||R(!1)}},He=async()=>{if(n.user?.id)try{const{data:s,error:a}=await c.from("partners").select("balance, level").eq("id",n.user.id).single();if(a)throw a;console.log("ğŸ’° [UserManagement] ê´€ë¦¬ì ë³´ìœ ê¸ˆ ì¡°íšŒ (partners í…Œì´ë¸”):",{level:s?.level,balance:s?.balance}),q(s?.balance||0),console.log("âœ… ê´€ë¦¬ì ë³´ìœ ê¸ˆ ì„¤ì •:",s?.balance||0)}catch(s){console.error("âŒ í˜„ì¬ ì‚¬ìš©ì ë³´ìœ ê¸ˆ ì¡°íšŒ ì‹¤íŒ¨:",s)}};g.useEffect(()=>{L(),He(),n.user?.level===1&&se()},[n.user?.id,n.user?.level]);const se=async()=>{try{const{data:s}=await c.from("partners").select("id, username, nickname, partner_type, level").in("partner_type",["head_office","main_office","sub_office","distributor","store"]).eq("status","active").order("level",{ascending:!0}).order("created_at",{ascending:!0});ee(s||[])}catch(s){console.error("ì†Œì† íŒŒíŠ¸ë„ˆ ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨:",s)}};g.useEffect(()=>{if(!n.user?.id)return;const s=c.channel("users-changes").on("postgres_changes",{event:"*",schema:"public",table:"users"},o=>{console.log("ğŸ‘¥ users í…Œì´ë¸” ë³€ê²½ ê°ì§€:",o),L(!0)}).subscribe(),a=c.channel("current-partner-balance").on("postgres_changes",{event:"UPDATE",schema:"public",table:"partners",filter:`id=eq.${n.user.id}`},o=>{const l=o.new;console.log("ğŸ’° í˜„ì¬ ê´€ë¦¬ì ë³´ìœ ê¸ˆ ë³€ê²½ (partners):",{balance:l.balance,invest_balance:l.invest_balance,oroplay_balance:l.oroplay_balance,level:l.level}),q(l.balance||0)}).subscribe();return()=>{c.removeChannel(s),c.removeChannel(a)}},[n.user?.id]),g.useEffect(()=>{(i?.type==="user_balance_updated"||i?.type==="user_updated")&&(console.log("ğŸ”” ì‚¬ìš©ì ì—…ë°ì´íŠ¸ ì•Œë¦¼ ìˆ˜ì‹ :",i),L(!0))},[i]),g.useEffect(()=>{(async()=>{if(!B?.id){U(0),C(0),W(0),de(0);return}try{console.log("ğŸ” [ForceTransaction] ëŒ€ìƒ ì‚¬ìš©ì:",{id:B.id,username:B.username,referrer_id:B.referrer_id,referrer:B.referrer});const a=B.referrer_id;if(!a){console.error("âŒ ì‚¬ìš©ìì˜ referrer_idê°€ ì—†ìŠµë‹ˆë‹¤.");return}const{data:o,error:l}=await c.from("partners").select("balance, level, username").eq("id",a).single();if(l||!o){console.error("âŒ íŒŒíŠ¸ë„ˆ ì •ë³´ ì¡°íšŒ ì‹¤íŒ¨:",l);return}if(console.log("ğŸ’° [ForceTransaction] ì†Œì† íŒŒíŠ¸ë„ˆ ë³´ìœ ê¸ˆ ì¡°íšŒ:",{partnerId:a,username:o.username,level:o.level,balance:o.balance}),de(o.level),o.level===1){const{data:x,error:v}=await c.from("api_configs").select("balance, api_provider").eq("partner_id",a);if(!v&&x){const j=x.find(E=>E.api_provider==="invest")?.balance||0,F=x.find(E=>E.api_provider==="oroplay")?.balance||0;C(j),W(F),console.log("âœ… Lv1 ì†Œì† íŒŒíŠ¸ë„ˆ ë³´ìœ ê¸ˆ ì„¤ì • (api_configs):",{invest:j,oroplay:F})}else console.warn("âš ï¸ Lv1 api_configs ì¡°íšŒ ì‹¤íŒ¨:",v),C(0),W(0)}else o.level===2?(C(o.invest_balance||0),W(o.oroplay_balance||0),console.log("âœ… Lv2 ì†Œì† íŒŒíŠ¸ë„ˆ ë³´ìœ ê¸ˆ ì„¤ì • (ë‘ ê°œ ì§€ê°‘):",{invest_balance:o.invest_balance||0,oroplay_balance:o.oroplay_balance||0})):(U(o.balance||0),console.log("âœ… Lv3~7 ì†Œì† íŒŒíŠ¸ë„ˆ ë³´ìœ ê¸ˆ ì„¤ì •:",o.balance||0))}catch(a){console.error("âŒ ì†Œì† íŒŒíŠ¸ë„ˆ ë³´ìœ ê¸ˆ ì¡°íšŒ ì‹¤íŒ¨:",a)}})()},[B?.id]);const u=async()=>{if(!P.username||!P.password){m.error("ì•„ì´ë””ì™€ ë¹„ë°€ë²ˆí˜¸ëŠ” í•„ìˆ˜ì…ë‹ˆë‹¤.");return}if(d){console.warn("âš ï¸ íšŒì› ìƒì„±ì´ ì´ë¯¸ ì§„í–‰ ì¤‘ì…ë‹ˆë‹¤.");return}const s={...P};N(!1),z({username:"",nickname:"",password:"",bank_name:"",bank_account:"",memo:"",selected_referrer_id:""}),T(!0);try{console.log("ğŸ‘¤ ìƒˆ íšŒì› ìƒì„± ì‹œì‘:",s.username),m.loading(`[1/4] ì•„ì´ë”” ì¤‘ë³µ í™•ì¸ ì¤‘... (${s.username})`,{id:"create-user"});const{data:a}=await c.from("users").select("id").eq("username",s.username).maybeSingle();if(a){m.error(`ì´ë¯¸ ì‚¬ìš© ì¤‘ì¸ ì•„ì´ë””ì…ë‹ˆë‹¤ (íšŒì›): ${s.username}`,{id:"create-user"});return}const{data:o}=await c.from("partners").select("id").eq("username",s.username).maybeSingle();if(o){m.error(`ì´ë¯¸ ì‚¬ìš© ì¤‘ì¸ ì•„ì´ë””ì…ë‹ˆë‹¤ (íŒŒíŠ¸ë„ˆ): ${s.username}`,{id:"create-user"});return}m.loading(`[2/4] DBì— íšŒì› ì •ë³´ ì €ì¥ ì¤‘... (${s.username})`,{id:"create-user"});const l=n.user?.level===1&&s.selected_referrer_id?s.selected_referrer_id:n.user?.id,{data:x,error:v}=await c.from("users").insert({username:s.username,nickname:s.nickname||s.username,password_hash:s.password,bank_name:s.bank_name||null,bank_account:s.bank_account||null,memo:s.memo||null,referrer_id:l,status:"active",balance:0,points:0,api_account_status:"pending",api_invest_created:!1,api_oroplay_created:!1,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}).select().single();if(v){console.error("âŒ íšŒì› ìƒì„± DB ì˜¤ë¥˜:",v),v.code==="23505"?m.error(`ì´ë¯¸ ì‚¬ìš© ì¤‘ì¸ ì•„ì´ë””ì…ë‹ˆë‹¤: ${s.username}`,{id:"create-user"}):m.error(`íšŒì› ìƒì„± ì‹¤íŒ¨: ${v.message}`,{id:"create-user"});return}console.log("âœ… DB íšŒì› ìƒì„± ì™„ë£Œ:",x),m.loading(`[3/5] ì™¸ë¶€ API ê³„ì • ìƒì„± ì¤‘... (${s.username})`,{id:"create-user"}),console.log("ğŸŒ ì™¸ë¶€ API ê³„ì • ìƒì„± ì‹œì‘ (Invest + OroPlay)");const j=await Fe(x.id,s.username,n.user?.id||"","create-user");console.log("ğŸ” API ê³„ì • ìƒì„± ê²°ê³¼:",j),j.status==="error"?(m.error(`âš ï¸ API ê³„ì • ìƒì„± ì‹¤íŒ¨: ${j.errorMessage}`,{id:"create-user",duration:1e4}),console.error("âŒ ì™¸ë¶€ API ê³„ì • ìƒì„± ì‹¤íŒ¨:",j.errorMessage)):j.status==="partial"?(m.warning(`âš ï¸ ì¼ë¶€ APIë§Œ ìƒì„±ë¨ (Invest: ${j.investCreated?"âœ…":"âŒ"} / OroPlay: ${j.oroplayCreated?"âœ…":"âŒ"})`,{id:"create-user",duration:8e3}),console.warn("âš ï¸ ë¶€ë¶„ ì„±ê³µ:",j)):(m.success(`[5/5] âœ… íšŒì› ${s.username} ìƒì„± ì™„ë£Œ! (Invest âœ… / OroPlay âœ…)`,{id:"create-user",duration:5e3}),console.log("âœ… ëª¨ë“  API ê³„ì • ìƒì„± ì„±ê³µ")),await L()}catch(a){console.error("âŒ íšŒì› ìƒì„± ì „ì²´ ì˜¤ë¥˜:",a),m.error(a.message||"íšŒì› ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.",{id:"create-user"})}finally{T(!1)}},S=async(s,a)=>{const o=b.find(l=>l.id===s);if(!o){m.error("ì‚¬ìš©ì ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");return}h(l=>l.map(x=>x.id===s?{...x,status:"active",updated_at:new Date().toISOString()}:x));try{r(s),console.log("âœ… íšŒì› ìŠ¹ì¸ ì²˜ë¦¬ ì‹œì‘:",a),console.log("ğŸŒ ì™¸ë¶€ API ê³„ì • ìƒì„± ì‹œì‘ (Invest + OroPlay)");const l=await Fe(s,a,o.referrer_id||n.user?.id||"");if(console.log("ğŸ” API ê³„ì • ìƒì„± ê²°ê³¼:",l),l.status==="error"){h(v=>v.map(j=>j.id===s?{...j,status:"pending"}:j)),m.error(`ì™¸ë¶€ API ê³„ì • ìƒì„± ì‹¤íŒ¨: ${l.errorMessage}`),console.error("âŒ ì™¸ë¶€ API ê³„ì • ìƒì„± ì‹¤íŒ¨:",l.errorMessage);return}l.status==="partial"?(m.warning(`ì¼ë¶€ API ê³„ì •ë§Œ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤: ${l.errorMessage}`),console.warn("âš ï¸ ë¶€ë¶„ ì„±ê³µ:",l)):console.log("âœ… ëª¨ë“  API ê³„ì • ìƒì„± ì„±ê³µ");const{error:x}=await c.from("users").update({status:"active",updated_at:new Date().toISOString()}).eq("id",s);if(x)throw h(v=>v.map(j=>j.id===s?{...j,status:"pending"}:j)),console.error("âŒ íšŒì› ìŠ¹ì¸ DB ì˜¤ë¥˜:",x),x;m.success(`íšŒì› ${a}ì´ ìŠ¹ì¸ë˜ì—ˆìŠµë‹ˆë‹¤.`)}catch(l){console.error("íšŒì› ìŠ¹ì¸ ì‹¤íŒ¨:",l),m.error(l.message||"íšŒì› ìŠ¹ì¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")}finally{r(null)}},me=async(s,a)=>{const o=b.find(l=>l.id===s);h(l=>l.filter(x=>x.id!==s));try{r(s),console.log("âŒ íšŒì› ê°€ì… ê±°ì ˆ:",a);const{error:l}=await c.from("users").update({status:"blocked",memo:(o?.memo||"")+" [ê°€ì… ê±°ì ˆë¨]",updated_at:new Date().toISOString()}).eq("id",s);if(l)throw o&&h(x=>[...x,o]),console.error("âŒ íšŒì› ê±°ì ˆ ì˜¤ë¥˜:",l),l;m.success(`íšŒì› ${a}ì˜ ê°€ì…ì´ ê±°ì ˆë˜ì—ˆìŠµë‹ˆë‹¤.`)}catch(l){console.error("íšŒì› ê±°ì ˆ ì‹¤íŒ¨:",l),m.error(l.message||"íšŒì› ê±°ì ˆì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")}finally{r(null)}},rs=async()=>{if(!O)return;const s=O;h(a=>a.filter(o=>o.id!==O.id)),V(!1);try{ce(!0),console.log("ğŸ—‘ï¸ íšŒì› ì‚­ì œ ì²˜ë¦¬:",O.username);const{error:a}=await c.from("user_sessions").delete().eq("user_id",O.id);a&&console.warn("âš ï¸ ê²Œì„ ì„¸ì…˜ ì‚­ì œ ì¤‘ ì˜¤ë¥˜:",a);const{error:o}=await c.from("message_queue").delete().eq("sender_id",O.id);o&&console.warn("âš ï¸ ë©”ï¿½ï¿½ì§€ í (ë°œì†¡ì) ì‚­ì œ ì¤‘ ì˜¤ë¥˜:",o);const{error:l}=await c.from("message_queue").delete().eq("target_id",O.id);l&&console.warn("âš ï¸ ë©”ì‹œì§€ í (ìˆ˜ì‹ ì) ì‚­ì œ ì¤‘ ì˜¤ë¥˜:",l);const{error:x}=await c.from("notifications").delete().eq("recipient_id",O.id);x&&console.warn("âš ï¸ ì•Œë¦¼ ì‚­ì œ ì¤‘ ì˜¤ë¥˜:",x);const{error:v}=await c.from("realtime_notifications").delete().eq("recipient_id",O.id);v&&console.warn("âš ï¸ ì‹¤ì‹œê°„ ì•Œë¦¼ ì‚­ì œ ì¤‘ ì˜¤ë¥˜:",v);const{error:j}=await c.from("transactions").delete().eq("user_id",O.id);if(j){console.error("âŒ íŠ¸ëœì­ì…˜ ì‚­ì œ ì¤‘ ì˜¤ë¥˜:",j),h(J=>[...J,s]),m.error("íšŒì›ì˜ ê±°ë˜ ë‚´ì—­ ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤."),V(!0);return}const{error:F}=await c.from("game_records").delete().eq("user_id",O.id);F&&console.warn("âš ï¸ ê²Œì„ ê¸°ë¡ ì‚­ì œ ì¤‘ ì˜¤ë¥˜:",F);const{error:E}=await c.from("users").delete().eq("id",O.id);if(E)throw h(J=>[...J,s]),console.error("âŒ íšŒì› ì‚­ì œ ì˜¤ë¥˜:",E),E;console.log("âœ… íšŒì› ì‚­ì œ ì™„ë£Œ:",O.username),m.success(`íšŒì› ${O.username}ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.`),we(null)}catch(a){console.error("íšŒì› ì‚­ì œ ì‹¤íŒ¨:",a),m.error(a.message||"íšŒì› ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤."),V(!0)}finally{ce(!1)}},ns=async s=>{try{r(s.targetId);const a=b.find(ue=>ue.id===s.targetId);if(!a)return;console.log(`ğŸ’° ê°•ì œ ${s.type==="deposit"?"ì…ê¸ˆ":"ì¶œê¸ˆ"} ì²˜ë¦¬ ì‹œì‘:`,a.username,s.amount);const o=s.type==="deposit"?(a.balance||0)+s.amount:(a.balance||0)-s.amount;if(h(ue=>ue.map(ne=>ne.id===s.targetId?{...ne,balance:o,updated_at:new Date().toISOString()}:ne)),!n.user){h(ue=>ue.map(ne=>ne.id===s.targetId?{...ne,balance:a.balance,updated_at:a.updated_at}:ne));return}const{data:l,error:x}=await c.from("partners").select("balance, level, nickname, partner_type, invest_balance, oroplay_balance").eq("id",n.user.id).single();if(x||!l)return;const v=l.level===1;if(s.type==="deposit"&&!v){if(l.level===2){if(Math.min(l.invest_balance||0,l.oroplay_balance||0)<s.amount){console.error("âŒ Lv2 ë³´ìœ ê¸ˆ ë¶€ì¡±:",{invest:l.invest_balance,oroplay:l.oroplay_balance,required:s.amount});return}}else if(l.balance<s.amount){console.error("âŒ ë³´ìœ ê¸ˆ ë¶€ì¡±:",{balance:l.balance,required:s.amount});return}}const j=await vs(n.user);if(!j){console.error("âŒ API ì„¤ì •ì´ ì—†ìŠµë‹ˆë‹¤. api_configs í…Œì´ë¸”ì— invest_opcode, invest_token, invest_secret_keyë¥¼ ì„¤ì •í•˜ì„¸ìš”.");return}const F=js(j)?j.opcodes[0]:j;if(!F)return;let E=null,J=a.balance||0;if((l.level===1||l.level===2)&&s.type==="deposit")console.log("âœ… Lv1/Lv2 â†’ Lv7 ì…ê¸ˆ: ì™¸ë¶€ API í˜¸ì¶œ ê±´ë„ˆëœ€ (ë‚´ë¶€ ê±°ë˜ë§Œ, ê²Œì„ í”Œë ˆì´ ì‹œì—ë§Œ ì™¸ë¶€ API ì°¨ê°)"),J=(a.balance||0)+s.amount;else if((l.level===1||l.level===2)&&s.type==="withdrawal")console.log("âœ… Lv1/Lv2 â†’ Lv7 ì¶œê¸ˆ: ì™¸ë¶€ API í˜¸ì¶œ ê±´ë„ˆëœ€ (ë‚´ë¶€ ê±°ë˜ë§Œ, ê²Œì„ ì¢…ë£Œ ì‹œì—ë§Œ ì™¸ë¶€ API íšŒìˆ˜)"),J=(a.balance||0)-s.amount;else{if(E=s.type==="deposit"?await _s(a.username,s.amount,F.opcode,F.token,F.secretKey):await ws(a.username,s.amount,F.opcode,F.token,F.secretKey),!E.success||E.error){console.error(`API ${s.type==="deposit"?"ì…ê¸ˆ":"ì¶œê¸ˆ"} ì‹¤íŒ¨:`,E.error);return}console.log(`âœ… API ${s.type==="deposit"?"ì…ê¸ˆ":"ì¶œê¸ˆ"} ì„±ê³µ:`,E.data),J=ys(E.data,a.username),console.log("ğŸ’° ì‹¤ì œ ì”ê³ :",J)}const{error:ze}=await c.from("transactions").insert({user_id:a.id,partner_id:n.user?.id,transaction_type:s.type==="deposit"?"admin_deposit":"admin_withdrawal",amount:s.amount,status:"completed",processed_by:n.user?.id,memo:s.memo||`[ê´€ë¦¬ì ê°•ì œ ${s.type==="deposit"?"ì…ê¸ˆ":"ì¶œê¸ˆ"}] ${n.user?.username}`,balance_before:a.balance||0,balance_after:J,external_response:E?.data||null});if(ze)throw ze;const{error:Ve}=await c.from("users").update({balance:J,updated_at:new Date().toISOString()}).eq("id",a.id);if(Ve)throw Ve;l.level===1?console.log("â„¹ï¸ Lv1 â†’ Lv7 ì…ì¶œê¸ˆì€ ë‚´ë¶€ ê±°ë˜ë§Œ (Lv1 api_configs ë³€ë™ ì—†ìŒ, ê²Œì„ í”Œë ˆì´ ì‹œì—ë§Œ ì™¸ë¶€ API í˜¸ì¶œ)"):l.level===2?s.type==="deposit"?(console.log("â„¹ï¸ Lv2 â†’ Lv7 ì…ê¸ˆì€ ë‚´ë¶€ ê±°ë˜ë§Œ (ê²Œì„ í”Œë ˆì´ ì‹œì—ë§Œ ì™¸ë¶€ API ì°¨ê°)"),await c.from("partner_balance_logs").insert({partner_id:n.user.id,balance_before:l.invest_balance||0,balance_after:l.invest_balance||0,amount:0,transaction_type:"internal",from_partner_id:n.user.id,to_partner_id:null,processed_by:n.user.id,api_type:"invest",memo:`[íšŒì› ê°•ì œì…ê¸ˆ - ë‚´ë¶€ê±°ë˜] ${a.username}ì—ê²Œ ${s.amount.toLocaleString()}ì› ì…ê¸ˆ (ê²Œì„ í”Œë ˆì´ ì‹œ ì°¨ê°)${s.memo?`: ${s.memo}`:""}`})):(console.log("â„¹ï¸ Lv2 â†’ Lv7 ì¶œê¸ˆì€ ë‚´ë¶€ ê±°ë˜ë§Œ (ê²Œì„ ì¢…ë£Œ ì‹œì—ë§Œ ì™¸ë¶€ API íšŒìˆ˜)"),await c.from("partner_balance_logs").insert({partner_id:n.user.id,balance_before:l.invest_balance||0,balance_after:l.invest_balance||0,amount:0,transaction_type:"internal",from_partner_id:null,to_partner_id:n.user.id,processed_by:n.user.id,api_type:"invest",memo:`[íšŒì› ê°•ì œì¶œê¸ˆ - ë‚´ë¶€ê±°ë˜] ${a.username}ìœ¼ë¡œë¶€í„° ${s.amount.toLocaleString()}ì› ì¶œê¸ˆ (ê²Œì„ ì¢…ë£Œ ì‹œ íšŒìˆ˜)${s.memo?`: ${s.memo}`:""}`}),console.log(`ğŸ’° Lv2 ë³´ìœ ê¸ˆ ë³€ë™ ì—†ìŒ (ë‚´ë¶€ ê±°ë˜ë§Œ): Invest(${(l.invest_balance||0).toLocaleString()}), OroPlay(${(l.oroplay_balance||0).toLocaleString()})`)):s.type==="deposit"?(console.log("â„¹ï¸ Lv3~7 â†’ Lv7 ì…ê¸ˆì€ ë‚´ë¶€ ê±°ë˜ë§Œ (ê²Œì„ í”Œë ˆì´ ì‹œì—ë§Œ ì™¸ë¶€ API ì°¨ê°)"),await c.from("partner_balance_logs").insert({partner_id:n.user.id,balance_before:l.balance,balance_after:l.balance,amount:0,transaction_type:"internal",from_partner_id:n.user.id,to_partner_id:null,processed_by:n.user.id,memo:`[íšŒì› ê°•ì œì…ê¸ˆ - ë‚´ë¶€ê±°ë˜] ${a.username}ì—ê²Œ ${s.amount.toLocaleString()}ì› ì…ê¸ˆ (ê²Œì„ í”Œë ˆì´ ì‹œ ì°¨ê°)${s.memo?`: ${s.memo}`:""}`}),console.log(`ğŸ’° Lv3~7 ë³´ìœ ê¸ˆ ë³€ë™ ì—†ìŒ (ë‚´ë¶€ ê±°ë˜ë§Œ): balance(${l.balance.toLocaleString()})`)):(console.log("â„¹ï¸ Lv3~7 â†’ Lv7 ì¶œê¸ˆì€ ë‚´ë¶€ ê±°ë˜ë§Œ (ê²Œì„ ì¢…ë£Œ ì‹œì—ë§Œ ì™¸ë¶€ API íšŒìˆ˜)"),await c.from("partner_balance_logs").insert({partner_id:n.user.id,balance_before:l.balance,balance_after:l.balance,amount:0,transaction_type:"internal",from_partner_id:null,to_partner_id:n.user.id,processed_by:n.user.id,memo:`[íšŒì› ê°•ì œì¶œê¸ˆ - ë‚´ë¶€ê±°ë˜] ${a.username}ìœ¼ë¡œë¶€í„° ${s.amount.toLocaleString()}ì› ì¶œê¸ˆ (ê²Œì„ ì¢…ë£Œ ì‹œ íšŒìˆ˜)${s.memo?`: ${s.memo}`:""}`}),console.log(`ğŸ’° Lv3~7 ë³´ìœ ê¸ˆ ë³€ë™ ì—†ìŒ (ë‚´ë¶€ ê±°ë˜ë§Œ): balance(${l.balance.toLocaleString()})`)),p&&f&&(f({type:"user_balance_updated",data:{userId:a.id,amount:s.amount,type:s.type}}),f({type:"partner_balance_updated",data:{partnerId:n.user.id,amount:s.type==="deposit"?-s.amount:s.amount,type:s.type==="deposit"?"withdrawal":"deposit"}})),await L();const us=s.type==="deposit"?"ì…ê¸ˆ":"ì¶œê¸ˆ";m.success(`${a.username}ë‹˜ì—ê²Œ ${s.amount.toLocaleString()}ì› ${us} ì™„ë£Œ`)}catch(a){console.error("ê°•ì œ ì…ì¶œê¸ˆ ì²˜ë¦¬ ì‹¤íŒ¨:",a),m.error("ê°•ì œ ì…ì¶œê¸ˆ ì²˜ë¦¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")}finally{r(null)}},ls=s=>{he(s),ge("deposit"),re(!0)},os=s=>{he(s),ge("withdrawal"),re(!0)},is=async s=>{if(!s)return;const a=s.status==="suspended",o=a?"active":"suspended",l=a?(s.memo||"").replace(/\s*\[ì°¨ë‹¨ë¨.*?\]/g,""):(s.memo||"")+" [ì°¨ë‹¨ë¨: ê´€ë¦¬ì ì¡°ì¹˜]";h(x=>x.map(v=>v.id===s.id?{...v,status:o,memo:l,updated_at:new Date().toISOString()}:v));try{r(s.id),console.log("ğŸš« íšŒì› ì°¨ë‹¨/í•´ì œ:",s.username,o);const{error:x}=await c.from("users").update({status:o,memo:l,updated_at:new Date().toISOString()}).eq("id",s.id);if(x)throw h(v=>v.map(j=>j.id===s.id?{...j,status:s.status,memo:s.memo}:j)),x;m.success(`${s.username}ë‹˜ì´ ${a?"ì°¨ë‹¨ í•´ì œ":"ì°¨ë‹¨"}ë˜ì—ˆìŠµë‹ˆë‹¤.`)}catch(x){console.error("íšŒì› ì°¨ë‹¨/í•´ì œ ì‹¤íŒ¨:",x),m.error(x.message||"íšŒì› ì°¨ë‹¨/í•´ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")}finally{r(null)}},cs=async s=>{if(!s)return;const a=s.status==="blocked";a||h(o=>o.filter(l=>l.id!==s.id));try{if(r(s.id),console.log("ğŸš¨ ë¸”ë™ë¦¬ìŠ¤íŠ¸ ì²˜ë¦¬:",s.username),a){const{data:o,error:l}=await c.rpc("remove_user_from_blacklist_simple",{p_user_id:s.id,p_admin_id:n.user?.id});if(l)throw l;const x=Array.isArray(o)?o[0]:o;if(!x.success)throw new Error(x.error);m.success(`${s.username}ë‹˜ì´ ë¸”ë™ë¦¬ìŠ¤íŠ¸ì—ì„œ í•´ì œë˜ì—ˆìŠµë‹ˆë‹¤.`)}else{const{data:o,error:l}=await c.rpc("add_user_to_blacklist_simple",{p_user_id:s.id,p_admin_id:n.user?.id,p_reason:"ê´€ë¦¬ì ì¡°ì¹˜"});if(l)throw h(v=>[...v,s]),l;const x=Array.isArray(o)?o[0]:o;if(!x.success)throw h(v=>[...v,s]),new Error(x.error);m.success(`${s.username}ë‹˜ì´ ë¸”ë™ë¦¬ìŠ¤íŠ¸ì— ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.`)}}catch(o){console.error("ë¸”ë™ë¦¬ìŠ¤íŠ¸ ì²˜ë¦¬ ì‹¤íŒ¨:",o),m.error(o.message||"ë¸”ë™ë¦¬ìŠ¤íŠ¸ ì²˜ë¦¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")}finally{r(null)}};g.useEffect(()=>{i?.type==="user_registered"&&(console.log("ğŸ”” ìƒˆ íšŒì› ê°€ì… ì•Œë¦¼ ìˆ˜ì‹ "),L(),m.info("ìƒˆë¡œìš´ íšŒì› ê°€ì… ì‹ ì²­ì´ ìˆìŠµë‹ˆë‹¤."))},[i,L]);const We=b.filter(s=>{if(s.status==="blocked")return!1;const a=w===""||s.username?.toLowerCase().includes(w.toLowerCase())||s.nickname?.toLowerCase().includes(w.toLowerCase())||s.email?.toLowerCase().includes(w.toLowerCase())||s.phone?.includes(w)||s.bank_name?.toLowerCase().includes(w.toLowerCase())||s.bank_account?.includes(w)||s.balance?.toString().includes(w)||s.points?.toString().includes(w)||s.memo?.toLowerCase().includes(w.toLowerCase()),o=Y==="all"||s.status===Y;return a&&o}),ds=b.filter(s=>s.status==="pending").slice(0,5),ms=[{key:"username",header:t.userManagement.username},{key:"nickname",header:t.userManagement.nickname},{key:"referrer_info",header:t.userManagement.affiliation,cell:s=>e.jsx("span",{className:"text-sm text-slate-300",children:s.referrer?s.referrer.username:t.userManagement.unassigned})},{key:"status",header:t.common.status,cell:s=>s.status==="active"?e.jsxs(A,{className:"px-3 py-1 bg-gradient-to-r from-emerald-500/20 to-teal-500/20 text-emerald-400 border border-emerald-500/50 rounded-full shadow-[0_0_10px_rgba(16,185,129,0.5)]",children:["â— ",t.userManagement.approved]}):s.status==="pending"?e.jsxs(A,{className:"px-3 py-1 bg-gradient-to-r from-orange-500/20 to-amber-500/20 text-orange-400 border border-orange-500/50 rounded-full shadow-[0_0_10px_rgba(251,146,60,0.5)]",children:["â— ",t.userManagement.waiting]}):s.status==="suspended"?e.jsxs(A,{className:"px-3 py-1 bg-gradient-to-r from-slate-500/20 to-gray-500/20 text-slate-400 border border-slate-500/50 rounded-full shadow-[0_0_10px_rgba(100,116,139,0.5)]",children:["â— ",t.userManagement.suspended]}):null},{key:"balance",header:t.common.balance,cell:s=>e.jsxs("span",{className:"font-mono font-semibold text-cyan-400",children:[(s.balance||0).toLocaleString(),"ì›"]})},{key:"points",header:t.userManagement.points,cell:s=>e.jsxs("span",{className:"font-mono font-semibold text-purple-400",children:[(s.points||0).toLocaleString(),"P"]})},{key:"vip_level",header:t.userManagement.level,cell:s=>{const a=s.vip_level||0;return a===0?e.jsx(A,{className:"px-3 py-1 bg-slate-700/50 text-slate-300 border border-slate-600/50 rounded-full",children:"â—‹ Silver"}):a===1?e.jsx(A,{className:"px-3 py-1 bg-gradient-to-r from-yellow-500/20 to-amber-500/20 text-yellow-400 border border-yellow-500/50 rounded-full shadow-[0_0_10px_rgba(234,179,8,0.5)]",children:"âš¡ Gold"}):a===2?e.jsx(A,{className:"px-3 py-1 bg-gradient-to-r from-orange-500/20 to-red-500/20 text-orange-400 border border-orange-500/50 rounded-full shadow-[0_0_10px_rgba(251,146,60,0.5)]",children:"âš¡ Bronze"}):e.jsx(A,{className:"px-3 py-1 bg-gradient-to-r from-purple-500/20 to-pink-500/20 text-purple-400 border border-purple-500/50 rounded-full shadow-[0_0_10px_rgba(168,85,247,0.5)]",children:"âš¡ VIP"})}},{key:"api_account_status",header:t.userManagement.accountStatus,cell:s=>{const a=s.api_account_status||"active";return a==="pending"?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(A,{className:"px-2 py-1 bg-amber-500/20 text-amber-400 border border-amber-500/50 rounded-full text-xs",children:t.userManagement.creating}),e.jsx(Pe,{className:"h-3 w-3 text-amber-400 animate-pulse"})]}):a==="active"?e.jsx(A,{className:"px-2 py-1 bg-emerald-500/20 text-emerald-400 border border-emerald-500/50 rounded-full text-xs",children:t.userManagement.normal}):a==="error"?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(A,{className:"px-2 py-1 bg-red-500/20 text-red-400 border border-red-500/50 rounded-full text-xs",children:t.common.error}),e.jsx(Ms,{className:"h-3 w-3 text-red-400"})]}):a==="partial"?e.jsx(A,{className:"px-2 py-1 bg-orange-500/20 text-orange-400 border border-orange-500/50 rounded-full text-xs",children:t.userManagement.partialError}):e.jsx("span",{className:"text-slate-500 text-xs",children:t.userManagement.unknown})}},{key:"created_at",header:t.userManagement.registrationDate,cell:s=>{const a=new Date(s.created_at),o=a.getFullYear(),l=a.getMonth()+1,x=a.getDate();return e.jsxs("span",{className:"text-slate-400 text-sm",children:[o,". ",l,". ",x,"."]})}},{key:"last_login_at",header:t.userManagement.lastLogin,cell:s=>{if(!s.last_login_at)return e.jsx("span",{className:"text-slate-500 text-sm",children:t.userManagement.notLoggedIn});const a=new Date(s.last_login_at),o=a.getFullYear(),l=a.getMonth()+1,x=a.getDate();return e.jsxs("span",{className:"text-slate-400 text-sm",children:[o,". ",l,". ",x,"."]})}},{key:"is_online",header:t.userManagement.connection,cell:s=>s.is_online?e.jsxs(A,{className:"bg-gradient-to-r from-green-500 to-emerald-500 text-white border-0 animate-pulse",children:["â— ",t.userManagement.online]}):e.jsxs(A,{className:"bg-slate-600 text-slate-300 border-0",children:["â—‹ ",t.userManagement.offline]})},{key:"created_at_old",header:"ê°€ì…ì¼",cell:s=>new Date(s.created_at).toLocaleDateString("ko-KR")},{key:"actions",header:t.common.actions,cell:s=>s.status==="pending"?e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(M,{size:"sm",onClick:()=>S(s.id,s.username),disabled:H===s.id,className:"btn-premium-success",children:H===s.id?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}):e.jsxs(e.Fragment,{children:[e.jsx(Os,{className:"h-4 w-4 mr-1"}),t.userManagement.approve]})}),e.jsx(M,{size:"sm",onClick:()=>me(s.id,s.username),disabled:H===s.id,className:"btn-premium-danger",children:H===s.id?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}):e.jsxs(e.Fragment,{children:[e.jsx(Is,{className:"h-4 w-4 mr-1"}),t.userManagement.reject]})})]}):e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(M,{size:"sm",variant:"outline",onClick:()=>{D(s),oe(!0)},title:t.userManagement.detailInfo,children:e.jsx($s,{className:"h-4 w-4"})}),(s.api_account_status==="error"||s.api_account_status==="partial")&&e.jsx(M,{size:"sm",variant:"outline",onClick:async()=>{try{r(s.id),m.loading("API ê³„ì • ì¬ìƒì„± ì¤‘...",{id:"api-retry"}),await Fs(s.id),m.success("API ê³„ì • ì¬ìƒì„± ì™„ë£Œ",{id:"api-retry"}),L()}catch(a){m.error("ì¬ìƒì„± ì‹¤íŒ¨: "+a.message,{id:"api-retry"})}finally{r(null)}},disabled:H===s.id,className:"text-amber-600 hover:text-amber-700",title:"API ê³„ì • ì¬ì‹œë„",children:H===s.id?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-current"}):e.jsx(Ds,{className:"h-4 w-4"})}),e.jsx(M,{size:"sm",variant:"outline",onClick:()=>ls(s),className:"text-green-600 hover:text-green-700",title:t.userManagement.deposit,children:e.jsx(Ke,{className:"h-4 w-4"})}),e.jsx(M,{size:"sm",variant:"outline",onClick:()=>os(s),className:"text-red-600 hover:text-red-700",title:t.userManagement.withdrawal,children:e.jsx(Ke,{className:"h-4 w-4"})}),e.jsx(M,{size:"sm",variant:"outline",onClick:()=>is(s),disabled:H===s.id,className:s.status==="suspended"?"text-blue-600 hover:text-blue-700":"text-orange-600 hover:text-orange-700",title:s.status==="suspended"?t.userManagement.unblock:t.userManagement.block,children:H===s.id?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-current"}):s.status==="suspended"?e.jsx(Je,{className:"h-4 w-4"}):e.jsx(Xe,{className:"h-4 w-4"})}),e.jsx(M,{size:"sm",variant:"outline",onClick:()=>cs(s),disabled:H===s.id,className:"text-red-800 hover:text-red-900",title:t.userManagement.addToBlacklist,children:H===s.id?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-current"}):e.jsx(Xe,{className:"h-4 w-4"})}),e.jsx(M,{size:"sm",variant:"outline",onClick:()=>{we(s),V(!0)},className:"text-red-600 hover:text-red-700",title:t.userManagement.deleteUser,children:e.jsx(Qe,{className:"h-4 w-4"})})]})}];return _?e.jsx(xe,{}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-100",children:t.userManagement.title}),e.jsx("p",{className:"text-sm text-slate-400",children:t.userManagement.description})]}),e.jsxs(M,{onClick:()=>N(!0),className:"btn-premium-primary",children:[e.jsx(Ze,{className:"h-4 w-4 mr-2"}),t.userManagement.newUser]})]}),e.jsxs("div",{className:"grid gap-5 md:grid-cols-2 lg:grid-cols-4",children:[e.jsx(Ne,{title:t.userManagement.totalUsers,value:b.length.toLocaleString(),subtitle:`â†‘ ${t.userManagement.registeredUserCount}`,icon:Ts,color:"purple"}),e.jsx(Ne,{title:t.userManagement.pendingApproval,value:ds.length.toLocaleString(),subtitle:t.userManagement.waitingMembers,icon:Pe,color:"amber"}),e.jsx(Ne,{title:t.userManagement.activeUsers,value:b.filter(s=>s.status==="active").length.toLocaleString(),subtitle:t.userManagement.activeMembers,icon:Je,color:"green"}),e.jsx(Ne,{title:t.userManagement.onlineUsers,value:b.filter(s=>s.status==="active").length.toLocaleString(),subtitle:t.userManagement.realtimeUsers,icon:ss,color:"cyan"})]}),e.jsxs("div",{className:"glass-card rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6 pb-4 border-b border-slate-700/50",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-slate-100 mb-1",children:t.userManagement.userList}),e.jsxs("p",{className:"text-sm text-slate-400",children:[t.common.total," ",We.length.toLocaleString(),t.userManagement.managingMembers]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"relative w-96",children:[e.jsx(Us,{className:"absolute left-3 top-2.5 h-4 w-4 text-slate-400"}),e.jsx(Z,{placeholder:t.userManagement.searchPlaceholder,className:"pl-10 input-premium",value:w,onChange:s=>y(s.target.value)})]}),e.jsxs(Se,{value:Y,onValueChange:$,children:[e.jsxs(Ce,{className:"w-[160px] input-premium",children:[e.jsx(Es,{className:"h-4 w-4 mr-2"}),e.jsx(ke,{placeholder:t.userManagement.statusFilter})]}),e.jsxs(Me,{className:"bg-slate-800 border-slate-700",children:[e.jsx(pe,{value:"all",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-slate-500"}),t.common.all]})}),e.jsx(pe,{value:"pending",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-amber-500"}),t.userManagement.pendingApproval]})}),e.jsx(pe,{value:"active",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-emerald-500"}),t.common.active]})}),e.jsx(pe,{value:"suspended",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-slate-500"}),t.userManagement.blocked]})})]})]})]})]}),e.jsx(Ns,{columns:ms,data:We,searchable:!1,emptyMessage:w?t.userManagement.noSearchResults:t.userManagement.noUsers})]}),e.jsx(Te,{open:je,onOpenChange:N,children:e.jsxs(Ue,{className:"sm:max-w-[500px] bg-slate-900/90 backdrop-blur-md border-slate-700/60 shadow-2xl shadow-blue-500/20",children:[e.jsxs(Ee,{children:[e.jsx(Re,{className:"text-xl text-slate-100 bg-gradient-to-r from-blue-400 to-cyan-400 bg-clip-text text-transparent",children:t.userManagement.newUser}),e.jsx(Be,{className:"text-slate-400",children:t.userManagement.createUserDescription})]}),e.jsxs("div",{className:"grid gap-5 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(X,{htmlFor:"username",className:"text-right text-slate-300",children:t.userManagement.username}),e.jsx(Z,{id:"username",value:P.username,onChange:s=>z(a=>({...a,username:s.target.value})),className:"col-span-3 input-premium focus:border-blue-500/60 focus:ring-2 focus:ring-blue-500/20",placeholder:t.userManagement.enterUsername})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(X,{htmlFor:"nickname",className:"text-right text-slate-300",children:t.userManagement.nickname}),e.jsx(Z,{id:"nickname",value:P.nickname,onChange:s=>z(a=>({...a,nickname:s.target.value})),className:"col-span-3 input-premium focus:border-blue-500/60 focus:ring-2 focus:ring-blue-500/20",placeholder:t.userManagement.enterNickname})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(X,{htmlFor:"password",className:"text-right text-slate-300",children:t.common.password}),e.jsx(Z,{id:"password",type:"password",value:P.password,onChange:s=>z(a=>({...a,password:s.target.value})),className:"col-span-3 input-premium focus:border-blue-500/60 focus:ring-2 focus:ring-2 focus:ring-blue-500/20",placeholder:t.userManagement.enterInitialPassword})]}),n.user?.level===1&&I.length>0&&e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(X,{className:"text-right text-slate-300",children:t.userManagement.partnerAffiliation}),e.jsxs(Se,{value:P.selected_referrer_id||void 0,onValueChange:s=>z(a=>({...a,selected_referrer_id:s})),children:[e.jsx(Ce,{className:"col-span-3 input-premium focus:border-blue-500/60 focus:ring-2 focus:ring-blue-500/20",children:e.jsx(ke,{placeholder:t.userManagement.selectPartnerOptional})}),e.jsx(Me,{className:"bg-slate-800 border-slate-700",children:I.map(s=>{const o={2:t.partnerManagement.headOffice,3:t.partnerManagement.mainOffice,4:t.partnerManagement.subOffice,5:t.partnerManagement.distributor,6:t.partnerManagement.store}[s.level]||`Level ${s.level}`;return e.jsxs(pe,{value:s.id,className:"text-slate-200 focus:bg-slate-700 focus:text-slate-100",children:[s.nickname||s.username," (",o,")"]},s.id)})})]})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(X,{className:"text-right text-slate-300",children:t.userManagement.bankName}),e.jsxs(Se,{value:P.bank_name||void 0,onValueChange:s=>z(a=>({...a,bank_name:s})),children:[e.jsx(Ce,{className:"col-span-3 input-premium focus:border-blue-500/60 focus:ring-2 focus:ring-blue-500/20",children:e.jsx(ke,{placeholder:t.userManagement.selectBank})}),e.jsx(Me,{className:"bg-slate-800 border-slate-700",children:Vs.map(s=>e.jsx(pe,{value:s,className:"text-slate-200 focus:bg-slate-700 focus:text-slate-100",children:s},s))})]})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(X,{htmlFor:"bank_account",className:"text-right text-slate-300",children:t.userManagement.accountNumber}),e.jsx(Z,{id:"bank_account",value:P.bank_account,onChange:s=>z(a=>({...a,bank_account:s.target.value})),className:"col-span-3 input-premium focus:border-blue-500/60 focus:ring-2 focus:ring-blue-500/20",placeholder:t.userManagement.enterAccountNumber})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(X,{htmlFor:"memo",className:"text-right text-slate-300",children:t.common.note}),e.jsx(Z,{id:"memo",value:P.memo,onChange:s=>z(a=>({...a,memo:s.target.value})),className:"col-span-3 input-premium focus:border-blue-500/60 focus:ring-2 focus:ring-blue-500/20",placeholder:t.userManagement.adminMemo})]})]}),e.jsxs(Ge,{className:"gap-3",children:[e.jsx(M,{type:"button",variant:"outline",onClick:()=>N(!1),className:"bg-slate-800/50 border-slate-700 text-slate-300 hover:bg-slate-700 hover:text-slate-100",children:t.common.cancel}),e.jsxs(M,{type:"button",onClick:u,className:"btn-premium-primary",children:[e.jsx(Ze,{className:"h-4 w-4 mr-2"}),t.userManagement.createUser]})]})]})}),e.jsx(Te,{open:Ae,onOpenChange:V,children:e.jsxs(Ue,{className:"sm:max-w-[425px] bg-slate-900/90 backdrop-blur-md border-slate-700/60 shadow-2xl shadow-red-500/20",children:[e.jsxs(Ee,{children:[e.jsx(Re,{className:"text-xl text-slate-100",children:t.userManagement.deleteConfirm}),e.jsxs(Be,{className:"text-slate-400",children:[t.userManagement.deleteConfirmMessagePrefix,O?.username,t.userManagement.deleteConfirmMessageSuffix]})]}),e.jsxs(Ge,{className:"gap-3",children:[e.jsx(M,{variant:"outline",onClick:()=>V(!1),disabled:fe,className:"bg-slate-800/50 border-slate-700 text-slate-300 hover:bg-slate-700 hover:text-slate-100",children:t.common.cancel}),e.jsx(M,{onClick:rs,disabled:fe,className:"btn-premium-danger",children:fe?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),t.userManagement.deleting]}):e.jsxs(e.Fragment,{children:[e.jsx(Qe,{className:"h-4 w-4 mr-2"}),t.userManagement.permanentDelete]})})]})]})}),e.jsx(Rs,{open:_e,onOpenChange:s=>{re(s),s||he(null)},type:ie,targetType:"user",selectedTarget:B?{id:B.id,username:B.username,nickname:B.nickname,balance:B.balance||0}:null,onSubmit:ns,onTypeChange:ge,currentUserLevel:K,currentUserBalance:G}),e.jsx(Hs,{user:Le,isOpen:le,onClose:()=>{oe(!1),D(null)}})]})}export{ot as UserManagement,ot as default};
