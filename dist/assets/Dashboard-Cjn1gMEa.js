import{r as d,j as e}from"./react-core-BwkdTuSg.js";import{s as o,u as fe,a as xe,g as _e,B as ye,f as ve}from"./index-Be3DOFuy.js";import{M as A}from"./MetricCard-DF34t905.js";import{U as L,S as m}from"./UnifiedCard-DgbWL46V.js";import{k as we}from"./vendor-D410aui4.js";import{calculatePendingDeposits as je}from"./settlementCalculator-DhQR0qso.js";import{V as Ce,U as Se,A as De,a8 as Y,a9 as Z,T as z,j as oe,aa as F,ab as ne,S as re}from"./lucide-icons-D2Pw2Rdn.js";import"./radix-ui-omyR4zpf.js";import"./supabase-C8Oa5ukG.js";const X=new Map;async function Ne(n,j){const S=`${n}_${j}`;if(X.has(S))return X.get(S);try{let p=9;if(j===1){const{data:s,error:r}=await o.from("system_settings").select("setting_value").eq("setting_key","timezone_offset").maybeSingle();!r&&s&&(p=parseInt(s.setting_value))}else{const{data:s,error:r}=await o.from("partners").select("timezone_offset").eq("id",n).maybeSingle();if(!r&&s&&s.timezone_offset!==null)p=s.timezone_offset;else{const{data:u,error:D}=await o.from("system_settings").select("setting_value").eq("setting_key","timezone_offset").maybeSingle();!D&&u&&(p=parseInt(u.setting_value))}}return X.set(S,p),p}catch(p){return console.error("âŒ [Timezone] ì˜¤í”„ì…‹ ì¡°íšŒ ì‹¤íŒ¨:",p),9}}async function Te(n,j){const S=await Ne(n,j),p=new Date,s=S*60*60*1e3,r=new Date(p.getTime()+s),u=r.getUTCFullYear(),D=r.getUTCMonth(),x=r.getUTCDate(),$=r.getUTCHours(),_=r.getUTCMinutes(),q=r.getUTCSeconds();return new Date(u,D,x,$,_,q).toLocaleString("ko-KR")}function He({user:n}){const{balance:j,investBalance:S,oroplayBalance:p}=fe(),{t:s,formatCurrency:r}=xe(),[u,D]=d.useState({total_users:0,total_balance:0,daily_deposit:0,daily_withdrawal:0,daily_net_deposit:0,casino_betting:0,slot_betting:0,total_betting:0,online_users:0,pending_approvals:0,pending_messages:0,pending_deposits:0,pending_withdrawals:0}),[x,$]=d.useState({deposit:0,withdrawal:0,netDeposit:0,casinoBetting:0,slotBetting:0,totalBetting:0}),[_,q]=d.useState({deposit:0,withdrawal:0,netDeposit:0,casinoBetting:0,slotBetting:0,totalBetting:0}),[G,ie]=d.useState(0),[Be,J]=d.useState(!0),[Ie,le]=d.useState(new Date),[ce,de]=d.useState(""),[Pe,Ue]=d.useState(!1),[Ee,Re]=d.useState(!1);if(d.useEffect(()=>{D(c=>({...c,total_balance:j}))},[j]),!n||typeof n.level!="number")return e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("div",{className:"loading-premium mx-auto"}),e.jsx("p",{className:"text-muted-foreground",children:s.dashboard.loadingDashboard})]})});const N=async()=>{try{J(!0),console.log("============================================"),console.log("ðŸ“Š ëŒ€ì‹œë³´ë“œ í†µê³„ ì¡°íšŒ ì‹œìž‘"),console.log("Partner ID:",n.id),console.log("Partner Level:",n.level),console.log("Partner Type:",n.partner_type),console.log("============================================");const c=new Date;c.setHours(0,0,0,0),console.log("ðŸ” ì§ì ‘ DB ì¡°íšŒ ì‹œìž‘...");const{data:h,error:U}=await o.from("transactions").select("transaction_type, status, amount, created_at").gte("created_at",c.toISOString());if(console.log("ðŸ“Š ì˜¤ëŠ˜ transactions:",h?.length||0,"ê±´"),h&&h.length>0){console.log("ìƒì„¸:",h);const a=h.filter(t=>t.transaction_type==="deposit"&&["approved","completed"].includes(t.status)||t.transaction_type==="admin_adjustment"&&t.amount>0&&["approved","completed"].includes(t.status)).reduce((t,l)=>t+Number(l.amount),0),i=h.filter(t=>t.transaction_type==="withdrawal"&&["approved","completed"].includes(t.status)||t.transaction_type==="admin_adjustment"&&t.amount<0&&["approved","completed"].includes(t.status)).reduce((t,l)=>t+Math.abs(Number(l.amount)),0);console.log("ðŸ’° ì§ì ‘ ê³„ì‚° ìž…ê¸ˆ:",a),console.log("ðŸ’¸ ì§ì ‘ ê³„ì‚° ì¶œê¸ˆ:",i)}const{data:y,error:v}=await o.from("game_records").select("provider_id, bet_amount, played_at").gte("played_at",c.toISOString());if(console.log("ðŸŽ® ì˜¤ëŠ˜ game_records:",y?.length||0,"ê±´"),y&&y.length>0){console.log("ìƒì„¸:",y);const a=[410,77,2,30,78,86,11,28,89,91,44,85,0],i=y.filter(l=>a.includes(Number(l.provider_id))).reduce((l,C)=>l+Number(C.bet_amount),0),t=y.filter(l=>!a.includes(Number(l.provider_id))).reduce((l,C)=>l+Number(C.bet_amount),0);console.log("ðŸŽ° ì§ì ‘ ê³„ì‚° ì¹´ì§€ë…¸:",i),console.log("ðŸŽ² ì§ì ‘ ê³„ì‚° ìŠ¬ë¡¯:",t)}console.log(""),console.log("ðŸ”§ ì§ì ‘ SELECT ì¿¼ë¦¬ ì‹œìž‘ (RPC ì œê±°)...");const E=new Date,w=new Date(E.getFullYear(),E.getMonth(),E.getDate()).toISOString();console.log("ðŸ“… ì˜¤ëŠ˜ ì‹œìž‘ ì‹œê° (UTC):",w),console.log("ðŸ“… í˜„ìž¬ ì‹œê° (ë¡œì»¬):",E.toLocaleString("ko-KR",{timeZone:"Asia/Seoul"}));let g=[];if(n.level===1){const{data:a}=await o.from("partners").select("id");g=a?.map(i=>i.id)||[]}else{g=[n.id];const{data:a}=await o.from("partners").select("id").eq("parent_id",n.id),i=a?.map(t=>t.id)||[];if(g.push(...i),i.length>0){const{data:t}=await o.from("partners").select("id").in("parent_id",i),l=t?.map(C=>C.id)||[];if(g.push(...l),l.length>0){const{data:C}=await o.from("partners").select("id").in("parent_id",l),W=C?.map(H=>H.id)||[];if(g.push(...W),W.length>0){const{data:H}=await o.from("partners").select("id").in("parent_id",W),K=H?.map(V=>V.id)||[];if(g.push(...K),K.length>0){const{data:V}=await o.from("partners").select("id").in("parent_id",K),he=V?.map(be=>be.id)||[];g.push(...he)}}}}}console.log("ðŸ‘¥ í•˜ìœ„ íŒŒíŠ¸ë„ˆ ID ê°œìˆ˜:",g.length);let b=[];const{data:me}=await o.from("users").select("id").eq("referrer_id",n.id);b=me?.map(a=>a.id)||[],console.log("ðŸ‘¤ ì§ì† íšŒì› ID ê°œìˆ˜:",b.length);let f=[];const Q=g.filter(a=>a!==n.id);if(Q.length>0){const{data:a}=await o.from("users").select("id").in("referrer_id",Q);f=a?.map(i=>i.id)||[],console.log("ðŸ‘¥ í•˜ìœ„ íŒŒíŠ¸ë„ˆ íšŒì› ID ê°œìˆ˜:",f.length)}let R=0;if(b.length>0){const{data:a}=await o.from("transactions").select("amount, created_at").in("transaction_type",["deposit","admin_deposit"]).in("status",["approved","completed"]).in("user_id",b).gte("created_at",w);console.log("ðŸ’° ì§ì† íšŒì› ìž…ê¸ˆ ë°ì´í„°:",a),R=a?.reduce((i,t)=>i+Number(t.amount),0)||0}let O=0;if(b.length>0){const{data:a}=await o.from("transactions").select("amount, created_at").in("transaction_type",["withdrawal","admin_withdrawal"]).in("status",["approved","completed"]).in("user_id",b).gte("created_at",w);console.log("ðŸ’¸ ì§ì† íšŒì› ì¶œê¸ˆ ë°ì´í„°:",a),O=a?.reduce((i,t)=>i+Number(t.amount),0)||0}let k=0;if(f.length>0){const{data:a}=await o.from("transactions").select("amount, created_at").in("transaction_type",["deposit","admin_deposit"]).in("status",["approved","completed"]).in("user_id",f).gte("created_at",w);console.log("ðŸ’° í•˜ìœ„ íŒŒíŠ¸ë„ˆ íšŒì› ìž…ê¸ˆ ë°ì´í„°:",a),k=a?.reduce((i,t)=>i+Number(t.amount),0)||0}let M=0;if(f.length>0){const{data:a}=await o.from("transactions").select("amount, created_at").in("transaction_type",["withdrawal","admin_withdrawal"]).in("status",["approved","completed"]).in("user_id",f).gte("created_at",w);console.log("ðŸ’¸ í•˜ìœ„ íŒŒíŠ¸ë„ˆ íšŒì› ì¶œê¸ˆ ë°ì´í„°:",a),M=a?.reduce((i,t)=>i+Number(t.amount),0)||0}let ee=0;if(g.length>0){const{count:a}=await o.from("users").select("id",{count:"exact",head:!0}).in("referrer_id",g);ee=a||0}let te=0;const{count:ge}=await o.from("game_launch_sessions").select("*",{count:"exact",head:!0}).eq("status","active");te=ge||0;const pe=[...b,...f],ue=await je(pe,w,new Date().toISOString());let T=0,B=0;if(b.length>0){const{data:a}=await o.from("game_records").select("provider_id, bet_amount").in("user_id",b).gte("played_at",w);if(a&&a.length>0){const i=[410,77,2,30,78,86,11,28,89,91,44,85,0];T=a.filter(t=>i.includes(Number(t.provider_id))).reduce((t,l)=>t+Number(l.bet_amount||0),0),B=a.filter(t=>!i.includes(Number(t.provider_id))).reduce((t,l)=>t+Number(l.bet_amount||0),0)}}let I=0,P=0;if(f.length>0){const{data:a}=await o.from("game_records").select("provider_id, bet_amount").in("user_id",f).gte("played_at",w);if(a&&a.length>0){const i=[410,77,2,30,78,86,11,28,89,91,44,85,0];I=a.filter(t=>i.includes(Number(t.provider_id))).reduce((t,l)=>t+Number(l.bet_amount||0),0),P=a.filter(t=>!i.includes(Number(t.provider_id))).reduce((t,l)=>t+Number(l.bet_amount||0),0)}}const ae=R+k,se=O+M;D(a=>({...a,total_users:ee||0,daily_deposit:ae,daily_withdrawal:se,daily_net_deposit:ae-se,online_users:te||0,casino_betting:T+I,slot_betting:B+P,total_betting:T+B+I+P,pending_approvals:0,pending_messages:0,pending_deposits:0,pending_withdrawals:0})),$({deposit:R,withdrawal:O,netDeposit:R-O,casinoBetting:T,slotBetting:B,totalBetting:T+B}),q({deposit:k,withdrawal:M,netDeposit:k-M,casinoBetting:I,slotBetting:P,totalBetting:I+P}),ie(ue),console.log(""),console.log("âœ… ëŒ€ì‹œë³´ë“œ í†µê³„ ì—…ë°ì´íŠ¸ ì™„ë£Œ (RPC ì—†ìŒ)"),console.log("============================================")}catch(c){console.error(""),console.error("============================================"),console.error("âŒ ëŒ€ì‹œë³´ë“œ í†µê³„ ë¡œë”© ì˜¤ë¥˜"),console.error("Error:",c),console.error("Message:",c?.message),console.error("Details:",c?.details),console.error("Hint:",c?.hint),console.error("============================================"),we.error("ëŒ€ì‹œë³´ë“œ í†µê³„ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: "+(c?.message||"ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜"))}finally{J(!1)}};return d.useEffect(()=>{N()},[]),d.useEffect(()=>{const c=async()=>{const U=await Te(n.id,n.level);de(U)};c();const h=setInterval(()=>{le(new Date),c()},1e3);return()=>clearInterval(h)},[n.id,n.level]),d.useEffect(()=>{console.log("ðŸ”” ëŒ€ì‹œë³´ë“œ Realtime êµ¬ë… ì‹œìž‘:",n.id);const c=o.channel("dashboard_transactions").on("postgres_changes",{event:"*",schema:"public",table:"transactions"},v=>{console.log("ðŸ’° [ëŒ€ì‹œë³´ë“œ] transactions ë³€ê²½ ê°ì§€:",v.eventType),N()}).subscribe(),h=o.channel("dashboard_partners").on("postgres_changes",{event:"UPDATE",schema:"public",table:"partners",filter:`id=eq.${n.id}`},v=>{console.log("ðŸ’° [ëŒ€ì‹œë³´ë“œ] partners ë³´ìœ ê¸ˆ ë³€ê²½ ê°ì§€:",v.new),N()}).subscribe(),U=o.channel("dashboard_game_records").on("postgres_changes",{event:"INSERT",schema:"public",table:"game_records"},v=>{console.log("ðŸŽ® [ëŒ€ì‹œë³´ë“œ] game_records ë³€ê²½ ê°ì§€:",v.eventType),N()}).subscribe(),y=o.channel("dashboard_users").on("postgres_changes",{event:"UPDATE",schema:"public",table:"users"},v=>{console.log("ðŸ‘¤ [ëŒ€ì‹œë³´ë“œ] users ë³€ê²½ ê°ì§€:",v.eventType),N()}).subscribe();return()=>{console.log("ðŸ”• ëŒ€ì‹œë³´ë“œ Realtime êµ¬ë… í•´ì œ"),o.removeChannel(c),o.removeChannel(h),o.removeChannel(U),o.removeChannel(y)}},[n.id]),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row items-start md:items-center justify-between gap-4 mb-8",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-100",children:s.dashboard.adminDashboard}),e.jsxs("p",{className:"text-sm text-slate-400",children:[_e(n.level)," Â· ",n.nickname,s.dashboard.realtimeStatus]})]}),e.jsxs(ye,{variant:"outline",className:"flex items-center gap-2 px-3 py-1.5 text-xs badge-premium-primary",children:[e.jsx(Ce,{className:"h-3.5 w-3.5"}),ce]})]}),e.jsxs("div",{className:"grid gap-5 md:grid-cols-2 lg:grid-cols-4",children:[e.jsx(A,{title:s.dashboard.totalUsers,value:ve(u.total_users),subtitle:`â†‘ ${s.dashboard.registeredUsers}`,icon:Se,color:"blue"}),e.jsx(A,{title:s.dashboard.todayNetRevenue,value:r(u.daily_net_deposit),subtitle:u.daily_net_deposit>=0?`â†‘ ${s.dashboard.profitToday}`:`â†“ ${s.dashboard.lossToday}`,icon:De,color:u.daily_net_deposit>=0?"green":"pink"}),e.jsx(A,{title:s.dashboard.todayTotalBetting,value:r(u.total_betting),subtitle:`â†‘ ${s.dashboard.customerActivity}`,icon:Y,color:"purple"}),e.jsx(A,{title:s.dashboard.pendingCharges,value:r(G),subtitle:`â†‘ ${s.dashboard.pendingChargesDesc}`,icon:Z,color:"orange"})]}),e.jsxs("div",{className:"grid gap-5 md:grid-cols-2",children:[e.jsxs(L,{title:s.dashboard.directUserTransactions,icon:z,iconColor:"text-cyan-400",children:[e.jsx(m,{label:s.dashboard.dailyDeposit,value:r(x.deposit),valueColor:"text-cyan-400",icon:z,iconColor:"text-cyan-400"}),e.jsx(m,{label:s.dashboard.dailyWithdrawal,value:r(x.withdrawal),valueColor:"text-rose-400",icon:oe,iconColor:"text-rose-400"}),e.jsx(m,{label:s.dashboard.dailyNetDeposit,value:r(x.netDeposit),valueColor:"text-cyan-400",icon:Z,iconColor:"text-cyan-400"})]}),e.jsxs(L,{title:s.dashboard.directUserBetting,icon:F,iconColor:"text-amber-400",children:[e.jsx(m,{label:s.dashboard.casinoTotalBetting,value:r(x.casinoBetting),valueColor:"text-cyan-400",icon:Y,iconColor:"text-cyan-400"}),e.jsx(m,{label:s.dashboard.slotTotalBetting,value:r(x.slotBetting),valueColor:"text-amber-400",icon:F,iconColor:"text-amber-400"}),e.jsx(m,{label:s.dashboard.totalBetting,value:r(x.totalBetting),valueColor:"text-cyan-400",icon:ne,iconColor:"text-cyan-400"})]}),e.jsxs(L,{title:s.dashboard.subPartnerTransactions,icon:z,iconColor:"text-purple-400",children:[e.jsx(m,{label:s.dashboard.dailyDeposit,value:r(_.deposit),valueColor:"text-cyan-400",icon:z,iconColor:"text-cyan-400"}),e.jsx(m,{label:s.dashboard.dailyWithdrawal,value:r(_.withdrawal),valueColor:"text-rose-400",icon:oe,iconColor:"text-rose-400"}),e.jsx(m,{label:s.dashboard.dailyNetDeposit,value:r(_.netDeposit),valueColor:"text-cyan-400",icon:Z,iconColor:"text-cyan-400"})]}),e.jsxs(L,{title:s.dashboard.subPartnerBetting,icon:F,iconColor:"text-green-400",children:[e.jsx(m,{label:s.dashboard.casinoTotalBetting,value:r(_.casinoBetting),valueColor:"text-cyan-400",icon:Y,iconColor:"text-cyan-400"}),e.jsx(m,{label:s.dashboard.slotTotalBetting,value:r(_.slotBetting),valueColor:"text-amber-400",icon:F,iconColor:"text-amber-400"}),e.jsx(m,{label:s.dashboard.totalBetting,value:r(_.totalBetting),valueColor:"text-cyan-400",icon:ne,iconColor:"text-cyan-400"})]})]}),n.level===1&&e.jsx("div",{className:"mt-8 p-6 bg-gradient-to-r from-red-900/20 via-red-800/20 to-red-900/20 border-2 border-yellow-600/50 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-16 h-16 rounded-lg bg-gradient-to-br from-red-700 to-red-900 flex items-center justify-center border-2 border-yellow-600",children:e.jsx(re,{className:"w-8 h-8 text-yellow-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl",style:{fontFamily:"Impact, sans-serif",color:"#fff",letterSpacing:"0.1em",textShadow:"2px 2px 4px rgba(0,0,0,0.8)"},children:"MARVEL THEME CASINO"}),e.jsx("p",{className:"text-gray-400 text-sm mt-1",children:s.dashboard.marvelThemeDescription})]})]}),e.jsx("button",{onClick:()=>{window.location.hash="#/sample1"},className:"px-6 py-3 bg-gradient-to-r from-yellow-600 to-yellow-700 text-black rounded-md border-2 border-yellow-400 hover:from-yellow-500 hover:to-yellow-600 transition-all duration-200",style:{boxShadow:"0 0 20px rgba(234, 179, 8, 0.4)"},children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{style:{fontFamily:"Impact, sans-serif",letterSpacing:"0.05em"},children:s.dashboard.experience}),e.jsx("span",{children:"â†’"})]})})]})}),n.level===1&&e.jsx("div",{className:"mt-6 p-6 bg-gradient-to-r from-orange-900/20 via-amber-900/20 to-orange-900/20 border-2 border-orange-500/50 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-16 h-16 rounded-lg bg-gradient-to-br from-orange-600 to-amber-700 flex items-center justify-center border-2 border-orange-400",children:e.jsx(re,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl",style:{fontFamily:"Impact, sans-serif",color:"#fff",letterSpacing:"0.1em",textShadow:"2px 2px 4px rgba(0,0,0,0.8)"},children:"INDO CASINO"}),e.jsx("p",{className:"text-gray-400 text-sm mt-1",children:"Experience Indonesian themed casino"})]})]}),e.jsx("button",{onClick:()=>{window.location.hash="#/indo"},className:"px-6 py-3 bg-gradient-to-r from-orange-500 to-amber-600 text-white rounded-md border-2 border-orange-400 hover:from-orange-400 hover:to-amber-500 transition-all duration-200",style:{boxShadow:"0 0 20px rgba(249, 115, 22, 0.4)"},children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{style:{fontFamily:"Impact, sans-serif",letterSpacing:"0.05em"},children:"EXPLORE"}),e.jsx("span",{children:"â†’"})]})})]})})]})}export{He as Dashboard,He as default};
