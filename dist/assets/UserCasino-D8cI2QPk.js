const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-Be3DOFuy.js","assets/react-core-BwkdTuSg.js","assets/vendor-D410aui4.js","assets/radix-ui-omyR4zpf.js","assets/lucide-icons-D2Pw2Rdn.js","assets/supabase-C8Oa5ukG.js","assets/index-CW60_reT.css"])))=>i.map(i=>d[i]);
import{a as H,W as C,s as x,I as V,h as S,C as A,a7 as F,B as M,_ as X}from"./index-Be3DOFuy.js";import{r as n,j as e}from"./react-core-BwkdTuSg.js";import{G as Y,a as J}from"./GamePreparingDialog-BbV6xsaC.js";import{k as d}from"./vendor-D410aui4.js";import{r as v,a8 as Z,aa as Q,y as K,aF as ee,Z as z,U as se,w as ae,x as te,J as re,P as ie,V as le}from"./lucide-icons-D2Pw2Rdn.js";import"./radix-ui-omyR4zpf.js";import"./supabase-C8Oa5ukG.js";function ge({user:_,onRouteChange:oe}){const[u,I]=n.useState("all"),[h,G]=n.useState("all"),[g,W]=n.useState(""),[U,D]=n.useState([]),[E,q]=n.useState([]),[P,f]=n.useState(!1),[j,y]=n.useState(null),[R,m]=n.useState(!1),[B,b]=n.useState("launch"),c=n.useRef(!0),{t:l}=H(),$=[{id:"all",name:l.user.all,icon:v,gradient:"from-yellow-500 to-amber-600"},{id:"evolution",name:l.user.evolution,icon:Z,gradient:"from-red-500 to-red-600"},{id:"pragmatic",name:l.user.pragmatic,icon:Q,gradient:"from-blue-500 to-blue-600"},{id:"baccarat",name:l.user.baccarat,icon:K,gradient:"from-purple-500 to-purple-600"},{id:"blackjack",name:l.user.blackjack,icon:ee,gradient:"from-green-500 to-green-600"},{id:"roulette",name:l.user.roulette,icon:z,gradient:"from-orange-500 to-orange-600"}];n.useEffect(()=>(O(),()=>{c.current=!1}),[]),n.useEffect(()=>{c.current&&N()},[u,h]);const O=async()=>{if(c.current)try{f(!0);const s=await C.getUserVisibleProviders({type:"casino"});c.current&&q(s),await N()}catch(s){c.current&&(console.error("ì´ˆê¸°í™” ì˜¤ë¥˜:",s),d.error("ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤."))}finally{c.current&&f(!1)}},N=async()=>{if(c.current)try{f(!0);let s=x.from("games").select(`
          id,
          provider_id,
          name,
          type,
          status,
          image_url,
          is_featured,
          priority,
          api_type,
          game_providers!inner(
            id,
            name,
            logo_url
          )
        `).eq("type","casino").eq("status","visible");u!=="all"&&(s=s.eq("provider_id",parseInt(u)));const{data:a,error:o}=await s.order("priority",{ascending:!1});if(o)throw o;const i=(a?.map(t=>({game_id:t.id,provider_id:t.provider_id,provider_name:t.game_providers?.name||"Unknown",provider_logo:t.game_providers?.logo_url,game_name:t.name,game_type:t.type,image_url:t.image_url,is_featured:t.is_featured,status:t.status,priority:t.priority||0,api_type:t.api_type}))||[]).sort((t,p)=>t.is_featured&&!p.is_featured?-1:!t.is_featured&&p.is_featured?1:p.priority-t.priority);c.current&&D(i)}catch(s){c.current&&(console.error("ê²Œìž„ ë¡œë“œ ì‹¤íŒ¨:",s),d.error("ì¹´ì§€ë…¸ ê²Œìž„ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤."))}finally{c.current&&f(!1)}},T=async s=>{if(j!==s.game_id){y(s.game_id);try{const a=await C.checkActiveSession(_.id);if(a?.isActive&&a.api_type!==s.api_type){const r={invest:"Invest API",oroplay:"OroPlay API"};d.error(`${r[a.api_type]} ê²Œìž„ì´ ì‹¤í–‰ ì¤‘ìž…ë‹ˆë‹¤.\\ní˜„ìž¬ ê²Œìž„: ${a.game_name}\\n\\në‹¤ë¥¸ API ê²Œìž„ì„ ì‹¤í–‰í•˜ë ¤ë©´ í˜„ìž¬ ê²Œìž„ì„ ì¢…ë£Œí•´ì£¼ì„¸ìš”.`,{duration:5e3}),y(null);return}if(a?.isActive&&a.api_type===s.api_type&&a.game_id!==s.game_id){console.log("ðŸ”„ [ê²Œìž„ ì „í™˜] ê¸°ì¡´ ê²Œìž„ ì¶œê¸ˆ í›„ ìƒˆ ê²Œìž„ ì‹¤í–‰:",{oldGameId:a.game_id,newGameId:s.game_id}),b("withdraw"),m(!0);const{syncBalanceOnSessionEnd:r}=await X(async()=>{const{syncBalanceOnSessionEnd:i}=await import("./index-Be3DOFuy.js").then(t=>t.aa);return{syncBalanceOnSessionEnd:i}},__vite__mapDeps([0,1,2,3,4,5,6]));await r(_.id,a.api_type),console.log("âœ… [ê²Œìž„ ì „í™˜] ê¸°ì¡´ ê²Œìž„ ì¶œê¸ˆ ì™„ë£Œ, ìƒˆ ê²Œìž„ ì‹¤í–‰ ì‹œìž‘")}if(a?.isActive&&a.game_id===s.game_id&&a.status==="ready"&&a.launch_url){console.log("ðŸ”„ [ì¹´ì§€ë…¸ ìž…ìž¥] ready ì„¸ì…˜ ìž¬ì‚¬ìš© - ê¸°ì¡´ URL ì‚¬ìš© (ìž…ê¸ˆ API í˜¸ì¶œ ì•ˆí•¨):",a.session_id);const r=window.open(a.launch_url,"_blank","width=1920,height=1080,scrollbars=yes,resizable=yes,fullscreen=yes");if(r){d.success(`${s.game_name} ì¹´ì§€ë…¸ì— ìž…ìž¥í–ˆìŠµë‹ˆë‹¤.`);const i=a.session_id;await x.from("game_launch_sessions").update({ready_status:"popup_opened",last_activity_at:new Date().toISOString()}).eq("id",i),window.gameWindows||(window.gameWindows=new Map),window.gameWindows.set(i,r),window.gameWindowCheckers||(window.gameWindowCheckers=new Map);let t=!1;const p=async()=>{if(t)return;t=!0,b("withdraw"),m(!0);const w=window.gameWindowCheckers?.get(i);w&&(clearInterval(w),window.gameWindowCheckers?.delete(i)),window.gameWindows?.delete(i),await window.syncBalanceAfterGame?.(i),setTimeout(()=>{m(!1)},500)},k=setInterval(()=>{try{r.closed&&p()}catch{}},1e3);window.gameWindowCheckers.set(i,k)}else{d.error("ì°¨ë‹¨ë˜ì—ˆìŠµë‹ˆë‹¤. íŒì—… í—ˆìš© í›„ ë‹¤ì‹œ í´ë¦­í•´ì£¼ì„¸ìš”.");const i=a.session_id;await x.from("game_launch_sessions").update({ready_status:"popup_blocked",last_activity_at:new Date().toISOString()}).eq("id",i),console.log("âš ï¸ [íŒì—… ì°¨ë‹¨] ready_status=popup_blocked ì—…ë°ì´íŠ¸ ì™„ë£Œ (ready ì„¸ì…˜ ìž¬ì‚¬ìš©)")}y(null);return}b("launch"),m(!0);const o=await C.generateGameLaunchUrl(_.id,s.game_id);if(m(!1),o.success&&o.launchUrl){const r=o.sessionId,i=window.open(o.launchUrl,"_blank","width=1920,height=1080,scrollbars=yes,resizable=yes,fullscreen=yes");if(!i)d.error("ì°¨ë‹¨ë˜ì—ˆìŠµë‹ˆë‹¤. íŒì—… í—ˆìš© í›„ ë‹¤ì‹œ í´ë¦­í•´ì£¼ì„¸ìš”."),r&&typeof r=="number"&&(await x.from("game_launch_sessions").update({ready_status:"popup_blocked",last_activity_at:new Date().toISOString()}).eq("id",r),console.log("âš ï¸ [íŒì—… ì°¨ë‹¨] ready_status=popup_blocked ì—…ë°ì´íŠ¸ ì™„ë£Œ. ìž¬í´ë¦­ ì‹œ ê¸°ì¡´ URL ìž¬ì‚¬ìš©ë©ë‹ˆë‹¤."));else if(d.success(`${s.game_name} ì¹´ì§€ë…¸ì— ìž…ìž¥í–ˆìŠµë‹ˆë‹¤.`),r&&typeof r=="number"&&(await x.from("game_launch_sessions").update({ready_status:"popup_opened",last_activity_at:new Date().toISOString()}).eq("id",r),window.gameWindows||(window.gameWindows=new Map),window.gameWindows.set(r,i)),r&&typeof r=="number"){window.gameWindowCheckers||(window.gameWindowCheckers=new Map);let t=!1;const p=async()=>{if(t)return;t=!0,b("withdraw"),m(!0);const w=window.gameWindowCheckers?.get(r);w&&(clearInterval(w),window.gameWindowCheckers?.delete(r)),window.gameWindows?.delete(r),await window.syncBalanceAfterGame?.(r),setTimeout(()=>{m(!1)},500)},k=setInterval(()=>{try{i.closed&&p()}catch{}},1e3);window.gameWindowCheckers.set(r,k)}}else d.error(`ì¹´ì§€ë…¸ ìž…ìž¥ ì‹¤íŒ¨: ${o.error||"ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."}`)}catch(a){console.error("ì¹´ì§€ë…¸ ì‹¤í–‰ ì˜¤ë¥˜:",a),d.error(`ì¹´ì§€ë…¸ ìž…ìž¥ ì¤‘ ì˜¤ë¥˜: ${a instanceof Error?a.message:"ì‹œìŠ¤í…œ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."}`),m(!1)}finally{y(null)}}},L=U.filter(s=>{const a=g===""||s.game_name.toLowerCase().includes(g.toLowerCase())||s.provider_name.toLowerCase().includes(g.toLowerCase());let o=!0;if(h!=="all"){const i=s.game_name.toLowerCase(),t=s.provider_name.toLowerCase();switch(h){case"evolution":o=t.includes("evolution")||t.includes("ì—ë³¼ë£¨ì…˜");break;case"pragmatic":o=t.includes("pragmatic")||t.includes("í”„ë¼ê·¸ë§ˆí‹±");break;case"baccarat":o=i.includes("baccarat")||i.includes("ë°”ì¹´ë¼");break;case"blackjack":o=i.includes("blackjack")||i.includes("ë¸”ëž™ìž­");break;case"roulette":o=i.includes("roulette")||i.includes("ë£°ë ›");break}}let r=!0;return u!=="all"&&(r=s.provider_id===parseInt(u)),a&&o&&r});return e.jsxs(e.Fragment,{children:[e.jsx(Y,{show:R,stage:B}),e.jsxs("div",{className:"relative min-h-screen overflow-x-hidden",children:[e.jsx("div",{className:"fixed inset-0 z-0 w-full h-full",style:{backgroundImage:"linear-gradient(rgba(0, 0, 0, 0.85), rgba(0, 0, 0, 0.90)), url('https://images.unsplash.com/photo-1680191741548-1a9321688cc3?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxsdXh1cnklMjBjYXNpbm8lMjBpbnRlcmlvciUyMGJhY2tncm91bmR8ZW58MXx8fHwxNzU5NzIwMzYzfDA&ixlib=rb-4.1.0&q80&w=1080&utm_source=figma&utm_medium=referral')",backgroundSize:"cover",backgroundPosition:"center center",backgroundRepeat:"no-repeat"}}),e.jsxs("div",{className:"relative z-10 space-y-8 p-4 sm:p-6 lg:p-8",children:[e.jsxs("div",{className:"text-center space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-center gap-4 mb-6",children:[e.jsx(v,{className:"w-16 h-16 text-yellow-400 drop-shadow-[0_0_20px_rgba(250,204,21,0.8)]"}),e.jsx("h1",{className:"text-6xl lg:text-7xl font-bold gold-text neon-glow",children:l.user.casinoTitle}),e.jsx(v,{className:"w-16 h-16 text-yellow-400 drop-shadow-[0_0_20px_rgba(250,204,21,0.8)]"})]}),e.jsx("p",{className:"text-3xl text-yellow-100 tracking-wide",children:l.user.casinoSubtitle}),e.jsxs("div",{className:"flex items-center justify-center gap-6 text-yellow-300/80 text-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 bg-red-500 rounded-full animate-pulse"}),e.jsx("span",{children:l.user.realTimeLive})]}),e.jsx("div",{className:"w-px h-6 bg-yellow-600/50"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(se,{className:"w-5 h-5"}),e.jsx("span",{children:l.user.available24h})]}),e.jsx("div",{className:"w-px h-6 bg-yellow-600/50"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(z,{className:"w-5 h-5"}),e.jsx("span",{children:l.user.vipExclusive})]})]})]}),e.jsxs("div",{className:"flex flex-col lg:flex-row gap-5 items-center justify-between",children:[e.jsxs("div",{className:"relative flex-1 max-w-xl",children:[e.jsx(ae,{className:"absolute left-4 top-1/2 transform -translate-y-1/2 w-6 h-6 text-yellow-400"}),e.jsx(V,{type:"text",placeholder:l.user.searchGame,value:g,onChange:s=>W(s.target.value),className:"pl-12 h-14 text-lg bg-black/50 border-yellow-600/30 text-white placeholder:text-yellow-200/50 focus:border-yellow-500"})]}),e.jsx("div",{className:"flex flex-wrap gap-3",children:$.map(s=>{const a=s.icon,o=h===s.id;return e.jsxs(S,{variant:"ghost",onClick:()=>G(s.id),className:`
                      relative px-6 py-4 text-lg font-bold transition-all duration-300
                      ${o?`bg-gradient-to-r ${s.gradient} text-white shadow-lg shadow-yellow-500/50 scale-105`:"text-yellow-200/80 hover:text-yellow-100 hover:bg-yellow-900/20"}
                    `,children:[e.jsx(a,{className:"w-5 h-5 mr-2"}),s.name,o&&e.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-1 bg-gradient-to-r from-transparent via-yellow-300 to-transparent"})]},s.id)})})]}),e.jsx(J,{selectedProvider:u,onProviderChange:I,gameType:"casino",providers:E}),P?e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4",children:Array.from({length:10}).map((s,a)=>e.jsx(A,{className:"luxury-card animate-pulse border-yellow-600/20",children:e.jsx("div",{className:"aspect-[4/3] bg-gradient-to-br from-slate-700 to-slate-800 rounded-xl"})},a))}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4",children:L.map(s=>e.jsxs(A,{className:`group cursor-pointer bg-slate-900/80 border border-slate-700/50 hover:border-yellow-500/50 transition-all duration-300 overflow-hidden rounded-xl hover:shadow-xl hover:shadow-yellow-500/20 ${j===s.game_id?"opacity-50":""}`,onClick:()=>T(s),children:[e.jsxs("div",{className:"aspect-[4/3] relative overflow-hidden bg-slate-800",children:[e.jsx(F,{src:s.image_url,alt:s.game_name,className:"w-full h-full object-cover transition-transform duration-500 group-hover:scale-105"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/90 via-black/20 to-transparent opacity-60 group-hover:opacity-80 transition-opacity"}),e.jsx("div",{className:"absolute top-2 left-2 flex gap-2",children:e.jsxs(M,{className:"bg-red-500/90 text-white border-0 text-xs backdrop-blur-sm",children:[e.jsx("div",{className:"w-1.5 h-1.5 bg-white rounded-full mr-1 animate-pulse"}),"LIVE"]})}),s.is_featured&&e.jsx("div",{className:"absolute top-2 right-2",children:e.jsxs(M,{className:"bg-yellow-500/90 text-black border-0 text-xs backdrop-blur-sm",children:[e.jsx(te,{className:"w-3 h-3 mr-1 fill-current"}),"VIP"]})}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity duration-300",children:j===s.game_id?e.jsxs("div",{className:"flex flex-col items-center gap-2 text-white",children:[e.jsx(re,{className:"w-10 h-10 animate-spin"}),e.jsx("span",{className:"text-sm font-semibold",children:l.user.entering})]}):e.jsxs("div",{className:"flex flex-col items-center gap-3",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-yellow-500/20 backdrop-blur-md flex items-center justify-center border-2 border-yellow-500/50",children:e.jsx(ie,{className:"w-8 h-8 text-yellow-400 fill-current"})}),e.jsx("span",{className:"text-white font-bold text-sm",children:l.user.enterCasino})]})})]}),e.jsxs("div",{className:"p-3 bg-slate-900/90",children:[e.jsx("h3",{className:"font-bold text-white text-base mb-1 truncate",children:s.game_name}),e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("p",{className:"text-yellow-400/80 truncate flex-1",children:s.provider_name}),e.jsxs("div",{className:"flex items-center gap-1 text-green-400 ml-2",children:[e.jsx(le,{className:"w-3 h-3"}),e.jsx("span",{children:"24H"})]})]})]})]},s.game_id))}),L.length===0&&!P&&e.jsxs("div",{className:"text-center py-16 luxury-card rounded-2xl border-2 border-yellow-600/20",children:[e.jsx("div",{className:"mx-auto w-24 h-24 bg-gradient-to-br from-yellow-500/20 to-amber-600/20 rounded-full flex items-center justify-center mb-6",children:e.jsx(v,{className:"w-12 h-12 text-yellow-400"})}),e.jsx("h3",{className:"text-2xl font-bold gold-text mb-2",children:l.user.noGamesFound}),e.jsx("p",{className:"text-yellow-200/80 text-lg mb-4",children:g?l.user.noGamesMessage.replace("{{query}}",g):h!=="all"?l.user.noGamesCategory:u!=="all"?l.user.noGamesProvider:l.user.noGamesAvailable}),e.jsxs("div",{className:"flex gap-2 justify-center",children:[e.jsx(S,{variant:"outline",onClick:()=>{W(""),G("all"),I("all")},className:"border-yellow-600/30 text-yellow-300 hover:bg-yellow-900/20",children:l.user.viewAllGames}),e.jsx(S,{variant:"outline",onClick:()=>N(),className:"border-yellow-600/30 text-yellow-300 hover:bg-yellow-900/20",children:l.user.refresh})]})]})]})]})]})}export{ge as UserCasino};
