const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/vendor-D410aui4.js","assets/react-core-BwkdTuSg.js","assets/radix-ui-omyR4zpf.js","assets/index-McppjVnx.js","assets/lucide-icons-CePlpqHy.js","assets/supabase-C8Oa5ukG.js","assets/index-B69pnHHb.css"])))=>i.map(i=>d[i]);
import{r as g,j as e}from"./react-core-BwkdTuSg.js";import{s as c,_ as Te,c as fs,d as bs,e as vs,a as He,C as te,h as re,L as X,I as ee,i as k,B as A,T as _s,j as js,k as be,l as ve,m as xe,n as ss,o as ws,S as Se,p as ke,q as Me,r as Oe,t as pe,v as ys,w as Ns,x as Ps,y as As,z as Ls}from"./index-McppjVnx.js";import{D as Cs}from"./DataTable-w2U-jZDQ.js";import{A as Ue,a as Ee,b as Be,c as Re,d as qe,e as Ke}from"./AdminDialog-D_QT-Qbt.js";import{k as p}from"./vendor-D410aui4.js";import{b as Fe,t as Ie,W as $e,G as De,ac as ye,A as as,V as Pe,T as Ss,ad as ks,a8 as Ms,i as Os,ab as Is,Z as $s,Q as Ds,l as Ts,X as Us,n as Es,R as Bs,a9 as Je,ae as Xe,af as Qe,ag as Ze,N as es,U as Rs,w as qs,ah as Fs}from"./lucide-icons-CePlpqHy.js";import{M as Ne}from"./MetricCard-DnMFhTGK.js";import{F as Ys}from"./ForceTransactionModal-Q9UFVw2D.js";import"./radix-ui-omyR4zpf.js";import"./supabase-C8Oa5ukG.js";import"./table-CKCHMZ5m.js";import"./popover-e-C_onM2.js";import"./command-BcDTzi9L.js";async function Ye(n,d,x,f){console.log("ğŸ”§ [API-ACCOUNT] ì™¸ë¶€ API ê³„ì • ìƒì„± ì‹œì‘:",{userId:n,username:d,partnerId:x});const{toast:a}=await Te(async()=>{const{toast:N}=await import("./vendor-D410aui4.js").then(F=>F.v);return{toast:N}},__vite__mapDeps([0,1,2]));let b=!1,h=!1,_=[];f&&a.loading(`[3/5] Invest API ê³„ì • ìƒì„± ì¤‘... (${d})`,{id:f}),console.log("ğŸ”µ [API-ACCOUNT] Invest API ê³„ì • ìƒì„± ì‹œì‘");try{const N=await Hs(d,x);N.success?(b=!0,console.log("âœ… [API-ACCOUNT] Invest API ê³„ì • ìƒì„± ì„±ê³µ"),f&&a.loading(`[3/5] Invest âœ… â†’ OroPlay API ê³„ì • ìƒì„± ì¤‘... (${d})`,{id:f})):(_.push(`Invest: ${N.error}`),console.error("âŒ [API-ACCOUNT] Invest API ê³„ì • ìƒì„± ì‹¤íŒ¨:",N.error),f&&a.loading(`[3/5] Invest âŒ (${N.error}) â†’ OroPlay API ê³„ì • ìƒì„± ì¤‘...`,{id:f}))}catch(N){const F=N instanceof Error?N.message:"ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜";_.push(`Invest: ${F}`),console.error("âŒ [API-ACCOUNT] Invest API ê³„ì • ìƒì„± ì˜ˆì™¸:",N),f&&a.loading(`[3/5] Invest âŒ (${F}) â†’ OroPlay API ê³„ì • ìƒì„± ì¤‘...`,{id:f})}f&&a.loading(`[4/5] OroPlay API ê³„ì • ìƒì„± ì¤‘... (${d})`,{id:f}),console.log("ğŸ”· [API-ACCOUNT] OroPlay API ê³„ì • ìƒì„± ì‹œì‘");try{const N=await Ws(d,x);console.log("ğŸ” [API-ACCOUNT] OroPlay ìƒì„± ê²°ê³¼:",N),N.success?(h=!0,console.log("âœ… [API-ACCOUNT] OroPlay API ê³„ì • ìƒì„± ì„±ê³µ")):(_.push(`OroPlay: ${N.error}`),console.error("âŒ [API-ACCOUNT] OroPlay API ê³„ì • ìƒì„± ì‹¤íŒ¨:",N.error))}catch(N){const F=N instanceof Error?N.message:"ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜";_.push(`OroPlay: ${F}`),console.error("âŒ [API-ACCOUNT] OroPlay API ê³„ì • ìƒì„± ì˜ˆì™¸:",N)}let E;b&&h?E="active":b||h?E="partial":E="error";const{error:y}=await c.from("users").update({api_account_status:E,api_invest_created:b,api_oroplay_created:h,api_error_message:_.length>0?_.join("; "):null,api_last_check_at:new Date().toISOString()}).eq("id",n);return y?console.error("âŒ [API-ACCOUNT] DB ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:",y):console.log(`âœ… [API-ACCOUNT] ê³„ì • ìƒì„± ì™„ë£Œ (ìƒíƒœ: ${E})`),{status:E,investCreated:b,oroplayCreated:h,errorMessage:_.length>0?_.join("; "):void 0}}async function Hs(n,d){try{const x=await ts(d),{data:f}=await c.from("api_configs").select("invest_opcode, invest_secret_key, invest_token").eq("partner_id",x).single();if(!f?.invest_opcode||!f?.invest_secret_key)return{success:!1,error:"Invest API ì„¤ì •ì´ ì—†ìŠµë‹ˆë‹¤ (api_configs í™•ì¸ í•„ìš”)"};const a=await fs(f.invest_opcode,n,f.invest_secret_key);return a&&a.Result!==!1?{success:!0}:{success:!1,error:a?.Msg||"ê³„ì • ìƒì„± ì‹¤íŒ¨"}}catch(x){return{success:!1,error:x instanceof Error?x.message:"ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜"}}}async function Ws(n,d){try{console.log("  ğŸ”¹ [OROPLAY] ========== ì‹œì‘ =========="),console.log("  ğŸ”¹ [OROPLAY] Username:",n),console.log("  ğŸ”¹ [OROPLAY] Partner ID:",d),console.log("  ğŸ”¹ [OROPLAY] 1ë‹¨ê³„: ëŒ€ë³¸ì‚¬ ID ì°¾ê¸° ì‹œì‘");const x=await ts(d);console.log("  âœ… [OROPLAY] ëŒ€ë³¸ì‚¬ ID ì°¾ê¸° ì™„ë£Œ:",x),console.log("  ğŸ”¹ [OROPLAY] 2ë‹¨ê³„: API ì„¤ì • ì¡°íšŒ");let{data:f}=await c.from("api_configs").select("partner_id, oroplay_client_id, oroplay_client_secret").eq("partner_id",x).single();if(!f?.oroplay_client_id||!f?.oroplay_client_secret){console.log("  âš ï¸ [OROPLAY] ëŒ€ë³¸ì‚¬ ì„¤ì • ì—†ìŒ, ì²« ë²ˆì§¸ ìœ íš¨í•œ ì„¤ì • ì¡°íšŒ");const{data:_}=await c.from("api_configs").select("partner_id, oroplay_client_id, oroplay_client_secret").not("oroplay_client_id","is",null).not("oroplay_client_secret","is",null).limit(1).single();if(!_)return console.error("  âŒ [OROPLAY] OroPlay API ì„¤ì •ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤"),console.error("  âŒ [OROPLAY] api_configs í…Œì´ë¸”ì— oroplay_client_id, oroplay_client_secretì„ ì„¤ì •í•˜ì„¸ìš”"),{success:!1,error:"OroPlay API ì„¤ì •ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì‹œìŠ¤í…œ ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•˜ì„¸ìš”."};f=_,console.log("  âœ… [OROPLAY] ì²« ë²ˆì§¸ ì„¤ì • ì‚¬ìš© (partner_id:",f.partner_id,")")}else console.log("  âœ… [OROPLAY] API ì„¤ì • ì¡°íšŒ ì„±ê³µ (ëŒ€ë³¸ì‚¬)");console.log("  ğŸ”¹ [OROPLAY] 3ë‹¨ê³„: ìƒˆë¡œìš´ í† í° ê°•ì œ ë°œê¸‰ ì‹œì‘");const a=await bs(f.oroplay_client_id,f.oroplay_client_secret),b=a.token;console.log("  âœ… [OROPLAY] ìƒˆ í† í° ë°œê¸‰ ì„±ê³µ (ê¸¸ì´:",b.length,")"),console.log("  ğŸ”¹ [OROPLAY] í† í° ì•ë¶€ë¶„:",b.substring(0,30)+"..."),console.log("  ğŸ”¹ [OROPLAY] 4ë‹¨ê³„: DBì— ìƒˆ í† í° ì €ì¥"),await c.from("api_configs").update({oroplay_token:b,oroplay_token_expires_at:new Date(a.expiration*1e3).toISOString()}).eq("partner_id",f.partner_id),console.log("  âœ… [OROPLAY] DB ì €ì¥ ì™„ë£Œ (partner_id:",f.partner_id,")"),console.log("  ğŸ”¹ [OROPLAY] 5ë‹¨ê³„: OroPlay API createUser í˜¸ì¶œ ì‹œì‘"),console.log("  ğŸ”¹ [OROPLAY] í˜¸ì¶œ íŒŒë¼ë¯¸í„° - token:",b.substring(0,20)+"...",", username:",n);const h=await vs(b,n);return console.log("  âœ… [OROPLAY] createUser ì‘ë‹µ:",h),console.log("  âœ… [OROPLAY] ê³„ì • ìƒì„± ì™„ë£Œ!"),console.log("  ğŸ”¹ [OROPLAY] ========== ì™„ë£Œ =========="),{success:!0}}catch(x){return console.error("  âŒ [OROPLAY] ========== ì˜¤ë¥˜ ë°œìƒ =========="),console.error("  âŒ [OROPLAY] ì˜¤ë¥˜ íƒ€ì…:",x?.constructor?.name),console.error("  âŒ [OROPLAY] ì˜¤ë¥˜ ë©”ì‹œì§€:",x instanceof Error?x.message:String(x)),console.error("  âŒ [OROPLAY] ì˜¤ë¥˜ ìŠ¤íƒ:",x instanceof Error?x.stack:"No stack"),console.error("  âŒ [OROPLAY] ì „ì²´ ì˜¤ë¥˜ ê°ì²´:",JSON.stringify(x,null,2)),{success:!1,error:x instanceof Error?x.message:"ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜"}}}async function ts(n){console.log("    ğŸ”¸ [Lv1ì°¾ê¸°] ì‹œì‘ íŒŒíŠ¸ë„ˆ ID:",n);const{data:d}=await c.from("partners").select("id, partner_type, parent_id").eq("id",n).single();if(!d)throw console.error("    âŒ [Lv1ì°¾ê¸°] íŒŒíŠ¸ë„ˆ ì •ë³´ ì—†ìŒ"),new Error("íŒŒíŠ¸ë„ˆ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤");if(console.log("    ğŸ” [Lv1ì°¾ê¸°] íŒŒíŠ¸ë„ˆ íƒ€ì…:",d.partner_type),d.partner_type==="system_admin")return console.log("    âœ… [Lv1ì°¾ê¸°] Lv1 ì‹œìŠ¤í…œê´€ë¦¬ì ì°¾ìŒ:",d.id),d.id;if(d.partner_type==="head_office"){if(console.log("    ğŸ”¼ [Lv1ì°¾ê¸°] Lv2 ëŒ€ë³¸ì‚¬ ë°œê²¬, ìƒìœ„ Lv1ë¡œ ì´ë™"),!d.parent_id)throw new Error("Lv2 ëŒ€ë³¸ì‚¬ì˜ ìƒìœ„ Lv1ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤");const{data:x}=await c.from("partners").select("id, partner_type").eq("id",d.parent_id).single();if(x?.partner_type==="system_admin")return console.log("    âœ… [Lv1ì°¾ê¸°] Lv1 ì‹œìŠ¤í…œê´€ë¦¬ì ì°¾ìŒ:",x.id),x.id;throw new Error("Lv2ì˜ ìƒìœ„ íŒŒíŠ¸ë„ˆê°€ Lv1ì´ ì•„ë‹™ë‹ˆë‹¤")}if(d.parent_id){console.log("    ğŸ”¼ [Lv1ì°¾ê¸°] ìƒìœ„ íŒŒíŠ¸ë„ˆ íƒìƒ‰ ì‹œì‘");let x=d.parent_id,f=0;for(;x&&f<10;){const{data:a}=await c.from("partners").select("id, partner_type, parent_id").eq("id",x).single();if(console.log(`    ğŸ” [Lv1ì°¾ê¸°] ì‹œë„ ${f+1}: íƒ€ì…=${a?.partner_type}`),a?.partner_type==="system_admin")return console.log("    âœ… [Lv1ì°¾ê¸°] Lv1 ì‹œìŠ¤í…œê´€ë¦¬ì ì°¾ìŒ:",a.id),a.id;if(a?.partner_type==="head_office"){if(console.log("    ğŸ”¼ [Lv1ì°¾ê¸°] Lv2 ëŒ€ë³¸ì‚¬ ë°œê²¬, ìƒìœ„ Lv1ë¡œ ì´ë™"),!a.parent_id)throw new Error("Lv2 ëŒ€ë³¸ì‚¬ì˜ ìƒìœ„ Lv1ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤");const{data:b}=await c.from("partners").select("id, partner_type").eq("id",a.parent_id).single();if(b?.partner_type==="system_admin")return console.log("    âœ… [Lv1ì°¾ê¸°] Lv1 ì‹œìŠ¤í…œê´€ë¦¬ì ì°¾ìŒ:",b.id),b.id;throw new Error("Lv2ì˜ ìƒìœ„ íŒŒíŠ¸ë„ˆê°€ Lv1ì´ ì•„ë‹™ë‹ˆë‹¤")}x=a?.parent_id||null,f++}}throw console.error("    âŒ [Lv1ì°¾ê¸°] Lv1 ì‹œìŠ¤í…œê´€ë¦¬ìë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ"),new Error("ìƒìœ„ Lv1 ì‹œìŠ¤í…œê´€ë¦¬ìë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤")}async function zs(n){console.log("ğŸ”„ [API-ACCOUNT] ê³„ì • ì¬ìƒì„± ì‹œë„:",n);const{data:d,error:x}=await c.from("users").select("username, referrer_id").eq("id",n).single();if(x||!d)throw new Error("ì‚¬ìš©ìë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤");return await Ye(n,d.username,d.referrer_id)}function Vs({userId:n}){const{t:d}=He(),[x,f]=g.useState(""),[a,b]=g.useState(""),[h,_]=g.useState(!1),E=async()=>{if(!x||!a){p.error(d.passwordChange.enterPassword);return}if(x.length<4){p.error(d.passwordChange.minLength);return}if(x!==a){p.error(d.passwordChange.passwordMismatch);return}try{_(!0);const{error:y}=await c.from("users").update({password_hash:x,updated_at:new Date().toISOString()}).eq("id",n);if(y)throw y;p.success(d.passwordChange.changeSuccess),f(""),b("")}catch(y){console.error("Password change error:",y),p.error(d.passwordChange.changeFailed)}finally{_(!1)}};return e.jsxs("div",{children:[e.jsxs("h3",{className:"flex items-center gap-2 mb-3",children:[e.jsx(Fe,{className:"h-3.5 w-3.5 text-red-400"}),e.jsx("span",{className:"text-xs",children:d.passwordChange.title})]}),e.jsx(te,{className:"bg-white/5 border-white/10",children:e.jsxs(re,{className:"p-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(X,{htmlFor:"newPassword",className:"text-xs",children:d.passwordChange.newPassword}),e.jsx(ee,{id:"newPassword",type:"password",value:x,onChange:y=>f(y.target.value),placeholder:d.passwordChange.newPasswordPlaceholder,className:"bg-white/5 border-white/10 text-xs h-9"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(X,{htmlFor:"confirmPassword",className:"text-xs",children:d.passwordChange.confirmPassword}),e.jsx(ee,{id:"confirmPassword",type:"password",value:a,onChange:y=>b(y.target.value),placeholder:d.passwordChange.confirmPasswordPlaceholder,className:"bg-white/5 border-white/10 text-xs h-9"})]})]}),e.jsx("div",{className:"flex justify-end mt-4",children:e.jsx(k,{onClick:E,disabled:h||!x||!a,className:"bg-gradient-to-r from-red-500 to-pink-600 hover:from-red-600 hover:to-pink-700 text-white px-4 py-2 text-xs h-9",children:h?d.passwordChange.changing:d.passwordChange.changeButton})})]})})]})}function Gs({user:n,isOpen:d,onClose:x}){const{t:f}=He(),[a,b]=g.useState("basic"),[h,_]=g.useState(!1),[E,y]=g.useState([]),[N,F]=g.useState([]),[$,_e]=g.useState(null),[P,Ae]=g.useState({totalDeposit:0,totalWithdraw:0,totalBets:0,totalWinAmount:0,accountAge:0,lastActivity:"",gameCount:0,winRate:0}),[W,oe]=g.useState(1e8),[ie,je]=g.useState(null),[ne,ce]=g.useState(!1),ge=async()=>{try{_(!0);const{data:r}=await c.from("transactions").select("transaction_type, amount, status").eq("user_id",n.id),u=(r||[]).filter(L=>L.transaction_type==="deposit"&&L.status==="approved").reduce((L,S)=>L+(S.amount||0),0),T=(r||[]).filter(L=>L.transaction_type==="withdrawal"&&L.status==="approved").reduce((L,S)=>L+(S.amount||0),0),{data:O}=await c.from("game_records").select("bet_amount, win_amount").eq("user_id",n.id),se=(O||[]).reduce((L,S)=>L+(S.bet_amount||0),0),Q=(O||[]).reduce((L,S)=>L+(S.win_amount||0),0),q=O?.length||0,V=(O||[]).filter(L=>(L.win_amount||0)>(L.bet_amount||0)).length,C=q>0?V/q*100:0,G=Math.floor((Date.now()-new Date(n.created_at).getTime())/(1e3*60*60*24)),{data:Z}=await c.from("game_launch_sessions").select("launched_at").eq("user_id",n.id).order("launched_at",{ascending:!1}).limit(1).single();Ae({totalDeposit:u,totalWithdraw:T,totalBets:se,totalWinAmount:Q,accountAge:G,lastActivity:Z?.launched_at||n.created_at,gameCount:q,winRate:C})}catch(r){console.error("í†µê³„ ê³„ì‚° ì˜¤ë¥˜:",r)}finally{_(!1)}},B=async()=>{try{_(!0);const{data:r,error:u}=await c.from("transactions").select("*").eq("user_id",n.id).order("created_at",{ascending:!1}).limit(100);if(u)throw u;y(r||[])}catch(r){console.error("ì…ì¶œê¸ˆ ë‚´ì—­ ì¡°íšŒ ì˜¤ë¥˜:",r),p.error("ì…ì¶œê¸ˆ ë‚´ì—­ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")}finally{_(!1)}},he=async()=>{try{_(!0);const{data:r,error:u}=await c.from("game_records").select("*").eq("user_id",n.id).order("played_at",{ascending:!1}).limit(100);if(u)throw u;F(r||[])}catch(r){console.error("ë² íŒ… ë‚´ì—­ ì¡°íšŒ ì˜¤ë¥˜:",r),p.error("ë² íŒ… ë‚´ì—­ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")}finally{_(!1)}},M=async()=>{try{_(!0);const{data:r}=await c.from("game_records").select("*").eq("user_id",n.id).order("played_at",{ascending:!1}).limit(500);if(!r||r.length===0){_e(null);return}const u=new Map;r.forEach(m=>{const j=`${m.game_id}_${m.game_title||""}`;u.has(j)||u.set(j,{gameName:m.game_title||`ê²Œì„ ${m.game_id}`,providerName:m.provider_name||"",count:0,totalBet:0,totalWin:0,wins:0});const me=u.get(j);me.count++,me.totalBet+=m.bet_amount||0,me.totalWin+=m.win_amount||0,(m.win_amount||0)>(m.bet_amount||0)&&me.wins++});const T=Array.from(u.values()).sort((m,j)=>j.count-m.count).slice(0,5).map(m=>({game:m.gameName,provider:m.providerName,count:m.count,winRate:m.count>0?m.wins/m.count*100:0,netProfit:m.totalWin-m.totalBet})),O=new Array(24).fill(0);r.forEach(m=>{const j=new Date(m.played_at).getHours();O[j]++});const se=O.indexOf(Math.max(...O)),q=(O.slice(22).reduce((m,j)=>m+j,0)+O.slice(0,6).reduce((m,j)=>m+j,0))/r.length*100,V=r.map(m=>m.bet_amount||0),C=V.reduce((m,j)=>m+j,0)/r.length,G=Math.max(...V),Z=r.reduce((m,j)=>m+(j.bet_amount||0),0),S=r.reduce((m,j)=>m+(j.win_amount||0),0)-Z,H=r.filter(m=>(m.win_amount||0)>(m.bet_amount||0)).length/r.length*100;let R=0;C>1e5?R+=3:C>5e4?R+=2:C>1e4&&(R+=1),G>5e5?R+=3:G>2e5?R+=2:G>5e4&&(R+=1),S<-1e6?R+=3:S<-5e5?R+=2:S<-1e5&&(R+=1),r.length>500&&(R+=1);const ae=R>=6?"HIGH":R>=3?"MEDIUM":"LOW",U=[];if(T.length>0){const m=T[0],j=(m.count/r.length*100).toFixed(1);U.push(`ğŸ’ ê°€ì¥ ì„ í˜¸í•˜ëŠ” ê²Œì„ì€ "${m.game}"ë¡œ, ì „ì²´ í”Œë ˆì´ì˜ ${j}%ë¥¼ ì°¨ì§€í•©ë‹ˆë‹¤.`),m.winRate>60?U.push(`âœ… "${m.game}"ì—ì„œ ${m.winRate.toFixed(1)}%ì˜ ë†’ì€ ìŠ¹ë¥ ì„ ê¸°ë¡ ì¤‘ì…ë‹ˆë‹¤.`):m.winRate<40&&U.push(`âš ï¸ "${m.game}"ì—ì„œ ${m.winRate.toFixed(1)}%ì˜ ë‚®ì€ ìŠ¹ë¥ ë¡œ, ì „ëµ ê°œì„ ì´ í•„ìš”í•©ë‹ˆë‹¤.`)}U.push(`ğŸ• ì£¼ë¡œ ${se}ì‹œì— ê°€ì¥ í™œë°œí•œ í™œë™ì„ ë³´ì…ë‹ˆë‹¤.`),q>40&&U.push(`ğŸŒ™ ì•¼ê°„ ì‹œê°„ëŒ€(22ì‹œ~6ì‹œ) í”Œë ˆì´ ë¹„ìœ¨ì´ ${q.toFixed(1)}%ë¡œ ë†’ìŠµë‹ˆë‹¤.`),H>55?U.push(`ğŸ“ˆ ì „ì²´ ìŠ¹ë¥  ${H.toFixed(1)}%ë¡œ í‰ê·  ì´ìƒì˜ ìš°ìˆ˜í•œ ì„±ê³¼ë¥¼ ë³´ì…ë‹ˆë‹¤.`):H<45?U.push(`ğŸ“‰ ì „ì²´ ìŠ¹ë¥  ${H.toFixed(1)}%ë¡œ ê²Œì„ ì „ëµ ì¬ê²€í† ê°€ í•„ìš”í•©ë‹ˆë‹¤.`):U.push(`ğŸ“Š ì „ì²´ ìŠ¹ë¥  ${H.toFixed(1)}%ë¡œ í‰ê· ì ì¸ ìˆ˜ì¤€ì…ë‹ˆë‹¤.`),S>0?U.push(`ğŸ’° ì´ ${Math.abs(S).toLocaleString()}ì›ì˜ ìˆ˜ìµì„ ë‹¬ì„±í–ˆìŠµë‹ˆë‹¤.`):U.push(`ğŸ’¸ ì´ ${Math.abs(S).toLocaleString()}ì›ì˜ ì†ì‹¤ì´ ë°œìƒí–ˆìŠµë‹ˆë‹¤.`),C>5e4&&U.push(`âš¡ í‰ê·  ë² íŒ…ì•¡ì´ ${C.toLocaleString()}ì›ìœ¼ë¡œ ê³ ì•¡ ë² íŒ… ì„±í–¥ì…ë‹ˆë‹¤.`),G/C>10&&U.push("ğŸ“Š ë² íŒ… ê¸ˆì•¡ ë³€ë™ì„±ì´ ë†’ì•„ ì¼ê´€ëœ ë² íŒ… ì „ëµì´ í•„ìš”í•©ë‹ˆë‹¤.");let I="";ae==="HIGH"?I="ê³µê²©ì  ê³ ìœ„í—˜ í”Œë ˆì´ì–´":ae==="MEDIUM"?H>50?I="ì ê·¹ì  ì•ˆì •í˜• í”Œë ˆì´ì–´":I="ë„ì „ì  ì¤‘ìœ„í—˜ í”Œë ˆì´ì–´":C<1e4?I="ë³´ìˆ˜ì  ì €ìœ„í—˜ í”Œë ˆì´ì–´":I="ì‹ ì¤‘í•œ ì•ˆì •í˜• í”Œë ˆì´ì–´",_e({topGames:T,peakHour:se,nightPlayRatio:q,avgBet:C,maxBet:G,totalBets:r.length,winRate:H,netProfit:S,riskLevel:ae,userType:I,insights:U})}catch(r){console.error("íŒ¨í„´ ë¶„ì„ ì˜¤ë¥˜:",r),p.error("íŒ¨í„´ ë¶„ì„ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")}finally{_(!1)}},we=async()=>{try{ce(!0);const{md5Hash:r}=await Te(async()=>{const{md5Hash:C}=await import("./index-McppjVnx.js").then(G=>G.a9);return{md5Hash:C}},__vite__mapDeps([3,1,0,2,4,5,6])),{data:u,error:T}=await c.from("api_configs").select("invest_opcode, invest_secret_key").eq("partner_id",n.referrer_id).single();if(T||!u?.invest_opcode||!u?.invest_secret_key){p.error("íŒŒíŠ¸ë„ˆ API ì„¤ì •ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤."),console.error("API config error:",T,u);return}const O=r(u.invest_opcode+u.invest_secret_key),Q=await(await fetch("https://vi8282.com/proxy",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:"https://api.invest-ho.com/api/game/limit",method:"GET",headers:{"Content-Type":"application/json"},body:{opcode:u.invest_opcode,signature:O}})})).json(),V=(Q.DATA||Q).limit||1e8;je(V),oe(V)}catch(r){console.error("ì—ë³¼ë£¨ì…˜ ì„¤ì • ì¡°íšŒ ì˜¤ë¥˜:",r),p.error("ì„¤ì •ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")}finally{ce(!1)}},Le=async()=>{try{ce(!0);const{md5Hash:r}=await Te(async()=>{const{md5Hash:q}=await import("./index-McppjVnx.js").then(V=>V.a9);return{md5Hash:q}},__vite__mapDeps([3,1,0,2,4,5,6])),{data:u,error:T}=await c.from("api_configs").select("invest_opcode, invest_secret_key").eq("partner_id",n.referrer_id).single();if(T||!u?.invest_opcode||!u?.invest_secret_key){p.error("íŒŒíŠ¸ë„ˆ API ì„¤ì •ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");return}const O=r(u.invest_opcode+u.invest_secret_key),Q=await(await fetch("https://vi8282.com/proxy",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:"https://api.invest-ho.com/api/game/limit",method:"PUT",headers:{"Content-Type":"application/json"},body:{opcode:u.invest_opcode,users:[n.username],limit:W,signature:O}})})).json();Q.RESULT===!0||Q.result===!0?(p.success("ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤."),je(W)):p.error("ì„¤ì • ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")}catch(r){console.error("ì—ë³¼ë£¨ì…˜ ì„¤ì • ì €ì¥ ì˜¤ë¥˜:",r),p.error("ì„¤ì •ì„ ì €ì¥í•˜ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")}finally{ce(!1)}};g.useEffect(()=>{!d||!n||(a==="basic"?ge():a==="transactions"?B():a==="betting"?he():a==="pattern"?M():a==="evolution"&&we())},[a,d,n]);const D=r=>`â‚©${r.toLocaleString()}`,fe=r=>{const u=new Date(r);return`${u.getFullYear()}.${String(u.getMonth()+1).padStart(2,"0")}.${String(u.getDate()).padStart(2,"0")}`},de=r=>{const u=new Date(r);return`${u.getFullYear()}.${String(u.getMonth()+1).padStart(2,"0")}.${String(u.getDate()).padStart(2,"0")} ${String(u.getHours()).padStart(2,"0")}:${String(u.getMinutes()).padStart(2,"0")}`},Y=r=>{switch(r){case"approved":case"completed":return e.jsx(A,{className:"bg-green-500/20 text-green-400 border-green-500/30",children:"ìŠ¹ì¸"});case"pending":return e.jsx(A,{className:"bg-yellow-500/20 text-yellow-400 border-yellow-500/30",children:"ëŒ€ê¸°"});case"rejected":return e.jsx(A,{className:"bg-red-500/20 text-red-400 border-red-500/30",children:"ê±°ì ˆ"});default:return e.jsx(A,{children:r})}};return n?e.jsx(Ue,{open:d,onOpenChange:x,children:e.jsxs(Ee,{className:"!max-w-[2400px] w-[98vw] max-h-[92vh] overflow-hidden glass-card border border-white/10 p-0",children:[e.jsxs(Be,{className:"border-b border-white/10 pb-3 pt-4 px-6",children:[e.jsxs(Re,{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center",children:e.jsx(Ie,{className:"h-5 w-5 text-white"})}),e.jsx("div",{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-lg",children:n.nickname}),e.jsxs("span",{className:"text-muted-foreground",children:["(",n.username,")"]}),n.status==="active"?e.jsx(A,{className:"bg-green-500/20 text-green-400 border-green-500/30",children:"í™œì„±"}):n.status==="suspended"?e.jsx(A,{className:"bg-red-500/20 text-red-400 border-red-500/30",children:"ì •ì§€"}):e.jsx(A,{className:"bg-yellow-500/20 text-yellow-400 border-yellow-500/30",children:"ëŒ€ê¸°"}),n.is_online&&e.jsx(A,{className:"bg-green-500/20 text-green-400 border-green-500/30",children:"ì ‘ì†ì¤‘"})]})})]}),e.jsx(qe,{className:"text-sm text-muted-foreground mt-0.5 pl-12",children:"íšŒì›ì˜ ìƒì„¸ ì •ë³´, ì…ì¶œê¸ˆ ë‚´ì—­, ë² íŒ… ë‚´ì—­ ë° AI ê²Œì„ íŒ¨í„´ ë¶„ì„ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤."})]}),e.jsxs(_s,{value:a,onValueChange:b,className:"w-full px-6",children:[e.jsx("div",{className:"bg-slate-800/30 rounded-xl p-1.5 border border-slate-700/40",children:e.jsxs(js,{className:"bg-transparent h-auto p-0 border-0 gap-2 w-full grid grid-cols-5",children:[e.jsxs(be,{value:"basic",className:"bg-transparent text-slate-400 rounded-lg px-4 py-3 data-[state=active]:bg-gradient-to-br data-[state=active]:from-blue-500/20 data-[state=active]:to-cyan-500/10 data-[state=active]:text-white data-[state=active]:shadow-lg data-[state=active]:shadow-blue-500/20 data-[state=active]:border data-[state=active]:border-blue-400/30 transition-all duration-200",children:[e.jsx(Ie,{className:"h-4 w-4 mr-2"}),e.jsx("span",{className:"text-sm",children:"ê¸°ë³¸ì •ë³´"})]}),e.jsxs(be,{value:"transactions",className:"bg-transparent text-slate-400 rounded-lg px-4 py-3 data-[state=active]:bg-gradient-to-br data-[state=active]:from-green-500/20 data-[state=active]:to-emerald-500/10 data-[state=active]:text-white data-[state=active]:shadow-lg data-[state=active]:shadow-green-500/20 data-[state=active]:border data-[state=active]:border-green-400/30 transition-all duration-200",children:[e.jsx($e,{className:"h-4 w-4 mr-2"}),e.jsx("span",{className:"text-sm",children:"ì…ì¶œê¸ˆë‚´ì—­"})]}),e.jsxs(be,{value:"betting",className:"bg-transparent text-slate-400 rounded-lg px-4 py-3 data-[state=active]:bg-gradient-to-br data-[state=active]:from-purple-500/20 data-[state=active]:to-pink-500/10 data-[state=active]:text-white data-[state=active]:shadow-lg data-[state=active]:shadow-purple-500/20 data-[state=active]:border data-[state=active]:border-purple-400/30 transition-all duration-200",children:[e.jsx(De,{className:"h-4 w-4 mr-2"}),e.jsx("span",{className:"text-sm",children:"ë² íŒ…ë‚´ì—­"})]}),e.jsxs(be,{value:"pattern",className:"bg-transparent text-slate-400 rounded-lg px-4 py-3 data-[state=active]:bg-gradient-to-br data-[state=active]:from-orange-500/20 data-[state=active]:to-amber-500/10 data-[state=active]:text-white data-[state=active]:shadow-lg data-[state=active]:shadow-orange-500/20 data-[state=active]:border data-[state=active]:border-orange-400/30 transition-all duration-200",children:[e.jsx(ye,{className:"h-4 w-4 mr-2"}),e.jsx("span",{className:"text-sm",children:"AI ê²Œì„íŒ¨í„´"})]}),e.jsxs(be,{value:"evolution",className:"bg-transparent text-slate-400 rounded-lg px-4 py-3 data-[state=active]:bg-gradient-to-br data-[state=active]:from-red-500/20 data-[state=active]:to-rose-500/10 data-[state=active]:text-white data-[state=active]:shadow-lg data-[state=active]:shadow-red-500/20 data-[state=active]:border data-[state=active]:border-red-400/30 transition-all duration-200",children:[e.jsx(Fe,{className:"h-4 w-4 mr-2"}),e.jsx("span",{className:"text-sm",children:"ì—ë³¼ë£¨ì…˜ ì„¤ì •"})]})]})}),e.jsx(ve,{value:"basic",className:"max-h-[calc(92vh-140px)] overflow-y-auto pr-2 pt-3",children:h?e.jsx(xe,{}):e.jsxs("div",{className:"space-y-5 p-4",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"flex items-center gap-2 mb-4",children:[e.jsx(Ie,{className:"h-4 w-4 text-blue-400"}),e.jsx("span",{className:"text-base",children:"ê¸°ë³¸ ì •ë³´"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-x-6 gap-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between py-3 px-4 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"ì•„ì´ë””"}),e.jsx("span",{className:"text-base font-mono",children:n.username})]}),e.jsxs("div",{className:"flex items-center justify-between py-3 px-4 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"ë‹‰ë„¤ì„"}),e.jsx("span",{className:"text-base",children:n.nickname})]}),e.jsxs("div",{className:"flex items-center justify-between py-3 px-4 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"ê°€ì…ì¼"}),e.jsx("span",{className:"text-base",children:fe(n.created_at)})]}),e.jsxs("div",{className:"flex items-center justify-between py-3 px-4 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"ê°€ì… ê²½ê³¼"}),e.jsxs("span",{className:"text-base",children:[P.accountAge,"ì¼"]})]}),e.jsxs("div",{className:"flex items-center justify-between py-3 px-4 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"ì€í–‰"}),e.jsx("span",{className:"text-base",children:n.bank_name||"-"})]}),e.jsxs("div",{className:"flex items-center justify-between py-3 px-4 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"ê³„ì¢Œë²ˆí˜¸"}),e.jsx("span",{className:"text-base font-mono",children:n.bank_account||"-"})]})]})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"flex items-center gap-2 mb-4",children:[e.jsx($e,{className:"h-4 w-4 text-emerald-400"}),e.jsx("span",{className:"text-base",children:"ì”ê³  ì •ë³´"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-x-6 gap-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between py-3 px-4 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"ë³´ìœ ê¸ˆ"}),e.jsx("span",{className:"text-lg font-mono",children:D(n.balance||0)})]}),e.jsxs("div",{className:"flex items-center justify-between py-3 px-4 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"í¬ì¸íŠ¸"}),e.jsx("span",{className:"text-lg font-mono",children:D(n.points||0)})]}),e.jsxs("div",{className:"flex items-center justify-between py-3 px-4 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"ì´ ì…ê¸ˆ"}),e.jsx("span",{className:"text-lg font-mono text-blue-400",children:D(P.totalDeposit)})]}),e.jsxs("div",{className:"flex items-center justify-between py-3 px-4 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"ì´ ì¶œê¸ˆ"}),e.jsx("span",{className:"text-lg font-mono text-pink-400",children:D(P.totalWithdraw)})]}),e.jsxs("div",{className:"flex items-center justify-between py-3 px-4 rounded-lg bg-gradient-to-r from-white/10 to-white/5 border border-white/20",children:[e.jsx("span",{className:"text-base",children:"ìˆœ ì…ì¶œê¸ˆ"}),e.jsx("span",{className:`text-lg font-mono ${P.totalDeposit-P.totalWithdraw>=0?"text-green-400":"text-red-400"}`,children:D(P.totalDeposit-P.totalWithdraw)})]}),e.jsxs("div",{className:"flex items-center justify-between py-3 px-4 rounded-lg bg-gradient-to-r from-white/10 to-white/5 border border-white/20",children:[e.jsx("span",{className:"text-base",children:"ê²Œì„ ì†ìµ"}),e.jsxs("span",{className:`text-lg font-mono ${P.totalWinAmount-P.totalBets>=0?"text-green-400":"text-red-400"}`,children:[P.totalWinAmount-P.totalBets>=0?"+":"",D(P.totalWinAmount-P.totalBets)]})]})]})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"flex items-center gap-2 mb-4",children:[e.jsx(as,{className:"h-4 w-4 text-amber-400"}),e.jsx("span",{className:"text-base",children:"ë² íŒ… í†µê³„"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-x-6 gap-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between py-3 px-4 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"ê²Œì„ í”Œë ˆì´"}),e.jsxs("span",{className:"text-base font-mono",children:[P.gameCount,"íšŒ"]})]}),e.jsxs("div",{className:"flex items-center justify-between py-3 px-4 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"ìŠ¹ë¥ "}),e.jsxs("span",{className:`text-base font-mono ${P.winRate>50?"text-green-400":"text-red-400"}`,children:[P.winRate.toFixed(1),"%"]})]}),e.jsxs("div",{className:"flex items-center justify-between py-3 px-4 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"ì´ ë² íŒ…ì•¡"}),e.jsx("span",{className:"text-base font-mono",children:D(P.totalBets)})]}),e.jsxs("div",{className:"flex items-center justify-between py-3 px-4 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"ì´ ë‹¹ì²¨ì•¡"}),e.jsx("span",{className:"text-base font-mono",children:D(P.totalWinAmount)})]})]})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"flex items-center gap-2 mb-4",children:[e.jsx(Pe,{className:"h-4 w-4 text-purple-400"}),e.jsx("span",{className:"text-base",children:"í™œë™ ì •ë³´"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-x-6 gap-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between py-3 px-4 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"ìµœê·¼ í™œë™"}),e.jsx("span",{className:"text-base",children:de(P.lastActivity)})]}),e.jsxs("div",{className:"flex items-center justify-between py-3 px-4 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"ì¶”ì²œì¸"}),e.jsx("span",{className:"text-base",children:n.referrer?.username||"-"})]}),n.memo&&e.jsxs("div",{className:"col-span-2 py-3 px-4 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("span",{className:"text-sm text-muted-foreground block mb-1.5",children:"ë©”ëª¨"}),e.jsx("span",{className:"text-base",children:n.memo})]})]})]}),e.jsx(Vs,{userId:n.id})]})}),e.jsx(ve,{value:"transactions",className:"max-h-[calc(92vh-140px)] overflow-y-auto pr-2 pt-3",children:h?e.jsx(xe,{}):E.length===0?e.jsxs("div",{className:"text-center py-12 glass-card rounded-xl",children:[e.jsx($e,{className:"h-16 w-16 text-muted-foreground mx-auto mb-4 opacity-50"}),e.jsx("p",{className:"text-muted-foreground text-base",children:"ì…ì¶œê¸ˆ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤."})]}):e.jsx("div",{className:"glass-card rounded-xl overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"border-b border-white/10",children:e.jsxs("tr",{className:"bg-white/5",children:[e.jsx("th",{className:"px-4 py-3.5 text-left text-sm",children:"êµ¬ë¶„"}),e.jsx("th",{className:"px-4 py-3.5 text-left text-sm",children:"ìƒíƒœ"}),e.jsx("th",{className:"px-4 py-3.5 text-left text-sm",children:"ì¼ì‹œ"}),e.jsx("th",{className:"px-4 py-3.5 text-left text-sm",children:"ë©”ëª¨"}),e.jsx("th",{className:"px-4 py-3.5 text-right text-sm",children:"ê¸ˆì•¡"})]})}),e.jsx("tbody",{children:E.map(r=>e.jsxs("tr",{className:"border-b border-white/5 hover:bg-white/5 transition-colors",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`p-1.5 rounded-lg ${r.transaction_type==="deposit"?"bg-green-500/20":"bg-red-500/20"}`,children:r.transaction_type==="deposit"?e.jsx(Ss,{className:"h-4 w-4 text-green-400"}):e.jsx(ks,{className:"h-4 w-4 text-red-400"})}),e.jsx("span",{className:"text-sm",children:r.transaction_type==="deposit"?"ì…ê¸ˆ":"ì¶œê¸ˆ"})]})}),e.jsx("td",{className:"px-4 py-3",children:Y(r.status)}),e.jsx("td",{className:"px-4 py-3 text-muted-foreground text-sm",children:de(r.created_at)}),e.jsx("td",{className:"px-4 py-3 text-muted-foreground text-sm max-w-xs truncate",children:r.notes||"-"}),e.jsx("td",{className:"px-4 py-3 text-right",children:e.jsxs("span",{className:`font-mono text-base ${r.transaction_type==="deposit"?"text-green-400":"text-red-400"}`,children:[r.transaction_type==="deposit"?"+":"-",D(r.amount)]})})]},r.id))})]})})})}),e.jsx(ve,{value:"betting",className:"max-h-[calc(92vh-140px)] overflow-y-auto pr-2 pt-3",children:h?e.jsx(xe,{}):N.length===0?e.jsxs("div",{className:"text-center py-12 glass-card rounded-xl",children:[e.jsx(De,{className:"h-16 w-16 text-muted-foreground mx-auto mb-4 opacity-50"}),e.jsx("p",{className:"text-muted-foreground text-base",children:"ë² íŒ… ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤."})]}):e.jsx("div",{className:"glass-card rounded-xl overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"border-b border-white/10",children:e.jsxs("tr",{className:"bg-white/5",children:[e.jsx("th",{className:"px-4 py-3.5 text-left text-sm",children:"ê²Œì„"}),e.jsx("th",{className:"px-4 py-3.5 text-left text-sm",children:"í”„ë¡œë°”ì´ë”"}),e.jsx("th",{className:"px-4 py-3.5 text-left text-sm",children:"ì¼ì‹œ"}),e.jsx("th",{className:"px-4 py-3.5 text-right text-sm",children:"ë² íŒ…"}),e.jsx("th",{className:"px-4 py-3.5 text-right text-sm",children:"ë‹¹ì²¨"}),e.jsx("th",{className:"px-4 py-3.5 text-right text-sm",children:"ì†ìµ"})]})}),e.jsx("tbody",{children:N.map(r=>{const u=(r.win_amount||0)>(r.bet_amount||0),T=(r.win_amount||0)-(r.bet_amount||0);return e.jsxs("tr",{className:"border-b border-white/5 hover:bg-white/5 transition-colors",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`p-1.5 rounded-lg ${u?"bg-green-500/20":"bg-red-500/20"}`,children:e.jsx(De,{className:`h-4 w-4 ${u?"text-green-400":"text-red-400"}`})}),e.jsx("span",{className:"text-sm",children:r.game_title||`ê²Œì„ ID: ${r.game_id}`})]})}),e.jsx("td",{className:"px-4 py-3 text-muted-foreground text-sm",children:r.provider_name||`í”„ë¡œë°”ì´ë” ${r.provider_id}`}),e.jsx("td",{className:"px-4 py-3 text-muted-foreground text-sm",children:de(r.played_at)}),e.jsx("td",{className:"px-4 py-3 text-right font-mono text-sm",children:D(r.bet_amount||0)}),e.jsx("td",{className:"px-4 py-3 text-right font-mono text-sm",children:D(r.win_amount||0)}),e.jsx("td",{className:"px-4 py-3 text-right",children:e.jsxs("span",{className:`font-mono text-base ${u?"text-green-400":"text-red-400"}`,children:[T>=0?"+":"",D(T)]})})]},r.id)})})]})})})}),e.jsx(ve,{value:"pattern",className:"space-y-3 max-h-[calc(92vh-140px)] overflow-y-auto pr-2 pt-3",children:h?e.jsx(xe,{}):$?e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{className:"grid gap-4 grid-cols-4",children:[e.jsx(te,{className:"glass-card metric-gradient-purple",children:e.jsxs(re,{className:"pt-4 pb-4 px-5",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2.5",children:[e.jsx(Ms,{className:"h-4 w-4 text-white"}),e.jsx("h3",{className:"text-sm text-white",children:"ì‚¬ìš©ì ì„±í–¥"})]}),e.jsx("p",{className:"text-base font-bold text-white mb-1.5",children:$.userType}),e.jsx("p",{className:"text-sm text-white/80",children:"ë² íŒ… íŒ¨í„´ ì¢…í•© ë¶„ì„"})]})}),e.jsx(te,{className:"glass-card",children:e.jsxs(re,{className:"pt-4 pb-4 px-5",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2.5",children:[e.jsx(Os,{className:"h-4 w-4 text-yellow-400"}),e.jsx("h3",{className:"text-sm",children:"ë¦¬ìŠ¤í¬ ë¶„ì„"})]}),e.jsx(A,{className:`px-2.5 py-1 mb-2 ${$.riskLevel==="HIGH"?"bg-red-500/20 text-red-400 border-red-500/30":$.riskLevel==="MEDIUM"?"bg-yellow-500/20 text-yellow-400 border-yellow-500/30":"bg-green-500/20 text-green-400 border-green-500/30"}`,children:$.riskLevel==="HIGH"?"ê³ ìœ„í—˜":$.riskLevel==="MEDIUM"?"ì¤‘ìœ„í—˜":"ì €ìœ„í—˜"}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["í‰ê· : ",e.jsx("span",{className:"font-mono text-base",children:D($.avgBet)})]})]})}),e.jsx(te,{className:"glass-card",children:e.jsxs(re,{className:"pt-4 pb-4 px-5",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2.5",children:[e.jsx(Is,{className:"h-4 w-4 text-cyan-400"}),e.jsx("h3",{className:"text-sm",children:"ë² íŒ… í†µê³„"})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"ì´ ë² íŒ…"}),e.jsxs("span",{className:"text-base font-mono",children:[$.totalBets,"íšŒ"]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"ìŠ¹ë¥ "}),e.jsxs("span",{className:`text-base font-mono ${$.winRate>50?"text-green-400":"text-red-400"}`,children:[$.winRate.toFixed(1),"%"]})]})]})]})}),e.jsx(te,{className:"glass-card",children:e.jsxs(re,{className:"pt-4 pb-4 px-5",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2.5",children:[e.jsx(Pe,{className:"h-4 w-4 text-orange-400"}),e.jsx("h3",{className:"text-sm",children:"ì‹œê°„ íŒ¨í„´"})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"í”¼í¬"}),e.jsxs("span",{className:"text-base font-mono",children:[$.peakHour,"ì‹œ"]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"ì•¼ê°„"}),e.jsxs("span",{className:"text-base font-mono",children:[$.nightPlayRatio.toFixed(1),"%"]})]})]})]})})]}),e.jsx(te,{className:"glass-card",children:e.jsxs(re,{className:"pt-4 pb-4 px-5",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3 pb-3 border-b border-white/10",children:[e.jsx($s,{className:"h-4 w-4 text-yellow-400"}),e.jsx("h3",{className:"text-sm",children:"ì„ í˜¸ ê²Œì„ TOP 5"})]}),e.jsx("div",{className:"grid grid-cols-5 gap-3",children:$.topGames.map((r,u)=>e.jsxs("div",{className:"p-3 rounded-lg bg-white/5 hover:bg-white/10 transition-colors",children:[e.jsxs(A,{className:"bg-blue-500/20 text-blue-400 border-blue-500/30 px-2 py-0.5 mb-2",children:[u+1,"ìœ„"]}),e.jsx("p",{className:"text-sm mb-1 truncate",children:r.game}),e.jsx("p",{className:"text-sm text-muted-foreground mb-2 truncate",children:r.provider}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{className:"font-mono text-sm",children:[r.count,"íšŒ"]}),e.jsxs("p",{className:`text-sm ${r.winRate>50?"text-green-400":"text-red-400"}`,children:["ìŠ¹ë¥  ",r.winRate.toFixed(1),"%"]})]})]},u))})]})}),e.jsx(te,{className:"glass-card",children:e.jsxs(re,{className:"pt-4 pb-4 px-5",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3 pb-3 border-b border-white/10",children:[e.jsx(ye,{className:"h-4 w-4 text-purple-400"}),e.jsx("h3",{className:"text-sm",children:"AI ë¶„ì„ ì¸ì‚¬ì´íŠ¸"})]}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:$.insights.map((r,u)=>e.jsxs("div",{className:"flex items-start gap-2 p-3 rounded-lg bg-purple-500/10 border border-purple-500/20 hover:bg-purple-500/15 transition-colors",children:[e.jsx(ye,{className:"h-4 w-4 text-purple-400 mt-0.5 flex-shrink-0"}),e.jsx("p",{className:"text-sm leading-relaxed",children:r})]},u))})]})})]}):e.jsxs("div",{className:"text-center py-12 glass-card rounded-xl",children:[e.jsx(ye,{className:"h-16 w-16 text-muted-foreground mx-auto mb-4 opacity-50"}),e.jsx("p",{className:"text-muted-foreground text-base mb-2",children:"ë¶„ì„í•  ë² íŒ… ë°ì´í„°ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤."})]})}),e.jsx(ve,{value:"evolution",className:"max-h-[calc(92vh-140px)] overflow-y-auto pr-2 pt-3",children:ne?e.jsx(xe,{}):e.jsx("div",{className:"space-y-4 p-4",children:e.jsx(te,{className:"glass-card",children:e.jsxs(re,{className:"pt-6 pb-6 px-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-5 pb-4 border-b border-white/10",children:[e.jsx(Fe,{className:"h-5 w-5 text-red-400"}),e.jsx("h3",{className:"text-base",children:"ì—ë³¼ë£¨ì…˜ ìµœëŒ€ë°°íŒ…ê¸ˆ ì„¤ì •"})]}),e.jsxs("div",{className:"space-y-5",children:[ie!==null&&e.jsx("div",{className:"p-4 rounded-lg bg-blue-500/10 border border-blue-500/30",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-slate-400",children:"í˜„ì¬ ì„¤ì •"}),e.jsxs("span",{className:"font-mono text-lg text-blue-400",children:[ie.toLocaleString(),"ì›"]})]})}),e.jsxs("div",{className:"p-4 rounded-lg bg-slate-800/30 border border-slate-700",children:[e.jsx("div",{className:"text-sm text-slate-400 mb-2",children:"íšŒì› ì•„ì´ë””"}),e.jsx("div",{className:"font-mono text-base text-white",children:n.username})]}),e.jsxs("div",{children:[e.jsx(X,{className:"text-sm text-slate-400 mb-2",children:"ìµœëŒ€ë°°íŒ…ê¸ˆì•¡"}),e.jsx(ee,{type:"number",value:W,onChange:r=>{const u=parseInt(r.target.value)||0;oe(u)},className:"bg-slate-800/50 border-slate-700 text-white font-mono text-base",placeholder:"ê¸ˆì•¡ ì…ë ¥"}),e.jsxs("p",{className:"text-sm text-slate-500 mt-2",children:[W.toLocaleString(),"ì›"]})]}),e.jsx("div",{className:"grid grid-cols-4 gap-2",children:[{value:1e5,label:"1ì‹­ë§Œ"},{value:5e5,label:"5ì‹­ë§Œ"},{value:1e6,label:"1ë°±ë§Œ"},{value:5e6,label:"5ë°±ë§Œ"},{value:1e7,label:"1ì²œë§Œ"},{value:5e7,label:"5ì²œë§Œ"},{value:1e8,label:"10ì²œë§Œ"}].map(r=>e.jsx(k,{variant:"outline",size:"sm",onClick:()=>oe(u=>u+r.value),className:"bg-slate-800/50 border-slate-700 hover:bg-slate-700 text-sm font-mono",children:r.label},r.value))}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx(k,{variant:"outline",onClick:()=>oe(ie||1e8),className:"flex-1 border-slate-700 text-slate-300 hover:bg-slate-700/50 text-sm",children:"ì´ˆê¸°í™”"}),e.jsx(k,{onClick:Le,disabled:ne,className:"flex-1 bg-gradient-to-r from-red-500 to-rose-600 hover:from-red-600 hover:to-rose-700 text-sm",children:ne?"ì €ì¥ ì¤‘...":"ì €ì¥"})]})]})]})})})})]})]})}):null}const Ks={1:"ì‹œìŠ¤í…œê´€ë¦¬ì",2:"ëŒ€ë³¸ì‚¬",3:"ë³¸ì‚¬",4:"ë¶€ë³¸ì‚¬",5:"ì´íŒ",6:"ë§¤ì¥",7:"ì‚¬ìš©ì"};function Js(){const{authState:n}=ss(),[d,x]=g.useState(null),[f,a]=g.useState(!0);return g.useEffect(()=>{(async()=>{if(!n.user?.id){a(!1);return}try{const{data:h,error:_}=await c.from("partners").select("level").eq("id",n.user.id).maybeSingle();_?(console.error("ì‚¬ìš©ì ë ˆë²¨ í™•ì¸ ì˜¤ë¥˜:",_),x(null)):h?x(h.level||null):(console.log("íŒŒíŠ¸ë„ˆê°€ ì•„ë‹™ë‹ˆë‹¤. ì¼ë°˜ ì‚¬ìš©ìë¡œ íŒë‹¨í•©ë‹ˆë‹¤."),x(7))}catch(h){console.error("ì‚¬ìš©ì ë ˆë²¨ í™•ì¸ ì‹¤íŒ¨:",h),x(null)}finally{a(!1)}})()},[n.user?.id]),{userLevel:d,loading:f,isSystemAdmin:d===1,canManageUsers:d&&d<=6,getLevelName:b=>Ks[b]||"ì•Œ ìˆ˜ ì—†ìŒ"}}const Xs=["KBêµ­ë¯¼ì€í–‰","ì‹ í•œì€í–‰","ìš°ë¦¬ì€í–‰","í•˜ë‚˜ì€í–‰","ë†í˜‘ì€í–‰","IBKê¸°ì—…ì€í–‰","ë¶€ì‚°ì€í–‰","ëŒ€êµ¬ì€í–‰","ê´‘ì£¼ì€í–‰","ì „ë¶ì€í–‰","ê²½ë‚¨ì€í–‰","ì œì£¼ì€í–‰","SCì œì¼ì€í–‰","HSBCì€í–‰","KDBì‚°ì—…ì€í–‰","NHë†í˜‘ì€í–‰","ì‹ í˜‘ì¤‘ì•™íšŒ","ìš°ì²´êµ­ì˜ˆê¸ˆë³´í—˜","ìƒˆë§ˆì„ê¸ˆê³ ","ì¹´ì¹´ì˜¤ë±…í¬","ì¼€ì´ë±…í¬","í† ìŠ¤ë±…í¬"];function ma(){const{authState:n}=ss(),{lastMessage:d,connected:x,sendMessage:f}=ws();Js();const{t:a}=He(),[b,h]=g.useState([]),[_,E]=g.useState(!0),[y,N]=g.useState(""),[F,$]=g.useState("all"),[_e,P]=g.useState(!1),[Ae,W]=g.useState(!1),[oe,ie]=g.useState(!1),[je,ne]=g.useState(!1),[ce,ge]=g.useState("deposit"),[B,he]=g.useState(null),[M,we]=g.useState(null),[Le,D]=g.useState(null),[fe,de]=g.useState(!1),[Y,r]=g.useState(null),[u,T]=g.useState(!1),[O,se]=g.useState([]),[Q,q]=g.useState(0),[V,C]=g.useState(0),[G,Z]=g.useState(0),[L,S]=g.useState(0),[We,H]=g.useState(0),[R,ae]=g.useState(0),[U,Ce]=g.useState(0),[I,m]=g.useState({username:"",nickname:"",password:"",bank_name:"",bank_account:"",memo:"",selected_referrer_id:""}),j=async(s=!1)=>{try{s||E(!0);let t=[];if(n.user?.level===1){const{data:i,error:v}=await c.from("users").select(`
            *,
            balance_sync_call_count,
            balance_sync_started_at,
            referrer:partners!referrer_id(
              id,
              username,
              level
            )
          `).order("created_at",{ascending:!1});if(v)throw v;h(i||[]);return}else{const{data:i}=await c.rpc("get_hierarchical_partners",{p_partner_id:n.user?.id});t=[n.user?.id||"",...i?.map(v=>v.id)||[]]}const{data:o,error:l}=await c.from("users").select(`
          *,
          balance_sync_call_count,
          balance_sync_started_at,
          referrer:partners!referrer_id(
            id,
            username,
            level
          )
        `).in("referrer_id",t).order("created_at",{ascending:!1});if(l)throw l;h(o||[])}catch(t){console.error("âŒ íšŒì› ëª©ë¡ ì¡°íšŒ ì‹¤íŒ¨:",t),s||p.error("íšŒì› ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤."),h([])}finally{s||E(!1)}},me=async()=>{if(n.user?.id)try{const{data:s,error:t}=await c.from("partners").select("balance, level, invest_balance, oroplay_balance").eq("id",n.user.id).single();if(t)throw t;if(console.log("ğŸ’° [UserManagement] ê´€ë¦¬ì ë³´ìœ ê¸ˆ ì¡°íšŒ (partners í…Œì´ë¸”):",{level:s?.level,balance:s?.balance,invest_balance:s?.invest_balance,oroplay_balance:s?.oroplay_balance}),s?.level===1){const{data:o,error:l}=await c.from("api_configs").select("invest_balance, oroplay_balance").eq("partner_id",n.user.id).single();!l&&o?(C(o.invest_balance||0),Z(o.oroplay_balance||0),console.log("âœ… Lv1 ë³´ìœ ê¸ˆ ì„¤ì • (api_configs):",{invest:o.invest_balance||0,oroplay:o.oroplay_balance||0})):(console.warn("âš ï¸ Lv1 api_configs ì¡°íšŒ ì‹¤íŒ¨:",l),C(0),Z(0))}else s?.level===2?(C(s?.invest_balance||0),Z(s?.oroplay_balance||0),console.log("âœ… Lv2 ë³´ìœ ê¸ˆ ì„¤ì • (partners):",{invest:s?.invest_balance||0,oroplay:s?.oroplay_balance||0})):(q(s?.balance||0),console.log("âœ… Lv3~7 ë³´ìœ ê¸ˆ ì„¤ì •:",s?.balance||0))}catch(s){console.error("âŒ í˜„ì¬ ì‚¬ìš©ì ë³´ìœ ê¸ˆ ì¡°íšŒ ì‹¤íŒ¨:",s)}};g.useEffect(()=>{j(),me(),n.user?.level===1&&rs()},[n.user?.id,n.user?.level]);const rs=async()=>{try{const{data:s}=await c.from("partners").select("id, username, nickname, partner_type, level").in("partner_type",["head_office","main_office","sub_office","distributor","store"]).eq("status","active").order("level",{ascending:!0}).order("created_at",{ascending:!0});se(s||[])}catch(s){console.error("ì†Œì† íŒŒíŠ¸ë„ˆ ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨:",s)}};g.useEffect(()=>{if(!n.user?.id)return;const s=c.channel("users-changes").on("postgres_changes",{event:"*",schema:"public",table:"users"},l=>{console.log("ğŸ‘¥ users í…Œì´ë¸” ë³€ê²½ ê°ì§€:",l),j(!0)}).subscribe(),t=c.channel("current-partner-balance").on("postgres_changes",{event:"UPDATE",schema:"public",table:"partners",filter:`id=eq.${n.user.id}`},l=>{const i=l.new;console.log("ğŸ’° í˜„ì¬ ê´€ë¦¬ì ë³´ìœ ê¸ˆ ë³€ê²½ (partners):",{balance:i.balance,invest_balance:i.invest_balance,oroplay_balance:i.oroplay_balance,level:i.level}),i.level===2?(C(i.invest_balance||0),Z(i.oroplay_balance||0)):i.level>=3&&q(i.balance||0)}).subscribe();let o=null;return n.user.level===1&&(o=c.channel("current-api-config").on("postgres_changes",{event:"UPDATE",schema:"public",table:"api_configs",filter:`partner_id=eq.${n.user.id}`},l=>{const i=l.new;console.log("ğŸ’° Lv1 ë³´ìœ ê¸ˆ ë³€ê²½ (api_configs):",{invest_balance:i.invest_balance,oroplay_balance:i.oroplay_balance}),C(i.invest_balance||0),Z(i.oroplay_balance||0)}).subscribe()),()=>{c.removeChannel(s),c.removeChannel(t),o&&c.removeChannel(o)}},[n.user?.id]),g.useEffect(()=>{(d?.type==="user_balance_updated"||d?.type==="user_updated")&&(console.log("ğŸ”” ì‚¬ìš©ì ì—…ë°ì´íŠ¸ ì•Œë¦¼ ìˆ˜ì‹ :",d),j(!0))},[d]),g.useEffect(()=>{(async()=>{if(!B?.id){S(0),H(0),ae(0),Ce(0);return}try{console.log("ğŸ” [ForceTransaction] ëŒ€ìƒ ì‚¬ìš©ì:",{id:B.id,username:B.username,referrer_id:B.referrer_id,referrer:B.referrer});const t=B.referrer_id;if(!t){console.error("âŒ ì‚¬ìš©ìì˜ referrer_idê°€ ì—†ìŠµë‹ˆë‹¤.");return}const{data:o,error:l}=await c.from("partners").select("balance, level, invest_balance, oroplay_balance, username").eq("id",t).single();if(l||!o){console.error("âŒ íŒŒíŠ¸ë„ˆ ì •ë³´ ì¡°íšŒ ì‹¤íŒ¨:",l);return}if(console.log("ğŸ’° [ForceTransaction] ì†Œì† íŒŒíŠ¸ë„ˆ ë³´ìœ ê¸ˆ ì¡°íšŒ:",{partnerId:t,username:o.username,level:o.level,balance:o.balance,invest_balance:o.invest_balance,oroplay_balance:o.oroplay_balance}),Ce(o.level),o.level===1){const{data:i,error:v}=await c.from("api_configs").select("invest_balance, oroplay_balance").eq("partner_id",t).single();!v&&i?(H(i.invest_balance||0),ae(i.oroplay_balance||0),console.log("âœ… Lv1 ì†Œì† íŒŒíŠ¸ë„ˆ ë³´ìœ ê¸ˆ ì„¤ì • (api_configs):",{invest:i.invest_balance||0,oroplay:i.oroplay_balance||0})):(console.warn("âš ï¸ Lv1 api_configs ì¡°íšŒ ì‹¤íŒ¨:",v),H(0),ae(0))}else o.level===2?(H(o.invest_balance||0),ae(o.oroplay_balance||0),console.log("âœ… Lv2 ì†Œì† íŒŒíŠ¸ë„ˆ ë³´ìœ ê¸ˆ ì„¤ì •:",{invest:o.invest_balance||0,oroplay:o.oroplay_balance||0})):(S(o.balance||0),console.log("âœ… Lv3~7 ì†Œì† íŒŒíŠ¸ë„ˆ ë³´ìœ ê¸ˆ ì„¤ì •:",o.balance||0))}catch(t){console.error("âŒ ì†Œì† íŒŒíŠ¸ë„ˆ ë³´ìœ ê¸ˆ ì¡°íšŒ ì‹¤íŒ¨:",t)}})()},[B?.id]);const ns=async()=>{if(!I.username||!I.password){p.error("ì•„ì´ë””ì™€ ë¹„ë°€ë²ˆí˜¸ëŠ” í•„ìˆ˜ì…ë‹ˆë‹¤.");return}if(u){console.warn("âš ï¸ íšŒì› ìƒì„±ì´ ì´ë¯¸ ì§„í–‰ ì¤‘ì…ë‹ˆë‹¤.");return}const s={...I};P(!1),m({username:"",nickname:"",password:"",bank_name:"",bank_account:"",memo:"",selected_referrer_id:""}),T(!0);try{console.log("ğŸ‘¤ ìƒˆ íšŒì› ìƒì„± ì‹œì‘:",s.username),p.loading(`[1/4] ì•„ì´ë”” ì¤‘ë³µ í™•ì¸ ì¤‘... (${s.username})`,{id:"create-user"});const{data:t}=await c.from("users").select("id").eq("username",s.username).maybeSingle();if(t){p.error(`ì´ë¯¸ ì‚¬ìš© ì¤‘ì¸ ì•„ì´ë””ì…ë‹ˆë‹¤ (íšŒì›): ${s.username}`,{id:"create-user"});return}const{data:o}=await c.from("partners").select("id").eq("username",s.username).maybeSingle();if(o){p.error(`ì´ë¯¸ ì‚¬ìš© ì¤‘ì¸ ì•„ì´ë””ì…ë‹ˆë‹¤ (íŒŒíŠ¸ë„ˆ): ${s.username}`,{id:"create-user"});return}p.loading(`[2/4] DBì— íšŒì› ì •ë³´ ì €ì¥ ì¤‘... (${s.username})`,{id:"create-user"});const l=n.user?.level===1&&s.selected_referrer_id?s.selected_referrer_id:n.user?.id,{data:i,error:v}=await c.from("users").insert({username:s.username,nickname:s.nickname||s.username,password_hash:s.password,bank_name:s.bank_name||null,bank_account:s.bank_account||null,memo:s.memo||null,referrer_id:l,status:"active",balance:0,points:0,api_account_status:"pending",api_invest_created:!1,api_oroplay_created:!1,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}).select().single();if(v){console.error("âŒ íšŒì› ìƒì„± DB ì˜¤ë¥˜:",v),v.code==="23505"?p.error(`ì´ë¯¸ ì‚¬ìš© ì¤‘ì¸ ì•„ì´ë””ì…ë‹ˆë‹¤: ${s.username}`,{id:"create-user"}):p.error(`íšŒì› ìƒì„± ì‹¤íŒ¨: ${v.message}`,{id:"create-user"});return}console.log("âœ… DB íšŒì› ìƒì„± ì™„ë£Œ:",i),p.loading(`[3/5] ì™¸ë¶€ API ê³„ì • ìƒì„± ì¤‘... (${s.username})`,{id:"create-user"}),console.log("ğŸŒ ì™¸ë¶€ API ê³„ì • ìƒì„± ì‹œì‘ (Invest + OroPlay)");const w=await Ye(i.id,s.username,n.user?.id||"","create-user");console.log("ğŸ” API ê³„ì • ìƒì„± ê²°ê³¼:",w),w.status==="error"?(p.error(`âš ï¸ API ê³„ì • ìƒì„± ì‹¤íŒ¨: ${w.errorMessage}`,{id:"create-user",duration:1e4}),console.error("âŒ ì™¸ë¶€ API ê³„ì • ìƒì„± ì‹¤íŒ¨:",w.errorMessage)):w.status==="partial"?(p.warning(`âš ï¸ ì¼ë¶€ APIë§Œ ìƒì„±ë¨ (Invest: ${w.investCreated?"âœ…":"âŒ"} / OroPlay: ${w.oroplayCreated?"âœ…":"âŒ"})`,{id:"create-user",duration:8e3}),console.warn("âš ï¸ ë¶€ë¶„ ì„±ê³µ:",w)):(p.success(`[5/5] âœ… íšŒì› ${s.username} ìƒì„± ì™„ë£Œ! (Invest âœ… / OroPlay âœ…)`,{id:"create-user",duration:5e3}),console.log("âœ… ëª¨ë“  API ê³„ì • ìƒì„± ì„±ê³µ")),await j()}catch(t){console.error("âŒ íšŒì› ìƒì„± ì „ì²´ ì˜¤ë¥˜:",t),p.error(t.message||"íšŒì› ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.",{id:"create-user"})}finally{T(!1)}},ls=async(s,t)=>{const o=b.find(l=>l.id===s);if(!o){p.error("ì‚¬ìš©ì ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");return}h(l=>l.map(i=>i.id===s?{...i,status:"active",updated_at:new Date().toISOString()}:i));try{r(s),console.log("âœ… íšŒì› ìŠ¹ì¸ ì²˜ë¦¬ ì‹œì‘:",t),console.log("ğŸŒ ì™¸ë¶€ API ê³„ì • ìƒì„± ì‹œì‘ (Invest + OroPlay)");const l=await Ye(s,t,o.referrer_id||n.user?.id||"");if(console.log("ğŸ” API ê³„ì • ìƒì„± ê²°ê³¼:",l),l.status==="error"){h(v=>v.map(w=>w.id===s?{...w,status:"pending"}:w)),p.error(`ì™¸ë¶€ API ê³„ì • ìƒì„± ì‹¤íŒ¨: ${l.errorMessage}`),console.error("âŒ ì™¸ë¶€ API ê³„ì • ìƒì„± ì‹¤íŒ¨:",l.errorMessage);return}l.status==="partial"?(p.warning(`ì¼ë¶€ API ê³„ì •ë§Œ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤: ${l.errorMessage}`),console.warn("âš ï¸ ë¶€ë¶„ ì„±ê³µ:",l)):console.log("âœ… ëª¨ë“  API ê³„ì • ìƒì„± ì„±ê³µ");const{error:i}=await c.from("users").update({status:"active",updated_at:new Date().toISOString()}).eq("id",s);if(i)throw h(v=>v.map(w=>w.id===s?{...w,status:"pending"}:w)),console.error("âŒ íšŒì› ìŠ¹ì¸ DB ì˜¤ë¥˜:",i),i;p.success(`íšŒì› ${t}ì´ ìŠ¹ì¸ë˜ì—ˆìŠµë‹ˆë‹¤.`)}catch(l){console.error("íšŒì› ìŠ¹ì¸ ì‹¤íŒ¨:",l),p.error(l.message||"íšŒì› ìŠ¹ì¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")}finally{r(null)}},os=async(s,t)=>{const o=b.find(l=>l.id===s);h(l=>l.filter(i=>i.id!==s));try{r(s),console.log("âŒ íšŒì› ê°€ì… ê±°ì ˆ:",t);const{error:l}=await c.from("users").update({status:"blocked",memo:(o?.memo||"")+" [ê°€ì… ê±°ì ˆë¨]",updated_at:new Date().toISOString()}).eq("id",s);if(l)throw o&&h(i=>[...i,o]),console.error("âŒ íšŒì› ê±°ì ˆ ì˜¤ë¥˜:",l),l;p.success(`íšŒì› ${t}ì˜ ê°€ì…ì´ ê±°ì ˆë˜ì—ˆìŠµë‹ˆë‹¤.`)}catch(l){console.error("íšŒì› ê±°ì ˆ ì‹¤íŒ¨:",l),p.error(l.message||"íšŒì› ê±°ì ˆì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")}finally{r(null)}},is=async()=>{if(!M)return;const s=M;h(t=>t.filter(o=>o.id!==M.id)),W(!1);try{de(!0),console.log("ğŸ—‘ï¸ íšŒì› ì‚­ì œ ì²˜ë¦¬:",M.username);const{error:t}=await c.from("user_sessions").delete().eq("user_id",M.id);t&&console.warn("âš ï¸ ê²Œì„ ì„¸ì…˜ ì‚­ì œ ì¤‘ ì˜¤ë¥˜:",t);const{error:o}=await c.from("message_queue").delete().eq("sender_id",M.id);o&&console.warn("âš ï¸ ë©”ï¿½ï¿½ì§€ í (ë°œì†¡ì) ì‚­ì œ ì¤‘ ì˜¤ë¥˜:",o);const{error:l}=await c.from("message_queue").delete().eq("target_id",M.id);l&&console.warn("âš ï¸ ë©”ì‹œì§€ í (ìˆ˜ì‹ ì) ì‚­ì œ ì¤‘ ì˜¤ë¥˜:",l);const{error:i}=await c.from("notifications").delete().eq("recipient_id",M.id);i&&console.warn("âš ï¸ ì•Œë¦¼ ì‚­ì œ ì¤‘ ì˜¤ë¥˜:",i);const{error:v}=await c.from("realtime_notifications").delete().eq("recipient_id",M.id);v&&console.warn("âš ï¸ ì‹¤ì‹œê°„ ì•Œë¦¼ ì‚­ì œ ì¤‘ ì˜¤ë¥˜:",v);const{error:w}=await c.from("transactions").delete().eq("user_id",M.id);if(w){console.error("âŒ íŠ¸ëœì­ì…˜ ì‚­ì œ ì¤‘ ì˜¤ë¥˜:",w),h(J=>[...J,s]),p.error("íšŒì›ì˜ ê±°ë˜ ë‚´ì—­ ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤."),W(!0);return}const{error:K}=await c.from("game_records").delete().eq("user_id",M.id);K&&console.warn("âš ï¸ ê²Œì„ ê¸°ë¡ ì‚­ì œ ì¤‘ ì˜¤ë¥˜:",K);const{error:z}=await c.from("users").delete().eq("id",M.id);if(z)throw h(J=>[...J,s]),console.error("âŒ íšŒì› ì‚­ì œ ì˜¤ë¥˜:",z),z;console.log("âœ… íšŒì› ì‚­ì œ ì™„ë£Œ:",M.username),p.success(`íšŒì› ${M.username}ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.`),we(null)}catch(t){console.error("íšŒì› ì‚­ì œ ì‹¤íŒ¨:",t),p.error(t.message||"íšŒì› ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤."),W(!0)}finally{de(!1)}},cs=async s=>{try{r(s.targetId);const t=b.find(ue=>ue.id===s.targetId);if(!t)return;console.log(`ğŸ’° ê°•ì œ ${s.type==="deposit"?"ì…ê¸ˆ":"ì¶œê¸ˆ"} ì²˜ë¦¬ ì‹œì‘:`,t.username,s.amount);const o=s.type==="deposit"?(t.balance||0)+s.amount:(t.balance||0)-s.amount;if(h(ue=>ue.map(le=>le.id===s.targetId?{...le,balance:o,updated_at:new Date().toISOString()}:le)),!n.user){h(ue=>ue.map(le=>le.id===s.targetId?{...le,balance:t.balance,updated_at:t.updated_at}:le));return}const{data:l,error:i}=await c.from("partners").select("balance, level, nickname, partner_type, invest_balance, oroplay_balance").eq("id",n.user.id).single();if(i||!l)return;const v=l.level===1;if(s.type==="deposit"&&!v){if(l.level===2){if(Math.min(l.invest_balance||0,l.oroplay_balance||0)<s.amount){console.error("âŒ Lv2 ë³´ìœ ê¸ˆ ë¶€ì¡±:",{invest:l.invest_balance,oroplay:l.oroplay_balance,required:s.amount});return}}else if(l.balance<s.amount){console.error("âŒ ë³´ìœ ê¸ˆ ë¶€ì¡±:",{balance:l.balance,required:s.amount});return}}const w=await ys(n.user);if(!w){console.error("âŒ API ì„¤ì •ì´ ì—†ìŠµë‹ˆë‹¤. api_configs í…Œì´ë¸”ì— invest_opcode, invest_token, invest_secret_keyë¥¼ ì„¤ì •í•˜ì„¸ìš”.");return}const K=Ns(w)?w.opcodes[0]:w;if(!K)return;let z=null,J=t.balance||0;if((l.level===1||l.level===2)&&s.type==="deposit")console.log("âœ… Lv1/Lv2 â†’ Lv7 ì…ê¸ˆ: ì™¸ë¶€ API í˜¸ì¶œ ê±´ë„ˆëœ€ (ë‚´ë¶€ ê±°ë˜ë§Œ, ê²Œì„ í”Œë ˆì´ ì‹œì—ë§Œ ì™¸ë¶€ API ì°¨ê°)"),J=(t.balance||0)+s.amount;else if((l.level===1||l.level===2)&&s.type==="withdrawal")console.log("âœ… Lv1/Lv2 â†’ Lv7 ì¶œê¸ˆ: ì™¸ë¶€ API í˜¸ì¶œ ê±´ë„ˆëœ€ (ë‚´ë¶€ ê±°ë˜ë§Œ, ê²Œì„ ì¢…ë£Œ ì‹œì—ë§Œ ì™¸ë¶€ API íšŒìˆ˜)"),J=(t.balance||0)-s.amount;else{if(z=s.type==="deposit"?await Ps(t.username,s.amount,K.opcode,K.token,K.secretKey):await As(t.username,s.amount,K.opcode,K.token,K.secretKey),!z.success||z.error){console.error(`API ${s.type==="deposit"?"ì…ê¸ˆ":"ì¶œê¸ˆ"} ì‹¤íŒ¨:`,z.error);return}console.log(`âœ… API ${s.type==="deposit"?"ì…ê¸ˆ":"ì¶œê¸ˆ"} ì„±ê³µ:`,z.data),J=Ls(z.data,t.username),console.log("ğŸ’° ì‹¤ì œ ì”ê³ :",J)}const{error:Ve}=await c.from("transactions").insert({user_id:t.id,partner_id:n.user?.id,transaction_type:s.type==="deposit"?"admin_deposit":"admin_withdrawal",amount:s.amount,status:"completed",processed_by:n.user?.id,memo:s.memo||`[ê´€ë¦¬ì ê°•ì œ ${s.type==="deposit"?"ì…ê¸ˆ":"ì¶œê¸ˆ"}] ${n.user?.username}`,balance_before:t.balance||0,balance_after:J,external_response:z?.data||null});if(Ve)throw Ve;const{error:Ge}=await c.from("users").update({balance:J,updated_at:new Date().toISOString()}).eq("id",t.id);if(Ge)throw Ge;l.level===1?console.log("â„¹ï¸ Lv1 â†’ Lv7 ì…ì¶œê¸ˆì€ ë‚´ë¶€ ê±°ë˜ë§Œ (Lv1 api_configs ë³€ë™ ì—†ìŒ, ê²Œì„ í”Œë ˆì´ ì‹œì—ë§Œ ì™¸ë¶€ API í˜¸ì¶œ)"):l.level===2?s.type==="deposit"?(console.log("â„¹ï¸ Lv2 â†’ Lv7 ì…ê¸ˆì€ ë‚´ë¶€ ê±°ë˜ë§Œ (ê²Œì„ í”Œë ˆì´ ì‹œì—ë§Œ ì™¸ë¶€ API ì°¨ê°)"),await c.from("partner_balance_logs").insert({partner_id:n.user.id,balance_before:l.invest_balance||0,balance_after:l.invest_balance||0,amount:0,transaction_type:"internal",from_partner_id:n.user.id,to_partner_id:null,processed_by:n.user.id,api_type:"invest",memo:`[íšŒì› ê°•ì œì…ê¸ˆ - ë‚´ë¶€ê±°ë˜] ${t.username}ì—ê²Œ ${s.amount.toLocaleString()}ì› ì…ê¸ˆ (ê²Œì„ í”Œë ˆì´ ì‹œ ì°¨ê°)${s.memo?`: ${s.memo}`:""}`})):(console.log("â„¹ï¸ Lv2 â†’ Lv7 ì¶œê¸ˆì€ ë‚´ë¶€ ê±°ë˜ë§Œ (ê²Œì„ ì¢…ë£Œ ì‹œì—ë§Œ ì™¸ë¶€ API íšŒìˆ˜)"),await c.from("partner_balance_logs").insert({partner_id:n.user.id,balance_before:l.invest_balance||0,balance_after:l.invest_balance||0,amount:0,transaction_type:"internal",from_partner_id:null,to_partner_id:n.user.id,processed_by:n.user.id,api_type:"invest",memo:`[íšŒì› ê°•ì œì¶œê¸ˆ - ë‚´ë¶€ê±°ë˜] ${t.username}ìœ¼ë¡œë¶€í„° ${s.amount.toLocaleString()}ì› ì¶œê¸ˆ (ê²Œì„ ì¢…ë£Œ ì‹œ íšŒìˆ˜)${s.memo?`: ${s.memo}`:""}`}),console.log(`ğŸ’° Lv2 ë³´ìœ ê¸ˆ ë³€ë™ ì—†ìŒ (ë‚´ë¶€ ê±°ë˜ë§Œ): Invest(${(l.invest_balance||0).toLocaleString()}), OroPlay(${(l.oroplay_balance||0).toLocaleString()})`)):s.type==="deposit"?(console.log("â„¹ï¸ Lv3~7 â†’ Lv7 ì…ê¸ˆì€ ë‚´ë¶€ ê±°ë˜ë§Œ (ê²Œì„ í”Œë ˆì´ ì‹œì—ë§Œ ì™¸ë¶€ API ì°¨ê°)"),await c.from("partner_balance_logs").insert({partner_id:n.user.id,balance_before:l.balance,balance_after:l.balance,amount:0,transaction_type:"internal",from_partner_id:n.user.id,to_partner_id:null,processed_by:n.user.id,memo:`[íšŒì› ê°•ì œì…ê¸ˆ - ë‚´ë¶€ê±°ë˜] ${t.username}ì—ê²Œ ${s.amount.toLocaleString()}ì› ì…ê¸ˆ (ê²Œì„ í”Œë ˆì´ ì‹œ ì°¨ê°)${s.memo?`: ${s.memo}`:""}`}),console.log(`ğŸ’° Lv3~7 ë³´ìœ ê¸ˆ ë³€ë™ ì—†ìŒ (ë‚´ë¶€ ê±°ë˜ë§Œ): balance(${l.balance.toLocaleString()})`)):(console.log("â„¹ï¸ Lv3~7 â†’ Lv7 ì¶œê¸ˆì€ ë‚´ë¶€ ê±°ë˜ë§Œ (ê²Œì„ ì¢…ë£Œ ì‹œì—ë§Œ ì™¸ë¶€ API íšŒìˆ˜)"),await c.from("partner_balance_logs").insert({partner_id:n.user.id,balance_before:l.balance,balance_after:l.balance,amount:0,transaction_type:"internal",from_partner_id:null,to_partner_id:n.user.id,processed_by:n.user.id,memo:`[íšŒì› ê°•ì œì¶œê¸ˆ - ë‚´ë¶€ê±°ë˜] ${t.username}ìœ¼ë¡œë¶€í„° ${s.amount.toLocaleString()}ì› ì¶œê¸ˆ (ê²Œì„ ì¢…ë£Œ ì‹œ íšŒìˆ˜)${s.memo?`: ${s.memo}`:""}`}),console.log(`ğŸ’° Lv3~7 ë³´ìœ ê¸ˆ ë³€ë™ ì—†ìŒ (ë‚´ë¶€ ê±°ë˜ë§Œ): balance(${l.balance.toLocaleString()})`)),x&&f&&(f({type:"user_balance_updated",data:{userId:t.id,amount:s.amount,type:s.type}}),f({type:"partner_balance_updated",data:{partnerId:n.user.id,amount:s.type==="deposit"?-s.amount:s.amount,type:s.type==="deposit"?"withdrawal":"deposit"}})),await j();const hs=s.type==="deposit"?"ì…ê¸ˆ":"ì¶œê¸ˆ";p.success(`${t.username}ë‹˜ì—ê²Œ ${s.amount.toLocaleString()}ì› ${hs} ì™„ë£Œ`)}catch(t){console.error("ê°•ì œ ì…ì¶œê¸ˆ ì²˜ë¦¬ ì‹¤íŒ¨:",t),p.error("ê°•ì œ ì…ì¶œê¸ˆ ì²˜ë¦¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")}finally{r(null)}},ds=s=>{he(s),ge("deposit"),ne(!0)},ms=s=>{he(s),ge("withdrawal"),ne(!0)},us=async s=>{if(!s)return;const t=s.status==="suspended",o=t?"active":"suspended",l=t?(s.memo||"").replace(/\s*\[ì°¨ë‹¨ë¨.*?\]/g,""):(s.memo||"")+" [ì°¨ë‹¨ë¨: ê´€ë¦¬ì ì¡°ì¹˜]";h(i=>i.map(v=>v.id===s.id?{...v,status:o,memo:l,updated_at:new Date().toISOString()}:v));try{r(s.id),console.log("ğŸš« íšŒì› ì°¨ë‹¨/í•´ì œ:",s.username,o);const{error:i}=await c.from("users").update({status:o,memo:l,updated_at:new Date().toISOString()}).eq("id",s.id);if(i)throw h(v=>v.map(w=>w.id===s.id?{...w,status:s.status,memo:s.memo}:w)),i;p.success(`${s.username}ë‹˜ì´ ${t?"ì°¨ë‹¨ í•´ì œ":"ì°¨ë‹¨"}ë˜ì—ˆìŠµë‹ˆë‹¤.`)}catch(i){console.error("íšŒì› ì°¨ë‹¨/í•´ì œ ì‹¤íŒ¨:",i),p.error(i.message||"íšŒì› ì°¨ë‹¨/í•´ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")}finally{r(null)}},ps=async s=>{if(!s)return;const t=s.status==="blocked";t||h(o=>o.filter(l=>l.id!==s.id));try{if(r(s.id),console.log("ğŸš¨ ë¸”ë™ë¦¬ìŠ¤íŠ¸ ì²˜ë¦¬:",s.username),t){const{data:o,error:l}=await c.rpc("remove_user_from_blacklist_simple",{p_user_id:s.id,p_admin_id:n.user?.id});if(l)throw l;const i=Array.isArray(o)?o[0]:o;if(!i.success)throw new Error(i.error);p.success(`${s.username}ë‹˜ì´ ë¸”ë™ë¦¬ìŠ¤íŠ¸ì—ì„œ í•´ì œë˜ì—ˆìŠµë‹ˆë‹¤.`)}else{const{data:o,error:l}=await c.rpc("add_user_to_blacklist_simple",{p_user_id:s.id,p_admin_id:n.user?.id,p_reason:"ê´€ë¦¬ì ì¡°ì¹˜"});if(l)throw h(v=>[...v,s]),l;const i=Array.isArray(o)?o[0]:o;if(!i.success)throw h(v=>[...v,s]),new Error(i.error);p.success(`${s.username}ë‹˜ì´ ë¸”ë™ë¦¬ìŠ¤íŠ¸ì— ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.`)}}catch(o){console.error("ë¸”ë™ë¦¬ìŠ¤íŠ¸ ì²˜ë¦¬ ì‹¤íŒ¨:",o),p.error(o.message||"ë¸”ë™ë¦¬ìŠ¤íŠ¸ ì²˜ë¦¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")}finally{r(null)}};g.useEffect(()=>{d?.type==="user_registered"&&(console.log("ğŸ”” ìƒˆ íšŒì› ê°€ì… ì•Œë¦¼ ìˆ˜ì‹ "),j(),p.info("ìƒˆë¡œìš´ íšŒì› ê°€ì… ì‹ ì²­ì´ ìˆìŠµë‹ˆë‹¤."))},[d,j]);const ze=b.filter(s=>{if(s.status==="blocked")return!1;const t=y===""||s.username?.toLowerCase().includes(y.toLowerCase())||s.nickname?.toLowerCase().includes(y.toLowerCase())||s.email?.toLowerCase().includes(y.toLowerCase())||s.phone?.includes(y)||s.bank_name?.toLowerCase().includes(y.toLowerCase())||s.bank_account?.includes(y)||s.balance?.toString().includes(y)||s.points?.toString().includes(y)||s.memo?.toLowerCase().includes(y.toLowerCase()),o=F==="all"||s.status===F;return t&&o}),xs=b.filter(s=>s.status==="pending").slice(0,5),gs=[{key:"username",header:a.userManagement.username},{key:"nickname",header:a.userManagement.nickname},{key:"referrer_info",header:a.userManagement.affiliation,cell:s=>e.jsx("span",{className:"text-sm text-slate-300",children:s.referrer?s.referrer.username:a.userManagement.unassigned})},{key:"status",header:a.common.status,cell:s=>s.status==="active"?e.jsxs(A,{className:"px-3 py-1 bg-gradient-to-r from-emerald-500/20 to-teal-500/20 text-emerald-400 border border-emerald-500/50 rounded-full shadow-[0_0_10px_rgba(16,185,129,0.5)]",children:["â— ",a.userManagement.approved]}):s.status==="pending"?e.jsxs(A,{className:"px-3 py-1 bg-gradient-to-r from-orange-500/20 to-amber-500/20 text-orange-400 border border-orange-500/50 rounded-full shadow-[0_0_10px_rgba(251,146,60,0.5)]",children:["â— ",a.userManagement.waiting]}):s.status==="suspended"?e.jsxs(A,{className:"px-3 py-1 bg-gradient-to-r from-slate-500/20 to-gray-500/20 text-slate-400 border border-slate-500/50 rounded-full shadow-[0_0_10px_rgba(100,116,139,0.5)]",children:["â— ",a.userManagement.suspended]}):null},{key:"balance",header:a.common.balance,cell:s=>e.jsxs("span",{className:"font-mono font-semibold text-cyan-400",children:[(s.balance||0).toLocaleString(),"ì›"]})},{key:"points",header:a.userManagement.points,cell:s=>e.jsxs("span",{className:"font-mono font-semibold text-purple-400",children:[(s.points||0).toLocaleString(),"P"]})},{key:"vip_level",header:a.userManagement.level,cell:s=>{const t=s.vip_level||0;return t===0?e.jsx(A,{className:"px-3 py-1 bg-slate-700/50 text-slate-300 border border-slate-600/50 rounded-full",children:"â—‹ Silver"}):t===1?e.jsx(A,{className:"px-3 py-1 bg-gradient-to-r from-yellow-500/20 to-amber-500/20 text-yellow-400 border border-yellow-500/50 rounded-full shadow-[0_0_10px_rgba(234,179,8,0.5)]",children:"âš¡ Gold"}):t===2?e.jsx(A,{className:"px-3 py-1 bg-gradient-to-r from-orange-500/20 to-red-500/20 text-orange-400 border border-orange-500/50 rounded-full shadow-[0_0_10px_rgba(251,146,60,0.5)]",children:"âš¡ Bronze"}):e.jsx(A,{className:"px-3 py-1 bg-gradient-to-r from-purple-500/20 to-pink-500/20 text-purple-400 border border-purple-500/50 rounded-full shadow-[0_0_10px_rgba(168,85,247,0.5)]",children:"âš¡ VIP"})}},{key:"api_account_status",header:a.userManagement.accountStatus,cell:s=>{const t=s.api_account_status||"active";return t==="pending"?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(A,{className:"px-2 py-1 bg-amber-500/20 text-amber-400 border border-amber-500/50 rounded-full text-xs",children:a.userManagement.creating}),e.jsx(Pe,{className:"h-3 w-3 text-amber-400 animate-pulse"})]}):t==="active"?e.jsx(A,{className:"px-2 py-1 bg-emerald-500/20 text-emerald-400 border border-emerald-500/50 rounded-full text-xs",children:a.userManagement.normal}):t==="error"?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(A,{className:"px-2 py-1 bg-red-500/20 text-red-400 border border-red-500/50 rounded-full text-xs",children:a.common.error}),e.jsx(Ds,{className:"h-3 w-3 text-red-400"})]}):t==="partial"?e.jsx(A,{className:"px-2 py-1 bg-orange-500/20 text-orange-400 border border-orange-500/50 rounded-full text-xs",children:a.userManagement.partialError}):e.jsx("span",{className:"text-slate-500 text-xs",children:a.userManagement.unknown})}},{key:"created_at",header:a.userManagement.registrationDate,cell:s=>{const t=new Date(s.created_at),o=t.getFullYear(),l=t.getMonth()+1,i=t.getDate();return e.jsxs("span",{className:"text-slate-400 text-sm",children:[o,". ",l,". ",i,"."]})}},{key:"last_login_at",header:a.userManagement.lastLogin,cell:s=>{if(!s.last_login_at)return e.jsx("span",{className:"text-slate-500 text-sm",children:a.userManagement.notLoggedIn});const t=new Date(s.last_login_at),o=t.getFullYear(),l=t.getMonth()+1,i=t.getDate();return e.jsxs("span",{className:"text-slate-400 text-sm",children:[o,". ",l,". ",i,"."]})}},{key:"is_online",header:a.userManagement.connection,cell:s=>s.is_online?e.jsxs(A,{className:"bg-gradient-to-r from-green-500 to-emerald-500 text-white border-0 animate-pulse",children:["â— ",a.userManagement.online]}):e.jsxs(A,{className:"bg-slate-600 text-slate-300 border-0",children:["â—‹ ",a.userManagement.offline]})},{key:"created_at_old",header:"ê°€ì…ì¼",cell:s=>new Date(s.created_at).toLocaleDateString("ko-KR")},{key:"actions",header:a.common.actions,cell:s=>s.status==="pending"?e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(k,{size:"sm",onClick:()=>ls(s.id,s.username),disabled:Y===s.id,className:"btn-premium-success",children:Y===s.id?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}):e.jsxs(e.Fragment,{children:[e.jsx(Ts,{className:"h-4 w-4 mr-1"}),a.userManagement.approve]})}),e.jsx(k,{size:"sm",onClick:()=>os(s.id,s.username),disabled:Y===s.id,className:"btn-premium-danger",children:Y===s.id?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}):e.jsxs(e.Fragment,{children:[e.jsx(Us,{className:"h-4 w-4 mr-1"}),a.userManagement.reject]})})]}):e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(k,{size:"sm",variant:"outline",onClick:()=>{D(s),ie(!0)},title:a.userManagement.detailInfo,children:e.jsx(Es,{className:"h-4 w-4"})}),(s.api_account_status==="error"||s.api_account_status==="partial")&&e.jsx(k,{size:"sm",variant:"outline",onClick:async()=>{try{r(s.id),p.loading("API ê³„ì • ì¬ìƒì„± ì¤‘...",{id:"api-retry"}),await zs(s.id),p.success("API ê³„ì • ì¬ìƒì„± ì™„ë£Œ",{id:"api-retry"}),j()}catch(t){p.error("ì¬ìƒì„± ì‹¤íŒ¨: "+t.message,{id:"api-retry"})}finally{r(null)}},disabled:Y===s.id,className:"text-amber-600 hover:text-amber-700",title:"API ê³„ì • ì¬ì‹œë„",children:Y===s.id?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-current"}):e.jsx(Bs,{className:"h-4 w-4"})}),e.jsx(k,{size:"sm",variant:"outline",onClick:()=>ds(s),className:"text-green-600 hover:text-green-700",title:a.userManagement.deposit,children:e.jsx(Je,{className:"h-4 w-4"})}),e.jsx(k,{size:"sm",variant:"outline",onClick:()=>ms(s),className:"text-red-600 hover:text-red-700",title:a.userManagement.withdrawal,children:e.jsx(Je,{className:"h-4 w-4"})}),e.jsx(k,{size:"sm",variant:"outline",onClick:()=>us(s),disabled:Y===s.id,className:s.status==="suspended"?"text-blue-600 hover:text-blue-700":"text-orange-600 hover:text-orange-700",title:s.status==="suspended"?a.userManagement.unblock:a.userManagement.block,children:Y===s.id?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-current"}):s.status==="suspended"?e.jsx(Xe,{className:"h-4 w-4"}):e.jsx(Qe,{className:"h-4 w-4"})}),e.jsx(k,{size:"sm",variant:"outline",onClick:()=>ps(s),disabled:Y===s.id,className:"text-red-800 hover:text-red-900",title:a.userManagement.addToBlacklist,children:Y===s.id?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-current"}):e.jsx(Qe,{className:"h-4 w-4"})}),e.jsx(k,{size:"sm",variant:"outline",onClick:()=>{we(s),W(!0)},className:"text-red-600 hover:text-red-700",title:a.userManagement.deleteUser,children:e.jsx(Ze,{className:"h-4 w-4"})})]})}];return _?e.jsx(xe,{}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-100",children:a.userManagement.title}),e.jsx("p",{className:"text-sm text-slate-400",children:a.userManagement.description})]}),e.jsxs(k,{onClick:()=>P(!0),className:"btn-premium-primary",children:[e.jsx(es,{className:"h-4 w-4 mr-2"}),a.userManagement.newUser]})]}),e.jsxs("div",{className:"grid gap-5 md:grid-cols-2 lg:grid-cols-4",children:[e.jsx(Ne,{title:a.userManagement.totalUsers,value:b.length.toLocaleString(),subtitle:`â†‘ ${a.userManagement.registeredUserCount}`,icon:Rs,color:"purple"}),e.jsx(Ne,{title:a.userManagement.pendingApproval,value:xs.length.toLocaleString(),subtitle:a.userManagement.waitingMembers,icon:Pe,color:"amber"}),e.jsx(Ne,{title:a.userManagement.activeUsers,value:b.filter(s=>s.status==="active").length.toLocaleString(),subtitle:a.userManagement.activeMembers,icon:Xe,color:"green"}),e.jsx(Ne,{title:a.userManagement.onlineUsers,value:b.filter(s=>s.status==="active").length.toLocaleString(),subtitle:a.userManagement.realtimeUsers,icon:as,color:"cyan"})]}),e.jsxs("div",{className:"glass-card rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6 pb-4 border-b border-slate-700/50",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-slate-100 mb-1",children:a.userManagement.userList}),e.jsxs("p",{className:"text-sm text-slate-400",children:[a.common.total," ",ze.length.toLocaleString(),a.userManagement.managingMembers]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"relative w-96",children:[e.jsx(qs,{className:"absolute left-3 top-2.5 h-4 w-4 text-slate-400"}),e.jsx(ee,{placeholder:a.userManagement.searchPlaceholder,className:"pl-10 input-premium",value:y,onChange:s=>N(s.target.value)})]}),e.jsxs(Se,{value:F,onValueChange:$,children:[e.jsxs(ke,{className:"w-[160px] input-premium",children:[e.jsx(Fs,{className:"h-4 w-4 mr-2"}),e.jsx(Me,{placeholder:a.userManagement.statusFilter})]}),e.jsxs(Oe,{className:"bg-slate-800 border-slate-700",children:[e.jsx(pe,{value:"all",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-slate-500"}),a.common.all]})}),e.jsx(pe,{value:"pending",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-amber-500"}),a.userManagement.pendingApproval]})}),e.jsx(pe,{value:"active",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-emerald-500"}),a.common.active]})}),e.jsx(pe,{value:"suspended",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-slate-500"}),a.userManagement.blocked]})})]})]})]})]}),e.jsx(Cs,{columns:gs,data:ze,searchable:!1,emptyMessage:y?a.userManagement.noSearchResults:a.userManagement.noUsers})]}),e.jsx(Ue,{open:_e,onOpenChange:P,children:e.jsxs(Ee,{className:"sm:max-w-[500px] bg-slate-900/90 backdrop-blur-md border-slate-700/60 shadow-2xl shadow-blue-500/20",children:[e.jsxs(Be,{children:[e.jsx(Re,{className:"text-xl text-slate-100 bg-gradient-to-r from-blue-400 to-cyan-400 bg-clip-text text-transparent",children:a.userManagement.newUser}),e.jsx(qe,{className:"text-slate-400",children:a.userManagement.createUserDescription})]}),e.jsxs("div",{className:"grid gap-5 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(X,{htmlFor:"username",className:"text-right text-slate-300",children:a.userManagement.username}),e.jsx(ee,{id:"username",value:I.username,onChange:s=>m(t=>({...t,username:s.target.value})),className:"col-span-3 input-premium focus:border-blue-500/60 focus:ring-2 focus:ring-blue-500/20",placeholder:a.userManagement.enterUsername})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(X,{htmlFor:"nickname",className:"text-right text-slate-300",children:a.userManagement.nickname}),e.jsx(ee,{id:"nickname",value:I.nickname,onChange:s=>m(t=>({...t,nickname:s.target.value})),className:"col-span-3 input-premium focus:border-blue-500/60 focus:ring-2 focus:ring-blue-500/20",placeholder:a.userManagement.enterNickname})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(X,{htmlFor:"password",className:"text-right text-slate-300",children:a.common.password}),e.jsx(ee,{id:"password",type:"password",value:I.password,onChange:s=>m(t=>({...t,password:s.target.value})),className:"col-span-3 input-premium focus:border-blue-500/60 focus:ring-2 focus:ring-2 focus:ring-blue-500/20",placeholder:a.userManagement.enterInitialPassword})]}),n.user?.level===1&&O.length>0&&e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(X,{className:"text-right text-slate-300",children:a.userManagement.partnerAffiliation}),e.jsxs(Se,{value:I.selected_referrer_id||void 0,onValueChange:s=>m(t=>({...t,selected_referrer_id:s})),children:[e.jsx(ke,{className:"col-span-3 input-premium focus:border-blue-500/60 focus:ring-2 focus:ring-blue-500/20",children:e.jsx(Me,{placeholder:a.userManagement.selectPartnerOptional})}),e.jsx(Oe,{className:"bg-slate-800 border-slate-700",children:O.map(s=>{const o={2:a.partnerManagement.headOffice,3:a.partnerManagement.mainOffice,4:a.partnerManagement.subOffice,5:a.partnerManagement.distributor,6:a.partnerManagement.store}[s.level]||`Level ${s.level}`;return e.jsxs(pe,{value:s.id,className:"text-slate-200 focus:bg-slate-700 focus:text-slate-100",children:[s.nickname||s.username," (",o,")"]},s.id)})})]})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(X,{className:"text-right text-slate-300",children:a.userManagement.bankName}),e.jsxs(Se,{value:I.bank_name||void 0,onValueChange:s=>m(t=>({...t,bank_name:s})),children:[e.jsx(ke,{className:"col-span-3 input-premium focus:border-blue-500/60 focus:ring-2 focus:ring-blue-500/20",children:e.jsx(Me,{placeholder:a.userManagement.selectBank})}),e.jsx(Oe,{className:"bg-slate-800 border-slate-700",children:Xs.map(s=>e.jsx(pe,{value:s,className:"text-slate-200 focus:bg-slate-700 focus:text-slate-100",children:s},s))})]})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(X,{htmlFor:"bank_account",className:"text-right text-slate-300",children:a.userManagement.accountNumber}),e.jsx(ee,{id:"bank_account",value:I.bank_account,onChange:s=>m(t=>({...t,bank_account:s.target.value})),className:"col-span-3 input-premium focus:border-blue-500/60 focus:ring-2 focus:ring-blue-500/20",placeholder:a.userManagement.enterAccountNumber})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(X,{htmlFor:"memo",className:"text-right text-slate-300",children:a.common.note}),e.jsx(ee,{id:"memo",value:I.memo,onChange:s=>m(t=>({...t,memo:s.target.value})),className:"col-span-3 input-premium focus:border-blue-500/60 focus:ring-2 focus:ring-blue-500/20",placeholder:a.userManagement.adminMemo})]})]}),e.jsxs(Ke,{className:"gap-3",children:[e.jsx(k,{type:"button",variant:"outline",onClick:()=>P(!1),className:"bg-slate-800/50 border-slate-700 text-slate-300 hover:bg-slate-700 hover:text-slate-100",children:a.common.cancel}),e.jsxs(k,{type:"button",onClick:ns,className:"btn-premium-primary",children:[e.jsx(es,{className:"h-4 w-4 mr-2"}),a.userManagement.createUser]})]})]})}),e.jsx(Ue,{open:Ae,onOpenChange:W,children:e.jsxs(Ee,{className:"sm:max-w-[425px] bg-slate-900/90 backdrop-blur-md border-slate-700/60 shadow-2xl shadow-red-500/20",children:[e.jsxs(Be,{children:[e.jsx(Re,{className:"text-xl text-slate-100",children:a.userManagement.deleteConfirm}),e.jsxs(qe,{className:"text-slate-400",children:[a.userManagement.deleteConfirmMessagePrefix,M?.username,a.userManagement.deleteConfirmMessageSuffix]})]}),e.jsxs(Ke,{className:"gap-3",children:[e.jsx(k,{variant:"outline",onClick:()=>W(!1),disabled:fe,className:"bg-slate-800/50 border-slate-700 text-slate-300 hover:bg-slate-700 hover:text-slate-100",children:a.common.cancel}),e.jsx(k,{onClick:is,disabled:fe,className:"btn-premium-danger",children:fe?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),a.userManagement.deleting]}):e.jsxs(e.Fragment,{children:[e.jsx(Ze,{className:"h-4 w-4 mr-2"}),a.userManagement.permanentDelete]})})]})]})}),e.jsx(Ys,{open:je,onOpenChange:s=>{ne(s),s||he(null)},type:ce,targetType:"user",selectedTarget:B?{id:B.id,username:B.username,nickname:B.nickname,balance:B.balance||0}:null,onSubmit:cs,onTypeChange:ge,currentUserLevel:U,currentUserBalance:L,currentUserInvestBalance:We,currentUserOroplayBalance:R}),e.jsx(Gs,{user:Le,isOpen:oe,onClose:()=>{ie(!1),D(null)}})]})}export{ma as UserManagement,ma as default};
