import{r as d,j as e}from"./react-core-BwkdTuSg.js";import{a as Le,n as Re,s as h,l as Ee,h as w,T as Pe,i as $e,j as H,S as se,o as re,p as oe,q as ie,r as L,I as ce,H as le,k as U,L as k,z as de,B as me,t as pe,v as ge,w as ue,x as he,y as We}from"./index-Be3DOFuy.js";import{A as xe,a as fe,b as be,c as we,d as je,e as ve}from"./AdminDialog-6C2SLoqm.js";import{C as Oe,a as Be,e as He,b as Ue,c as Ke,d as Ve}from"./command-B168hacb.js";import{P as ze,a as Ge,b as Qe}from"./popover-BEBhnF_B.js";import{D as K}from"./DataTable-CJW7Gi2n.js";import{k as j}from"./vendor-D410aui4.js";import{M as V}from"./MetricCard-DF34t905.js";import{N as Ye,T as Je,j as Xe,V as Ze,i as ea,d as aa,w as ta,R as na,v as sa,aj as ra,ai as oa,l as ia,ag as ca}from"./lucide-icons-D2Pw2Rdn.js";import"./radix-ui-omyR4zpf.js";import"./supabase-C8Oa5ukG.js";import"./table-C50RqMyg.js";function ya({user:m}){const{t,language:la,formatCurrency:D}=Le(),{lastMessage:b,sendMessage:Y}=Re(),[M,z]=d.useState(!0),[N,_]=d.useState(!1),ye=()=>{const a=window.location.hash.substring(1);return a==="deposit-request"||a==="withdrawal-request"||a==="deposit-history"||a==="withdrawal-history"?a:"deposit-request"},[T,J]=d.useState(ye()),[R,X]=d.useState([]),[y,Me]=d.useState([]),[C,Ne]=d.useState("today"),[G,_e]=d.useState(""),[E,F]=d.useState(0),[P,Z]=d.useState({totalDeposit:0,totalWithdrawal:0,pendingDepositCount:0,pendingWithdrawalCount:0}),[p,A]=d.useState({open:!1,transaction:null,action:"approve",memo:""}),[s,x]=d.useState({open:!1,type:"deposit",userId:"",amount:"",memo:""}),[ee,ae]=d.useState(!1),Se=[1e3,3e3,5e3,1e4,3e4,5e4,1e5,3e5,5e5,1e6];d.useEffect(()=>{const a=()=>{const o=window.location.hash,r=o.indexOf("#",1);if(r!==-1){const i=o.substring(r+1);(i==="deposit-request"||i==="withdrawal-request"||i==="deposit-history"||i==="withdrawal-history")&&J(i)}};a();const n=()=>{a()};return window.addEventListener("hashchange",n),()=>window.removeEventListener("hashchange",n)},[]);const I=async(a=!1)=>{try{a?z(!0):_(!0),console.log("ðŸ”„ ë°ì´í„° ë¡œë“œ ì‹œìž‘:",{isInitial:a,periodFilter:C,userLevel:m.level});const n=Ce(C);let o=h.from("transactions").select(`
          *,
          user:users(id, nickname, username, balance, bank_name, bank_account, bank_holder),
          processed_partner:partners!transactions_processed_by_fkey(nickname, level)
        `).gte("created_at",n.start).lte("created_at",n.end);if(m.level>1){const{data:g}=await h.from("users").select("id").eq("referrer_id",m.id),u=g?.map(f=>f.id)||[];if(u.length>0)o=o.in("user_id",u);else{X([]),Z({totalDeposit:0,totalWithdrawal:0,pendingDepositCount:0,pendingWithdrawalCount:0}),a&&z(!1);return}}const{data:r,error:i}=await o.order("created_at",{ascending:!1});if(i)throw i;console.log("âœ… ê±°ëž˜ ë°ì´í„° ë¡œë“œ ì™„ë£Œ:",r?.length||0,"ê±´"),X(r||[]);let l=h.from("users").select("id, nickname, username, balance, bank_name, bank_account, bank_holder").eq("status","active");m.level>1&&(l=l.eq("referrer_id",m.id));const{data:v}=await l.order("nickname");if(Me(v||[]),r){const g=r.filter(c=>(c.transaction_type==="deposit"||c.transaction_type==="admin_deposit")&&c.status==="completed").reduce((c,q)=>c+parseFloat(q.amount.toString()),0),u=r.filter(c=>(c.transaction_type==="withdrawal"||c.transaction_type==="admin_withdrawal")&&c.status==="completed").reduce((c,q)=>c+parseFloat(q.amount.toString()),0),f=r.filter(c=>c.transaction_type==="deposit"&&c.status==="pending"),S=r.filter(c=>c.transaction_type==="withdrawal"&&c.status==="pending");console.log("ðŸ“Š í†µê³„ ê³„ì‚°:",{depositSum:g,withdrawalSum:u,depositCount:r.filter(c=>(c.transaction_type==="deposit"||c.transaction_type==="admin_deposit")&&c.status==="completed").length,withdrawalCount:r.filter(c=>(c.transaction_type==="withdrawal"||c.transaction_type==="admin_withdrawal")&&c.status==="completed").length}),Z({totalDeposit:g,totalWithdrawal:u,pendingDepositCount:f.length,pendingWithdrawalCount:S.length})}}catch(n){console.error("âŒ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:",n),j.error(t.transactionManagement.loadDataFailed)}finally{a?z(!1):_(!1)}},Ce=a=>{const n=new Date,o=new Date(n.getFullYear(),n.getMonth(),n.getDate());switch(a){case"today":return{start:o.toISOString(),end:n.toISOString()};case"week":const r=new Date(o);return r.setDate(o.getDate()-7),{start:r.toISOString(),end:n.toISOString()};case"month":const i=new Date(o);return i.setMonth(o.getMonth()-1),{start:i.toISOString(),end:n.toISOString()};default:return{start:o.toISOString(),end:n.toISOString()}}};d.useEffect(()=>{I(!0)},[]),d.useEffect(()=>{M||I(!1)},[C,E]),d.useEffect(()=>{const a=h.channel("transactions-changes").on("postgres_changes",{event:"*",schema:"public",table:"transactions"},n=>{console.log("ðŸ’° transactions í…Œì´ë¸” ë³€ê²½ ê°ì§€:",n),F(o=>o+1)}).subscribe();return()=>{h.removeChannel(a)}},[]),d.useEffect(()=>{b&&["deposit_approved","withdrawal_approved","deposit_rejected","withdrawal_rejected"].includes(b.type)&&(console.log("ðŸ’¬ WebSocket ìž…ì¶œê¸ˆ ì•Œë¦¼:",b),F(a=>a+1))},[b]);const te=(a,n)=>{A({open:!0,transaction:a,action:n,memo:""})},Ie=async()=>{if(p.transaction)try{_(!0);const{action:a,transaction:n,memo:o}=p;if(a==="approve"){const i=await pe(m),l=ge(i)?i.opcodes[0]:i;if(!n.user?.username)throw new Error(t.transactionManagement.userInfoNotFound);const v=Math.floor(parseFloat(n.amount.toString()));console.log("ðŸ’° ê±°ëž˜ ìŠ¹ì¸ ì²˜ë¦¬ ì‹œìž‘:",{transaction_type:n.transaction_type,username:n.user.username,amount:v,opcode:l.opcode});let g;if(n.transaction_type==="deposit"?(console.log("ðŸ“¥ ìž…ê¸ˆ API í˜¸ì¶œ ì¤‘..."),g=await ue(n.user.username,v,l.opcode,l.token,l.secretKey)):n.transaction_type==="withdrawal"&&(console.log("ðŸ“¤ ì¶œê¸ˆ API í˜¸ì¶œ ì¤‘..."),g=await he(n.user.username,v,l.opcode,l.token,l.secretKey)),g&&!g.success)throw console.error("âŒ Invest API í˜¸ì¶œ ì‹¤íŒ¨:",g),new Error(g.error||"Invest API í˜¸ì¶œ ì‹¤íŒ¨");console.log("âœ… Invest API ì²˜ë¦¬ ì™„ë£Œ:",g)}const{error:r}=await h.from("transactions").update({status:a==="approve"?"completed":"rejected",processed_by:m.id,processed_at:new Date().toISOString(),memo:a==="reject"?o:n.memo}).eq("id",n.id);if(r)throw r;j.success(a==="approve"?t.transactionManagement.transactionApproved:t.transactionManagement.transactionRejected),Y({type:"transaction_processed",data:{transactionId:n.id,action:a,processedBy:m.nickname,userId:n.user_id}}),A({open:!1,transaction:null,action:"approve",memo:""})}catch(a){console.error("ê±°ëž˜ ì²˜ë¦¬ ì‹¤íŒ¨:",a),j.error(a instanceof Error?a.message:t.transactionManagement.transactionProcessFailed)}finally{_(!1)}},ke=async()=>{try{_(!0);const{type:a,userId:n,amount:o,memo:r}=s;if(!n||!o){j.error(t.transactionManagement.enterMemberAndAmount);return}const i=y.find(O=>O.id===n);if(!i){j.error(t.transactionManagement.memberNotFoundError);return}if(!i.username){j.error(t.transactionManagement.memberUsernameNotFound);return}const l=Math.floor(parseFloat(o)),v=parseFloat(i.balance?.toString()||"0");if(console.log("ðŸ’° ê°•ì œ ìž…ì¶œê¸ˆ ì²˜ë¦¬ ì‹œìž‘:",{type:a,username:i.username,amount:l,balanceBefore:v}),a==="withdrawal"&&l>v){j.error(t.transactionManagement.withdrawalExceedsBalance.replace("{{balance}}",v.toLocaleString())),_(!1);return}const g=await pe(m),u=ge(g)?g.opcodes[0]:g;console.log("ðŸ”‘ OPCODE ì„¤ì •:",{opcode:u.opcode,token:"***"+u.token.slice(-4),secretKey:"***"+u.secretKey.slice(-4)});let f;if(a==="deposit"?(console.log("ðŸ“¥ ìž…ê¸ˆ API í˜¸ì¶œ ì¤‘..."),f=await ue(i.username,l,u.opcode,u.token,u.secretKey)):(console.log("ðŸ“¤ ì¶œê¸ˆ API í˜¸ì¶œ ì¤‘..."),f=await he(i.username,l,u.opcode,u.token,u.secretKey)),!f.success||f.error)throw new Error(f.error||"Invest API í˜¸ì¶œ ì‹¤íŒ¨");console.log("âœ… Invest API ê°•ì œ ìž…ì¶œê¸ˆ ì™„ë£Œ:",f);const S=We(f.data,i.username);console.log("ðŸ’° ì‹¤ì œ ìž”ê³ :",S);const{error:c}=await h.from("transactions").insert({user_id:n,partner_id:m.id,transaction_type:a==="deposit"?"admin_deposit":"admin_withdrawal",amount:l,status:"completed",balance_before:v,balance_after:S,memo:`[ê´€ë¦¬ìž ê°•ì œ ${a==="deposit"?"ìž…ê¸ˆ":"ì¶œê¸ˆ"}] ${r}`,processed_by:m.id,processed_at:new Date().toISOString(),external_response:f.data});if(c)throw c;if(console.log("âœ… transactions INSERT ì™„ë£Œ â†’ íŠ¸ë¦¬ê±°ê°€ users.balance ìžë™ ì—…ë°ì´íŠ¸"),m.level===2){const{data:O,error:qe}=await h.from("partners").select("balance").eq("id",m.id).single();if(qe||!O)console.warn("âš ï¸ Lv2 ê´€ë¦¬ìžì˜ partners ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");else{const B=O.balance||0,Q=a==="deposit"?B-l:B+l,{error:ne}=await h.from("partners").update({balance:Q,updated_at:new Date().toISOString()}).eq("id",m.id);ne?console.error("âŒ Lv2 balance ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:",ne):(console.log(`âœ… Lv2 balance ì—…ë°ì´íŠ¸: ${B} â†’ ${Q}`),await h.from("partner_balance_logs").insert({partner_id:m.id,balance_before:B,balance_after:Q,amount:a==="deposit"?-l:l,transaction_type:a==="deposit"?"withdrawal":"deposit",from_partner_id:a==="deposit"?m.id:n,to_partner_id:a==="deposit"?n:m.id,processed_by:m.id,memo:`[ê°•ì œ${a==="deposit"?"ìž…ê¸ˆ":"ì¶œê¸ˆ"}] ${i.username}ì—ê²Œ ${l.toLocaleString()}ì› ${a==="deposit"?"ìž…ê¸ˆ":"íšŒìˆ˜"}${r?`: ${r}`:""}`}))}}const q=a==="deposit"?t.transactionManagement.forceDepositSuccess.replace("{{balance}}",S.toLocaleString()):t.transactionManagement.forceWithdrawalSuccess.replace("{{balance}}",S.toLocaleString());j.success(q),Y({type:"admin_force_transaction",data:{userId:n,type:a,amount:l,balanceAfter:S,processedBy:m.nickname}}),x({open:!1,type:"deposit",userId:"",amount:"",memo:""})}catch(a){console.error("ê°•ì œ ìž…ì¶œê¸ˆ ì‹¤íŒ¨:",a),j.error(a instanceof Error?a.message:t.transactionManagement.forceTransactionFailed)}finally{_(!1)}};if(d.useEffect(()=>{I(!0)},[]),d.useEffect(()=>{E>0&&!M&&(console.log("ðŸ”„ Realtime íŠ¸ë¦¬ê±° ë°ì´í„° ë¡œë“œ:",E),I(!1))},[E]),d.useEffect(()=>{M||(console.log("ðŸ“… ê¸°ê°„ í•„í„° ë³€ê²½:",C),I(!1))},[C]),d.useEffect(()=>{console.log("ðŸ”Œ Realtime subscription ì„¤ì • ì¤‘...");const a=h.channel("transactions-realtime-changes").on("postgres_changes",{event:"*",schema:"public",table:"transactions"},o=>{console.log("ðŸ’³ transactions í…Œì´ë¸” ë³€ê²½ ê°ì§€:",o.eventType,o.new),F(r=>r+1)}).subscribe(o=>{console.log("ðŸ’³ transactions ì±„ë„ êµ¬ë… ìƒíƒœ:",o)}),n=h.channel("users-realtime-balance-changes").on("postgres_changes",{event:"UPDATE",schema:"public",table:"users"},o=>{console.log("ðŸ‘¤ users í…Œì´ë¸” ë³€ê²½ ê°ì§€:",o.new),F(r=>r+1)}).subscribe(o=>{console.log("ðŸ‘¤ users ì±„ë„ êµ¬ë… ìƒíƒœ:",o)});return()=>{console.log("ðŸ”Œ Realtime subscription ì •ë¦¬ ì¤‘..."),h.removeChannel(a),h.removeChannel(n)}},[]),d.useEffect(()=>{(b?.type==="transaction_update"||b?.type==="deposit_request"||b?.type==="withdrawal_request"||b?.type==="admin_force_transaction"||b?.type==="transaction_processed")&&(console.log("ðŸ“¨ WebSocket ë©”ì‹œì§€ ìˆ˜ì‹ :",b.type),F(a=>a+1))},[b]),M)return e.jsx(Ee,{});const $=a=>G===""||a.user?.nickname?.toLowerCase().includes(G.toLowerCase()),De=R.filter(a=>a.transaction_type==="deposit"&&a.status==="pending"&&$(a)),Te=R.filter(a=>a.transaction_type==="withdrawal"&&a.status==="pending"&&$(a)),Fe=R.filter(a=>(a.transaction_type==="deposit"||a.transaction_type==="withdrawal")&&a.status==="completed"&&$(a)),Ae=R.filter(a=>(a.transaction_type==="admin_deposit"||a.transaction_type==="admin_withdrawal"||a.transaction_type==="admin_adjustment")&&a.status==="completed"&&$(a)),W=(a=!1)=>[{header:t.transactionManagement.transactionDate,cell:n=>e.jsx("span",{className:"text-sm text-slate-300",children:new Date(n.created_at).toLocaleString("ko-KR")})},{header:t.transactionManagement.member,cell:n=>e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-slate-200",children:n.user?.nickname}),e.jsx("p",{className:"text-sm text-slate-500",children:n.user?.username})]})},{header:t.transactionManagement.transactionType,cell:n=>{const r={deposit:{text:t.transactionManagement.deposit,color:"bg-green-500"},withdrawal:{text:t.transactionManagement.withdrawal,color:"bg-red-500"},admin_deposit:{text:t.transactionManagement.adminDeposit,color:"bg-green-600"},admin_withdrawal:{text:t.transactionManagement.adminWithdrawal,color:"bg-red-600"},admin_adjustment:{text:n.memo?.includes("ê°•ì œ ì¶œê¸ˆ")?t.transactionManagement.withdrawal:t.transactionManagement.deposit,color:n.memo?.includes("ê°•ì œ ì¶œê¸ˆ")?"bg-red-600":"bg-green-600"}}[n.transaction_type]||{text:n.transaction_type,color:"bg-gray-500"};return e.jsx(me,{className:`${r.color} text-white`,children:r.text})}},{header:t.transactionManagement.amount,cell:n=>{const o=n.transaction_type==="withdrawal"||n.transaction_type==="admin_withdrawal"||n.transaction_type==="admin_adjustment"&&n.memo?.includes("ê°•ì œ ì¶œê¸ˆ");return e.jsxs("span",{className:le("font-mono font-semibold",o?"text-red-400":"text-green-400"),children:[o?"-":"+",D(parseFloat(n.amount.toString()))]})}},{header:t.transactionManagement.balanceAfter,cell:n=>e.jsx("span",{className:"font-mono text-cyan-400",children:D(parseFloat(n.balance_after?.toString()||"0"))})},{header:t.transactionManagement.status,cell:n=>{const r={pending:{text:t.transactionManagement.pending,color:"bg-yellow-500"},completed:{text:t.transactionManagement.completed,color:"bg-green-500"},rejected:{text:t.transactionManagement.rejected,color:"bg-red-500"}}[n.status]||{text:n.status,color:"bg-gray-500"};return e.jsx(me,{className:`${r.color} text-white`,children:r.text})}},{header:t.transactionManagement.memo,cell:n=>e.jsx("div",{className:"max-w-xs",children:e.jsx("span",{className:"text-sm text-slate-400 block truncate",title:n.memo||"",children:n.memo||"-"})})},{header:t.transactionManagement.processor,cell:n=>e.jsx("span",{className:"text-sm text-slate-400",children:n.processed_partner?.nickname||"-"})},...a?[{header:t.transactionManagement.actions,cell:n=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(w,{size:"sm",onClick:()=>te(n,"approve"),disabled:N,className:"h-8 px-3 bg-green-600 hover:bg-green-700",children:t.transactionManagement.approve}),e.jsx(w,{size:"sm",variant:"outline",onClick:()=>te(n,"reject"),disabled:N,className:"h-8 px-3 border-red-500 text-red-500 hover:bg-red-500 hover:text-white",children:t.transactionManagement.reject})]})}]:[]];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-100",children:t.transactionManagement.title}),e.jsx("p",{className:"text-sm text-slate-400",children:t.transactionManagement.subtitle})]}),e.jsxs(w,{onClick:()=>x({...s,open:!0}),className:"btn-premium-primary",children:[e.jsx(Ye,{className:"h-4 w-4 mr-2"}),t.transactionManagement.forceTransaction]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-5",children:[e.jsx(V,{title:t.transactionManagement.totalDeposit,value:D(P.totalDeposit),subtitle:t.transactionManagement.accumulatedDeposit,icon:Je,color:"green"}),e.jsx(V,{title:t.transactionManagement.totalWithdrawal,value:D(P.totalWithdrawal),subtitle:t.transactionManagement.accumulatedWithdrawal,icon:Xe,color:"red"}),e.jsx(V,{title:t.transactionManagement.depositRequests,value:`${P.pendingDepositCount}ê±´`,subtitle:t.transactionManagement.pendingProcessing,icon:Ze,color:"amber"}),e.jsx(V,{title:t.transactionManagement.withdrawalRequests,value:`${P.pendingWithdrawalCount}ê±´`,subtitle:t.transactionManagement.pendingProcessing,icon:ea,color:"orange"})]}),e.jsx("div",{className:"glass-card rounded-xl p-6",children:e.jsxs(Pe,{value:T,onValueChange:J,className:"space-y-6",children:[e.jsx("div",{className:"bg-slate-800/30 rounded-xl p-1.5 border border-slate-700/40",children:e.jsxs($e,{className:"bg-transparent h-auto p-0 border-0 gap-2 w-full grid grid-cols-4",children:[e.jsx(H,{value:"deposit-request",className:"bg-transparent text-slate-400 rounded-lg px-6 py-3 data-[state=active]:bg-gradient-to-br data-[state=active]:from-blue-500/20 data-[state=active]:to-cyan-500/10 data-[state=active]:text-white data-[state=active]:shadow-lg data-[state=active]:shadow-blue-500/20 data-[state=active]:border data-[state=active]:border-blue-400/30 transition-all duration-200",children:t.transactionManagement.depositRequestTab}),e.jsx(H,{value:"withdrawal-request",className:"bg-transparent text-slate-400 rounded-lg px-6 py-3 data-[state=active]:bg-gradient-to-br data-[state=active]:from-purple-500/20 data-[state=active]:to-pink-500/10 data-[state=active]:text-white data-[state=active]:shadow-lg data-[state=active]:shadow-purple-500/20 data-[state=active]:border data-[state=active]:border-purple-400/30 transition-all duration-200",children:t.transactionManagement.withdrawalRequestTab}),e.jsx(H,{value:"completed-history",className:"bg-transparent text-slate-400 rounded-lg px-6 py-3 data-[state=active]:bg-gradient-to-br data-[state=active]:from-green-500/20 data-[state=active]:to-emerald-500/10 data-[state=active]:text-white data-[state=active]:shadow-lg data-[state=active]:shadow-green-500/20 data-[state=active]:border data-[state=active]:border-green-400/30 transition-all duration-200",children:t.transactionManagement.completedHistoryTab}),e.jsx(H,{value:"admin-history",className:"bg-transparent text-slate-400 rounded-lg px-6 py-3 data-[state=active]:bg-gradient-to-br data-[state=active]:from-orange-500/20 data-[state=active]:to-amber-500/10 data-[state=active]:text-white data-[state=active]:shadow-lg data-[state=active]:shadow-orange-500/20 data-[state=active]:border data-[state=active]:border-orange-400/30 transition-all duration-200",children:t.transactionManagement.adminHistoryTab})]})}),e.jsx("div",{className:"flex items-center justify-between pb-4 border-b border-slate-700/50",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(aa,{className:"h-5 w-5 text-slate-400"}),e.jsxs("h3",{className:"font-semibold text-slate-100",children:[T==="deposit-request"&&t.transactionManagement.depositRequestTab,T==="withdrawal-request"&&t.transactionManagement.withdrawalRequestTab,T==="completed-history"&&t.transactionManagement.completedHistoryTab,T==="admin-history"&&t.transactionManagement.adminHistoryTab]})]})}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(se,{value:C,onValueChange:Ne,children:[e.jsx(re,{className:"w-[140px] input-premium",children:e.jsx(oe,{placeholder:t.transactionManagement.period})}),e.jsxs(ie,{className:"bg-slate-800 border-slate-700",children:[e.jsx(L,{value:"today",children:t.transactionManagement.today}),e.jsx(L,{value:"week",children:t.transactionManagement.lastWeek}),e.jsx(L,{value:"month",children:t.transactionManagement.lastMonth})]})]}),e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(ta,{className:"absolute left-3 top-2.5 h-4 w-4 text-slate-400"}),e.jsx(ce,{placeholder:t.transactionManagement.searchMembers,className:"pl-10 input-premium",value:G,onChange:a=>_e(a.target.value)})]}),e.jsxs(w,{onClick:()=>{console.log("ðŸ”„ ìˆ˜ë™ ìƒˆë¡œê³ ì¹¨"),I(!1)},disabled:N,variant:"outline",className:"btn-premium-primary",children:[e.jsx(na,{className:le("h-4 w-4 mr-2",N&&"animate-spin")}),t.transactionManagement.refresh]})]}),e.jsx(U,{value:"deposit-request",children:e.jsx(K,{searchable:!1,columns:W(!0),data:De,loading:M,emptyMessage:t.transactionManagement.noDepositRequests})}),e.jsx(U,{value:"withdrawal-request",children:e.jsx(K,{searchable:!1,columns:W(!0),data:Te,loading:M,emptyMessage:t.transactionManagement.noWithdrawalRequests})}),e.jsx(U,{value:"completed-history",children:e.jsx(K,{searchable:!1,columns:W(!1),data:Fe,loading:M,emptyMessage:t.transactionManagement.noTransactionHistory})}),e.jsx(U,{value:"admin-history",children:e.jsx(K,{searchable:!1,columns:W(!1),data:Ae,loading:M,emptyMessage:t.transactionManagement.noAdminTransactionHistory})})]})}),e.jsx(xe,{open:p.open,onOpenChange:a=>A({...p,open:a}),children:e.jsxs(fe,{className:"bg-slate-900 border-slate-700",children:[e.jsxs(be,{children:[e.jsx(we,{className:"text-white",children:p.action==="approve"?t.transactionManagement.approveTransaction:t.transactionManagement.rejectTransaction}),e.jsx(je,{className:"text-slate-400",children:p.action==="approve"?t.transactionManagement.confirmApproveMessage:t.transactionManagement.enterRejectReason})]}),p.transaction&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"p-4 bg-slate-800/50 rounded-lg space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{className:"text-slate-400",children:[t.transactionManagement.member,":"]}),e.jsx("span",{className:"text-white",children:p.transaction.user?.nickname})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{className:"text-slate-400",children:[t.transactionManagement.transactionType,":"]}),e.jsx("span",{className:"text-white",children:p.transaction.transaction_type==="deposit"?t.transactionManagement.deposit:t.transactionManagement.withdrawal})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{className:"text-slate-400",children:[t.transactionManagement.amount,":"]}),e.jsx("span",{className:"text-green-400 font-mono",children:D(parseFloat(p.transaction.amount.toString()))})]})]}),p.action==="reject"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{htmlFor:"transaction-reject-reason",className:"text-slate-300",children:t.transactionManagement.rejectReason}),e.jsx(de,{id:"transaction-reject-reason",name:"reject_reason",value:p.memo,onChange:a=>A({...p,memo:a.target.value}),placeholder:t.transactionManagement.rejectReasonPlaceholder,className:"bg-slate-800 border-slate-700 text-white",rows:3})]})]}),e.jsxs(ve,{children:[e.jsx(w,{variant:"outline",onClick:()=>A({...p,open:!1}),disabled:N,children:t.transactionManagement.cancel}),e.jsx(w,{onClick:Ie,disabled:N||p.action==="reject"&&!p.memo,className:p.action==="approve"?"bg-green-600 hover:bg-green-700":"bg-red-600 hover:bg-red-700",children:p.action==="approve"?t.transactionManagement.approve:t.transactionManagement.reject})]})]})}),e.jsx(xe,{open:s.open,onOpenChange:a=>x({...s,open:a}),children:e.jsxs(fe,{className:"sm:max-w-[550px]",children:[e.jsxs(be,{children:[e.jsx(we,{className:"flex items-center gap-2",children:s.type==="deposit"?e.jsxs(e.Fragment,{children:[e.jsx(sa,{className:"h-5 w-5 text-emerald-500"}),t.transactionManagement.forceDeposit]}):e.jsxs(e.Fragment,{children:[e.jsx(ra,{className:"h-5 w-5 text-rose-500"}),t.transactionManagement.forceWithdrawal]})}),e.jsx(je,{children:t.transactionManagement.adjustMemberBalance})]}),e.jsxs("div",{className:"grid gap-5 py-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(k,{htmlFor:"force-dialog-type",children:t.transactionManagement.transactionTypeLabel}),e.jsxs(se,{value:s.type,onValueChange:a=>x({...s,type:a}),children:[e.jsx(re,{id:"force-dialog-type",className:"input-premium h-10",children:e.jsx(oe,{})}),e.jsxs(ie,{className:"bg-slate-800 border-slate-700",children:[e.jsx(L,{value:"deposit",children:t.transactionManagement.deposit}),e.jsx(L,{value:"withdrawal",children:t.transactionManagement.withdrawal})]})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(k,{htmlFor:"force-dialog-user-search",children:t.transactionManagement.selectMember}),e.jsxs(ze,{open:ee,onOpenChange:ae,children:[e.jsx(Ge,{asChild:!0,children:e.jsxs(w,{id:"force-dialog-user-search",variant:"outline",role:"combobox","aria-expanded":ee,className:"justify-between input-premium h-10",children:[s.userId?y.find(a=>a.id===s.userId)?.username+` (${y.find(a=>a.id===s.userId)?.nickname}) - ${parseFloat(y.find(a=>a.id===s.userId)?.balance?.toString()||"0").toLocaleString()}ì›`:t.transactionManagement.selectMemberPlaceholder,e.jsx(oa,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),e.jsx(Qe,{className:"w-[480px] p-0 bg-slate-800 border-slate-700",children:e.jsxs(Oe,{className:"bg-slate-800",children:[e.jsx(Be,{placeholder:t.transactionManagement.selectMemberPlaceholder,className:"h-9 text-slate-100 placeholder:text-slate-500"}),e.jsxs(He,{children:[e.jsx(Ue,{className:"text-slate-400 py-6 text-center text-sm",children:t.transactionManagement.memberNotFound}),e.jsx(Ke,{className:"max-h-64 overflow-auto",children:y.map(a=>e.jsxs(Ve,{value:`${a.username} ${a.nickname}`,onSelect:()=>{x({...s,userId:a.id}),ae(!1)},className:"flex items-center justify-between cursor-pointer hover:bg-slate-700/50 text-slate-300",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ia,{className:`mr-2 h-4 w-4 ${s.userId===a.id?`opacity-100 ${s.type==="deposit"?"text-emerald-500":"text-rose-500"}`:"opacity-0"}`}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-slate-100",children:a.username}),e.jsx("div",{className:"text-xs text-slate-400",children:a.nickname})]})]}),e.jsx("div",{className:"text-sm",children:e.jsxs("span",{className:"text-cyan-400 font-mono",children:[parseFloat(a.balance?.toString()||"0").toLocaleString(),"ì›"]})})]},a.id))})]})]})})]})]}),s.userId&&(()=>{const a=y.find(n=>n.id===s.userId);return a?e.jsxs("div",{className:"p-3 bg-slate-800/50 rounded-lg border border-slate-700",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm text-slate-400",children:t.transactionManagement.selectedMember}),e.jsx("span",{className:"text-cyan-400 font-medium",children:a.nickname})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-slate-400",children:t.transactionManagement.currentBalance}),e.jsxs("span",{className:"font-mono text-cyan-400",children:[parseFloat(a.balance?.toString()||"0").toLocaleString(),"ì›"]})]})]}):null})(),e.jsxs("div",{className:"grid gap-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(k,{htmlFor:"force-dialog-amount",children:t.transactionManagement.amountLabel}),e.jsx(w,{type:"button",variant:"ghost",size:"sm",onClick:()=>x({...s,amount:"0"}),className:`h-7 px-2 text-xs text-slate-400 ${s.type==="deposit"?"hover:text-orange-400 hover:bg-orange-500/10":"hover:text-red-400 hover:bg-red-500/10"}`,children:t.transactionManagement.deleteAll})]}),e.jsx(ce,{id:"force-dialog-amount",name:"amount",type:"number",value:s.amount,onChange:a=>{const n=parseFloat(a.target.value||"0");if(s.type==="withdrawal"&&s.userId){const o=y.find(r=>r.id===s.userId);if(o){const r=parseFloat(o.balance?.toString()||"0");if(n>r){j.error(`ì¶œê¸ˆ ê¸ˆì•¡ì´ ë³´ìœ ê¸ˆ(${r.toLocaleString()}ì›)ì„ ì´ˆê³¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`),x({...s,amount:r.toString()});return}}}x({...s,amount:a.target.value})},placeholder:t.transactionManagement.enterAmountPlaceholder,className:"input-premium"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(k,{className:"text-slate-400 text-sm",children:t.transactionManagement.quickInput}),e.jsx("div",{className:"grid grid-cols-4 gap-2",children:Se.map(a=>e.jsxs(w,{type:"button",variant:"outline",onClick:()=>{const o=parseFloat(s.amount||"0")+a;if(s.type==="withdrawal"&&s.userId){const r=y.find(i=>i.id===s.userId);if(r){const i=parseFloat(r.balance?.toString()||"0");if(o>i){j.error(`ì¶œê¸ˆ ê¸ˆì•¡ì´ ë³´ìœ ê¸ˆ(${i.toLocaleString()}ì›)ì„ ì´ˆê³¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`),x({...s,amount:i.toString()});return}}}x({...s,amount:o.toString()})},className:`h-9 transition-all bg-slate-800/50 border-slate-700 text-slate-300 ${s.type==="deposit"?"hover:bg-orange-500/20 hover:border-orange-500/60 hover:text-orange-400 hover:shadow-[0_0_15px_rgba(251,146,60,0.3)]":"hover:bg-red-500/20 hover:border-red-500/60 hover:text-red-400 hover:shadow-[0_0_15px_rgba(239,68,68,0.3)]"}`,children:["+",a>=1e4?`${a/1e4}ë§Œ`:`${a/1e3}ì²œ`]},a))})]}),s.type==="withdrawal"&&s.userId&&e.jsx("div",{className:"grid gap-2",children:e.jsxs(w,{type:"button",variant:"outline",onClick:()=>{const a=y.find(n=>n.id===s.userId);if(a){const n=parseFloat(a.balance?.toString()||"0");x({...s,amount:n.toString()})}},className:"w-full h-9 bg-red-900/20 border-red-500/50 text-red-400 hover:bg-red-900/40 hover:border-red-500",children:[e.jsx(ca,{className:"h-4 w-4 mr-2"}),t.transactionManagement.fullWithdrawal]})}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(k,{htmlFor:"force-dialog-memo",children:t.transactionManagement.memoLabel}),e.jsx(de,{id:"force-dialog-memo",name:"memo",value:s.memo,onChange:a=>x({...s,memo:a.target.value}),placeholder:t.transactionManagement.memoPlaceholder,className:"input-premium min-h-[80px]"})]})]}),e.jsx(ve,{children:e.jsx(w,{type:"button",onClick:ke,disabled:N||!s.userId||!s.amount||parseFloat(s.amount)<=0,className:`w-full ${s.type==="deposit"?"btn-premium-warning":"btn-premium-danger"}`,children:N?t.transactionManagement.processing:s.type==="deposit"?t.transactionManagement.forceDeposit:t.transactionManagement.forceWithdrawal})})]})})]})}export{ya as TransactionManagement,ya as default};
