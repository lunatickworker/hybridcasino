import{r as u,j as e}from"./react-core-BwkdTuSg.js";import{a as Ve,n as We,o as Ye,u as Je,B as Ke,m as Xe,i as f,L as y,I as H,A as W,S as Ze,p as et,q as tt,r as at,t as F,s as o}from"./index-McppjVnx.js";import{D as nt}from"./DataTable-w2U-jZDQ.js";import{A as Y,f as J,a as K,b as X,c as Z,d as ee,e as te}from"./AdminDialog-D_QT-Qbt.js";import{C as ae,a as ne,b as se,c as re,d as oe}from"./command-BcDTzi9L.js";import{P as ie,a as le,b as ce}from"./popover-e-C_onM2.js";import{k as i}from"./vendor-D410aui4.js";import{M as Q}from"./MetricCard-DnMFhTGK.js";import{r as Me,v as de,ai as me,l as pe,aj as Pe,ak as Ce,T as st,j as rt,w as ot}from"./lucide-icons-CePlpqHy.js";import"./radix-ui-omyR4zpf.js";import"./supabase-C8Oa5ukG.js";import"./table-CKCHMZ5m.js";function _t(){const{t:a}=Ve(),{authState:r}=We(),{connected:P,sendMessage:g}=Ye(),{balance:it,syncBalance:lt}=Je(),[U,ue]=u.useState([]),[v,Le]=u.useState([]),[C,h]=u.useState(!0),[D,ke]=u.useState(""),[I,De]=u.useState("all"),[Ae,ge]=u.useState(!1),[$e,he]=u.useState(!1),[Te,xe]=u.useState(!1),[s,L]=u.useState(""),[A,q]=u.useState(""),[$,B]=u.useState(""),[T,O]=u.useState(""),[S,k]=u.useState(""),[fe,ve]=u.useState(!1),[je,be]=u.useState(!1),[_e,we]=u.useState(!1),R=async()=>{try{h(!0);let t=o.from("point_transactions").select(`
          *,
          users:user_id (
            username,
            nickname
          ),
          partners:partner_id (
            nickname
          )
        `);if(r.user?.level&&r.user.level>1){const{data:d}=await o.from("users").select("id").eq("referrer_id",r.user.id),j=d?.map(m=>m.id)||[];if(j.length>0)t=t.in("user_id",j);else{ue([]),h(!1);return}}const{data:n,error:l}=await t.order("created_at",{ascending:!1}).limit(1e3);if(l)throw l;const x=n?.map(d=>({...d,user_username:d.users?.username||"",user_nickname:d.users?.nickname||"",partner_nickname:d.partners?.nickname||""}))||[];ue(x)}catch(t){console.error("í¬ì¸íŠ¸ ê±°ëž˜ ë‚´ì—­ ì¡°íšŒ ì˜¤ë¥˜:",t),i.error(a.pointManagement.loadTransactionsFailed)}finally{h(!1)}},G=async()=>{try{let t=o.from("users").select("id, username, nickname, points, balance").eq("status","active");r.user?.level&&r.user.level>1&&(t=t.eq("referrer_id",r.user.id));const{data:n,error:l}=await t.order("username");if(l)throw l;Le(n||[])}catch(t){console.error(a.pointManagement.loadUsersFailed,t)}},z=[10,30,50,70,100,200,300,400],Ee=t=>{const n=parseFloat(A)||0;q((n+t).toString())},Fe=t=>{const n=parseFloat(T)||0;O((n+t).toString())},Ue=t=>{const n=parseFloat($)||0;B((n+t).toString())},Ie=()=>{q("")},qe=()=>{B("")},Be=()=>{O("")},Oe=async()=>{try{if(!s||!A||parseFloat(A)<=0){i.error(a.pointManagement.enterValidAmount);return}const t=parseFloat(A),n=r.user?.level||1;if(n===1){i.error(a.pointManagement.lv1CannotGive);return}h(!0);const{data:l,error:x}=await o.from("partners").select("*").eq("id",r.user?.id).single();if(x){i.error(`ê´€ë¦¬ìž ì •ë³´ ì¡°íšŒ ì‹¤íŒ¨: ${x.message}`),h(!1);return}const{data:d,error:j}=await o.from("users").select("*").eq("id",s).single();if(j){i.error(`ì‚¬ìš©ìž ì •ë³´ ì¡°íšŒ ì‹¤íŒ¨: ${j.message}`),h(!1);return}const m=d.points||0;if(console.log("ðŸŽ [í¬ì¸íŠ¸ ì§€ê¸‰] ì‹œìž‘:",{adminLevel:n,adminId:r.user?.id,userId:s,amount:t}),n===2){console.log("âœ… [Lv2 í¬ì¸íŠ¸ ì§€ê¸‰] Lv7 í¬ì¸íŠ¸ë§Œ ì¦ê°€");const c=m+t,{error:p}=await o.from("users").update({points:c,updated_at:new Date().toISOString()}).eq("id",s);if(p)throw p;const{data:w,error:N}=await o.from("point_transactions").insert([{user_id:s,partner_id:r.user?.id,transaction_type:"admin_adjustment",amount:t,points_before:m,points_after:c,memo:S||"ê´€ë¦¬ìž í¬ì¸íŠ¸ ì§€ê¸‰ (Lv2)"}]).select().single();N&&console.error("âŒ [í¬ì¸íŠ¸ ì§€ê¸‰] ê±°ëž˜ë‚´ì—­ ìƒì„± ì‹¤íŒ¨:",N),i.success(`${t.toLocaleString()}Pê°€ ì§€ê¸‰ë˜ì—ˆìŠµë‹ˆë‹¤. (Lv2ëŠ” ë³€ë™ ì—†ìŒ)`,{duration:3e3,icon:"ðŸŽ"}),P&&g&&g({type:"points_given",data:{transaction:w}})}else if(n===3){const c=l.balance||0;if(t>c){i.error(`ë³´ìœ ê¸ˆì´ ë¶€ì¡±í•©ë‹ˆë‹¤. í˜„ìž¬ ë³´ìœ ê¸ˆ: ${c.toLocaleString()}ì›`),h(!1);return}const p=c-t,{error:w}=await o.from("partners").update({balance:p,updated_at:new Date().toISOString()}).eq("id",r.user?.id);if(w)throw w;const N=m+t,{error:M}=await o.from("users").update({points:N,updated_at:new Date().toISOString()}).eq("id",s);if(M)throw M;const{data:V,error:E}=await o.from("point_transactions").insert([{user_id:s,partner_id:r.user?.id,transaction_type:"admin_adjustment",amount:t,points_before:m,points_after:N,memo:S||"ê´€ë¦¬ìž í¬ì¸íŠ¸ ì§€ê¸‰ (Lv3)"}]).select().single();E&&console.error("âŒ [í¬ì¸íŠ¸ ì§€ê¸‰] ê±°ëž˜ë‚´ì—­ ìƒì„± ì‹¤íŒ¨:",E),await o.from("partner_balance_logs").insert({partner_id:r.user?.id,balance_before:c,balance_after:p,amount:-t,transaction_type:"admin_adjustment",processed_by:r.user?.id,memo:`í¬ì¸íŠ¸ ì§€ê¸‰: ${d.username} (${d.nickname})`}),i.success(`${t.toLocaleString()}Pê°€ ì§€ê¸‰ë˜ì—ˆìŠµë‹ˆë‹¤. (ë³´ìœ ê¸ˆ: ${p.toLocaleString()}ì›)`,{duration:3e3,icon:"ðŸŽ"}),P&&g&&g({type:"points_given",data:{transaction:V}})}else{const c=l.balance||0;if(t>c){i.error(`ë³´ìœ ê¸ˆì´ ë¶€ì¡±í•©ë‹ˆë‹¤. í˜„ìž¬ ë³´ìœ ê¸ˆ: ${c.toLocaleString()}ì›`),h(!1);return}const p=c-t,{error:w}=await o.from("partners").update({balance:p,updated_at:new Date().toISOString()}).eq("id",r.user?.id);if(w)throw w;const N=m+t,{error:M}=await o.from("users").update({points:N,updated_at:new Date().toISOString()}).eq("id",s);if(M)throw M;const{data:V,error:E}=await o.from("point_transactions").insert([{user_id:s,partner_id:r.user?.id,transaction_type:"admin_adjustment",amount:t,points_before:m,points_after:N,memo:S||"ê´€ë¦¬ìž í¬ì¸íŠ¸ ì§€ê¸‰"}]).select().single();E&&console.error("âŒ [í¬ì¸íŠ¸ ì§€ê¸‰] ê±°ëž˜ë‚´ì—­ ìƒì„± ì‹¤íŒ¨:",E),await o.from("partner_balance_logs").insert({partner_id:r.user?.id,balance_before:c,balance_after:p,amount:-t,transaction_type:"admin_adjustment",processed_by:r.user?.id,memo:`í¬ì¸íŠ¸ ì§€ê¸‰: ${d.username} (${d.nickname})`}),i.success(`${t.toLocaleString()}Pê°€ ì§€ê¸‰ë˜ì—ˆìŠµë‹ˆë‹¤. (ë³´ìœ ê¸ˆ: ${p.toLocaleString()}ì›)`,{duration:3e3,icon:"ðŸŽ"}),P&&g&&g({type:"points_given",data:{transaction:V}})}const{data:b,error:_}=await o.from("point_transactions").insert([{user_id:s,partner_id:r.user?.id,transaction_type:"admin_adjustment",amount:t,points_before:m,points_after:newPoints,memo:S||"ê´€ë¦¬ìž í¬ì¸íŠ¸ ì§€ê¸‰"}]).select().single();_&&console.error("âŒ [í¬ì¸íŠ¸ ì§€ê¸‰] ê±°ëž˜ë‚´ì—­ ìƒì„± ì‹¤íŒ¨:",_),i.success(`${t.toLocaleString()}Pê°€ ì§€ê¸‰ë˜ì—ˆìŠµë‹ˆë‹¤. (ë³´ìœ ê¸ˆ: ${newAdminBalance.toLocaleString()}ì›)`,{duration:3e3,icon:"ðŸŽ"}),ge(!1),L(""),q(""),k(""),console.log("âœ… [í¬ì¸íŠ¸ ì§€ê¸‰] ë³´ìœ ê¸ˆ ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ ëŒ€ê¸° ì¤‘..."),P&&g&&g({type:"points_given",data:{transaction:b}}),R(),G()}catch(t){console.error("âŒ [í¬ì¸íŠ¸ ì§€ê¸‰] ì˜ˆìƒì¹˜ ëª»í•œ ì˜¤ë¥˜:",t),i.error("í¬ì¸íŠ¸ ì§€ê¸‰ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")}finally{h(!1)}},Re=async()=>{try{if(!s||!$||parseFloat($)<=0){i.error("ì‚¬ìš©ìžì™€ ìœ íš¨í•œ í¬ì¸íŠ¸ ê¸ˆì•¡ì„ ìž…ë ¥í•´ì£¼ì„¸ìš”.");return}h(!0);const t=parseFloat($),n=r.user?.level||1,{data:l,error:x}=await o.from("partners").select("*").eq("id",r.user?.id).single();if(x){i.error(`ê´€ë¦¬ìž ì •ë³´ ì¡°íšŒ ì‹¤íŒ¨: ${x.message}`),h(!1);return}const{data:d,error:j}=await o.from("users").select("*").eq("id",s).single();if(j){i.error(`ì‚¬ìš©ìž ì •ë³´ ì¡°íšŒ ì‹¤íŒ¨: ${j.message}`),h(!1);return}const m=d.points||0;if(m<t){i.error(`íšŒìˆ˜í•  í¬ì¸íŠ¸ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤. í˜„ìž¬ í¬ì¸íŠ¸: ${m.toLocaleString()}P`),h(!1);return}if(console.log("ðŸ”„ [í¬ì¸íŠ¸ íšŒìˆ˜] ì‹œìž‘:",{adminLevel:n,adminId:r.user?.id,userId:s,amount:t}),n===2){console.log("âœ… [Lv2 í¬ì¸íŠ¸ íšŒìˆ˜] Lv7 í¬ì¸íŠ¸ë§Œ ì°¨ê°, Lv2 ë³€ë™ ì—†ìŒ");const b=m-t,{error:_}=await o.from("users").update({points:b,updated_at:new Date().toISOString()}).eq("id",s);if(_)throw _;const{data:c,error:p}=await o.from("point_transactions").insert([{user_id:s,partner_id:r.user?.id,transaction_type:"use",amount:-t,points_before:m,points_after:b,memo:S||"ê´€ë¦¬ìž í¬ì¸íŠ¸ íšŒìˆ˜ (Lv2)"}]).select().single();p&&console.error("âŒ [í¬ì¸íŠ¸ íšŒìˆ˜] ê±°ëž˜ë‚´ì—­ ìƒì„± ì‹¤íŒ¨:",p),i.success(`${t.toLocaleString()}Pê°€ íšŒìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤. (Lv2ëŠ” ë³€ë™ ì—†ìŒ)`,{duration:3e3,icon:"ðŸ”„"}),P&&g&&g({type:"points_recovered",data:{transaction:c}})}else if(n===3){console.log("âœ… [Lv3 í¬ì¸íŠ¸ íšŒìˆ˜] Lv3 balance ì¦ê°€");const b=l.invest_balance||0,_=m-t,{error:c}=await o.from("users").update({points:_,updated_at:new Date().toISOString()}).eq("id",s);if(c)throw c;const p=b+t,{error:w}=await o.from("partners").update({invest_balance:p,updated_at:new Date().toISOString()}).eq("id",r.user?.id);if(w)throw w;const{data:N,error:M}=await o.from("point_transactions").insert([{user_id:s,partner_id:r.user?.id,transaction_type:"use",amount:-t,points_before:m,points_after:_,memo:S||"ê´€ë¦¬ìž í¬ì¸íŠ¸ íšŒìˆ˜ (Lv3)"}]).select().single();M&&console.error("âŒ [í¬ì¸íŠ¸ íšŒìˆ˜] ê±°ëž˜ë‚´ì—­ ìƒì„± ì‹¤íŒ¨:",M),await o.from("partner_balance_logs").insert({partner_id:r.user?.id,balance_before:b,balance_after:p,amount:t,transaction_type:"admin_adjustment",processed_by:r.user?.id,memo:`í¬ì¸íŠ¸ íšŒìˆ˜: ${d.username} (${d.nickname})`}),i.success(`${t.toLocaleString()}Pê°€ íšŒìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤. (Lv3 balance ì¦ê°€)`,{duration:3e3,icon:"ðŸ”„"}),P&&g&&g({type:"points_recovered",data:{transaction:N}})}else{const b=l.balance||0,_=m-t,{error:c}=await o.from("users").update({points:_,updated_at:new Date().toISOString()}).eq("id",s);if(c)throw c;const p=b+t,{error:w}=await o.from("partners").update({balance:p,updated_at:new Date().toISOString()}).eq("id",r.user?.id);if(w)throw w;const{data:N,error:M}=await o.from("point_transactions").insert([{user_id:s,partner_id:r.user?.id,transaction_type:"use",amount:-t,points_before:m,points_after:_,memo:S||"ê´€ë¦¬ìž í¬ì¸íŠ¸ íšŒìˆ˜"}]).select().single();M&&console.error("âŒ [í¬ì¸íŠ¸ íšŒìˆ˜] ê±°ëž˜ë‚´ì—­ ìƒì„± ì‹¤íŒ¨:",M),await o.from("partner_balance_logs").insert({partner_id:r.user?.id,balance_before:b,balance_after:p,amount:t,transaction_type:"admin_adjustment",processed_by:r.user?.id,memo:`í¬ì¸íŠ¸ íšŒìˆ˜: ${d.username} (${d.nickname})`}),i.success(`${t.toLocaleString()}Pê°€ íšŒìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤. (ë³´ìœ ê¸ˆ: ${p.toLocaleString()}ì›)`,{duration:3e3,icon:"ðŸ”„"}),P&&g&&g({type:"points_recovered",data:{transaction:N}})}he(!1),L(""),B(""),k(""),R(),G()}catch(t){console.error("âŒ [í¬ì¸íŠ¸ íšŒìˆ˜] ì˜ˆìƒì¹˜ ëª»í•œ ì˜¤ë¥˜:",t),i.error("í¬ì¸íŠ¸ íšŒìˆ˜ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")}finally{h(!1)}},Ge=async()=>{try{if(!s||!T||parseFloat(T)<=0){i.error("ì‚¬ìš©ìžì™€ ìœ íš¨í•œ ì „í™˜ ê¸ˆì•¡ì„ ìž…ë ¥í•´ì£¼ì„¸ìš”.");return}h(!0);const t=parseFloat(T),{data:n,error:l}=await o.from("users").select("points, balance").eq("id",s).single();if(l)throw l;const x=n.points||0,d=n.balance||0;if(x<t){i.error("ë³´ìœ  í¬ì¸íŠ¸ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤.");return}const j=x-t,m=d+t,{error:b}=await o.from("users").update({points:j,balance:m,updated_at:new Date().toISOString()}).eq("id",s);if(b)throw b;const{data:_,error:c}=await o.from("point_transactions").insert([{user_id:s,partner_id:r.user?.id,transaction_type:"convert_to_balance",amount:t,points_before:x,points_after:j,memo:S||"í¬ì¸íŠ¸ -> ë³´ìœ ê¸ˆ ì „í™˜"}]).select().single();if(c)throw c;i.success(`${t.toLocaleString()}Pê°€ ë³´ìœ ê¸ˆìœ¼ë¡œ ì „í™˜ë˜ì—ˆìŠµë‹ˆë‹¤.`),xe(!1),L(""),O(""),k(""),P&&g&&g({type:"points_converted",data:{transaction:_}}),R(),G()}catch(t){console.error("í¬ì¸íŠ¸ ì „í™˜ ì˜¤ë¥˜:",t),i.error("í¬ì¸íŠ¸ ì „í™˜ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")}finally{h(!1)}},He=t=>({earn:a.pointManagement.typeEarn,use:a.pointManagement.typeUse,convert_to_balance:a.pointManagement.typeConvert,admin_adjustment:a.pointManagement.typeAdjustment})[t]||t,Ne=U.filter(t=>{const n=t.user_username.toLowerCase().includes(D.toLowerCase())||t.user_nickname.toLowerCase().includes(D.toLowerCase())||t.memo.toLowerCase().includes(D.toLowerCase()),l=I==="all"||t.transaction_type===I;return n&&l}),Qe=[{key:"user_username",header:a.pointManagement.username},{key:"user_nickname",header:a.pointManagement.nickname},{key:"transaction_type",header:a.pointManagement.transactionType,cell:t=>{const n=t.transaction_type,l={earn:"px-3 py-1 bg-gradient-to-r from-emerald-500/20 to-teal-500/20 text-emerald-400 border border-emerald-500/50 rounded-full shadow-[0_0_10px_rgba(16,185,129,0.5)]",use:"px-3 py-1 bg-gradient-to-r from-rose-500/20 to-red-500/20 text-rose-400 border border-rose-500/50 rounded-full shadow-[0_0_10px_rgba(244,63,94,0.5)]",convert_to_balance:"px-3 py-1 bg-gradient-to-r from-blue-500/20 to-cyan-500/20 text-blue-400 border border-blue-500/50 rounded-full shadow-[0_0_10px_rgba(59,130,246,0.5)]",admin_adjustment:"px-3 py-1 bg-gradient-to-r from-amber-500/20 to-orange-500/20 text-amber-400 border border-amber-500/50 rounded-full shadow-[0_0_10px_rgba(251,146,60,0.5)]"};return e.jsx(Ke,{className:l[n],children:He(n)})}},{key:"amount",header:a.pointManagement.amount,cell:t=>{const n=t.amount,l=t.transaction_type,x=l==="earn"||l==="admin_adjustment";return e.jsxs("span",{className:`font-mono font-semibold ${x?"text-emerald-400":"text-rose-400"}`,children:[x?"+":"-",Math.abs(n).toLocaleString(),"P"]})}},{key:"points_before",header:a.pointManagement.pointsBefore,cell:t=>e.jsxs("span",{className:"font-mono text-slate-400",children:[t.points_before.toLocaleString(),"P"]})},{key:"points_after",header:a.pointManagement.changedPoints,cell:t=>e.jsxs("span",{className:"font-mono font-semibold text-amber-400",children:[t.points_after.toLocaleString(),"P"]})},{key:"memo",header:a.pointManagement.memo,cell:t=>e.jsx("div",{className:"max-w-[200px] truncate text-slate-400",title:t.memo,children:t.memo})},{key:"partner_nickname",header:a.pointManagement.processor,cell:t=>e.jsx("span",{className:"text-cyan-400",children:t.partner_nickname})},{key:"created_at",header:a.pointManagement.processTime,cell:t=>{const n=new Date(t.created_at),l=n.getFullYear(),x=n.getMonth()+1,d=n.getDate(),j=n.getHours().toString().padStart(2,"0"),m=n.getMinutes().toString().padStart(2,"0");return e.jsxs("span",{className:"text-slate-400 text-sm",children:[l,". ",x,". ",d,". ",j,":",m]})}}],ye=U.filter(t=>t.transaction_type==="earn"||t.transaction_type==="admin_adjustment").reduce((t,n)=>t+n.amount,0),Se=U.filter(t=>t.transaction_type==="use"||t.transaction_type==="convert_to_balance").reduce((t,n)=>t+n.amount,0),ze=v.reduce((t,n)=>t+(n.points||0),0);return u.useEffect(()=>{R(),G()},[]),C&&U.length===0?e.jsx(Xe,{}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("h1",{className:"text-2xl font-bold text-slate-100 flex items-center gap-2",children:[e.jsx(Me,{className:"h-6 w-6 text-amber-400"}),a.pointManagement.title]}),e.jsx("p",{className:"text-muted-foreground",children:a.pointManagement.subtitle})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(Y,{open:Ae,onOpenChange:ge,children:[e.jsx(J,{asChild:!0,children:e.jsxs(f,{className:"btn-premium-warning",children:[e.jsx(de,{className:"h-4 w-4 mr-2"}),a.pointManagement.givePoints]})}),e.jsxs(K,{className:"sm:max-w-[550px]",children:[e.jsxs(X,{children:[e.jsxs(Z,{className:"flex items-center gap-2",children:[e.jsx(de,{className:"h-5 w-5 text-orange-500"}),a.pointManagement.givePointsTitle]}),e.jsx(ee,{children:a.pointManagement.givePointsDesc})]}),e.jsxs("div",{className:"grid gap-5 py-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(y,{htmlFor:"user",children:a.pointManagement.user}),e.jsxs(ie,{open:fe,onOpenChange:ve,children:[e.jsx(le,{asChild:!0,children:e.jsxs(f,{variant:"outline",role:"combobox","aria-expanded":fe,className:"justify-between input-premium h-10",children:[s?v.find(t=>t.id===s)?.username+" ("+v.find(t=>t.id===s)?.nickname+") - "+(v.find(t=>t.id===s)?.points||0).toLocaleString()+"P":a.pointManagement.selectUserMemoPlaceholder,e.jsx(me,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),e.jsx(ce,{className:"w-[480px] p-0 bg-slate-800 border-slate-700",children:e.jsxs(ae,{className:"bg-slate-800",children:[e.jsx(ne,{placeholder:a.pointManagement.searchUserPlaceholder,className:"h-9 text-slate-100 placeholder:text-slate-500"}),e.jsx(se,{className:"text-slate-400 py-6 text-center text-sm",children:a.pointManagement.userNotFound}),e.jsx(re,{className:"max-h-64 overflow-auto",children:v.map(t=>e.jsxs(oe,{value:`${t.username} ${t.nickname}`,onSelect:()=>{L(t.id),ve(!1)},className:"flex items-center justify-between cursor-pointer hover:bg-slate-700/50 text-slate-300",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(pe,{className:`mr-2 h-4 w-4 ${s===t.id?"opacity-100 text-orange-500":"opacity-0"}`}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-slate-100",children:t.username}),e.jsx("div",{className:"text-xs text-slate-400",children:t.nickname})]})]}),e.jsx("div",{className:"text-sm",children:e.jsxs("span",{className:"text-amber-400 font-mono",children:[t.points.toLocaleString(),"P"]})})]},t.id))})]})})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(y,{htmlFor:"amount",children:a.pointManagement.points}),e.jsx(f,{type:"button",variant:"ghost",size:"sm",onClick:Ie,className:"h-7 px-2 text-xs text-slate-400 hover:text-orange-400 hover:bg-orange-500/10",children:a.pointManagement.deleteAll})]}),e.jsx(H,{id:"amount",type:"number",value:A,onChange:t=>q(t.target.value),className:"input-premium",placeholder:a.pointManagement.enterGiveAmount})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(y,{className:"text-slate-400 text-sm",children:a.pointManagement.quickGive}),e.jsx("div",{className:"grid grid-cols-4 gap-2",children:z.map(t=>e.jsxs(f,{type:"button",variant:"outline",onClick:()=>Ee(t),className:"h-9 transition-all bg-slate-800/50 border-slate-700 text-slate-300 hover:bg-orange-500/20 hover:border-orange-500/60 hover:text-orange-400 hover:shadow-[0_0_15px_rgba(251,146,60,0.3)]",children:["+",t,"P"]},t))})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(y,{htmlFor:"memo",children:a.pointManagement.memo}),e.jsx(W,{id:"memo",value:S,onChange:t=>k(t.target.value),className:"input-premium min-h-[80px]",placeholder:a.pointManagement.giveMemoPlaceholder})]})]}),e.jsx(te,{children:e.jsx(f,{type:"submit",onClick:Oe,disabled:C,className:"btn-premium-warning w-full",children:C?a.pointManagement.processing:a.pointManagement.givePointsButton})})]})]}),e.jsxs(Y,{open:$e,onOpenChange:he,children:[e.jsx(J,{asChild:!0,children:e.jsxs(f,{className:"btn-premium-danger",children:[e.jsx(Pe,{className:"h-4 w-4 mr-2"}),a.pointManagement.recoverPoints]})}),e.jsxs(K,{className:"sm:max-w-[550px]",children:[e.jsxs(X,{children:[e.jsxs(Z,{className:"flex items-center gap-2",children:[e.jsx(Pe,{className:"h-5 w-5 text-red-500"}),a.pointManagement.recoverPointsTitle]}),e.jsx(ee,{children:a.pointManagement.recoverPointsDesc})]}),e.jsxs("div",{className:"grid gap-5 py-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(y,{htmlFor:"recover_user",children:a.pointManagement.user}),e.jsxs(ie,{open:je,onOpenChange:be,children:[e.jsx(le,{asChild:!0,children:e.jsxs(f,{variant:"outline",role:"combobox","aria-expanded":je,className:"justify-between input-premium h-10",children:[s?v.find(t=>t.id===s)?.username+" ("+v.find(t=>t.id===s)?.nickname+") - "+(v.find(t=>t.id===s)?.points||0).toLocaleString()+"P":a.pointManagement.selectUserPlaceholder,e.jsx(me,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),e.jsx(ce,{className:"w-[480px] p-0 bg-slate-800 border-slate-700",children:e.jsxs(ae,{className:"bg-slate-800",children:[e.jsx(ne,{placeholder:a.pointManagement.searchUserPlaceholder,className:"h-9 text-slate-100 placeholder:text-slate-500"}),e.jsx(se,{className:"text-slate-400 py-6 text-center text-sm",children:a.pointManagement.userNotFound}),e.jsx(re,{className:"max-h-64 overflow-auto",children:v.filter(t=>t.points>0).map(t=>e.jsxs(oe,{value:`${t.username} ${t.nickname}`,onSelect:()=>{L(t.id),be(!1)},className:"flex items-center justify-between cursor-pointer hover:bg-slate-700/50 text-slate-300",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(pe,{className:`mr-2 h-4 w-4 ${s===t.id?"opacity-100 text-red-500":"opacity-0"}`}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-slate-100",children:t.username}),e.jsx("div",{className:"text-xs text-slate-400",children:t.nickname})]})]}),e.jsx("div",{className:"text-sm",children:e.jsxs("span",{className:"text-amber-400 font-mono",children:[t.points.toLocaleString(),"P"]})})]},t.id))})]})})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(y,{htmlFor:"recover_amount",children:a.pointManagement.recoverAmount}),e.jsx(f,{type:"button",variant:"ghost",size:"sm",onClick:qe,className:"h-7 px-2 text-xs text-slate-400 hover:text-red-400 hover:bg-red-500/10",children:a.pointManagement.deleteAll})]}),e.jsx(H,{id:"recover_amount",type:"number",value:$,onChange:t=>B(t.target.value),className:"input-premium",placeholder:a.pointManagement.enterRecoverAmount})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(y,{className:"text-slate-400 text-sm",children:a.pointManagement.quickRecover}),e.jsx("div",{className:"grid grid-cols-4 gap-2",children:z.map(t=>e.jsxs(f,{type:"button",variant:"outline",onClick:()=>Ue(t),className:"h-9 transition-all bg-slate-800/50 border-slate-700 text-slate-300 hover:bg-red-500/20 hover:border-red-500/60 hover:text-red-400 hover:shadow-[0_0_15px_rgba(239,68,68,0.3)]",children:["+",t,"P"]},t))})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(y,{htmlFor:"recover_memo",children:a.pointManagement.memo}),e.jsx(W,{id:"recover_memo",value:S,onChange:t=>k(t.target.value),className:"input-premium min-h-[80px]",placeholder:a.pointManagement.recoverMemoPlaceholder})]})]}),e.jsx(te,{children:e.jsx(f,{type:"submit",onClick:Re,disabled:C,className:"btn-premium-danger w-full",children:C?a.pointManagement.processing:a.pointManagement.recoverPointsButton})})]})]}),e.jsxs(Y,{open:Te,onOpenChange:xe,children:[e.jsx(J,{asChild:!0,children:e.jsxs(f,{className:"btn-premium-primary",children:[e.jsx(Ce,{className:"h-4 w-4 mr-2"}),a.pointManagement.convertToBalance]})}),e.jsxs(K,{className:"sm:max-w-[550px]",children:[e.jsxs(X,{children:[e.jsxs(Z,{className:"flex items-center gap-2",children:[e.jsx(Ce,{className:"h-5 w-5 text-blue-500"}),a.pointManagement.convertToBalanceTitle]}),e.jsx(ee,{children:a.pointManagement.convertPointsDesc})]}),e.jsxs("div",{className:"grid gap-5 py-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(y,{htmlFor:"convert_user",children:a.pointManagement.user}),e.jsxs(ie,{open:_e,onOpenChange:we,children:[e.jsx(le,{asChild:!0,children:e.jsxs(f,{variant:"outline",role:"combobox","aria-expanded":_e,className:"justify-between input-premium h-10",children:[s?v.find(t=>t.id===s)?.username+" ("+v.find(t=>t.id===s)?.nickname+") - "+(v.find(t=>t.id===s)?.points||0).toLocaleString()+"P":a.pointManagement.selectUserPlaceholder,e.jsx(me,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),e.jsx(ce,{className:"w-[480px] p-0 bg-slate-800 border-slate-700",children:e.jsxs(ae,{className:"bg-slate-800",children:[e.jsx(ne,{placeholder:a.pointManagement.searchUserPlaceholder,className:"h-9 text-slate-100 placeholder:text-slate-500"}),e.jsx(se,{className:"text-slate-400 py-6 text-center text-sm",children:a.pointManagement.userNotFound}),e.jsx(re,{className:"max-h-64 overflow-auto",children:v.filter(t=>t.points>0).map(t=>e.jsxs(oe,{value:`${t.username} ${t.nickname}`,onSelect:()=>{L(t.id),we(!1)},className:"flex items-center justify-between cursor-pointer hover:bg-slate-700/50 text-slate-300",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(pe,{className:`mr-2 h-4 w-4 ${s===t.id?"opacity-100 text-blue-500":"opacity-0"}`}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-slate-100",children:t.username}),e.jsx("div",{className:"text-xs text-slate-400",children:t.nickname})]})]}),e.jsx("div",{className:"text-sm",children:e.jsxs("span",{className:"text-amber-400 font-mono",children:[t.points.toLocaleString(),"P"]})})]},t.id))})]})})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(y,{htmlFor:"convert_amount",children:a.pointManagement.convertAmount}),e.jsx(f,{type:"button",variant:"ghost",size:"sm",onClick:Be,className:"h-7 px-2 text-xs text-slate-400 hover:text-blue-400 hover:bg-blue-500/10",children:a.pointManagement.deleteAll})]}),e.jsx(H,{id:"convert_amount",type:"number",value:T,onChange:t=>O(t.target.value),className:"input-premium",placeholder:a.pointManagement.enterConvertAmount})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(y,{className:"text-slate-400 text-sm",children:a.pointManagement.quickConvert}),e.jsx("div",{className:"grid grid-cols-4 gap-2",children:z.map(t=>e.jsxs(f,{type:"button",variant:"outline",onClick:()=>Fe(t),className:"h-9 transition-all bg-slate-800/50 border-slate-700 text-slate-300 hover:bg-blue-500/20 hover:border-blue-500/60 hover:text-blue-400 hover:shadow-[0_0_15px_rgba(59,130,246,0.3)]",children:["+",t,"P"]},t))})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(y,{htmlFor:"convert_memo",children:a.pointManagement.memo}),e.jsx(W,{id:"convert_memo",value:S,onChange:t=>k(t.target.value),className:"input-premium min-h-[80px]",placeholder:a.pointManagement.convertMemoPlaceholder})]})]}),e.jsx(te,{children:e.jsx(f,{type:"submit",onClick:Ge,disabled:C,className:"btn-premium-primary w-full",children:C?a.pointManagement.processing:a.pointManagement.convertButton})})]})]})]})]}),e.jsxs("div",{className:"grid gap-5 md:grid-cols-4",children:[e.jsx(Q,{title:a.pointManagement.totalGivenPoints,value:`${ye.toLocaleString()}P`,subtitle:a.pointManagement.cumulativeGiven,icon:st,color:"green"}),e.jsx(Q,{title:a.pointManagement.totalUsedPoints,value:`${Se.toLocaleString()}P`,subtitle:a.pointManagement.cumulativeUsed,icon:rt,color:"red"}),e.jsx(Q,{title:a.pointManagement.pointsInSystem,value:`${ze.toLocaleString()}P`,subtitle:a.pointManagement.currentHolding,icon:Me,color:"orange"}),e.jsx(Q,{title:a.pointManagement.netPoints,value:`${(ye-Se).toLocaleString()}P`,subtitle:a.pointManagement.givenMinusUsed,icon:de,color:"purple"})]}),e.jsxs("div",{className:"glass-card rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6 pb-4 border-b border-slate-700/50",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-slate-100 mb-1",children:a.pointManagement.transactionHistory}),e.jsx("p",{className:"text-sm text-slate-400",children:a.pointManagement.totalTransactionsCount.replace("{{count}}",Ne.length.toLocaleString())})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"relative w-96",children:[e.jsx(ot,{className:"absolute left-3 top-2.5 h-4 w-4 text-slate-400"}),e.jsx(H,{placeholder:a.pointManagement.searchMemoPlaceholder,className:"pl-10 input-premium",value:D,onChange:t=>ke(t.target.value)})]}),e.jsxs(Ze,{value:I,onValueChange:De,children:[e.jsx(et,{className:"w-[180px] input-premium",children:e.jsx(tt,{placeholder:a.pointManagement.typeFilter})}),e.jsxs(at,{className:"bg-slate-800 border-slate-700",children:[e.jsx(F,{value:"all",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-slate-500"}),a.pointManagement.allTypes]})}),e.jsx(F,{value:"earn",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-emerald-500"}),a.pointManagement.typeEarn]})}),e.jsx(F,{value:"use",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-rose-500"}),a.pointManagement.typeUse]})}),e.jsx(F,{value:"convert_to_balance",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-blue-500"}),a.pointManagement.typeConvert]})}),e.jsx(F,{value:"admin_adjustment",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-amber-500"}),a.pointManagement.typeAdjustment]})})]})]})]})]}),e.jsx(nt,{columns:Qe,data:Ne,searchable:!1,loading:C,emptyMessage:D||I!=="all"?a.pointManagement.noSearchResults:a.pointManagement.noTransactionHistory})]})]})}export{_t as PointManagement,_t as default};
