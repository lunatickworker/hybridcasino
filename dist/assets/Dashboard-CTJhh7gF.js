import{r as d,j as e}from"./react-core-BwkdTuSg.js";import{s as o,u as fe,a as xe,g as _e,B as ye,f as ve}from"./index-CGvwOXPh.js";import{M as q}from"./MetricCard-Bg9coGoy.js";import{U as A,S as p}from"./UnifiedCard-DCP7c5YG.js";import{k as we}from"./vendor-D410aui4.js";import{c as je}from"./settlementCalculator-BoiNnd7Z.js";import{V as Ce,U as Se,A as De,a8 as Y,a9 as Z,T as F,j as oe,aa as L,ab as ne,S as re}from"./lucide-icons-CAeZOOE5.js";import"./radix-ui-omyR4zpf.js";import"./supabase-C8Oa5ukG.js";const X=new Map;async function Ne(r,v){const D=`${r}_${v}`;if(X.has(D))return X.get(D);try{let m=9;if(v===1){const{data:a,error:n}=await o.from("system_settings").select("setting_value").eq("setting_key","timezone_offset").maybeSingle();!n&&a&&(m=parseInt(a.setting_value))}else if(v===2){const{data:a,error:n}=await o.from("partners").select("timezone_offset").eq("id",r).maybeSingle();if(!n&&a&&a.timezone_offset!==null)m=a.timezone_offset;else{const{data:g,error:u}=await o.from("system_settings").select("setting_value").eq("setting_key","timezone_offset").maybeSingle();!u&&g&&(m=parseInt(g.setting_value))}}else{let a=r;for(;;){const{data:n,error:g}=await o.from("partners").select("parent_id").eq("id",a).maybeSingle();if(g||!n||!n.parent_id)break;const{data:u,error:b}=await o.from("partners").select("level, timezone_offset").eq("id",n.parent_id).maybeSingle();if(b||!u)break;if(u.level===2){if(u.timezone_offset!==null)m=u.timezone_offset;else{const{data:N,error:f}=await o.from("system_settings").select("setting_value").eq("setting_key","timezone_offset").maybeSingle();!f&&N&&(m=parseInt(N.setting_value))}break}a=n.parent_id}}return X.set(D,m),m}catch(m){return console.error("âŒ [Timezone] ì˜¤í”„ì…‹ ì¡°íšŒ ì‹¤íŒ¨:",m),9}}async function Te(r,v){const D=await Ne(r,v),m=new Date,a=D*60*60*1e3,n=new Date(m.getTime()+a),g=n.getUTCFullYear(),u=n.getUTCMonth(),b=n.getUTCDate(),N=n.getUTCHours(),f=n.getUTCMinutes(),$=n.getUTCSeconds();return new Date(g,u,b,N,f,$).toLocaleString("ko-KR")}function He({user:r}){const{balance:v,investBalance:D,oroplayBalance:m}=fe(),{t:a,formatCurrency:n}=xe(),[g,u]=d.useState({total_users:0,total_balance:0,daily_deposit:0,daily_withdrawal:0,daily_net_deposit:0,casino_betting:0,slot_betting:0,total_betting:0,online_users:0,pending_approvals:0,pending_messages:0,pending_deposits:0,pending_withdrawals:0}),[b,N]=d.useState({deposit:0,withdrawal:0,netDeposit:0,casinoBetting:0,slotBetting:0,totalBetting:0}),[f,$]=d.useState({deposit:0,withdrawal:0,netDeposit:0,casinoBetting:0,slotBetting:0,totalBetting:0}),[G,ie]=d.useState(0),[Be,J]=d.useState(!0),[Ie,le]=d.useState(new Date),[ce,de]=d.useState(""),[Pe,Ue]=d.useState(!1),[Ee,ke]=d.useState(!1);if(d.useEffect(()=>{u(c=>({...c,total_balance:v}))},[v]),!r||typeof r.level!="number")return e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("div",{className:"loading-premium mx-auto"}),e.jsx("p",{className:"text-muted-foreground",children:a.dashboard.loadingDashboard})]})});const T=async()=>{try{J(!0),console.log("============================================"),console.log("ðŸ“Š ëŒ€ì‹œë³´ë“œ í†µê³„ ì¡°íšŒ ì‹œìž‘"),console.log("Partner ID:",r.id),console.log("Partner Level:",r.level),console.log("Partner Type:",r.partner_type),console.log("============================================");const c=new Date;c.setHours(0,0,0,0),console.log("ðŸ” ì§ì ‘ DB ì¡°íšŒ ì‹œìž‘...");const{data:x,error:E}=await o.from("transactions").select("transaction_type, status, amount, created_at").gte("created_at",c.toISOString());if(console.log("ðŸ“Š ì˜¤ëŠ˜ transactions:",x?.length||0,"ê±´"),x&&x.length>0){console.log("ìƒì„¸:",x);const s=x.filter(t=>t.transaction_type==="deposit"&&["approved","completed"].includes(t.status)||t.transaction_type==="admin_adjustment"&&t.amount>0&&["approved","completed"].includes(t.status)).reduce((t,l)=>t+Number(l.amount),0),i=x.filter(t=>t.transaction_type==="withdrawal"&&["approved","completed"].includes(t.status)||t.transaction_type==="admin_adjustment"&&t.amount<0&&["approved","completed"].includes(t.status)).reduce((t,l)=>t+Math.abs(Number(l.amount)),0);console.log("ðŸ’° ì§ì ‘ ê³„ì‚° ìž…ê¸ˆ:",s),console.log("ðŸ’¸ ì§ì ‘ ê³„ì‚° ì¶œê¸ˆ:",i)}const{data:w,error:j}=await o.from("game_records").select("provider_id, bet_amount, played_at").gte("played_at",c.toISOString());if(console.log("ðŸŽ® ì˜¤ëŠ˜ game_records:",w?.length||0,"ê±´"),w&&w.length>0){console.log("ìƒì„¸:",w);const s=[410,77,2,30,78,86,11,28,89,91,44,85,0],i=w.filter(l=>s.includes(Number(l.provider_id))).reduce((l,S)=>l+Number(S.bet_amount),0),t=w.filter(l=>!s.includes(Number(l.provider_id))).reduce((l,S)=>l+Number(S.bet_amount),0);console.log("ðŸŽ° ì§ì ‘ ê³„ì‚° ì¹´ì§€ë…¸:",i),console.log("ðŸŽ² ì§ì ‘ ê³„ì‚° ìŠ¬ë¡¯:",t)}console.log(""),console.log("ðŸ”§ ì§ì ‘ SELECT ì¿¼ë¦¬ ì‹œìž‘ (RPC ì œê±°)...");const k=new Date,C=new Date(k.getFullYear(),k.getMonth(),k.getDate()).toISOString();console.log("ðŸ“… ì˜¤ëŠ˜ ì‹œìž‘ ì‹œê° (UTC):",C),console.log("ðŸ“… í˜„ìž¬ ì‹œê° (ë¡œì»¬):",k.toLocaleString("ko-KR",{timeZone:"Asia/Seoul"}));let h=[];if(r.level===1){const{data:s}=await o.from("partners").select("id");h=s?.map(i=>i.id)||[]}else{h=[r.id];const{data:s}=await o.from("partners").select("id").eq("parent_id",r.id),i=s?.map(t=>t.id)||[];if(h.push(...i),i.length>0){const{data:t}=await o.from("partners").select("id").in("parent_id",i),l=t?.map(S=>S.id)||[];if(h.push(...l),l.length>0){const{data:S}=await o.from("partners").select("id").in("parent_id",l),W=S?.map(H=>H.id)||[];if(h.push(...W),W.length>0){const{data:H}=await o.from("partners").select("id").in("parent_id",W),K=H?.map(V=>V.id)||[];if(h.push(...K),K.length>0){const{data:V}=await o.from("partners").select("id").in("parent_id",K),he=V?.map(be=>be.id)||[];h.push(...he)}}}}}console.log("ðŸ‘¥ í•˜ìœ„ íŒŒíŠ¸ë„ˆ ID ê°œìˆ˜:",h.length);let _=[];const{data:me}=await o.from("users").select("id").eq("referrer_id",r.id);_=me?.map(s=>s.id)||[],console.log("ðŸ‘¤ ì§ì† íšŒì› ID ê°œìˆ˜:",_.length);let y=[];const Q=h.filter(s=>s!==r.id);if(Q.length>0){const{data:s}=await o.from("users").select("id").in("referrer_id",Q);y=s?.map(i=>i.id)||[],console.log("ðŸ‘¥ í•˜ìœ„ íŒŒíŠ¸ë„ˆ íšŒì› ID ê°œìˆ˜:",y.length)}let R=0;if(_.length>0){const{data:s}=await o.from("transactions").select("amount, created_at").in("transaction_type",["deposit","admin_deposit"]).in("status",["approved","completed"]).in("user_id",_).gte("created_at",C);console.log("ðŸ’° ì§ì† íšŒì› ìž…ê¸ˆ ë°ì´í„°:",s),R=s?.reduce((i,t)=>i+Number(t.amount),0)||0}let z=0;if(_.length>0){const{data:s}=await o.from("transactions").select("amount, created_at").in("transaction_type",["withdrawal","admin_withdrawal"]).in("status",["approved","completed"]).in("user_id",_).gte("created_at",C);console.log("ðŸ’¸ ì§ì† íšŒì› ì¶œê¸ˆ ë°ì´í„°:",s),z=s?.reduce((i,t)=>i+Number(t.amount),0)||0}let O=0;if(y.length>0){const{data:s}=await o.from("transactions").select("amount, created_at").in("transaction_type",["deposit","admin_deposit"]).in("status",["approved","completed"]).in("user_id",y).gte("created_at",C);console.log("ðŸ’° í•˜ìœ„ íŒŒíŠ¸ë„ˆ íšŒì› ìž…ê¸ˆ ë°ì´í„°:",s),O=s?.reduce((i,t)=>i+Number(t.amount),0)||0}let M=0;if(y.length>0){const{data:s}=await o.from("transactions").select("amount, created_at").in("transaction_type",["withdrawal","admin_withdrawal"]).in("status",["approved","completed"]).in("user_id",y).gte("created_at",C);console.log("ðŸ’¸ í•˜ìœ„ íŒŒíŠ¸ë„ˆ íšŒì› ì¶œê¸ˆ ë°ì´í„°:",s),M=s?.reduce((i,t)=>i+Number(t.amount),0)||0}let ee=0;if(h.length>0){const{count:s}=await o.from("users").select("id",{count:"exact",head:!0}).in("referrer_id",h);ee=s||0}let te=0;const{count:ge}=await o.from("game_launch_sessions").select("*",{count:"exact",head:!0}).eq("status","active");te=ge||0;const pe=[..._,...y],ue=await je(pe,C,new Date().toISOString());let B=0,I=0;if(_.length>0){const{data:s}=await o.from("game_records").select("provider_id, bet_amount").in("user_id",_).gte("played_at",C);if(s&&s.length>0){const i=[410,77,2,30,78,86,11,28,89,91,44,85,0];B=s.filter(t=>i.includes(Number(t.provider_id))).reduce((t,l)=>t+Number(l.bet_amount||0),0),I=s.filter(t=>!i.includes(Number(t.provider_id))).reduce((t,l)=>t+Number(l.bet_amount||0),0)}}let P=0,U=0;if(y.length>0){const{data:s}=await o.from("game_records").select("provider_id, bet_amount").in("user_id",y).gte("played_at",C);if(s&&s.length>0){const i=[410,77,2,30,78,86,11,28,89,91,44,85,0];P=s.filter(t=>i.includes(Number(t.provider_id))).reduce((t,l)=>t+Number(l.bet_amount||0),0),U=s.filter(t=>!i.includes(Number(t.provider_id))).reduce((t,l)=>t+Number(l.bet_amount||0),0)}}const ae=R+O,se=z+M;u(s=>({...s,total_users:ee||0,daily_deposit:ae,daily_withdrawal:se,daily_net_deposit:ae-se,online_users:te||0,casino_betting:B+P,slot_betting:I+U,total_betting:B+I+P+U,pending_approvals:0,pending_messages:0,pending_deposits:0,pending_withdrawals:0})),N({deposit:R,withdrawal:z,netDeposit:R-z,casinoBetting:B,slotBetting:I,totalBetting:B+I}),$({deposit:O,withdrawal:M,netDeposit:O-M,casinoBetting:P,slotBetting:U,totalBetting:P+U}),ie(ue),console.log(""),console.log("âœ… ëŒ€ì‹œë³´ë“œ í†µê³„ ì—…ë°ì´íŠ¸ ì™„ë£Œ (RPC ì—†ìŒ)"),console.log("============================================")}catch(c){console.error(""),console.error("============================================"),console.error("âŒ ëŒ€ì‹œë³´ë“œ í†µê³„ ë¡œë”© ì˜¤ë¥˜"),console.error("Error:",c),console.error("Message:",c?.message),console.error("Details:",c?.details),console.error("Hint:",c?.hint),console.error("============================================"),we.error("ëŒ€ì‹œë³´ë“œ í†µê³„ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: "+(c?.message||"ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜"))}finally{J(!1)}};return d.useEffect(()=>{T()},[]),d.useEffect(()=>{const c=async()=>{const E=await Te(r.id,r.level);de(E)};c();const x=setInterval(()=>{le(new Date),c()},1e3);return()=>clearInterval(x)},[r.id,r.level]),d.useEffect(()=>{console.log("ðŸ”” ëŒ€ì‹œë³´ë“œ Realtime êµ¬ë… ì‹œìž‘:",r.id);const c=o.channel("dashboard_transactions").on("postgres_changes",{event:"*",schema:"public",table:"transactions"},j=>{console.log("ðŸ’° [ëŒ€ì‹œë³´ë“œ] transactions ë³€ê²½ ê°ì§€:",j.eventType),T()}).subscribe(),x=o.channel("dashboard_partners").on("postgres_changes",{event:"UPDATE",schema:"public",table:"partners",filter:`id=eq.${r.id}`},j=>{console.log("ðŸ’° [ëŒ€ì‹œë³´ë“œ] partners ë³´ìœ ê¸ˆ ë³€ê²½ ê°ì§€:",j.new),T()}).subscribe(),E=o.channel("dashboard_game_records").on("postgres_changes",{event:"INSERT",schema:"public",table:"game_records"},j=>{console.log("ðŸŽ® [ëŒ€ì‹œë³´ë“œ] game_records ë³€ê²½ ê°ì§€:",j.eventType),T()}).subscribe(),w=o.channel("dashboard_users").on("postgres_changes",{event:"UPDATE",schema:"public",table:"users"},j=>{console.log("ðŸ‘¤ [ëŒ€ì‹œë³´ë“œ] users ë³€ê²½ ê°ì§€:",j.eventType),T()}).subscribe();return()=>{console.log("ðŸ”• ëŒ€ì‹œë³´ë“œ Realtime êµ¬ë… í•´ì œ"),o.removeChannel(c),o.removeChannel(x),o.removeChannel(E),o.removeChannel(w)}},[r.id]),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row items-start md:items-center justify-between gap-4 mb-8",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-100",children:a.dashboard.adminDashboard}),e.jsxs("p",{className:"text-sm text-slate-400",children:[_e(r.level)," Â· ",r.nickname,a.dashboard.realtimeStatus]})]}),e.jsxs(ye,{variant:"outline",className:"flex items-center gap-2 px-3 py-1.5 text-xs badge-premium-primary",children:[e.jsx(Ce,{className:"h-3.5 w-3.5"}),ce]})]}),e.jsxs("div",{className:"grid gap-5 md:grid-cols-2 lg:grid-cols-4",children:[e.jsx(q,{title:a.dashboard.totalUsers,value:ve(g.total_users),subtitle:`â†‘ ${a.dashboard.registeredUsers}`,icon:Se,color:"blue"}),e.jsx(q,{title:a.dashboard.todayNetRevenue,value:n(g.daily_net_deposit),subtitle:g.daily_net_deposit>=0?`â†‘ ${a.dashboard.profitToday}`:`â†“ ${a.dashboard.lossToday}`,icon:De,color:g.daily_net_deposit>=0?"green":"pink"}),e.jsx(q,{title:a.dashboard.todayTotalBetting,value:n(g.total_betting),subtitle:`â†‘ ${a.dashboard.customerActivity}`,icon:Y,color:"purple"}),e.jsx(q,{title:a.dashboard.pendingCharges,value:n(G),subtitle:`â†‘ ${a.dashboard.pendingChargesDesc}`,icon:Z,color:"orange"})]}),e.jsxs("div",{className:"grid gap-5 md:grid-cols-2",children:[e.jsxs(A,{title:a.dashboard.directUserTransactions,icon:F,iconColor:"text-cyan-400",children:[e.jsx(p,{label:a.dashboard.dailyDeposit,value:n(b.deposit),valueColor:"text-cyan-400",icon:F,iconColor:"text-cyan-400"}),e.jsx(p,{label:a.dashboard.dailyWithdrawal,value:n(b.withdrawal),valueColor:"text-rose-400",icon:oe,iconColor:"text-rose-400"}),e.jsx(p,{label:a.dashboard.dailyNetDeposit,value:n(b.netDeposit),valueColor:"text-cyan-400",icon:Z,iconColor:"text-cyan-400"})]}),e.jsxs(A,{title:a.dashboard.directUserBetting,icon:L,iconColor:"text-amber-400",children:[e.jsx(p,{label:a.dashboard.casinoTotalBetting,value:n(b.casinoBetting),valueColor:"text-cyan-400",icon:Y,iconColor:"text-cyan-400"}),e.jsx(p,{label:a.dashboard.slotTotalBetting,value:n(b.slotBetting),valueColor:"text-amber-400",icon:L,iconColor:"text-amber-400"}),e.jsx(p,{label:a.dashboard.totalBetting,value:n(b.totalBetting),valueColor:"text-cyan-400",icon:ne,iconColor:"text-cyan-400"})]}),e.jsxs(A,{title:a.dashboard.subPartnerTransactions,icon:F,iconColor:"text-purple-400",children:[e.jsx(p,{label:a.dashboard.dailyDeposit,value:n(f.deposit),valueColor:"text-cyan-400",icon:F,iconColor:"text-cyan-400"}),e.jsx(p,{label:a.dashboard.dailyWithdrawal,value:n(f.withdrawal),valueColor:"text-rose-400",icon:oe,iconColor:"text-rose-400"}),e.jsx(p,{label:a.dashboard.dailyNetDeposit,value:n(f.netDeposit),valueColor:"text-cyan-400",icon:Z,iconColor:"text-cyan-400"})]}),e.jsxs(A,{title:a.dashboard.subPartnerBetting,icon:L,iconColor:"text-green-400",children:[e.jsx(p,{label:a.dashboard.casinoTotalBetting,value:n(f.casinoBetting),valueColor:"text-cyan-400",icon:Y,iconColor:"text-cyan-400"}),e.jsx(p,{label:a.dashboard.slotTotalBetting,value:n(f.slotBetting),valueColor:"text-amber-400",icon:L,iconColor:"text-amber-400"}),e.jsx(p,{label:a.dashboard.totalBetting,value:n(f.totalBetting),valueColor:"text-cyan-400",icon:ne,iconColor:"text-cyan-400"})]})]}),r.level===1&&e.jsx("div",{className:"mt-8 p-6 bg-gradient-to-r from-red-900/20 via-red-800/20 to-red-900/20 border-2 border-yellow-600/50 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-16 h-16 rounded-lg bg-gradient-to-br from-red-700 to-red-900 flex items-center justify-center border-2 border-yellow-600",children:e.jsx(re,{className:"w-8 h-8 text-yellow-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl",style:{fontFamily:"Impact, sans-serif",color:"#fff",letterSpacing:"0.1em",textShadow:"2px 2px 4px rgba(0,0,0,0.8)"},children:"MARVEL THEME CASINO"}),e.jsx("p",{className:"text-gray-400 text-sm mt-1",children:a.dashboard.marvelThemeDescription})]})]}),e.jsx("button",{onClick:()=>{window.location.hash="#/sample1"},className:"px-6 py-3 bg-gradient-to-r from-yellow-600 to-yellow-700 text-black rounded-md border-2 border-yellow-400 hover:from-yellow-500 hover:to-yellow-600 transition-all duration-200",style:{boxShadow:"0 0 20px rgba(234, 179, 8, 0.4)"},children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{style:{fontFamily:"Impact, sans-serif",letterSpacing:"0.05em"},children:a.dashboard.experience}),e.jsx("span",{children:"â†’"})]})})]})}),r.level===1&&e.jsx("div",{className:"mt-6 p-6 bg-gradient-to-r from-orange-900/20 via-amber-900/20 to-orange-900/20 border-2 border-orange-500/50 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-16 h-16 rounded-lg bg-gradient-to-br from-orange-600 to-amber-700 flex items-center justify-center border-2 border-orange-400",children:e.jsx(re,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl",style:{fontFamily:"Impact, sans-serif",color:"#fff",letterSpacing:"0.1em",textShadow:"2px 2px 4px rgba(0,0,0,0.8)"},children:"INDO CASINO"}),e.jsx("p",{className:"text-gray-400 text-sm mt-1",children:"Experience Indonesian themed casino"})]})]}),e.jsx("button",{onClick:()=>{window.location.hash="#/indo"},className:"px-6 py-3 bg-gradient-to-r from-orange-500 to-amber-600 text-white rounded-md border-2 border-orange-400 hover:from-orange-400 hover:to-amber-500 transition-all duration-200",style:{boxShadow:"0 0 20px rgba(249, 115, 22, 0.4)"},children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{style:{fontFamily:"Impact, sans-serif",letterSpacing:"0.05em"},children:"EXPLORE"}),e.jsx("span",{children:"â†’"})]})})]})})]})}export{He as Dashboard,He as default};
