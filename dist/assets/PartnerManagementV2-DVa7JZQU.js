import{j as e,r as i}from"./react-core-BwkdTuSg.js";import{s as o,a as Ze,L as A,S as Le,o as Ce,p as ke,q as Te,r as D,I as Y,h as W,B as K,m as wa,n as ya,l as sa,T as ja,i as Sa,j as ia,k as la,C as Z,E as U,F as ee,e as ae,G as oa}from"./index-CGvwOXPh.js";import{A as ga,a as ha,b as fa,c as xa,d as _a,e as ba}from"./AdminDialog-CFXz2Dfn.js";import{k as y}from"./vendor-D410aui4.js";import{a3 as Na,a9 as Me,ap as Ma,N as La,f as J,S as pe,n as Ca,w as ka,g as ca,h as da,T as Ta,U as ma,aq as pa,_ as Da}from"./lucide-icons-CAeZOOE5.js";import{M as q}from"./MetricCard-Bg9coGoy.js";import{F as $a}from"./ForceTransactionModal-O0UljU0D.js";import"./radix-ui-omyR4zpf.js";import"./supabase-C8Oa5ukG.js";import"./popover-zgyRlH_H.js";import"./command-CChhJe2s.js";const Ba=async({transferTargetPartner:a,currentUserId:n,amount:r,transferMode:l,transferMemo:h=""})=>{const{data:g,error:c}=await o.from("partners").select("balance, nickname, partner_type, level").eq("id",n).single();if(c)throw c;const s=g.level===1;if(l==="withdrawal"){const{data:v,error:S}=await o.from("partners").select("balance").eq("id",a.id).single();if(S)throw S;if(v.balance<r)throw new Error(`TARGET_BALANCE_INSUFFICIENT:${v.balance}`)}if(l==="deposit"&&!s&&g.balance<r)throw new Error(`BALANCE_LOW:${g.balance}`);if(l==="deposit"&&g.level===2&&a.partner_type==="main_office"){const{data:v,error:S}=await o.from("partners").select("balance").eq("parent_id",n).eq("partner_type","main_office");if(S)throw console.error("[Child Main Office Fetch Error]:",S),S;const w=(v||[]).reduce((d,b)=>d+(b.balance||0),0),f=w+r;if(console.log("ğŸ’° [ëŒ€ë³¸ì‚¬â†’ë³¸ì‚¬ ì§€ê¸‰ ê²€ì¦]",{ëŒ€ë³¸ì‚¬_ë³´ìœ ê¸ˆ:g.balance,í˜„ì¬_í•˜ìœ„ë³¸ì‚¬_ë³´ìœ ê¸ˆí•©ê³„:w,ì§€ê¸‰ì•¡:r,ì§€ê¸‰í›„_í•˜ìœ„ë³¸ì‚¬_ë³´ìœ ê¸ˆí•©ê³„:f,ì´ˆê³¼ì—¬ë¶€:f>g.balance}),f>g.balance)throw new Error(`CHILD_BALANCE_EXCEEDS:${w}:${f}:${g.balance}`)}console.log("âœ… [íŒŒíŠ¸ë„ˆ ë³´ìœ ê¸ˆ ì…ì¶œê¸ˆ] ì™¸ë¶€ API í˜¸ì¶œ ê±´ë„ˆëœ€ - ë‚´ë¶€ DBë§Œ ì²˜ë¦¬ (GMS ë¨¸ë‹ˆ ì‹œìŠ¤í…œ)");let u=g.balance,C=a.balance;if(l==="deposit"){if(!s){u=g.balance-r;const{error:S}=await o.from("partners").update({balance:u,updated_at:new Date().toISOString()}).eq("id",n);if(S)throw S;await o.from("partner_balance_logs").insert({partner_id:n,balance_before:g.balance,balance_after:u,amount:-r,transaction_type:"withdrawal",from_partner_id:n,to_partner_id:a.id,processed_by:n,memo:`[ë³´ìœ ê¸ˆ ì§€ê¸‰] ${a.nickname}ì—ê²Œ ${r.toLocaleString()}ì› ì§€ê¸‰${h?`: ${h}`:""}`})}C=a.balance+r;const{error:v}=await o.from("partners").update({balance:C,updated_at:new Date().toISOString()}).eq("id",a.id);if(v)throw v;await o.from("partner_balance_logs").insert({partner_id:a.id,balance_before:a.balance,balance_after:C,amount:r,transaction_type:"deposit",from_partner_id:s?null:n,to_partner_id:a.id,processed_by:n,memo:`[ë³´ìœ ê¸ˆ ìˆ˜ì‹ ] ${g.nickname}ìœ¼ë¡œë¶€í„° ${r.toLocaleString()}ì› ìˆ˜ì‹ ${h?`: ${h}`:""}`})}else{C=a.balance-r;const{error:v}=await o.from("partners").update({balance:C,updated_at:new Date().toISOString()}).eq("id",a.id);if(v)throw v;if(await o.from("partner_balance_logs").insert({partner_id:a.id,balance_before:a.balance,balance_after:C,amount:-r,transaction_type:"withdrawal",from_partner_id:a.id,to_partner_id:s?null:n,processed_by:n,memo:`[ë³´ìœ ê¸ˆ íšŒìˆ˜] ${g.nickname}ì´(ê°€) ${r.toLocaleString()}ì› íšŒìˆ˜${h?`: ${h}`:""}`}),!s){u=g.balance+r;const{error:S}=await o.from("partners").update({balance:u,updated_at:new Date().toISOString()}).eq("id",n);if(S)throw S;await o.from("partner_balance_logs").insert({partner_id:n,balance_before:g.balance,balance_after:u,amount:r,transaction_type:"deposit",from_partner_id:a.id,to_partner_id:n,processed_by:n,memo:`[ë³´ìœ ê¸ˆ íšŒìˆ˜] ${a.nickname}ìœ¼ë¡œë¶€í„° ${r.toLocaleString()}ì› íšŒìˆ˜${h?`: ${h}`:""}`})}}return{success:!0,senderNewBalance:u,receiverNewBalance:C}};function Ea({open:a,onOpenChange:n,targetPartner:r,transferMode:l,setTransferMode:h,transferAmount:g,setTransferAmount:c,transferMemo:s,setTransferMemo:u,transferLoading:C,currentUserId:v,onSuccess:S,onWebSocketUpdate:w}){const{t:f}=Ze(),d=async()=>{if(!r||!v)return;const b=parseFloat(g);if(!b||b<=0){const x=l==="deposit"?f.partnerManagement.depositLabel:f.partnerManagement.withdrawalLabel;y.error(f.partnerManagement.depositOrWithdrawalAmountInvalid.replace("{{type}}",x));return}try{await Ba({transferTargetPartner:r,currentUserId:v,amount:b,transferMode:l,transferMemo:s});const x=l==="deposit"?"ì§€ê¸‰":"íšŒìˆ˜";y.success(`${r.nickname}ì—ê²Œ ${b.toLocaleString()}ì› ${x} ì™„ë£Œ`,{duration:3e3,icon:"ğŸ’°"}),w&&w({type:"partner_balance_transfer",data:{from:v,to:r.id,amount:b,mode:l}}),S(),n(!1)}catch(x){if(console.error("[Partner Balance Transfer Error]:",x),x.message?.includes("TARGET_BALANCE_INSUFFICIENT")){const T=x.message.split(":")[1];y.error(f.partnerManagement.targetBalanceInsufficientError.replace("{{balance}}",parseInt(T).toLocaleString()))}else if(x.message?.includes("BALANCE_LOW")){const T=x.message.split(":")[1];y.error(f.partnerManagement.balanceLowError.replace("{{balance}}",parseInt(T).toLocaleString()))}else if(x.message?.includes("CHILD_BALANCE_EXCEEDS")){const T=x.message.split(":"),m=T[1],p=T[2],N=T[3];y.error(`í•˜ìœ„ ë³¸ì‚¬ë“¤ì˜ ë³´ìœ ê¸ˆ í•©ê³„ê°€ ëŒ€ë³¸ì‚¬ ë³´ìœ ê¸ˆì„ ì´ˆê³¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
í˜„ì¬ í•˜ìœ„ ë³¸ì‚¬ ë³´ìœ ê¸ˆ í•©ê³„: ${parseInt(m).toLocaleString()}ì›
ì§€ê¸‰ í›„ í•©ê³„: ${parseInt(p).toLocaleString()}ì›
ëŒ€ë³¸ì‚¬ ë³´ìœ ê¸ˆ: ${parseInt(N).toLocaleString()}ì›`,{duration:5e3})}else{const T=l==="deposit"?f.partnerManagement.depositLabel:f.partnerManagement.withdrawalLabel;y.error(`${T} failed`)}}};return e.jsx(ga,{open:a,onOpenChange:n,children:e.jsxs(ha,{className:"sm:max-w-[500px]",children:[e.jsxs(fa,{children:[e.jsx(xa,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Na,{className:"h-5 w-5"}),f.partnerManagement.partnerBalanceTransfer]})}),e.jsx(_a,{children:"í•˜ìœ„ íŒŒíŠ¸ë„ˆì—ê²Œ GMS ë¨¸ë‹ˆë¥¼ ì§€ê¸‰í•˜ê±°ë‚˜ íšŒìˆ˜í•©ë‹ˆë‹¤."})]}),r&&e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(A,{children:f.partnerManagement.targetPartner}),e.jsx("div",{className:"mt-1 text-sm",children:r.nickname})]}),e.jsxs("div",{children:[e.jsx(A,{children:f.partnerManagement.currentBalance}),e.jsxs("div",{className:"mt-1 text-sm",children:[r.balance.toLocaleString(),"ì›"]})]})]}),e.jsxs("div",{children:[e.jsx(A,{htmlFor:"transfer-mode",children:f.partnerManagement.transactionType}),e.jsxs(Le,{value:l,onValueChange:b=>h(b),children:[e.jsx(Ce,{id:"transfer-mode",children:e.jsx(ke,{})}),e.jsxs(Te,{children:[e.jsx(D,{value:"deposit",children:f.partnerManagement.depositLabel}),e.jsx(D,{value:"withdrawal",children:f.partnerManagement.withdrawalLabel})]})]})]}),e.jsxs("div",{children:[e.jsx(A,{htmlFor:"transfer-amount",children:f.partnerManagement.amount}),e.jsx(Y,{id:"transfer-amount",type:"number",value:g,onChange:b=>c(b.target.value),placeholder:"ê¸ˆì•¡ ì…ë ¥"})]}),e.jsxs("div",{children:[e.jsx(A,{htmlFor:"transfer-memo",children:f.partnerManagement.memo}),e.jsx(Y,{id:"transfer-memo",type:"text",value:s,onChange:b=>u(b.target.value),placeholder:"ë©”ëª¨ ì…ë ¥ (ì„ íƒì‚¬í•­)"})]})]}),e.jsxs(ba,{children:[e.jsx(W,{variant:"outline",onClick:()=>n(!1),children:f.partnerManagement.cancel}),e.jsx(W,{onClick:d,disabled:C,children:C?f.partnerManagement.processing:f.partnerManagement.confirm})]})]})})}function ua({open:a,onOpenChange:n,mode:r,partner:l,userLevel:h,onSuccess:g,onWebSocketUpdate:c}){const{t:s}=Ze(),[u,C]=i.useState(!1),[v,S]=i.useState(""),[w,f]=i.useState(null),[d,b]=i.useState({username:"",nickname:"",password:"",partner_type:"head_office",parent_id:"",opcode:"",secret_key:"",api_token:"",commission_rolling:.5,commission_losing:5,withdrawal_fee:1,min_withdrawal_amount:1e4,max_withdrawal_amount:1e6,daily_withdrawal_limit:5e6});i.useEffect(()=>{r==="edit"&&l?b({username:l.username,nickname:l.nickname,password:"",partner_type:l.partner_type,parent_id:l.parent_id||"",opcode:"",secret_key:"",api_token:"",commission_rolling:l.commission_rolling,commission_losing:l.commission_losing,withdrawal_fee:l.withdrawal_fee,min_withdrawal_amount:l.min_withdrawal_amount||1e4,max_withdrawal_amount:l.max_withdrawal_amount||1e6,daily_withdrawal_limit:l.daily_withdrawal_limit||5e6}):r==="create"&&x()},[r,l,a]);const x=()=>{b({username:"",nickname:"",password:"",partner_type:"head_office",parent_id:"",opcode:"",secret_key:"",api_token:"",commission_rolling:.5,commission_losing:5,withdrawal_fee:1,min_withdrawal_amount:1e4,max_withdrawal_amount:1e6,daily_withdrawal_limit:5e6}),S(""),f(null)},T=async()=>{try{if(C(!0),r==="create"){if(!d.username.trim()){y.error(s.partnerManagement.enterUsernameError);return}if(!d.nickname.trim()){y.error(s.partnerManagement.enterNicknameError);return}if(!d.password.trim()){y.error(s.partnerManagement.enterPasswordError);return}y.success(s.partnerManagement.partnerCreatedSuccess),g(),n(!1),x()}else{if(!l)return;const m={nickname:d.nickname,commission_rolling:d.commission_rolling,commission_losing:d.commission_losing,withdrawal_fee:d.withdrawal_fee,min_withdrawal_amount:d.min_withdrawal_amount,max_withdrawal_amount:d.max_withdrawal_amount,daily_withdrawal_limit:d.daily_withdrawal_limit,updated_at:new Date().toISOString()};d.password&&d.password.trim()!==""&&(m.password_hash=d.password);const{error:p}=await o.from("partners").update(m).eq("id",l.id);if(p)throw p;y.success(s.partnerManagement.partnerUpdatedSuccess),c&&c({type:"partner_updated",data:{partnerId:l.id,updates:m}}),g(),n(!1)}}catch(m){console.error("íŒŒíŠ¸ë„ˆ ì €ì¥ ì˜¤ë¥˜:",m),y.error(r==="create"?s.partnerManagement.createPartnerError:s.partnerManagement.updatePartnerError)}finally{C(!1)}};return e.jsx(ga,{open:a,onOpenChange:n,children:e.jsxs(ha,{className:"sm:max-w-[600px] max-h-[80vh] overflow-y-auto",children:[e.jsxs(fa,{children:[e.jsx(xa,{children:r==="create"?s.partnerManagement.newPartner:"íŒŒíŠ¸ë„ˆ ì •ë³´ ìˆ˜ì •"}),e.jsx(_a,{children:r==="create"?s.partnerManagement.createPartnerDescription:"íŒŒíŠ¸ë„ˆì˜ ì •ë³´ë¥¼ ìˆ˜ì •í•©ë‹ˆë‹¤."})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{htmlFor:r==="create"?"username":"edit_username",children:s.partnerManagement.partnerUsername}),e.jsx(Y,{id:r==="create"?"username":"edit_username",value:d.username,onChange:m=>b(p=>({...p,username:m.target.value})),placeholder:s.partnerManagement.partnerUsernameInput,disabled:r==="edit",className:r==="edit"?"bg-muted":""})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{htmlFor:r==="create"?"nickname":"edit_nickname",children:s.partnerManagement.partnerNickname}),e.jsx(Y,{id:r==="create"?"nickname":"edit_nickname",value:d.nickname,onChange:m=>b(p=>({...p,nickname:m.target.value})),placeholder:s.partnerManagement.partnerNicknameInput})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{htmlFor:r==="create"?"password":"edit_password",children:r==="create"?s.common.password:s.partnerManagement.passwordChangeOnly}),e.jsx(Y,{id:r==="create"?"password":"edit_password",type:"password",value:d.password,onChange:m=>b(p=>({...p,password:m.target.value})),placeholder:r==="create"?s.partnerManagement.initialPassword:s.partnerManagement.passwordChangeHint}),r==="edit"&&e.jsx("p",{className:"text-xs text-muted-foreground",children:s.partnerManagement.passwordChangeNote})]}),r==="create"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{htmlFor:"partner_type",children:s.partnerManagement.partnerGrade}),e.jsxs(Le,{value:d.partner_type,onValueChange:m=>{b(p=>({...p,partner_type:m}))},children:[e.jsx(Ce,{children:e.jsx(ke,{})}),e.jsxs(Te,{children:[h===1&&e.jsx(D,{value:"head_office",children:s.partnerManagement.headOffice}),h===2&&e.jsx(D,{value:"main_office",children:s.partnerManagement.mainOffice}),h===3&&e.jsx(D,{value:"sub_office",children:s.partnerManagement.subOffice}),h===4&&e.jsx(D,{value:"distributor",children:s.partnerManagement.distributor}),h===5&&e.jsx(D,{value:"store",children:s.partnerManagement.store})]})]}),v&&e.jsx("div",{className:"p-3 bg-red-50 dark:bg-red-900/10 rounded-lg border border-red-200 dark:border-red-800",children:e.jsx("p",{className:"text-xs text-red-700 dark:text-red-300",children:v})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(A,{className:"flex items-center gap-2",children:[e.jsx(Me,{className:"h-4 w-4 text-green-500"}),s.partnerManagement.commissionSettingsLabel]}),d.partner_type!=="head_office"&&w&&e.jsxs(K,{variant:"outline",className:"text-xs",children:[s.partnerManagement.upperLimit," ",w.rolling,"% / ",w.losing,"% / ",w.fee,"%"]})]}),d.partner_type==="head_office"?e.jsx("div",{className:"p-3 bg-purple-50 dark:bg-purple-900/10 rounded-lg border border-purple-200 dark:border-purple-800",children:e.jsxs("p",{className:"text-xs text-purple-700 dark:text-purple-300",children:["ğŸ¢ ",e.jsx("strong",{children:"ëŒ€ë³¸ì‚¬"}),"ëŠ” ìµœìƒìœ„ íŒŒíŠ¸ë„ˆë¡œ ì»¤ë¯¸ì…˜ì´ ",e.jsx("strong",{children:"100%"}),"ë¡œ ê³ ì •ë©ë‹ˆë‹¤."]})}):e.jsx("div",{className:"p-3 bg-amber-50 dark:bg-amber-900/10 rounded-lg border border-amber-200 dark:border-amber-800",children:e.jsx("p",{className:"text-xs text-amber-700 dark:text-amber-300",children:"âš ï¸ ì»¤ë¯¸ì…˜ ë³€ê²½ ì‹œ ì •ì‚°ì— ì¦‰ì‹œ ë°˜ì˜ë˜ë©°, ìƒìœ„ íŒŒíŠ¸ë„ˆ ìš”ìœ¨ì„ ì´ˆê³¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤."})}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{htmlFor:"commission_rolling",children:s.partnerManagement.rollingCommissionLabel}),e.jsx(Y,{id:"commission_rolling",type:"number",step:"0.1",min:"0",max:d.partner_type==="head_office"?100:w?.rolling||100,value:d.commission_rolling,onChange:m=>b(p=>({...p,commission_rolling:parseFloat(m.target.value)||0})),disabled:d.partner_type==="head_office",className:d.partner_type==="head_office"?"bg-muted":""}),e.jsx("p",{className:"text-xs text-muted-foreground",children:d.partner_type==="head_office"?"ëŒ€ë³¸ì‚¬ ê³ ì •ê°’":s.partnerManagement.totalBettingAmount})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{htmlFor:"commission_losing",children:s.partnerManagement.losingCommissionLabel}),e.jsx(Y,{id:"commission_losing",type:"number",step:"0.1",min:"0",max:d.partner_type==="head_office"?100:w?.losing||100,value:d.commission_losing,onChange:m=>b(p=>({...p,commission_losing:parseFloat(m.target.value)||0})),disabled:d.partner_type==="head_office",className:d.partner_type==="head_office"?"bg-muted":""}),e.jsx("p",{className:"text-xs text-muted-foreground",children:d.partner_type==="head_office"?"ëŒ€ë³¸ì‚¬ ê³ ì •ê°’":s.partnerManagement.memberNetLoss})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{htmlFor:"withdrawal_fee",children:s.partnerManagement.withdrawalFeeLabel}),e.jsx(Y,{id:"withdrawal_fee",type:"number",step:"0.1",min:"0",max:d.partner_type==="head_office"?100:w?.fee||100,value:d.withdrawal_fee,onChange:m=>b(p=>({...p,withdrawal_fee:parseFloat(m.target.value)||0})),disabled:d.partner_type==="head_office",className:d.partner_type==="head_office"?"bg-muted":""}),e.jsx("p",{className:"text-xs text-muted-foreground",children:d.partner_type==="head_office"?"ëŒ€ë³¸ì‚¬ ê³ ì •ê°’":s.partnerManagement.withdrawalFeeDesc})]})]})]})]}),e.jsxs(ba,{children:[e.jsx(W,{variant:"outline",onClick:()=>{n(!1),x()},children:s.common.cancel}),e.jsx(W,{onClick:T,disabled:u,children:u?r==="create"?s.partnerManagement.creating:"ìˆ˜ì • ì¤‘...":r==="create"?s.partnerManagement.createPartnerButton:s.common.save})]})]})})}const Fa=async(a,n)=>{let r=o.from("partners").select(`
      id,
      username,
      nickname,
      partner_type,
      level,
      parent_id,
      balance,
      invest_balance,
      oroplay_balance,
      commission_rolling,
      commission_losing,
      withdrawal_fee,
      status,
      created_at,
      updated_at,
      parent:parent_id (
        nickname
      )
    `).order("level",{ascending:!0}).order("created_at",{ascending:!1});const l=n===1,{data:h,error:g}=l?await r:await o.rpc("get_hierarchical_partners",{p_partner_id:a});if(g)throw g;return await Promise.all((h||[]).map(async s=>{const{count:u}=await o.from("partners").select("*",{count:"exact"}).eq("parent_id",s.id),{count:C}=await o.from("users").select("*",{count:"exact"}).eq("referrer_id",s.id);let v=0,S=0;if(s.level===1){const{data:w}=await o.from("api_configs").select("balance").eq("partner_id",s.id).eq("api_provider","invest").maybeSingle(),{data:f}=await o.from("api_configs").select("balance").eq("partner_id",s.id).eq("api_provider","oroplay").maybeSingle();v=w?.balance||0,S=f?.balance||0}else s.level===2&&(v=s.invest_balance||0,S=s.oroplay_balance||0);return{...s,parent_nickname:s.parent?.nickname||"-",child_count:u||0,user_count:C||0,balance:s.level===1||s.level===2?0:s.balance||0,invest_balance:v,oroplay_balance:S}}))},Pa=async a=>{try{const{data:n,error:r}=await o.from("partners").select("commission_rolling, commission_losing, withdrawal_fee, partner_type, nickname").eq("id",a).maybeSingle();return r?(console.error("[Partner Commission Error]:",r),null):n?{rolling:n.commission_rolling||100,losing:n.commission_losing||100,fee:n.withdrawal_fee||100,nickname:n.nickname}:null}catch(n){return console.error("[Partner Commission Fetch Failed]:",n),null}},Aa=async()=>{try{const{data:a,error:n}=await o.from("system_settings").select("setting_key, setting_value").in("setting_key",["default_rolling_commission","default_losing_commission","default_withdrawal_fee"]);if(n)return console.error("[System Default Commission Load Error]:",n),null;if(a&&a.length>0){const r={rolling:.5,losing:5,fee:1};return a.forEach(l=>{l.setting_key==="default_rolling_commission"?r.rolling=parseFloat(l.setting_value)||.5:l.setting_key==="default_losing_commission"?r.losing=parseFloat(l.setting_value)||5:l.setting_key==="default_withdrawal_fee"&&(r.fee=parseFloat(l.setting_value)||1)}),r}return null}catch(a){return console.error("[System Default Commission Load Failed]:",a),null}},Ia=async a=>{try{const{data:n,error:r}=await o.from("api_configs").select("balance").eq("partner_id",a).eq("api_provider","invest").maybeSingle(),{data:l,error:h}=await o.from("api_configs").select("balance").eq("partner_id",a).eq("api_provider","oroplay").maybeSingle();return r&&console.error("âš ï¸ Lv1 invest api_configs ì¡°íšŒ ì‹¤íŒ¨:",r),h&&console.error("âš ï¸ Lv1 oroplay api_configs ì¡°íšŒ ì‹¤íŒ¨:",h),{invest:n?.balance||0,oroplay:l?.balance||0}}catch(n){return console.error("âŒ Lv1 API ë³´ìœ ê¸ˆ ì¡°íšŒ ì‹¤íŒ¨:",n),{invest:0,oroplay:0}}},Oa=async a=>{try{const{data:n,error:r}=await o.from("partners").select("balance, level, invest_balance, oroplay_balance").eq("id",a).single();if(r)throw r;let l={};if(n?.level===1){const{data:h,error:g}=await o.from("api_configs").select("balance").eq("partner_id",a).eq("api_provider","invest").maybeSingle(),{data:c,error:s}=await o.from("api_configs").select("balance").eq("partner_id",a).eq("api_provider","oroplay").maybeSingle();l.investBalance=h?.balance||0,l.oroplayBalance=c?.balance||0}else n?.level===2?(l.investBalance=n?.invest_balance||0,l.oroplayBalance=n?.oroplay_balance||0):l.balance=n?.balance||0;return l}catch(n){return console.error("âŒ í˜„ì¬ ì‚¬ìš©ì ë³´ìœ ê¸ˆ ì¡°íšŒ ì‹¤íŒ¨:",n),{}}},qa=()=>{const{authState:a}=wa(),{connected:n,sendMessage:r}=ya(),[l,h]=i.useState([]),[g,c]=i.useState(!0),[s,u]=i.useState(""),[C,v]=i.useState("all"),[S,w]=i.useState("all"),[f,d]=i.useState(null),[b,x]=i.useState(!1),[T,m]=i.useState(!1),[p,N]=i.useState(!1),[F,V]=i.useState(null),[ie,$]=i.useState(""),[ue,De]=i.useState(!1),[$e,Be]=i.useState(!1),[te,_]=i.useState("hierarchy"),[ne,G]=i.useState({}),[Ee,le]=i.useState([]),[ge,he]=i.useState(new Set),[Fe,Pe]=i.useState(!1),[Ae,Ue]=i.useState(""),[re,Ie]=i.useState({rolling:.5,losing:5,fee:1}),[Oe,fe]=i.useState(!1),[qe,We]=i.useState("deposit"),[He,xe]=i.useState(null),[ea,oe]=i.useState({invest:0,oroplay:0}),[aa,Ve]=i.useState(0),[ta,Ge]=i.useState(0),[na,ce]=i.useState(0),[Re,_e]=i.useState(null),[ze,be]=i.useState({username:"",nickname:"",password:"",partner_type:"head_office",parent_id:"",commission_rolling:.5,commission_losing:5,withdrawal_fee:0,min_withdrawal_amount:1e4,max_withdrawal_amount:1e6,daily_withdrawal_limit:5e6}),[Xe,de]=i.useState(!1),[ve,Ye]=i.useState(null),[Je,t]=i.useState(""),[j,k]=i.useState(""),[M,Q]=i.useState("deposit"),[P,Ke]=i.useState(!1),we=i.useCallback(async()=>{if(a.user?.id)try{c(!0);const L=await Fa(a.user.id,a.user.level||1);h(L)}catch(L){console.error("[Partner List Fetch Error]:",L),y.error("íŒŒíŠ¸ë„ˆ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")}finally{c(!1)}},[a.user?.id,a.user?.level]),ye=i.useCallback(async()=>{if(!a.user?.id)return;const L=await Pa(a.user.id);L&&_e(L)},[a.user?.id]),je=i.useCallback(async()=>{const L=await Aa();L&&(Ie(L),be(Qe=>({...Qe,commission_rolling:L.rolling,commission_losing:L.losing,withdrawal_fee:L.fee})))},[]),Se=i.useCallback(async()=>{if(!a.user?.id||a.user?.level!==1){oe({invest:0,oroplay:0});return}const L=await Ia(a.user.id);oe(L)},[a.user?.id,a.user?.level]),ra=i.useCallback(async()=>{if(!a.user?.id)return;const L=await Oa(a.user.id);L.investBalance!==void 0&&Ge(L.investBalance),L.oroplayBalance!==void 0&&ce(L.oroplayBalance),L.balance!==void 0&&Ve(L.balance)},[a.user?.id]);return i.useEffect(()=>{a.user?.id&&(je(),ye(),we(),Se(),ra())},[a.user?.id]),i.useEffect(()=>{if(!a.user?.id)return;console.log("âœ… Realtime êµ¬ë…: partners.balance ë³€ê²½ ê°ì§€");const L=o.channel("partner_balance_changes").on("postgres_changes",{event:"UPDATE",schema:"public",table:"partners"},B=>{const I=B.new.id,R=B.old.balance,H=B.new.balance;R!==H&&h(O=>{const E=O.find(z=>z.id===I);return!E||E.level===1||E.level===2?O:(console.log(`ğŸ’° Lv${E.level} ë³´ìœ ê¸ˆ ë³€ê²½ (partner_id: ${I}): ${R} â†’ ${H}`),O.map(z=>z.id===I?{...z,balance:H}:z))})}).subscribe(),Qe=o.channel("api_configs_balance_changes").on("postgres_changes",{event:"UPDATE",schema:"public",table:"api_configs"},async B=>{const I=B.new.partner_id,R=B.new.api_provider,H=B.old.balance||0,O=B.new.balance||0;H!==O&&(console.log(`ğŸ’° API ë³´ìœ ê¸ˆ ë³€ê²½ (partner_id: ${I}, provider: ${R}): ${H} â†’ ${O}`),I===a.user?.id&&a.user?.level===1&&oe(E=>({...E,[R]:O})),h(E=>{const z=E.find(X=>X.id===I);return!z||z.level!==1?E:E.map(X=>{if(X.id===I){const se={...X,balance:0};return R==="invest"?se.invest_balance=O:R==="oroplay"&&(se.oroplay_balance=O),se}return X})}))}).subscribe(),va=o.channel("lv2_balance_changes").on("postgres_changes",{event:"UPDATE",schema:"public",table:"partners"},async B=>{const I=B.new.id,R=B.old.invest_balance||0,H=B.new.invest_balance||0,O=B.old.oroplay_balance||0,E=B.new.oroplay_balance||0;(R!==H||O!==E)&&h(X=>{const se=X.find(me=>me.id===I);return!se||se.level!==2?X:(console.log(`ğŸ’° Lv2 ë³´ìœ ê¸ˆ ë³€ê²½ (partner_id: ${I}):`,{invest_balance:H,oroplay_balance:E}),X.map(me=>me.id===I?{...me,invest_balance:H,oroplay_balance:E}:me))})}).subscribe();return()=>{o.removeChannel(L),o.removeChannel(Qe),o.removeChannel(va)}},[a.user?.id,a.user?.level]),{partners:l,setPartners:h,loading:g,setLoading:c,searchTerm:s,setSearchTerm:u,typeFilter:C,setTypeFilter:v,statusFilter:S,setStatusFilter:w,selectedPartner:f,setSelectedPartner:d,showCreateDialog:b,setShowCreateDialog:x,showEditDialog:T,setShowEditDialog:m,showDeleteDialog:p,setShowDeleteDialog:N,partnerToDelete:F,setPartnerToDelete:V,deleteConfirmText:ie,setDeleteConfirmText:$,deleteLoading:ue,setDeleteLoading:De,showHierarchyView:$e,setShowHierarchyView:Be,currentTab:te,setCurrentTab:_,dashboardData:ne,setDashboardData:G,levelDistribution:Ee,setLevelDistribution:le,expandedPartners:ge,setExpandedPartners:he,allExpanded:Fe,setAllExpanded:Pe,hierarchyWarning:Ae,setHierarchyWarning:Ue,systemDefaultCommission:re,setSystemDefaultCommission:Ie,showForceTransactionModal:Oe,setShowForceTransactionModal:fe,forceTransactionType:qe,setForceTransactionType:We,forceTransactionTarget:He,setForceTransactionTarget:xe,adminApiBalances:ea,setAdminApiBalances:oe,currentUserBalance:aa,setCurrentUserBalance:Ve,currentUserInvestBalance:ta,setCurrentUserInvestBalance:Ge,currentUserOroplayBalance:na,setCurrentUserOroplayBalance:ce,parentCommission:Re,setParentCommission:_e,formData:ze,setFormData:be,showTransferDialog:Xe,setShowTransferDialog:de,transferTargetPartner:ve,setTransferTargetPartner:Ye,transferAmount:Je,setTransferAmount:t,transferMemo:j,setTransferMemo:k,transferMode:M,setTransferMode:Q,transferLoading:P,setTransferLoading:Ke,fetchPartners:we,loadParentCommission:ye,loadSystemDefaultCommission:je,fetchAdminApiBalances:Se,fetchCurrentUserBalance:ra,authState:a,connected:n,sendMessage:r}};async function Wa(a,n,r,l,h,g){try{console.log("ğŸ’° [íŒŒíŠ¸ë„ˆ ê°•ì œ ì…ì¶œê¸ˆ] ì‹œì‘:",a);const{data:c,error:s}=await o.from("partners").select("id, nickname, balance, level, partner_type, invest_balance, oroplay_balance").eq("id",a.targetId).single();if(s||!c){y.error(r.partnerManagement.targetPartnerFetchError),console.error("âŒ ëŒ€ìƒ íŒŒíŠ¸ë„ˆ ì¡°íšŒ ì‹¤íŒ¨:",s);return}const{data:u,error:C}=await o.from("partners").select("balance, level, nickname, partner_type, invest_balance, oroplay_balance").eq("id",n).single();if(C||!u){y.error(r.partnerManagement.adminInfoFetchError),console.error("âŒ ê´€ë¦¬ì ì •ë³´ ì¡°íšŒ ì‹¤íŒ¨:",C);return}const v=u.level===1,S=c.partner_type==="head_office",w=v&&c.level===2,f=v&&c.level===3,d=u.level===2&&c.level===3;if(console.log("ğŸ“Š [íŒŒíŠ¸ë„ˆ ê°•ì œ ì…ì¶œê¸ˆ] ìƒí™©:",{isLv1ToLv2:w,isLv2ToLv3:d,adminLevel:u.level,targetLevel:c.level,apiType:a.apiType}),a.type==="withdrawal"){if(w&&a.apiType){const m=(a.apiType==="invest"?c.invest_balance:c.oroplay_balance)||0;if(m<a.amount){const p=a.apiType==="invest"?"Invest":"OroPlay";y.error(r.partnerManagement.withdrawalExceedError.replace("{{balance}}",`${p} ${m.toLocaleString()}`));return}}else if(!w&&c.balance<a.amount){y.error(r.partnerManagement.withdrawalExceedError.replace("{{balance}}",c.balance.toLocaleString()));return}}if(a.type==="deposit"){if(w&&a.apiType){const{data:m,error:p}=await o.from("api_configs").select("balance").eq("partner_id",n).eq("api_provider",a.apiType).maybeSingle();if(p||!m){y.error(r.partnerManagement.apiConfigFetchError),console.error("âŒ API ì„¤ì • ì¡°íšŒ ì‹¤íŒ¨:",p);return}const N=m.balance||0;if(console.log(`ğŸ’³ Lv1 ${a.apiType.toUpperCase()} API ë³´ìœ ê¸ˆ:`,N),N<a.amount){const F=a.apiType==="invest"?"Invest":"OroPlay";y.error(r.partnerManagement.apiBalanceInsufficientError.replace("{{apiName}}",F).replace("{{balance}}",N.toLocaleString()));return}}else if(d&&!a.apiType){const m=u.invest_balance||0,p=u.oroplay_balance||0,N=Math.min(m,p);if(a.amount>N){y.error(r.partnerManagement.balanceInsufficientError.replace("{{balance}}",N.toLocaleString()));return}}else if(!w&&!d&&u.balance<a.amount){y.error(r.partnerManagement.balanceInsufficientError.replace("{{balance}}",u.balance.toLocaleString()));return}}if(w&&a.type==="deposit"&&a.apiType){console.log("âœ… [Lv1â†’Lv2 ì…ê¸ˆ] Lv1 ì™¸ë¶€ ì§€ê°‘ì€ ë³€ê²½í•˜ì§€ ì•Šê³  Lv2ì—ê²Œë§Œ í• ë‹¹");const m=a.apiType==="invest"?"invest_balance":"oroplay_balance",p=(a.apiType==="invest"?c.invest_balance:c.oroplay_balance)||0,N=p+a.amount,{error:F}=await o.from("partners").update({[m]:N,updated_at:new Date().toISOString()}).eq("id",a.targetId);if(F){y.error(r.partnerManagement.lv2BalanceUpdateError),console.error("âŒ Lv2 partners ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:",F);return}console.log(`âœ… Lv2 partners.${m} ì¦ê°€:`,{before:p,after:N,amount:a.amount});const V=a.apiType==="invest"?"Invest":"OroPlay";await o.from("partner_balance_logs").insert({partner_id:a.targetId,balance_before:p,balance_after:N,amount:a.amount,transaction_type:"deposit",from_partner_id:n,to_partner_id:a.targetId,processed_by:n,api_type:a.apiType,memo:`[${V} API í• ë‹¹] ${u.nickname}ìœ¼ë¡œë¶€í„° ${a.amount.toLocaleString()}ì› í• ë‹¹${a.memo?`: ${a.memo}`:""}`}),y.success(r.partnerManagement.apiAllocationSuccess.replace("{{nickname}}",c.nickname).replace("{{apiName}}",V).replace("{{amount}}",a.amount.toLocaleString())),g();return}if(w&&a.type==="withdrawal"&&a.apiType){console.log("âœ… [Lv1â†’Lv2 ì¶œê¸ˆ] Lv1 ì™¸ë¶€ ì§€ê°‘ì€ ë³€ê²½í•˜ì§€ ì•Šê³  Lv2ì—ì„œë§Œ íšŒìˆ˜");const m=a.apiType==="invest"?"invest_balance":"oroplay_balance",p=(a.apiType==="invest"?c.invest_balance:c.oroplay_balance)||0,N=p-a.amount,{error:F}=await o.from("partners").update({[m]:N,updated_at:new Date().toISOString()}).eq("id",a.targetId);if(F){y.error(r.partnerManagement.lv2WithdrawalDeductError),console.error("âŒ Lv2 partners ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:",F);return}console.log(`âœ… Lv2 partners.${m} ì°¨ê°:`,{before:p,after:N,amount:-a.amount});const V=a.apiType==="invest"?"Invest":"OroPlay";await o.from("partner_balance_logs").insert({partner_id:a.targetId,balance_before:p,balance_after:N,amount:-a.amount,transaction_type:"withdrawal",from_partner_id:a.targetId,to_partner_id:n,processed_by:n,api_type:a.apiType,memo:`[${V} API íšŒìˆ˜] ${u.nickname}ì´(ê°€) ${a.amount.toLocaleString()}ì› íšŒìˆ˜${a.memo?`: ${a.memo}`:""}`}),y.success(r.partnerManagement.apiRecoveryCompletedFromPartner.replace("{{nickname}}",c.nickname).replace("{{apiName}}",V).replace("{{amount}}",a.amount.toLocaleString())),g();return}console.log("âœ… [íŒŒíŠ¸ë„ˆ ê°•ì œ ì…ì¶œê¸ˆ] ì™¸ë¶€ API í˜¸ì¶œ ê±´ë„ˆëœ€ - ë‚´ë¶€ DBë§Œ ì²˜ë¦¬");let b=u.balance,x=c.balance;if(a.type==="deposit"){if((f||d)&&c.level===3){console.log("âœ… [Lv1/Lv2â†’Lv3 ì…ê¸ˆ] Lv2 ë³€ë™ ì—†ìŒ, Lv3 balanceë§Œ ì¦ê°€");const m=c.balance,p=m+a.amount;await o.from("partners").update({balance:p,updated_at:new Date().toISOString()}).eq("id",a.targetId),await o.from("partner_balance_logs").insert({partner_id:a.targetId,balance_before:m,balance_after:p,amount:a.amount,transaction_type:"deposit",from_partner_id:n,to_partner_id:a.targetId,processed_by:n,memo:`[Lv3 ìˆ˜ì‹ ] ${u.nickname}ìœ¼ë¡œë¶€í„° ${a.amount.toLocaleString()}ì› ì…ê¸ˆ${a.memo?`: ${a.memo}`:""}`}),y.success(r.partnerManagement.depositCompleted.replace("{{nickname}}",c.nickname).replace("{{amount}}",a.amount.toLocaleString())),g();return}if(u.level===2&&c.level>=4&&a.apiType){const m=a.apiType==="invest"?"invest_balance":"oroplay_balance",N=((a.apiType==="invest"?u.invest_balance:u.oroplay_balance)||0)-a.amount;await o.from("partners").update({[m]:N,updated_at:new Date().toISOString()}).eq("id",n),x=c.balance+a.amount,await o.from("partners").update({balance:x,updated_at:new Date().toISOString()}).eq("id",a.targetId),await o.from("partner_balance_logs").insert({partner_id:a.targetId,balance_before:c.balance,balance_after:x,amount:a.amount,transaction_type:"deposit",from_partner_id:n,to_partner_id:a.targetId,processed_by:n,memo:`[ê°•ì œì…ê¸ˆ] ${u.nickname}ìœ¼ë¡œë¶€í„° ${a.amount.toLocaleString()}ì› ì…ê¸ˆ${a.memo?`: ${a.memo}`:""}`})}else b=u.balance-a.amount,await o.from("partners").update({balance:b,updated_at:new Date().toISOString()}).eq("id",n),x=c.balance+a.amount,await o.from("partners").update({balance:x,updated_at:new Date().toISOString()}).eq("id",a.targetId),await o.from("partner_balance_logs").insert({partner_id:a.targetId,balance_before:c.balance,balance_after:x,amount:a.amount,transaction_type:"deposit",from_partner_id:n,to_partner_id:a.targetId,processed_by:n,memo:`[ê°•ì œì…ê¸ˆ] ${u.nickname}ìœ¼ë¡œë¶€í„° ${a.amount.toLocaleString()}ì› ì…ê¸ˆ${a.memo?`: ${a.memo}`:""}`})}else{if((f||d)&&c.level===3){console.log("âœ… [Lv1/Lv2â†’Lv3 íšŒìˆ˜] Lv2 ë³€ë™ ì—†ìŒ, Lv3 balanceë§Œ ì°¨ê°");const m=c.balance,p=m-a.amount;await o.from("partners").update({balance:p,updated_at:new Date().toISOString()}).eq("id",a.targetId),await o.from("partner_balance_logs").insert({partner_id:a.targetId,balance_before:m,balance_after:p,amount:-a.amount,transaction_type:"withdrawal",from_partner_id:a.targetId,to_partner_id:n,processed_by:n,memo:`[Lv3 íšŒìˆ˜] ${u.nickname}ì—ê²Œ ${a.amount.toLocaleString()}ì› ì¶œê¸ˆ${a.memo?`: ${a.memo}`:""}`}),y.success(r.partnerManagement.withdrawalCompleted.replace("{{nickname}}",c.nickname).replace("{{amount}}",a.amount.toLocaleString())),g();return}if(u.level===2&&c.level>=4&&a.apiType){x=c.balance-a.amount,await o.from("partners").update({balance:x,updated_at:new Date().toISOString()}).eq("id",a.targetId);const m=a.apiType==="invest"?"invest_balance":"oroplay_balance",N=((a.apiType==="invest"?u.invest_balance:u.oroplay_balance)||0)+a.amount;await o.from("partners").update({[m]:N,updated_at:new Date().toISOString()}).eq("id",n),await o.from("partner_balance_logs").insert({partner_id:a.targetId,balance_before:c.balance,balance_after:x,amount:-a.amount,transaction_type:"withdrawal",from_partner_id:a.targetId,to_partner_id:n,processed_by:n,memo:`[ê°•ì œì¶œê¸ˆ] ${u.nickname}ì—ê²Œ ${a.amount.toLocaleString()}ì› ì¶œê¸ˆ${a.memo?`: ${a.memo}`:""}`})}else x=c.balance-a.amount,await o.from("partners").update({balance:x,updated_at:new Date().toISOString()}).eq("id",a.targetId),b=u.balance+a.amount,await o.from("partners").update({balance:b,updated_at:new Date().toISOString()}).eq("id",n),await o.from("partner_balance_logs").insert({partner_id:a.targetId,balance_before:c.balance,balance_after:x,amount:-a.amount,transaction_type:"withdrawal",from_partner_id:a.targetId,to_partner_id:n,processed_by:n,memo:`[ê°•ì œì¶œê¸ˆ] ${u.nickname}ì—ê²Œ ${a.amount.toLocaleString()}ì› ì¶œê¸ˆ${a.memo?`: ${a.memo}`:""}`})}l&&h&&h({type:"partner_balance_updated",data:{partnerId:a.targetId,amount:a.amount,type:a.type}});const T=a.type==="deposit"?r.partnerManagement.depositTypeLabel:r.partnerManagement.withdrawalTypeLabel;y.success(r.partnerManagement.forceTransactionSuccess.replace("{{type}}",T).replace("{{amount}}",a.amount.toLocaleString())),g()}catch(c){console.error("âŒ [íŒŒíŠ¸ë„ˆ ê°•ì œ ì…ì¶œê¸ˆ] ì˜¤ë¥˜:",c),y.error("ì…ì¶œê¸ˆ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.")}}const Ne={system_admin:"bg-purple-500",head_office:"bg-red-500",main_office:"bg-orange-500",sub_office:"bg-yellow-500",distributor:"bg-blue-500",store:"bg-green-500"},Ha={active:"bg-green-500",inactive:"bg-gray-500",blocked:"bg-red-500"};function et(){const{t:a}=Ze(),{partners:n,loading:r,searchTerm:l,setSearchTerm:h,typeFilter:g,setTypeFilter:c,statusFilter:s,setStatusFilter:u,showTransferDialog:C,setShowTransferDialog:v,transferTargetPartner:S,setTransferTargetPartner:w,transferMode:f,setTransferMode:d,transferAmount:b,setTransferAmount:x,transferMemo:T,setTransferMemo:m,transferLoading:p,showForceTransactionModal:N,setShowForceTransactionModal:F,forceTransactionType:V,setForceTransactionType:ie,forceTransactionTarget:$,setForceTransactionTarget:ue,currentUserBalance:De,currentUserInvestBalance:$e,currentUserOroplayBalance:Be,fetchPartners:te,authState:_,connected:ne,sendMessage:G}=qa(),[Ee,le]=i.useState(new Set),[ge,he]=i.useState(!1),[Fe,Pe]=i.useState("hierarchy"),[Ae,Ue]=i.useState({}),[re,Ie]=i.useState([]),[Oe,fe]=i.useState(!1),[qe,We]=i.useState(null),[He,xe]=i.useState(!1),[ea,oe]=i.useState(""),[aa,Ve]=i.useState(null),[ta]=i.useState({rolling:.5,losing:5,fee:1}),[Ge,na]=i.useState({username:"",nickname:"",password:"",partner_type:"head_office",parent_id:"",opcode:"",secret_key:"",api_token:"",commission_rolling:.5,commission_losing:5,withdrawal_fee:1,min_withdrawal_amount:1e4,max_withdrawal_amount:1e6,daily_withdrawal_limit:5e6}),ce={system_admin:a.partnerManagement.systemAdmin,head_office:a.partnerManagement.headOffice,main_office:a.partnerManagement.mainOffice,sub_office:a.partnerManagement.subOffice,distributor:a.partnerManagement.distributor,store:a.partnerManagement.store},Re={active:a.partnerManagement.active,inactive:a.partnerManagement.inactive,blocked:a.partnerManagement.blocked},_e=n.filter(t=>{const j=!l||t.username.toLowerCase().includes(l.toLowerCase())||t.nickname.toLowerCase().includes(l.toLowerCase()),k=g==="all"||t.partner_type===g,M=s==="all"||t.status===s;return j&&k&&M}),ze=t=>{const j=new Map,k=[];return t.forEach(M=>{j.set(M.id,{...M,children:[]})}),t.forEach(M=>{const Q=j.get(M.id);if(Q)if(M.parent_id&&j.has(M.parent_id)){const P=j.get(M.parent_id);P&&P.children&&P.children.push(Q)}else k.push(Q)}),k},be=t=>{le(j=>{const k=new Set(j);return k.has(t)?k.delete(t):k.add(t),k})},Xe=()=>{if(ge)le(new Set),he(!1);else{const t=new Set,j=k=>{k.forEach(M=>{M.children&&M.children.length>0&&(t.add(M.id),j(M.children))})};j(de),le(t),he(!0)}},de=ze(_e),ve=(t,j)=>{const k=Ee.has(t.id),M=t.children&&t.children.length>0,Q=j*24;return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-1.5 p-2.5 rounded-lg hover:bg-slate-800/50 transition-colors border border-slate-700/30 bg-slate-800/20 min-w-[1200px]",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-[130px] flex-shrink-0",style:{paddingLeft:`${Q}px`},children:[e.jsx("button",{onClick:()=>M&&be(t.id),className:`flex items-center justify-center w-5 h-5 rounded transition-colors flex-shrink-0 ${M?"hover:bg-slate-700 text-slate-300 cursor-pointer":"invisible"}`,children:M&&(k?e.jsx(ca,{className:"h-3 w-3"}):e.jsx(da,{className:"h-3 w-3"}))}),e.jsx("span",{className:"font-medium text-white text-sm truncate",children:t.username})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[e.jsx("div",{className:"min-w-[90px] flex-shrink-0",children:e.jsx("span",{className:"text-slate-300 text-sm truncate",children:t.nickname})}),e.jsx("div",{className:"min-w-[85px] flex-shrink-0",children:e.jsx(K,{className:`${Ne[t.partner_type]} text-white text-xs`,children:ce[t.partner_type]})}),e.jsx("div",{className:"min-w-[60px] flex-shrink-0",children:e.jsx(K,{className:`${Ha[t.status]} text-white text-xs`,children:Re[t.status]})}),e.jsxs("div",{className:"min-w-[110px] text-right flex-shrink-0",children:[e.jsxs("span",{className:"font-mono text-green-400 text-sm",children:[t.level===1||t.level===2?((t.invest_balance||0)+(t.oroplay_balance||0)).toLocaleString():t.balance.toLocaleString(),"ì›"]}),(t.level===1||t.level===2)&&e.jsxs("div",{className:"text-[10px] text-slate-400 mt-0.5",children:["(I:",(t.invest_balance||0).toLocaleString()," + O:",(t.oroplay_balance||0).toLocaleString(),")"]})]}),e.jsx("div",{className:"min-w-[170px] flex-shrink-0",children:e.jsxs("div",{className:"flex items-center gap-1 text-xs",children:[e.jsxs(K,{variant:"outline",className:"bg-green-500/10 text-green-400 border-green-500/30 text-xs px-1",children:["R:",t.commission_rolling,"%"]}),e.jsxs(K,{variant:"outline",className:"bg-orange-500/10 text-orange-400 border-orange-500/30 text-xs px-1",children:["L:",t.commission_losing,"%"]}),e.jsxs(K,{variant:"outline",className:"bg-blue-500/10 text-blue-400 border-blue-500/30 text-xs px-1",children:["F:",t.withdrawal_fee,"%"]})]})}),e.jsxs("div",{className:"flex items-center gap-1.5 min-w-[110px] flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(J,{className:"h-3 w-3 text-slate-400"}),e.jsx("span",{className:"text-xs text-slate-400",children:t.child_count||0})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ma,{className:"h-3 w-3 text-slate-400"}),e.jsx("span",{className:"text-xs text-slate-400",children:t.user_count||0})]})]}),e.jsx("div",{className:"min-w-[120px] flex-shrink-0",children:t.last_login_at?(()=>{const P=new Date(t.last_login_at),Ke=P.getFullYear(),we=String(P.getMonth()+1).padStart(2,"0"),ye=String(P.getDate()).padStart(2,"0"),je=String(P.getHours()).padStart(2,"0"),Se=String(P.getMinutes()).padStart(2,"0");return e.jsx("span",{className:"text-xs text-slate-400",children:`${Ke}/${we}/${ye} ${je}:${Se}`})})():e.jsx("span",{className:"text-xs text-slate-600",children:"-"})})]}),e.jsxs("div",{className:"flex items-center gap-1.5 w-[240px] flex-shrink-0",children:[(_.user?.level===1&&t.partner_type==="head_office"||_.user?.level===2&&t.partner_type==="main_office"&&t.parent_id===_.user?.id)&&e.jsxs(e.Fragment,{children:[e.jsx(W,{variant:"outline",size:"sm",onClick:()=>{ue(t),ie("deposit"),F(!0)},className:"bg-green-500/10 border-green-500/50 text-green-400 hover:bg-green-500/20 flex-shrink-0",title:"ì…ê¸ˆ (API í˜¸ì¶œ)",children:e.jsx(Me,{className:"h-4 w-4"})}),e.jsx(W,{variant:"outline",size:"sm",onClick:()=>{ue(t),ie("withdrawal"),F(!0)},className:"bg-orange-500/10 border-orange-500/50 text-orange-400 hover:bg-orange-500/20 flex-shrink-0",title:"ì¶œê¸ˆ (API í˜¸ì¶œ)",children:e.jsx(pa,{className:"h-4 w-4"})})]}),t.parent_id===_.user?.id&&t.partner_type!=="head_office"&&t.partner_type!=="main_office"&&e.jsxs(e.Fragment,{children:[e.jsx(W,{variant:"outline",size:"sm",onClick:()=>{w(t),d("deposit"),v(!0)},className:"bg-green-500/10 border-green-500/50 text-green-400 hover:bg-green-500/20 flex-shrink-0",title:"ë³´ìœ ê¸ˆ ì§€ê¸‰ (GMS ë¨¸ë‹ˆ)",children:e.jsx(Me,{className:"h-4 w-4"})}),e.jsx(W,{variant:"outline",size:"sm",onClick:()=>{w(t),d("withdrawal"),v(!0)},className:"bg-orange-500/10 border-orange-500/50 text-orange-400 hover:bg-orange-500/20 flex-shrink-0",title:"ë³´ìœ ê¸ˆ íšŒìˆ˜ (GMS ë¨¸ë‹ˆ)",children:e.jsx(pa,{className:"h-4 w-4"})})]}),e.jsx(W,{variant:"outline",size:"sm",onClick:()=>{We(t),fe(!0)},className:"bg-blue-500/10 border-blue-500/50 text-blue-400 hover:bg-blue-500/20 flex-shrink-0",children:e.jsx(Da,{className:"h-3 w-3"})})]})]}),k&&M&&e.jsx("div",{children:t.children.map(P=>ve(P,j+1))})]},t.id)},Ye=async t=>{_.user?.id&&await Wa(t,_.user.id,a,ne,G,te)},Je=()=>{w(null),x(""),m(""),d("deposit"),te()};return r?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(sa,{})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{children:e.jsx("h2",{className:"text-gray-100",children:a.partnerManagement.title})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(W,{variant:"outline",children:[e.jsx(Ma,{className:"h-4 w-4 mr-2"}),a.partnerManagement.export]}),e.jsxs(W,{onClick:()=>xe(!0),children:[e.jsx(La,{className:"h-4 w-4 mr-2"}),a.partnerManagement.createPartner]})]})]}),e.jsxs("div",{className:"grid gap-5 md:grid-cols-4",children:[e.jsx(q,{title:a.partnerManagement.allSubPartners,value:n.filter(t=>t.id!==_.user?.id).length.toLocaleString(),subtitle:a.partnerManagement.managingPartners,icon:J,color:"purple"}),_.user?.level===2&&e.jsx(q,{title:a.partnerManagement.mainOffice,value:n.filter(t=>t.id!==_.user?.id&&t.partner_type==="main_office").length.toLocaleString(),subtitle:`${a.partnerManagement.mainOffice} ${a.partnerManagement.partnerLabel}`,icon:pe,color:"red"}),_.user?.level===3&&e.jsx(q,{title:a.partnerManagement.subOffice,value:n.filter(t=>t.id!==_.user?.id&&t.partner_type==="sub_office").length.toLocaleString(),subtitle:`${a.partnerManagement.subOffice} ${a.partnerManagement.partnerLabel}`,icon:pe,color:"red"}),_.user?.level===4&&e.jsx(q,{title:a.partnerManagement.distributor,value:n.filter(t=>t.id!==_.user?.id&&t.partner_type==="distributor").length.toLocaleString(),subtitle:`${a.partnerManagement.distributor} ${a.partnerManagement.partnerLabel}`,icon:pe,color:"red"}),_.user?.level===2&&e.jsx(q,{title:a.partnerManagement.subOfficeDistributorStore,value:n.filter(t=>t.id!==_.user?.id&&(t.partner_type==="sub_office"||t.partner_type==="distributor"||t.partner_type==="store")).length.toLocaleString(),subtitle:a.partnerManagement.subPartnerLabel,icon:J,color:"orange"}),_.user?.level===3&&e.jsx(q,{title:a.partnerManagement.distributorStore,value:n.filter(t=>t.id!==_.user?.id&&(t.partner_type==="distributor"||t.partner_type==="store")).length.toLocaleString(),subtitle:a.partnerManagement.subPartnerLabel,icon:J,color:"orange"}),_.user?.level===4&&e.jsx(q,{title:a.partnerManagement.storePartner,value:n.filter(t=>t.id!==_.user?.id&&t.partner_type==="store").length.toLocaleString(),subtitle:a.partnerManagement.storePartnerLabel,icon:J,color:"orange"}),_.user?.level===5&&e.jsxs(e.Fragment,{children:[e.jsx(q,{title:a.partnerManagement.storePartner,value:n.filter(t=>t.id!==_.user?.id&&t.partner_type==="store").length.toLocaleString(),subtitle:a.partnerManagement.storePartnerLabel,icon:pe,color:"red"}),e.jsx(q,{title:a.partnerManagement.emptyLabel||"-",value:"0",subtitle:a.partnerManagement.noSubPartnerLabel||"í•˜ìœ„ ì—†ìŒ",icon:J,color:"orange"})]}),(_.user?.level===1||_.user?.level===6)&&e.jsxs(e.Fragment,{children:[e.jsx(q,{title:a.partnerManagement.headOfficePartner,value:n.filter(t=>t.id!==_.user?.id&&t.partner_type==="head_office").length.toLocaleString(),subtitle:a.partnerManagement.headOfficePartnerLabel,icon:pe,color:"red"}),e.jsx(q,{title:a.partnerManagement.mainSubOffice,value:n.filter(t=>t.id!==_.user?.id&&(t.partner_type==="main_office"||t.partner_type==="sub_office")).length.toLocaleString(),subtitle:a.partnerManagement.middlePartner,icon:J,color:"orange"})]}),e.jsx(q,{title:a.partnerManagement.activePartners,value:n.filter(t=>t.id!==_.user?.id&&t.status==="active").length.toLocaleString(),subtitle:a.partnerManagement.normalOperation,icon:Ca,color:"green"})]}),e.jsxs(ja,{value:Fe,onValueChange:Pe,className:"space-y-6",children:[e.jsx("div",{className:"bg-slate-800/30 rounded-xl p-1.5 border border-slate-700/40",children:e.jsxs(Sa,{className:"bg-transparent h-auto p-0 border-0 gap-2 w-full grid grid-cols-2",children:[e.jsx(ia,{value:"hierarchy",className:"bg-transparent text-slate-400 rounded-lg px-6 py-3 data-[state=active]:bg-gradient-to-br data-[state=active]:from-blue-500/20 data-[state=active]:to-cyan-500/10 data-[state=active]:text-white data-[state=active]:shadow-lg data-[state=active]:shadow-blue-500/20 data-[state=active]:border data-[state=active]:border-blue-400/30 transition-all duration-200",children:a.partnerManagement.partnerHierarchyManagement}),e.jsx(ia,{value:"dashboard",className:"bg-transparent text-slate-400 rounded-lg px-6 py-3 data-[state=active]:bg-gradient-to-br data-[state=active]:from-purple-500/20 data-[state=active]:to-pink-500/10 data-[state=active]:text-white data-[state=active]:shadow-lg data-[state=active]:shadow-purple-500/20 data-[state=active]:border data-[state=active]:border-purple-400/30 transition-all duration-200",children:a.partnerManagement.partnerDashboard})]})}),e.jsx(la,{value:"hierarchy",className:"space-y-4",children:e.jsxs(Z,{className:"bg-slate-900/40 border-slate-700/50 backdrop-blur",children:[e.jsx(U,{children:e.jsx(ee,{className:"text-white",children:a.partnerManagement.hierarchyManagementTitle})}),e.jsxs(ae,{children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(ka,{className:"absolute left-2 top-2.5 h-4 w-4 text-slate-400"}),e.jsx(Y,{placeholder:a.partnerManagement.searchIdOrNickname,className:"pl-8 bg-slate-800/50 border-slate-700 text-white",value:l,onChange:t=>h(t.target.value)})]})}),e.jsx(W,{onClick:Xe,variant:"outline",className:"border-blue-500/30 bg-blue-500/10 text-blue-300 hover:bg-blue-500/20 hover:border-blue-400/50",children:ge?e.jsxs(e.Fragment,{children:[e.jsx(ca,{className:"h-4 w-4 mr-2"}),a.partnerManagement.collapseView]}):e.jsxs(e.Fragment,{children:[e.jsx(da,{className:"h-4 w-4 mr-2"}),a.partnerManagement.expandView]})}),e.jsxs(Le,{value:g,onValueChange:c,children:[e.jsx(Ce,{className:"w-[180px] bg-slate-800/50 border-slate-700 text-white",children:e.jsx(ke,{placeholder:a.partnerManagement.partnerGradeFilter})}),e.jsxs(Te,{children:[e.jsx(D,{value:"all",children:a.partnerManagement.allGrades}),e.jsx(D,{value:"head_office",children:a.partnerManagement.headOffice}),e.jsx(D,{value:"main_office",children:a.partnerManagement.mainOffice}),e.jsx(D,{value:"sub_office",children:a.partnerManagement.subOffice}),e.jsx(D,{value:"distributor",children:a.partnerManagement.distributor}),e.jsx(D,{value:"store",children:a.partnerManagement.store})]})]}),e.jsxs(Le,{value:s,onValueChange:u,children:[e.jsx(Ce,{className:"w-[180px] bg-slate-800/50 border-slate-700 text-white",children:e.jsx(ke,{placeholder:a.partnerManagement.statusFilter})}),e.jsxs(Te,{children:[e.jsx(D,{value:"all",children:a.partnerManagement.allStatus}),e.jsx(D,{value:"active",children:a.partnerManagement.active}),e.jsx(D,{value:"inactive",children:a.partnerManagement.inactive}),e.jsx(D,{value:"blocked",children:a.partnerManagement.blocked})]})]})]}),e.jsx("div",{className:"mb-3 px-3 py-2 bg-slate-800/50 rounded-lg border border-slate-700/30",children:e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"min-w-[130px] flex-shrink-0",children:e.jsx("div",{className:"text-xs font-medium text-slate-400",children:a.partnerManagement.id})}),e.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[e.jsx("div",{className:"min-w-[90px] text-xs font-medium text-slate-400",children:a.partnerManagement.nickname}),e.jsx("div",{className:"min-w-[85px] text-xs font-medium text-slate-400",children:a.partnerManagement.gradeLabel}),e.jsx("div",{className:"min-w-[60px] text-xs font-medium text-slate-400",children:a.partnerManagement.statusLabel}),e.jsx("div",{className:"min-w-[110px] text-xs font-medium text-slate-400 text-right",children:a.partnerManagement.balanceLabel}),e.jsx("div",{className:"min-w-[170px] text-xs font-medium text-slate-400",children:a.partnerManagement.commissionLabel}),e.jsx("div",{className:"min-w-[110px] text-xs font-medium text-slate-400",children:a.partnerManagement.subMembers}),e.jsx("div",{className:"min-w-[120px] text-xs font-medium text-slate-400",children:a.partnerManagement.recentAccess})]}),e.jsx("div",{className:"w-[240px] text-xs font-medium text-slate-400 text-center flex-shrink-0",children:a.partnerManagement.management})]})}),r?e.jsx(sa,{}):de.length===0?e.jsx("div",{className:"text-center py-12 text-slate-400",children:a.partnerManagement.noPartners}):e.jsx("div",{className:"space-y-1 overflow-x-auto",children:de.map(t=>ve(t,0))})]})]})}),e.jsx(la,{value:"dashboard",className:"space-y-4",children:e.jsxs(Z,{className:"bg-slate-900/40 border-slate-700/50 backdrop-blur",children:[e.jsxs(U,{children:[e.jsxs(ee,{className:"flex items-center gap-2 text-white",children:[e.jsx(Ta,{className:"h-5 w-5"}),"íŒŒíŠ¸ë„ˆ ëŒ€ì‹œë³´ë“œ"]}),e.jsx(oa,{className:"text-slate-400",children:"íŒŒíŠ¸ë„ˆë³„ ì„±ê³¼ ë° ìˆ˜ìµ í˜„í™©ì„ í™•ì¸í•©ë‹ˆë‹¤."})]}),e.jsxs(ae,{children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-3 mb-6",children:[e.jsxs(Z,{children:[e.jsxs(U,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(ee,{className:"text-sm font-medium",children:"ì´ë²ˆë‹¬ ìˆœìˆ˜ìµ"}),e.jsx(Me,{className:"h-4 w-4 text-green-500"})]}),e.jsxs(ae,{children:[e.jsxs("div",{className:"text-2xl font-bold text-green-600",children:[(Ae.monthlyCommission||0).toLocaleString(),"ì›"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"ë‚´ ìˆ˜ì… - í•˜ìœ„ íŒŒíŠ¸ë„ˆ ì§€ê¸‰"})]})]}),e.jsxs(Z,{children:[e.jsxs(U,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(ee,{className:"text-sm font-medium",children:"ì´ íŒŒíŠ¸ë„ˆ ìˆ˜"}),e.jsx(J,{className:"h-4 w-4 text-blue-500"})]}),e.jsxs(ae,{children:[e.jsxs("div",{className:"text-2xl font-bold text-blue-600",children:[n.length.toLocaleString(),"ê°œ"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"+2 new this month"})]})]}),e.jsxs(Z,{children:[e.jsxs(U,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(ee,{className:"text-sm font-medium",children:"í™œì„± íšŒì› ìˆ˜"}),e.jsx(ma,{className:"h-4 w-4 text-purple-500"})]}),e.jsxs(ae,{children:[e.jsxs("div",{className:"text-2xl font-bold text-purple-600",children:[n.reduce((t,j)=>t+(j.user_count||0),0).toLocaleString(),"ëª…"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"+5% from last month"})]})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs(Z,{children:[e.jsx(U,{children:e.jsx(ee,{className:"text-lg",children:"ìƒìœ„ ì„±ê³¼ íŒŒíŠ¸ë„ˆ"})}),e.jsx(ae,{children:e.jsx("div",{className:"space-y-3",children:n.filter(t=>t.partner_type!=="system_admin").sort((t,j)=>(j.user_count||0)-(t.user_count||0)).slice(0,5).map((t,j)=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(K,{className:`${Ne[t.partner_type]} text-white`,children:["#",j+1]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:t.nickname}),e.jsx("p",{className:"text-sm text-muted-foreground",children:ce[t.partner_type]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-medium",children:[t.user_count||0,"ëª…"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"ê´€ë¦¬ íšŒì›"})]})]},t.id))})})]}),e.jsxs(Z,{children:[e.jsxs(U,{children:[e.jsx(ee,{className:"text-lg",children:"íŒŒíŠ¸ë„ˆ ë ˆë²¨ë³„ ë¶„í¬"}),e.jsx(oa,{className:"text-xs",children:"ê° ë ˆë²¨ íŒŒíŠ¸ë„ˆë“¤ì´ ë³´ìœ í•œ ì‚¬ìš©ìë“¤ì˜ ì´ ë³´ìœ ê¸ˆ"})]}),e.jsx(ae,{children:e.jsx("div",{className:"space-y-4",children:re.length>0?e.jsxs(e.Fragment,{children:[re.map(t=>{const j=Math.max(...re.map(M=>M.usersBalance),1),k=Math.round(t.usersBalance/j*100);return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(K,{className:`${Ne[t.type]} text-white text-xs`,children:["LV.",t.level]}),e.jsx("span",{className:"text-sm font-medium",children:t.typeName}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:["(",t.partnerCount,"ê°œ)"]})]}),e.jsxs("span",{className:"text-sm font-medium text-blue-600",children:["â‚©",t.usersBalance.toLocaleString()]})]}),e.jsx("div",{className:"w-full bg-slate-800/40 rounded-full h-3 overflow-hidden",children:e.jsx("div",{className:`h-3 rounded-full transition-all duration-500 ${Ne[t.type]}`,style:{width:`${Math.max(k,2)}%`}})})]},t.type)}),e.jsx("div",{className:"pt-3 border-t border-slate-700/50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium text-slate-300",children:"ì´ ì‚¬ìš©ì ë³´ìœ ê¸ˆ"}),e.jsxs("span",{className:"text-sm font-bold text-emerald-400",children:["â‚©",re.reduce((t,j)=>t+j.usersBalance,0).toLocaleString()]})]})})]}):e.jsx("div",{className:"text-center py-8 text-muted-foreground text-sm",children:"í•˜ìœ„ íŒŒíŠ¸ë„ˆê°€ ì—†ìŠµë‹ˆë‹¤"})})})]})]})]})]})})]}),e.jsx($a,{open:N,onOpenChange:F,type:V,targetType:"partner",selectedTarget:$?{id:$.id,username:$.username,nickname:$.nickname,balance:$.level===2?($.invest_balance||0)+($.oroplay_balance||0):$.balance||0,level:$.level,invest_balance:$.invest_balance||0,oroplay_balance:$.oroplay_balance||0}:null,onSubmit:Ye,onTypeChange:ie,currentUserLevel:_.user?.level,currentUserBalance:De,currentUserInvestBalance:$e,currentUserOroplayBalance:Be,useGmsMoney:_.user?.level===2&&$?.partner_type==="main_office"}),e.jsx(Ea,{open:C,onOpenChange:v,targetPartner:S,transferMode:f,setTransferMode:d,transferAmount:b,setTransferAmount:x,transferMemo:T,setTransferMemo:m,transferLoading:p,currentUserId:_.user?.id||"",onSuccess:Je,onWebSocketUpdate:t=>{G&&ne&&G(t)}}),e.jsx(ua,{open:He,onOpenChange:xe,mode:"create",userLevel:_.user?.level,onSuccess:()=>{te()},onWebSocketUpdate:t=>{G&&ne&&G(t)}}),e.jsx(ua,{open:Oe,onOpenChange:fe,mode:"edit",partner:qe,userLevel:_.user?.level,onSuccess:()=>{te()},onWebSocketUpdate:t=>{G&&ne&&G(t)}})]})}export{et as PartnerManagementV2,et as default};
