import{r,j as e}from"./react-core-BwkdTuSg.js";import{a as F,s as k,m as H,i as g,J as B,C as j,F as f,G as y,S as E,p as I,q as O,r as A,t as i,H as V,h as q,B as N}from"./index-McppjVnx.js";import{P as z,a as G,b as J}from"./popover-e-C_onM2.js";import{C as Q}from"./calendar-tXmCd-Rv.js";import{k as b,n,p as a}from"./vendor-D410aui4.js";import{R as W,a2 as $,Q as K}from"./lucide-icons-CePlpqHy.js";import"./radix-ui-omyR4zpf.js";import"./supabase-C8Oa5ukG.js";function ae({user:m}){const{t}=F(),[S,x]=r.useState(!0),[o,h]=r.useState(!1),[d,_]=r.useState([]),[c,w]=r.useState("all"),[l,v]=r.useState();r.useEffect(()=>{p()},[m.id,c,l]);const p=async()=>{try{o||x(!0);const s=l?.from?l.from.toISOString():null,D=l?.to?l.to.toISOString():null,M=c==="all"?null:c,{data:R,error:u}=await k.rpc("get_settlement_history",{p_partner_id:m.id,p_start_date:s,p_end_date:D,p_settlement_type:M});if(u){console.error("정산 이력 조회 실패:",u),b.error(t.settlement.historyLoadFailed);return}_(R||[])}catch(s){console.error("정산 이력 조회 실패:",s),b.error(t.settlement.historyLoadFailed)}finally{x(!1),h(!1)}},C=()=>{h(!0),p()},T=s=>{switch(s){case"partner_commission":return t.settlement.partnerCommission;case"integrated":return t.settlement.integratedType;case"rolling":return t.settlement.rollingType;case"losing":return t.settlement.losingType;default:return s}},P=s=>{switch(s){case"partner_commission":return"bg-blue-500/10 text-blue-400 border-blue-500/20";case"integrated":return"bg-purple-500/10 text-purple-400 border-purple-500/20";case"rolling":return"bg-green-500/10 text-green-400 border-green-500/20";case"losing":return"bg-orange-500/10 text-orange-400 border-orange-500/20";default:return"bg-slate-500/10 text-slate-400 border-slate-500/20"}},L=s=>{switch(s){case"today":return t.settlement.today;case"yesterday":return t.settlement.yesterday;case"week":return t.settlement.lastWeek;case"month":return t.settlement.thisMonth;case"custom":return t.settlement.customPeriod;default:return s}};return S?e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsx(H,{})}):e.jsxs("div",{className:"space-y-6 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl text-white mb-2",children:t.settlement.historyTitle}),e.jsx("p",{className:"text-slate-400",children:t.settlement.historySubtitle})]}),e.jsxs(g,{variant:"outline",size:"sm",onClick:C,disabled:o,children:[e.jsx(W,{className:B("h-4 w-4 mr-2",o&&"animate-spin")}),t.common.refresh]})]}),e.jsx(j,{children:e.jsx(f,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(y,{children:t.settlement.filter}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(E,{value:c,onValueChange:w,children:[e.jsx(I,{className:"w-[180px]",children:e.jsx(O,{})}),e.jsxs(A,{children:[e.jsx(i,{value:"all",children:t.settlement.all}),e.jsx(i,{value:"partner_commission",children:t.settlement.partnerCommission}),e.jsx(i,{value:"integrated",children:t.settlement.integratedType}),e.jsx(i,{value:"rolling",children:t.settlement.rollingType}),e.jsx(i,{value:"losing",children:t.settlement.losingType})]})]}),e.jsxs(z,{children:[e.jsx(G,{asChild:!0,children:e.jsxs(g,{variant:"outline",className:"w-[280px] justify-start text-left",children:[e.jsx($,{className:"mr-2 h-4 w-4"}),l?.from?l.to?e.jsxs(e.Fragment,{children:[n(l.from,"PPP",{locale:a})," -"," ",n(l.to,"PPP",{locale:a})]}):n(l.from,"PPP",{locale:a}):e.jsx("span",{children:t.settlement.selectDate})]})}),e.jsx(J,{className:"w-auto p-0",align:"end",children:e.jsx(Q,{initialFocus:!0,mode:"range",defaultMonth:l?.from,selected:l,onSelect:v,numberOfMonths:2,locale:a})})]})]})]})})}),e.jsxs(j,{children:[e.jsxs(f,{children:[e.jsx(y,{children:t.settlement.historyCount.replace("{count}",d.length.toString())}),e.jsx(V,{children:t.settlement.completedSettlements})]}),e.jsx(q,{children:d.length===0?e.jsxs("div",{className:"text-center py-12 text-slate-400",children:[e.jsx(K,{className:"h-12 w-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:t.settlement.noHistory})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-slate-700",children:[e.jsx("th",{className:"text-left p-3 text-slate-400",children:t.settlement.settlementDateTime}),e.jsx("th",{className:"text-left p-3 text-slate-400",children:t.settlement.settlementType}),e.jsx("th",{className:"text-left p-3 text-slate-400",children:t.settlement.settlementPeriod}),e.jsx("th",{className:"text-left p-3 text-slate-400",children:t.settlement.periodRange}),e.jsx("th",{className:"text-left p-3 text-slate-400",children:t.settlement.api}),e.jsx("th",{className:"text-right p-3 text-slate-400",children:t.settlement.rolling}),e.jsx("th",{className:"text-right p-3 text-slate-400",children:t.settlement.losing}),e.jsx("th",{className:"text-right p-3 text-slate-400",children:t.settlement.withdrawal}),e.jsx("th",{className:"text-right p-3 text-slate-400",children:t.settlement.totalAmount}),e.jsx("th",{className:"text-left p-3 text-slate-400",children:t.settlement.executor})]})}),e.jsx("tbody",{children:d.map(s=>e.jsxs("tr",{className:"border-b border-slate-800 hover:bg-slate-800/30",children:[e.jsx("td",{className:"p-3 text-slate-300",children:n(new Date(s.processed_at||s.created_at),"yyyy-MM-dd HH:mm",{locale:a})}),e.jsx("td",{className:"p-3",children:e.jsx(N,{className:P(s.settlement_type),children:T(s.settlement_type)})}),e.jsx("td",{className:"p-3 text-slate-300",children:L(s.settlement_period)}),e.jsxs("td",{className:"p-3 text-slate-300 text-xs",children:[n(new Date(s.period_start),"MM/dd",{locale:a})," ~ ",n(new Date(s.period_end),"MM/dd",{locale:a})]}),e.jsx("td",{className:"p-3",children:e.jsx(N,{variant:"outline",className:"text-xs",children:s.api_filter==="all"?t.settlement.all:s.api_filter})}),e.jsxs("td",{className:"p-3 text-right text-blue-400",children:["₩",s.rolling_commission.toLocaleString()]}),e.jsxs("td",{className:"p-3 text-right text-purple-400",children:["₩",s.losing_commission.toLocaleString()]}),e.jsxs("td",{className:"p-3 text-right text-green-400",children:["₩",s.withdrawal_commission.toLocaleString()]}),e.jsx("td",{className:"p-3 text-right",children:s.settlement_type==="integrated"?e.jsxs("div",{children:[e.jsxs("p",{className:"text-orange-400 font-mono",children:["₩",s.net_profit.toLocaleString()]}),e.jsx("p",{className:"text-xs text-slate-500",children:t.settlement.netProfitLabel})]}):e.jsxs("p",{className:"text-orange-400 font-mono",children:["₩",s.commission_amount.toLocaleString()]})}),e.jsx("td",{className:"p-3 text-slate-300 text-sm",children:s.executor_nickname||"-"})]},s.id))})]})})})]})]})}export{ae as SettlementHistory};
