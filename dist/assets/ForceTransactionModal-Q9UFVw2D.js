import{r as b,j as e}from"./react-core-BwkdTuSg.js";import{a as B,u as U,L as N,S as V,p as q,q as z,r as G,t as S,i as A,I as ee,A as se}from"./index-McppjVnx.js";import{P as te,a as ae,b as le}from"./popover-e-C_onM2.js";import{C as ie,a as ne,e as oe,b as re,c as ce,d as de}from"./command-BcDTzi9L.js";import{A as me,a as xe,b as he,c as pe,d as je,e as fe}from"./AdminDialog-D_QT-Qbt.js";import{T as ge,j as be,ai as Ne,l as ue,ag as ve}from"./lucide-icons-CePlpqHy.js";function Ie({open:H,onOpenChange:F,type:i,targetType:j,selectedTarget:w,targets:_=[],onSubmit:O,onTypeChange:R,currentUserLevel:x,currentUserBalance:P=0,currentUserInvestBalance:a=0,currentUserOroplayBalance:n=0}){const{t:Ae}=B(),{useInvestApi:o,useOroplayApi:c}=U(),[u,y]=b.useState(""),[f,h]=b.useState(""),[T,$]=b.useState(""),[k,D]=b.useState(!1),[M,E]=b.useState(!1),W=o?"invest":"oroplay",[r,C]=b.useState(W),J=[1e3,3e3,5e3,1e4,3e4,5e4,1e5,3e5,5e5,1e6],t=w||_.find(s=>s.id===u),v=t?parseFloat(t.balance?.toString()||"0"):0,I=!!w,L=j==="partner"&&x===1&&t?.level===2,K=s=>{const l=parseFloat(f||"0")+s;h(l.toString())},Q=s=>{h(s)},p=parseFloat(f||"0"),g=x===1&&t?.level===2;x===1&&t?.level,x===2&&t?.level;let m="";if(t&&p>0){if(i==="withdrawal")if(g){const s=r==="invest"?t.invest_balance||0:t.oroplay_balance||0;p>s&&(m=`${r==="invest"?"Invest":"OroPlay"} API ì¶œê¸ˆ ê°€ëŠ¥ ê¸ˆì•¡ì„ ì´ˆê³¼í–ˆìŠµë‹ˆë‹¤. (ìµœëŒ€: ${s.toLocaleString()}ì›)`)}else p>v&&(m=`ì¶œê¸ˆ ê°€ëŠ¥ ê¸ˆì•¡ì„ ì´ˆê³¼í–ˆìŠµë‹ˆë‹¤. (ìµœëŒ€: ${v.toLocaleString()}ì›)`);if(i==="deposit")if(x===1&&t?.level===2){const s=r==="invest"?a:n;p>s&&(m=`${r==="invest"?"Invest":"OroPlay"} API ë³´ìœ ê¸ˆì´ ë¶€ì¡±í•©ë‹ˆë‹¤. (ì…ê¸ˆ ê°€ëŠ¥: ${s.toLocaleString()}ì›)`)}else if(x===1){const s=[];o&&s.push(a),c&&s.push(n);const d=s.length>0?Math.min(...s):0;if(p>d){let l="";o&&c?l=a<n?"Invest":"OroPlay":o?l="Invest":l="OroPlay",m=`${l} API ë³´ìœ ê¸ˆì´ ë¶€ì¡±í•©ë‹ˆë‹¤. (ì…ê¸ˆ ê°€ëŠ¥: ${d.toLocaleString()}ì›)`}}else if(x===2){const s=[];o&&a>0&&s.push(a),c&&n>0&&s.push(n);const d=s.length>0?Math.min(...s):0;if(p>d){let l="";o&&c?a>0&&n>0?l=a<n?"Invest":"OroPlay":a>0?l="Invest":l="OroPlay":o&&a>0?l="Invest":c&&n>0&&(l="OroPlay"),m=l?`${l} API ë³´ìœ ê¸ˆì´ ë¶€ì¡±í•©ë‹ˆë‹¤. (ì…ê¸ˆ ê°€ëŠ¥: ${d.toLocaleString()}ì›)`:"ë…¸ì¶œëœ ê²Œì„ì‚¬ì˜ ë³´ìœ ê¸ˆì´ ì—†ìŠµë‹ˆë‹¤."}}else p>P&&(m=`ë³´ìœ ê¸ˆì´ ë¶€ì¡±í•©ë‹ˆë‹¤. (í˜„ì¬: ${P.toLocaleString()}ì›)`)}const X=()=>{h("0")},Y=()=>{if(t&&i==="withdrawal")if(L){const s=r==="invest"?t.invest_balance||0:t.oroplay_balance||0;h(s.toString())}else h(v.toString())},Z=async()=>{const s=w?.id||u;if(!s||m)return;const d=parseFloat(f||"0");if(!(d<=0))try{E(!0),await O({targetId:s,type:i,amount:d,memo:T,apiType:L?r:void 0}),I||y(""),h(""),$(""),C("invest"),F(!1)}catch(l){console.error("ê°•ì œ ì…ì¶œê¸ˆ ì‹¤í–‰ ì˜¤ë¥˜:",l)}finally{E(!1)}};return e.jsx(me,{open:H,onOpenChange:s=>{s||(I||y(""),h(""),$(""),C("invest")),F(s)},children:e.jsxs(xe,{className:"sm:max-w-[550px]",children:[e.jsxs(he,{children:[e.jsx(pe,{className:"flex items-center gap-2",children:i==="deposit"?e.jsxs(e.Fragment,{children:[e.jsx(ge,{className:"h-5 w-5 text-emerald-500"}),"ê°•ì œ ì…ê¸ˆ"]}):e.jsxs(e.Fragment,{children:[e.jsx(be,{className:"h-5 w-5 text-rose-500"}),"ê°•ì œ ì¶œê¸ˆ"]})}),e.jsxs(je,{children:[j==="user"?"íšŒì›":"íŒŒíŠ¸ë„ˆ","ì˜ ì”ì•¡ì„ ì§ì ‘ ì¡°ì •í•©ë‹ˆë‹¤."]})]}),e.jsxs("div",{className:"grid gap-5 py-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(N,{htmlFor:"force-transaction-type",children:"ê±°ë˜ ìœ í˜•"}),e.jsxs(V,{value:i,onValueChange:s=>R(s),children:[e.jsx(q,{id:"force-transaction-type",className:"input-premium h-10",children:e.jsx(z,{})}),e.jsxs(G,{className:"bg-slate-800 border-slate-700",children:[e.jsx(S,{value:"deposit",children:"ì…ê¸ˆ"}),e.jsx(S,{value:"withdrawal",children:"ì¶œê¸ˆ"})]})]})]}),!I&&e.jsxs("div",{className:"grid gap-2",children:[e.jsxs(N,{htmlFor:"force-transaction-target-search",children:[j==="user"?"íšŒì›":"íŒŒíŠ¸ë„ˆ"," ì„ íƒ"]}),e.jsxs(te,{open:k,onOpenChange:D,children:[e.jsx(ae,{asChild:!0,children:e.jsxs(A,{id:"force-transaction-target-search",variant:"outline",role:"combobox","aria-expanded":k,className:"justify-between input-premium h-10",children:[u?`${t?.username} (${t?.nickname}) - ${v.toLocaleString()}ì›`:"ì•„ì´ë””, ë‹‰ë„¤ì„ìœ¼ë¡œ ê²€ìƒ‰",e.jsx(Ne,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),e.jsx(le,{className:"w-[480px] p-0 bg-slate-800 border-slate-700",children:e.jsxs(ie,{className:"bg-slate-800",children:[e.jsx(ne,{placeholder:"ì•„ì´ë””, ë‹‰ë„¤ì„ìœ¼ë¡œ ê²€ìƒ‰...",className:"h-9 text-slate-100 placeholder:text-slate-500"}),e.jsxs(oe,{children:[e.jsxs(re,{className:"text-slate-400 py-6 text-center text-sm",children:[j==="user"?"íšŒì›":"íŒŒíŠ¸ë„ˆ","ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤."]}),e.jsx(ce,{className:"max-h-64 overflow-auto",children:_.map(s=>e.jsxs(de,{value:`${s.username} ${s.nickname}`,onSelect:()=>{y(s.id),D(!1)},className:"flex items-center justify-between cursor-pointer hover:bg-slate-700/50 text-slate-300",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ue,{className:`mr-2 h-4 w-4 ${u===s.id?`opacity-100 ${i==="deposit"?"text-emerald-500":"text-rose-500"}`:"opacity-0"}`}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-slate-100",children:s.username}),e.jsx("div",{className:"text-xs text-slate-400",children:s.nickname})]})]}),e.jsx("div",{className:"text-sm",children:e.jsxs("span",{className:"text-cyan-400 font-mono",children:[parseFloat(s.balance?.toString()||"0").toLocaleString(),"ì›"]})})]},s.id))})]})]})})]})]}),t&&e.jsxs("div",{className:"p-3 bg-slate-800/50 rounded-lg border border-slate-700",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("span",{className:"text-sm text-slate-400",children:["ì„ íƒëœ ",j==="user"?"íšŒì›":"íŒŒíŠ¸ë„ˆ"]}),e.jsx("span",{className:"text-cyan-400 font-medium",children:t.nickname})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm text-slate-400",children:[j==="user"?"íšŒì›":"íŒŒíŠ¸ë„ˆ"," ì”ê³ "]}),e.jsxs("span",{className:"font-mono text-cyan-400",children:[v.toLocaleString(),"ì›"]})]}),t.level===2&&g&&e.jsxs("div",{className:"mt-2 pt-2 border-t border-slate-700 space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs text-slate-400",children:"â”” Invest API:"}),e.jsxs("span",{className:`font-mono text-xs ${r==="invest"?"text-cyan-400":"text-slate-500"}`,children:[(t.invest_balance||0).toLocaleString(),"ì›"]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs text-slate-400",children:"â”” OroPlay API:"}),e.jsxs("span",{className:`font-mono text-xs ${r==="oroplay"?"text-cyan-400":"text-slate-500"}`,children:[(t.oroplay_balance||0).toLocaleString(),"ì›"]})]})]}),t.level===3&&e.jsx("div",{className:"mt-2 pt-2 border-t border-slate-700",children:e.jsx("p",{className:"text-[10px] text-slate-500",children:"â€» Lv3ëŠ” ë‹¨ì¼ ì§€ê°‘(balance)ì„ ì‚¬ìš©í•©ë‹ˆë‹¤."})})]}),i==="deposit"&&e.jsxs("div",{className:"p-3 bg-emerald-900/20 rounded-lg border border-emerald-700/50",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsx("span",{className:"text-sm text-emerald-400",children:"ğŸ’° ê´€ë¦¬ì ë³´ìœ ê¸ˆ (ì…ê¸ˆ ê°€ëŠ¥ ê¸ˆì•¡)"})}),x===1?e.jsxs("div",{className:"space-y-1.5",children:[o&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs text-slate-400",children:"Invest API:"}),e.jsxs("span",{className:`font-mono text-sm ${g&&r==="invest"?"text-emerald-400 font-bold":"text-emerald-400/60"}`,children:[a.toLocaleString(),"ì›"]})]}),c&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs text-slate-400",children:"OroPlay API:"}),e.jsxs("span",{className:`font-mono text-sm ${g&&r==="oroplay"?"text-emerald-400 font-bold":"text-emerald-400/60"}`,children:[n.toLocaleString(),"ì›"]})]}),g?e.jsxs("div",{className:"pt-1.5 mt-1.5 border-t border-emerald-700/30 flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-emerald-400",children:"ì…ê¸ˆ ê°€ëŠ¥ (ì„ íƒí•œ API):"}),e.jsxs("span",{className:"font-mono text-emerald-400 font-bold",children:[(r==="invest"?a:n).toLocaleString(),"ì›"]})]}):e.jsxs("div",{className:"pt-1.5 mt-1.5 border-t border-emerald-700/30 flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-emerald-400",children:"ì…ê¸ˆ ê°€ëŠ¥ (ìµœì†Œê°’):"}),e.jsxs("span",{className:"font-mono text-emerald-400 font-bold",children:[(()=>{const s=[];return o&&s.push(a),c&&s.push(n),s.length>0?Math.min(...s).toLocaleString():"0"})(),"ì›"]})]}),e.jsx("p",{className:"text-xs text-slate-500 mt-2",children:g?"â€» ì„ íƒí•œ API ë³´ìœ ê¸ˆì—ì„œë§Œ ì…ê¸ˆë©ë‹ˆë‹¤.":o&&c?"â€» ë‘ API ì¤‘ ê°€ì¥ ì‘ì€ ë³´ìœ ê¸ˆì„ ê¸°ì¤€ìœ¼ë¡œ ì…ê¸ˆ ì œí•œë©ë‹ˆë‹¤.":"â€» í™œì„±í™”ëœ API ë³´ìœ ê¸ˆì„ ê¸°ì¤€ìœ¼ë¡œ ì…ê¸ˆ ì œí•œë©ë‹ˆë‹¤."})]}):x===2?e.jsxs("div",{className:"space-y-1.5",children:[o&&a>0&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs text-slate-400",children:"Invest API:"}),e.jsxs("span",{className:"font-mono text-sm text-emerald-400",children:[a.toLocaleString(),"ì›"]})]}),c&&n>0&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs text-slate-400",children:"OroPlay API:"}),e.jsxs("span",{className:"font-mono text-sm text-emerald-400",children:[n.toLocaleString(),"ì›"]})]}),e.jsxs("div",{className:"pt-1.5 mt-1.5 border-t border-emerald-700/30 flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-emerald-400",children:"ì…ê¸ˆ ê°€ëŠ¥:"}),e.jsxs("span",{className:"font-mono text-emerald-400 font-bold",children:[(()=>{const s=[];return o&&a>0&&s.push(a),c&&n>0&&s.push(n),s.length>0?Math.min(...s).toLocaleString():"ê³„ì‚° ì—†ìŒ"})(),"ì›"]})]}),e.jsx("p",{className:"text-xs text-slate-500 mt-2",children:"â€» Lv2 ì…ê¸ˆ ì‹œ Lv2 ë¶ˆìš©ê¸ˆì„ í™œìš©í•©ë‹ˆë‹¤."})]}):e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-slate-400",children:"ì‚¬ìš© ê°€ëŠ¥:"}),e.jsxs("span",{className:"font-mono text-emerald-400",children:[P.toLocaleString(),"ì›"]})]})]}),L&&e.jsxs("div",{className:"grid gap-2",children:[e.jsxs(N,{htmlFor:"api-type-select",children:[i==="deposit"?"ì…ê¸ˆí• ":"íšŒìˆ˜í• "," API ì„ íƒ"]}),e.jsxs(V,{value:r,onValueChange:s=>C(s),children:[e.jsx(q,{id:"api-type-select",className:"input-premium h-10",children:e.jsx(z,{})}),e.jsxs(G,{className:"bg-slate-800 border-slate-700",children:[o&&e.jsx(S,{value:"invest",children:"Invest API"}),c&&e.jsx(S,{value:"oroplay",children:"OroPlay API"})]})]}),e.jsx("p",{className:"text-xs text-slate-500",children:i==="deposit"?"ì„ íƒí•œ APIë¡œë§Œ ì…ê¸ˆë©ë‹ˆë‹¤.":"ì„ íƒí•œ APIì˜ ë³´ìœ ê¸ˆì—ì„œë§Œ ì¶œê¸ˆë©ë‹ˆë‹¤."})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(N,{htmlFor:"force-transaction-amount",children:"ê¸ˆì•¡"}),e.jsx(A,{type:"button",variant:"ghost",size:"sm",onClick:X,className:`h-7 px-2 text-xs text-slate-400 ${i==="deposit"?"hover:text-orange-400 hover:bg-orange-500/10":"hover:text-red-400 hover:bg-red-500/10"}`,children:"ì „ì²´ì‚­ì œ"})]}),e.jsx(ee,{id:"force-transaction-amount",name:"amount",type:"number",value:f,onChange:s=>Q(s.target.value),className:"input-premium",placeholder:"ê¸ˆì•¡ì„ ì…ë ¥í•˜ì„¸ìš”"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(N,{className:"text-slate-400 text-sm",children:"ë‹¨ì¶• ì…ë ¥ (ëˆ„ì  ë”í•˜ê¸°)"}),e.jsx("div",{className:"grid grid-cols-4 gap-2",children:J.map(s=>e.jsxs(A,{type:"button",variant:"outline",onClick:()=>K(s),className:`h-9 transition-all bg-slate-800/50 border-slate-700 text-slate-300 ${i==="deposit"?"hover:bg-orange-500/20 hover:border-orange-500/60 hover:text-orange-400 hover:shadow-[0_0_15px_rgba(251,146,60,0.3)]":"hover:bg-red-500/20 hover:border-red-500/60 hover:text-red-400 hover:shadow-[0_0_15px_rgba(239,68,68,0.3)]"}`,children:["+",s>=1e4?`${s/1e4}ë§Œ`:`${s/1e3}ì²œ`]},s))})]}),i==="withdrawal"&&t&&e.jsx("div",{className:"grid gap-2",children:e.jsxs(A,{type:"button",variant:"outline",onClick:Y,className:"w-full h-9 bg-red-900/20 border-red-500/50 text-red-400 hover:bg-red-900/40 hover:border-red-500",children:[e.jsx(ve,{className:"h-4 w-4 mr-2"}),"ì „ì•¡ì¶œê¸ˆ"]})}),m&&e.jsx("div",{className:"p-3 bg-rose-900/20 border border-rose-500/50 rounded-lg",children:e.jsx("p",{className:"text-sm text-rose-400",children:m})}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(N,{htmlFor:"force-transaction-memo",children:"ë©”ëª¨"}),e.jsx(se,{id:"force-transaction-memo",name:"memo",value:T,onChange:s=>$(s.target.value),placeholder:"ë©”ëª¨ë¥¼ ì…ë ¥í•˜ì„¸ìš” (ì„ íƒì‚¬í•­)",className:"input-premium min-h-[80px]"})]})]}),e.jsx(fe,{children:e.jsx(A,{type:"button",onClick:Z,disabled:M||!w?.id&&!u||!f||parseFloat(f)<=0||!!m,className:`w-full ${i==="deposit"?"btn-premium-warning":"btn-premium-danger"}`,children:M?"ì²˜ë¦¬ ì¤‘...":i==="deposit"?"ê°•ì œ ì…ê¸ˆ":"ê°•ì œ ì¶œê¸ˆ"})})]})})}export{Ie as F};
